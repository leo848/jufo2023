var CD=Object.defineProperty;var kD=(t,e,n)=>e in t?CD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var lo=(t,e,n)=>(kD(t,typeof e!="symbol"?e+"":e,n),n);function SD(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const o in s)if(o!=="default"&&!(o in t)){const r=Object.getOwnPropertyDescriptor(s,o);r&&Object.defineProperty(t,o,r.get?r:{enumerable:!0,get:()=>s[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function Kv(t,e){const n=Object.create(null),s=t.split(",");for(let o=0;o<s.length;o++)n[s[o]]=!0;return e?o=>!!n[o.toLowerCase()]:o=>!!n[o]}const Dt={},Ja=[],vo=()=>{},ID=()=>!1,$D=/^on[^a-z]/,Tf=t=>$D.test(t),qv=t=>t.startsWith("onUpdate:"),Qt=Object.assign,Xv=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},TD=Object.prototype.hasOwnProperty,dt=(t,e)=>TD.call(t,e),Be=Array.isArray,el=t=>Nf(t)==="[object Map]",Yk=t=>Nf(t)==="[object Set]",Ze=t=>typeof t=="function",Ht=t=>typeof t=="string",Yv=t=>typeof t=="symbol",Rt=t=>t!==null&&typeof t=="object",Zk=t=>Rt(t)&&Ze(t.then)&&Ze(t.catch),Qk=Object.prototype.toString,Nf=t=>Qk.call(t),ND=t=>Nf(t).slice(8,-1),Jk=t=>Nf(t)==="[object Object]",Zv=t=>Ht(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,ph=Kv(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ef=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},ED=/-(\w)/g,eo=Ef(t=>t.replace(ED,(e,n)=>n?n.toUpperCase():"")),_D=/\B([A-Z])/g,Rl=Ef(t=>t.replace(_D,"-$1").toLowerCase()),Er=Ef(t=>t.charAt(0).toUpperCase()+t.slice(1)),_m=Ef(t=>t?`on${Er(t)}`:""),Ac=(t,e)=>!Object.is(t,e),mh=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},Sh=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},kg=t=>{const e=parseFloat(t);return isNaN(e)?t:e},AD=t=>{const e=Ht(t)?Number(t):NaN;return isNaN(e)?t:e};let Q0;const Sg=()=>Q0||(Q0=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function _f(t){if(Be(t)){const e={};for(let n=0;n<t.length;n++){const s=t[n],o=Ht(s)?OD(s):_f(s);if(o)for(const r in o)e[r]=o[r]}return e}else{if(Ht(t))return t;if(Rt(t))return t}}const RD=/;(?![^(]*\))/g,DD=/:([^]+)/,FD=/\/\*[^]*?\*\//g;function OD(t){const e={};return t.replace(FD,"").split(RD).forEach(n=>{if(n){const s=n.split(DD);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function Qv(t){let e="";if(Ht(t))e=t;else if(Be(t))for(let n=0;n<t.length;n++){const s=Qv(t[n]);s&&(e+=s+" ")}else if(Rt(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const PD="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",MD=Kv(PD);function eS(t){return!!t||t===""}const ts=t=>Ht(t)?t:t==null?"":Be(t)||Rt(t)&&(t.toString===Qk||!Ze(t.toString))?JSON.stringify(t,tS,2):String(t),tS=(t,e)=>e&&e.__v_isRef?tS(t,e.value):el(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[s,o])=>(n[`${s} =>`]=o,n),{})}:Yk(e)?{[`Set(${e.size})`]:[...e.values()]}:Rt(e)&&!Be(e)&&!Jk(e)?String(e):e;let $s;class nS{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=$s,!e&&$s&&(this.index=($s.scopes||($s.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const n=$s;try{return $s=this,e()}finally{$s=n}}}on(){$s=this}off(){$s=this.parent}stop(e){if(this._active){let n,s;for(n=0,s=this.effects.length;n<s;n++)this.effects[n].stop();for(n=0,s=this.cleanups.length;n<s;n++)this.cleanups[n]();if(this.scopes)for(n=0,s=this.scopes.length;n<s;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!e){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0,this._active=!1}}}function Jv(t){return new nS(t)}function LD(t,e=$s){e&&e.active&&e.effects.push(t)}function BD(){return $s}function ms(t){$s&&$s.cleanups.push(t)}const eb=t=>{const e=new Set(t);return e.w=0,e.n=0,e},sS=t=>(t.w&ii)>0,oS=t=>(t.n&ii)>0,VD=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=ii},zD=t=>{const{deps:e}=t;if(e.length){let n=0;for(let s=0;s<e.length;s++){const o=e[s];sS(o)&&!oS(o)?o.delete(t):e[n++]=o,o.w&=~ii,o.n&=~ii}e.length=n}},Ih=new WeakMap;let pc=0,ii=1;const Ig=30;let po;const Xi=Symbol(""),$g=Symbol("");class tb{constructor(e,n=null,s){this.fn=e,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,LD(this,s)}run(){if(!this.active)return this.fn();let e=po,n=Jr;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=po,po=this,Jr=!0,ii=1<<++pc,pc<=Ig?VD(this):J0(this),this.fn()}finally{pc<=Ig&&zD(this),ii=1<<--pc,po=this.parent,Jr=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){po===this?this.deferStop=!0:this.active&&(J0(this),this.onStop&&this.onStop(),this.active=!1)}}function J0(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Jr=!0;const rS=[];function Dl(){rS.push(Jr),Jr=!1}function Fl(){const t=rS.pop();Jr=t===void 0?!0:t}function gs(t,e,n){if(Jr&&po){let s=Ih.get(t);s||Ih.set(t,s=new Map);let o=s.get(n);o||s.set(n,o=eb()),iS(o)}}function iS(t,e){let n=!1;pc<=Ig?oS(t)||(t.n|=ii,n=!sS(t)):n=!t.has(po),n&&(t.add(po),po.deps.push(t))}function xr(t,e,n,s,o,r){const i=Ih.get(t);if(!i)return;let a=[];if(e==="clear")a=[...i.values()];else if(n==="length"&&Be(t)){const l=Number(s);i.forEach((c,u)=>{(u==="length"||u>=l)&&a.push(c)})}else switch(n!==void 0&&a.push(i.get(n)),e){case"add":Be(t)?Zv(n)&&a.push(i.get("length")):(a.push(i.get(Xi)),el(t)&&a.push(i.get($g)));break;case"delete":Be(t)||(a.push(i.get(Xi)),el(t)&&a.push(i.get($g)));break;case"set":el(t)&&a.push(i.get(Xi));break}if(a.length===1)a[0]&&Tg(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);Tg(eb(l))}}function Tg(t,e){const n=Be(t)?t:[...t];for(const s of n)s.computed&&e1(s);for(const s of n)s.computed||e1(s)}function e1(t,e){(t!==po||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}function WD(t,e){var n;return(n=Ih.get(t))==null?void 0:n.get(e)}const UD=Kv("__proto__,__v_isRef,__isVue"),aS=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Yv)),GD=nb(),HD=nb(!1,!0),jD=nb(!0),t1=KD();function KD(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...n){const s=Qe(this);for(let r=0,i=this.length;r<i;r++)gs(s,"get",r+"");const o=s[e](...n);return o===-1||o===!1?s[e](...n.map(Qe)):o}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...n){Dl();const s=Qe(this)[e].apply(this,n);return Fl(),s}}),t}function qD(t){const e=Qe(this);return gs(e,"has",t),e.hasOwnProperty(t)}function nb(t=!1,e=!1){return function(s,o,r){if(o==="__v_isReactive")return!t;if(o==="__v_isReadonly")return t;if(o==="__v_isShallow")return e;if(o==="__v_raw"&&r===(t?e?uF:hS:e?dS:uS).get(s))return s;const i=Be(s);if(!t){if(i&&dt(t1,o))return Reflect.get(t1,o,r);if(o==="hasOwnProperty")return qD}const a=Reflect.get(s,o,r);return(Yv(o)?aS.has(o):UD(o))||(t||gs(s,"get",o),e)?a:Vt(a)?i&&Zv(o)?a:a.value:Rt(a)?t?cu(a):Jn(a):a}}const XD=lS(),YD=lS(!0);function lS(t=!1){return function(n,s,o,r){let i=n[s];if(ul(i)&&Vt(i)&&!Vt(o))return!1;if(!t&&(!$h(o)&&!ul(o)&&(i=Qe(i),o=Qe(o)),!Be(n)&&Vt(i)&&!Vt(o)))return i.value=o,!0;const a=Be(n)&&Zv(s)?Number(s)<n.length:dt(n,s),l=Reflect.set(n,s,o,r);return n===Qe(r)&&(a?Ac(o,i)&&xr(n,"set",s,o):xr(n,"add",s,o)),l}}function ZD(t,e){const n=dt(t,e);t[e];const s=Reflect.deleteProperty(t,e);return s&&n&&xr(t,"delete",e,void 0),s}function QD(t,e){const n=Reflect.has(t,e);return(!Yv(e)||!aS.has(e))&&gs(t,"has",e),n}function JD(t){return gs(t,"iterate",Be(t)?"length":Xi),Reflect.ownKeys(t)}const cS={get:GD,set:XD,deleteProperty:ZD,has:QD,ownKeys:JD},eF={get:jD,set(t,e){return!0},deleteProperty(t,e){return!0}},tF=Qt({},cS,{get:HD,set:YD}),sb=t=>t,Af=t=>Reflect.getPrototypeOf(t);function Ud(t,e,n=!1,s=!1){t=t.__v_raw;const o=Qe(t),r=Qe(e);n||(e!==r&&gs(o,"get",e),gs(o,"get",r));const{has:i}=Af(o),a=s?sb:n?ib:Rc;if(i.call(o,e))return a(t.get(e));if(i.call(o,r))return a(t.get(r));t!==o&&t.get(e)}function Gd(t,e=!1){const n=this.__v_raw,s=Qe(n),o=Qe(t);return e||(t!==o&&gs(s,"has",t),gs(s,"has",o)),t===o?n.has(t):n.has(t)||n.has(o)}function Hd(t,e=!1){return t=t.__v_raw,!e&&gs(Qe(t),"iterate",Xi),Reflect.get(t,"size",t)}function n1(t){t=Qe(t);const e=Qe(this);return Af(e).has.call(e,t)||(e.add(t),xr(e,"add",t,t)),this}function s1(t,e){e=Qe(e);const n=Qe(this),{has:s,get:o}=Af(n);let r=s.call(n,t);r||(t=Qe(t),r=s.call(n,t));const i=o.call(n,t);return n.set(t,e),r?Ac(e,i)&&xr(n,"set",t,e):xr(n,"add",t,e),this}function o1(t){const e=Qe(this),{has:n,get:s}=Af(e);let o=n.call(e,t);o||(t=Qe(t),o=n.call(e,t)),s&&s.call(e,t);const r=e.delete(t);return o&&xr(e,"delete",t,void 0),r}function r1(){const t=Qe(this),e=t.size!==0,n=t.clear();return e&&xr(t,"clear",void 0,void 0),n}function jd(t,e){return function(s,o){const r=this,i=r.__v_raw,a=Qe(i),l=e?sb:t?ib:Rc;return!t&&gs(a,"iterate",Xi),i.forEach((c,u)=>s.call(o,l(c),l(u),r))}}function Kd(t,e,n){return function(...s){const o=this.__v_raw,r=Qe(o),i=el(r),a=t==="entries"||t===Symbol.iterator&&i,l=t==="keys"&&i,c=o[t](...s),u=n?sb:e?ib:Rc;return!e&&gs(r,"iterate",l?$g:Xi),{next(){const{value:d,done:h}=c.next();return h?{value:d,done:h}:{value:a?[u(d[0]),u(d[1])]:u(d),done:h}},[Symbol.iterator](){return this}}}}function Lr(t){return function(...e){return t==="delete"?!1:this}}function nF(){const t={get(r){return Ud(this,r)},get size(){return Hd(this)},has:Gd,add:n1,set:s1,delete:o1,clear:r1,forEach:jd(!1,!1)},e={get(r){return Ud(this,r,!1,!0)},get size(){return Hd(this)},has:Gd,add:n1,set:s1,delete:o1,clear:r1,forEach:jd(!1,!0)},n={get(r){return Ud(this,r,!0)},get size(){return Hd(this,!0)},has(r){return Gd.call(this,r,!0)},add:Lr("add"),set:Lr("set"),delete:Lr("delete"),clear:Lr("clear"),forEach:jd(!0,!1)},s={get(r){return Ud(this,r,!0,!0)},get size(){return Hd(this,!0)},has(r){return Gd.call(this,r,!0)},add:Lr("add"),set:Lr("set"),delete:Lr("delete"),clear:Lr("clear"),forEach:jd(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=Kd(r,!1,!1),n[r]=Kd(r,!0,!1),e[r]=Kd(r,!1,!0),s[r]=Kd(r,!0,!0)}),[t,n,e,s]}const[sF,oF,rF,iF]=nF();function ob(t,e){const n=e?t?iF:rF:t?oF:sF;return(s,o,r)=>o==="__v_isReactive"?!t:o==="__v_isReadonly"?t:o==="__v_raw"?s:Reflect.get(dt(n,o)&&o in s?n:s,o,r)}const aF={get:ob(!1,!1)},lF={get:ob(!1,!0)},cF={get:ob(!0,!1)},uS=new WeakMap,dS=new WeakMap,hS=new WeakMap,uF=new WeakMap;function dF(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hF(t){return t.__v_skip||!Object.isExtensible(t)?0:dF(ND(t))}function Jn(t){return ul(t)?t:rb(t,!1,cS,aF,uS)}function fS(t){return rb(t,!1,tF,lF,dS)}function cu(t){return rb(t,!0,eF,cF,hS)}function rb(t,e,n,s,o){if(!Rt(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const r=o.get(t);if(r)return r;const i=hF(t);if(i===0)return t;const a=new Proxy(t,i===2?s:n);return o.set(t,a),a}function tl(t){return ul(t)?tl(t.__v_raw):!!(t&&t.__v_isReactive)}function ul(t){return!!(t&&t.__v_isReadonly)}function $h(t){return!!(t&&t.__v_isShallow)}function pS(t){return tl(t)||ul(t)}function Qe(t){const e=t&&t.__v_raw;return e?Qe(e):t}function mS(t){return Sh(t,"__v_skip",!0),t}const Rc=t=>Rt(t)?Jn(t):t,ib=t=>Rt(t)?cu(t):t;function gS(t){Jr&&po&&(t=Qe(t),iS(t.dep||(t.dep=eb())))}function vS(t,e){t=Qe(t);const n=t.dep;n&&Tg(n)}function Vt(t){return!!(t&&t.__v_isRef===!0)}function _e(t){return bS(t,!1)}function He(t){return bS(t,!0)}function bS(t,e){return Vt(t)?t:new fF(t,e)}class fF{constructor(e,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?e:Qe(e),this._value=n?e:Rc(e)}get value(){return gS(this),this._value}set value(e){const n=this.__v_isShallow||$h(e)||ul(e);e=n?e:Qe(e),Ac(e,this._rawValue)&&(this._rawValue=e,this._value=n?e:Rc(e),vS(this))}}function hs(t){return Vt(t)?t.value:t}const pF={get:(t,e,n)=>hs(Reflect.get(t,e,n)),set:(t,e,n,s)=>{const o=t[e];return Vt(o)&&!Vt(n)?(o.value=n,!0):Reflect.set(t,e,n,s)}};function yS(t){return tl(t)?t:new Proxy(t,pF)}function ab(t){const e=Be(t)?new Array(t.length):{};for(const n in t)e[n]=xS(t,n);return e}class mF{constructor(e,n,s){this._object=e,this._key=n,this._defaultValue=s,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return WD(Qe(this._object),this._key)}}class gF{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function Pe(t,e,n){return Vt(t)?t:Ze(t)?new gF(t):Rt(t)&&arguments.length>1?xS(t,e,n):_e(t)}function xS(t,e,n){const s=t[e];return Vt(s)?s:new mF(t,e,n)}class vF{constructor(e,n,s,o){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new tb(e,()=>{this._dirty||(this._dirty=!0,vS(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!o,this.__v_isReadonly=s}get value(){const e=Qe(this);return gS(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function bF(t,e,n=!1){let s,o;const r=Ze(t);return r?(s=t,o=vo):(s=t.get,o=t.set),new vF(s,o,r||!o,n)}function ei(t,e,n,s){let o;try{o=s?t(...s):t()}catch(r){Rf(r,e,n)}return o}function Qs(t,e,n,s){if(Ze(t)){const r=ei(t,e,n,s);return r&&Zk(r)&&r.catch(i=>{Rf(i,e,n)}),r}const o=[];for(let r=0;r<t.length;r++)o.push(Qs(t[r],e,n,s));return o}function Rf(t,e,n,s=!0){const o=e?e.vnode:null;if(e){let r=e.parent;const i=e.proxy,a=n;for(;r;){const c=r.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](t,i,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){ei(l,null,10,[t,i,a]);return}}yF(t,n,o,s)}function yF(t,e,n,s=!0){console.error(t)}let Dc=!1,Ng=!1;const Vn=[];let Go=0;const nl=[];let pr=null,Bi=0;const wS=Promise.resolve();let lb=null;function gn(t){const e=lb||wS;return t?e.then(this?t.bind(this):t):e}function xF(t){let e=Go+1,n=Vn.length;for(;e<n;){const s=e+n>>>1;Fc(Vn[s])<t?e=s+1:n=s}return e}function cb(t){(!Vn.length||!Vn.includes(t,Dc&&t.allowRecurse?Go+1:Go))&&(t.id==null?Vn.push(t):Vn.splice(xF(t.id),0,t),CS())}function CS(){!Dc&&!Ng&&(Ng=!0,lb=wS.then(SS))}function wF(t){const e=Vn.indexOf(t);e>Go&&Vn.splice(e,1)}function CF(t){Be(t)?nl.push(...t):(!pr||!pr.includes(t,t.allowRecurse?Bi+1:Bi))&&nl.push(t),CS()}function i1(t,e=Dc?Go+1:0){for(;e<Vn.length;e++){const n=Vn[e];n&&n.pre&&(Vn.splice(e,1),e--,n())}}function kS(t){if(nl.length){const e=[...new Set(nl)];if(nl.length=0,pr){pr.push(...e);return}for(pr=e,pr.sort((n,s)=>Fc(n)-Fc(s)),Bi=0;Bi<pr.length;Bi++)pr[Bi]();pr=null,Bi=0}}const Fc=t=>t.id==null?1/0:t.id,kF=(t,e)=>{const n=Fc(t)-Fc(e);if(n===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function SS(t){Ng=!1,Dc=!0,Vn.sort(kF);const e=vo;try{for(Go=0;Go<Vn.length;Go++){const n=Vn[Go];n&&n.active!==!1&&ei(n,null,14)}}finally{Go=0,Vn.length=0,kS(),Dc=!1,lb=null,(Vn.length||nl.length)&&SS()}}function SF(t,e,...n){if(t.isUnmounted)return;const s=t.vnode.props||Dt;let o=n;const r=e.startsWith("update:"),i=r&&e.slice(7);if(i&&i in s){const u=`${i==="modelValue"?"model":i}Modifiers`,{number:d,trim:h}=s[u]||Dt;h&&(o=n.map(f=>Ht(f)?f.trim():f)),d&&(o=n.map(kg))}let a,l=s[a=_m(e)]||s[a=_m(eo(e))];!l&&r&&(l=s[a=_m(Rl(e))]),l&&Qs(l,t,6,o);const c=s[a+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[a])return;t.emitted[a]=!0,Qs(c,t,6,o)}}function IS(t,e,n=!1){const s=e.emitsCache,o=s.get(t);if(o!==void 0)return o;const r=t.emits;let i={},a=!1;if(!Ze(t)){const l=c=>{const u=IS(c,e,!0);u&&(a=!0,Qt(i,u))};!n&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!r&&!a?(Rt(t)&&s.set(t,null),null):(Be(r)?r.forEach(l=>i[l]=null):Qt(i,r),Rt(t)&&s.set(t,i),i)}function Df(t,e){return!t||!Tf(e)?!1:(e=e.slice(2).replace(/Once$/,""),dt(t,e[0].toLowerCase()+e.slice(1))||dt(t,Rl(e))||dt(t,e))}let Es=null,Ff=null;function Th(t){const e=Es;return Es=t,Ff=t&&t.type.__scopeId||null,e}function IF(t){Ff=t}function $F(){Ff=null}function pe(t,e=Es,n){if(!e||t._n)return t;const s=(...o)=>{s._d&&y1(-1);const r=Th(e);let i;try{i=t(...o)}finally{Th(r),s._d&&y1(1)}return i};return s._n=!0,s._c=!0,s._d=!0,s}function Am(t){const{type:e,vnode:n,proxy:s,withProxy:o,props:r,propsOptions:[i],slots:a,attrs:l,emit:c,render:u,renderCache:d,data:h,setupState:f,ctx:p,inheritAttrs:m}=t;let g,v;const b=Th(t);try{if(n.shapeFlag&4){const x=o||s;g=Vo(u.call(x,x,d,r,f,h,p)),v=l}else{const x=e;g=Vo(x.length>1?x(r,{attrs:l,slots:a,emit:c}):x(r,null)),v=e.props?l:TF(l)}}catch(x){Ic.length=0,Rf(x,t,1),g=I(bo)}let y=g;if(v&&m!==!1){const x=Object.keys(v),{shapeFlag:w}=y;x.length&&w&7&&(i&&x.some(qv)&&(v=NF(v,i)),y=wr(y,v))}return n.dirs&&(y=wr(y),y.dirs=y.dirs?y.dirs.concat(n.dirs):n.dirs),n.transition&&(y.transition=n.transition),g=y,Th(b),g}const TF=t=>{let e;for(const n in t)(n==="class"||n==="style"||Tf(n))&&((e||(e={}))[n]=t[n]);return e},NF=(t,e)=>{const n={};for(const s in t)(!qv(s)||!(s.slice(9)in e))&&(n[s]=t[s]);return n};function EF(t,e,n){const{props:s,children:o,component:r}=t,{props:i,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return s?a1(s,i,c):!!i;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const h=u[d];if(i[h]!==s[h]&&!Df(c,h))return!0}}}else return(o||a)&&(!a||!a.$stable)?!0:s===i?!1:s?i?a1(s,i,c):!0:!!i;return!1}function a1(t,e,n){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let o=0;o<s.length;o++){const r=s[o];if(e[r]!==t[r]&&!Df(n,r))return!0}return!1}function _F({vnode:t,parent:e},n){for(;e&&e.subTree===t;)(t=e.vnode).el=n,e=e.parent}const AF=t=>t.__isSuspense;function RF(t,e){e&&e.pendingBranch?Be(t)?e.effects.push(...t):e.effects.push(t):CF(t)}function To(t,e){return ub(t,null,e)}const qd={};function ze(t,e,n){return ub(t,e,n)}function ub(t,e,{immediate:n,deep:s,flush:o,onTrack:r,onTrigger:i}=Dt){var a;const l=BD()===((a=kn)==null?void 0:a.scope)?kn:null;let c,u=!1,d=!1;if(Vt(t)?(c=()=>t.value,u=$h(t)):tl(t)?(c=()=>t,s=!0):Be(t)?(d=!0,u=t.some(x=>tl(x)||$h(x)),c=()=>t.map(x=>{if(Vt(x))return x.value;if(tl(x))return Hi(x);if(Ze(x))return ei(x,l,2)})):Ze(t)?e?c=()=>ei(t,l,2):c=()=>{if(!(l&&l.isUnmounted))return h&&h(),Qs(t,l,3,[f])}:c=vo,e&&s){const x=c;c=()=>Hi(x())}let h,f=x=>{h=b.onStop=()=>{ei(x,l,4)}},p;if(Lc)if(f=vo,e?n&&Qs(e,l,3,[c(),d?[]:void 0,f]):c(),o==="sync"){const x=kO();p=x.__watcherHandles||(x.__watcherHandles=[])}else return vo;let m=d?new Array(t.length).fill(qd):qd;const g=()=>{if(!!b.active)if(e){const x=b.run();(s||u||(d?x.some((w,k)=>Ac(w,m[k])):Ac(x,m)))&&(h&&h(),Qs(e,l,3,[x,m===qd?void 0:d&&m[0]===qd?[]:m,f]),m=x)}else b.run()};g.allowRecurse=!!e;let v;o==="sync"?v=g:o==="post"?v=()=>cs(g,l&&l.suspense):(g.pre=!0,l&&(g.id=l.uid),v=()=>cb(g));const b=new tb(c,v);e?n?g():m=b.run():o==="post"?cs(b.run.bind(b),l&&l.suspense):b.run();const y=()=>{b.stop(),l&&l.scope&&Xv(l.scope.effects,b)};return p&&p.push(y),y}function DF(t,e,n){const s=this.proxy,o=Ht(t)?t.includes(".")?$S(s,t):()=>s[t]:t.bind(s,s);let r;Ze(e)?r=e:(r=e.handler,n=e);const i=kn;dl(this);const a=ub(o,r.bind(s),n);return i?dl(i):Yi(),a}function $S(t,e){const n=e.split(".");return()=>{let s=t;for(let o=0;o<n.length&&s;o++)s=s[n[o]];return s}}function Hi(t,e){if(!Rt(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),Vt(t))Hi(t.value,e);else if(Be(t))for(let n=0;n<t.length;n++)Hi(t[n],e);else if(Yk(t)||el(t))t.forEach(n=>{Hi(n,e)});else if(Jk(t))for(const n in t)Hi(t[n],e);return t}function $n(t,e){const n=Es;if(n===null)return t;const s=Bf(n)||n.proxy,o=t.dirs||(t.dirs=[]);for(let r=0;r<e.length;r++){let[i,a,l,c=Dt]=e[r];i&&(Ze(i)&&(i={mounted:i,updated:i}),i.deep&&Hi(a),o.push({dir:i,instance:s,value:a,oldValue:void 0,arg:l,modifiers:c}))}return t}function Ai(t,e,n,s){const o=t.dirs,r=e&&e.dirs;for(let i=0;i<o.length;i++){const a=o[i];r&&(a.oldValue=r[i].value);let l=a.dir[s];l&&(Dl(),Qs(l,n,8,[t.el,a,t,e]),Fl())}}function TS(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ir(()=>{t.isMounted=!0}),oo(()=>{t.isUnmounting=!0}),t}const Ls=[Function,Array],NS={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ls,onEnter:Ls,onAfterEnter:Ls,onEnterCancelled:Ls,onBeforeLeave:Ls,onLeave:Ls,onAfterLeave:Ls,onLeaveCancelled:Ls,onBeforeAppear:Ls,onAppear:Ls,onAfterAppear:Ls,onAppearCancelled:Ls},FF={name:"BaseTransition",props:NS,setup(t,{slots:e}){const n=xb(),s=TS();let o;return()=>{const r=e.default&&db(e.default(),!0);if(!r||!r.length)return;let i=r[0];if(r.length>1){for(const m of r)if(m.type!==bo){i=m;break}}const a=Qe(t),{mode:l}=a;if(s.isLeaving)return Rm(i);const c=l1(i);if(!c)return Rm(i);const u=Oc(c,a,s,n);Pc(c,u);const d=n.subTree,h=d&&l1(d);let f=!1;const{getTransitionKey:p}=c.type;if(p){const m=p();o===void 0?o=m:m!==o&&(o=m,f=!0)}if(h&&h.type!==bo&&(!Vi(c,h)||f)){const m=Oc(h,a,s,n);if(Pc(h,m),l==="out-in")return s.isLeaving=!0,m.afterLeave=()=>{s.isLeaving=!1,n.update.active!==!1&&n.update()},Rm(i);l==="in-out"&&c.type!==bo&&(m.delayLeave=(g,v,b)=>{const y=ES(s,h);y[String(h.key)]=h,g._leaveCb=()=>{v(),g._leaveCb=void 0,delete u.delayedLeave},u.delayedLeave=b})}return i}}},OF=FF;function ES(t,e){const{leavingVNodes:n}=t;let s=n.get(e.type);return s||(s=Object.create(null),n.set(e.type,s)),s}function Oc(t,e,n,s){const{appear:o,mode:r,persisted:i=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:c,onEnterCancelled:u,onBeforeLeave:d,onLeave:h,onAfterLeave:f,onLeaveCancelled:p,onBeforeAppear:m,onAppear:g,onAfterAppear:v,onAppearCancelled:b}=e,y=String(t.key),x=ES(n,t),w=(C,$)=>{C&&Qs(C,s,9,$)},k=(C,$)=>{const T=$[1];w(C,$),Be(C)?C.every(E=>E.length<=1)&&T():C.length<=1&&T()},S={mode:r,persisted:i,beforeEnter(C){let $=a;if(!n.isMounted)if(o)$=m||a;else return;C._leaveCb&&C._leaveCb(!0);const T=x[y];T&&Vi(t,T)&&T.el._leaveCb&&T.el._leaveCb(),w($,[C])},enter(C){let $=l,T=c,E=u;if(!n.isMounted)if(o)$=g||l,T=v||c,E=b||u;else return;let _=!1;const A=C._enterCb=O=>{_||(_=!0,O?w(E,[C]):w(T,[C]),S.delayedLeave&&S.delayedLeave(),C._enterCb=void 0)};$?k($,[C,A]):A()},leave(C,$){const T=String(t.key);if(C._enterCb&&C._enterCb(!0),n.isUnmounting)return $();w(d,[C]);let E=!1;const _=C._leaveCb=A=>{E||(E=!0,$(),A?w(p,[C]):w(f,[C]),C._leaveCb=void 0,x[T]===t&&delete x[T])};x[T]=t,h?k(h,[C,_]):_()},clone(C){return Oc(C,e,n,s)}};return S}function Rm(t){if(Of(t))return t=wr(t),t.children=null,t}function l1(t){return Of(t)?t.children?t.children[0]:void 0:t}function Pc(t,e){t.shapeFlag&6&&t.component?Pc(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function db(t,e=!1,n){let s=[],o=0;for(let r=0;r<t.length;r++){let i=t[r];const a=n==null?i.key:String(n)+String(i.key!=null?i.key:r);i.type===ot?(i.patchFlag&128&&o++,s=s.concat(db(i.children,e,a))):(e||i.type!==bo)&&s.push(a!=null?wr(i,{key:a}):i)}if(o>1)for(let r=0;r<s.length;r++)s[r].patchFlag=-2;return s}function hb(t,e){return Ze(t)?(()=>Qt({name:t.name},e,{setup:t}))():t}const gh=t=>!!t.type.__asyncLoader,Of=t=>t.type.__isKeepAlive;function _S(t,e){RS(t,"a",e)}function AS(t,e){RS(t,"da",e)}function RS(t,e,n=kn){const s=t.__wdc||(t.__wdc=()=>{let o=n;for(;o;){if(o.isDeactivated)return;o=o.parent}return t()});if(Pf(e,s,n),n){let o=n.parent;for(;o&&o.parent;)Of(o.parent.vnode)&&PF(s,e,n,o),o=o.parent}}function PF(t,e,n,s){const o=Pf(e,t,s,!0);FS(()=>{Xv(s[e],o)},n)}function Pf(t,e,n=kn,s=!1){if(n){const o=n[t]||(n[t]=[]),r=e.__weh||(e.__weh=(...i)=>{if(n.isUnmounted)return;Dl(),dl(n);const a=Qs(e,n,t,i);return Yi(),Fl(),a});return s?o.unshift(r):o.push(r),r}}const _r=t=>(e,n=kn)=>(!Lc||t==="sp")&&Pf(t,(...s)=>e(...s),n),fb=_r("bm"),ir=_r("m"),MF=_r("bu"),DS=_r("u"),oo=_r("bum"),FS=_r("um"),LF=_r("sp"),BF=_r("rtg"),VF=_r("rtc");function zF(t,e=kn){Pf("ec",t,e)}const pb="components",WF="directives";function Ln(t,e){return mb(pb,t,!0,e)||t}const OS=Symbol.for("v-ndc");function UF(t){return Ht(t)?mb(pb,t,!1)||t:t||OS}function ar(t){return mb(WF,t)}function mb(t,e,n=!0,s=!1){const o=Es||kn;if(o){const r=o.type;if(t===pb){const a=xO(r,!1);if(a&&(a===e||a===eo(e)||a===Er(eo(e))))return r}const i=c1(o[t]||r[t],e)||c1(o.appContext[t],e);return!i&&s?r:i}}function c1(t,e){return t&&(t[e]||t[eo(e)]||t[Er(eo(e))])}function Mf(t,e,n,s){let o;const r=n&&n[s];if(Be(t)||Ht(t)){o=new Array(t.length);for(let i=0,a=t.length;i<a;i++)o[i]=e(t[i],i,void 0,r&&r[i])}else if(typeof t=="number"){o=new Array(t);for(let i=0;i<t;i++)o[i]=e(i+1,i,void 0,r&&r[i])}else if(Rt(t))if(t[Symbol.iterator])o=Array.from(t,(i,a)=>e(i,a,void 0,r&&r[a]));else{const i=Object.keys(t);o=new Array(i.length);for(let a=0,l=i.length;a<l;a++){const c=i[a];o[a]=e(t[c],c,a,r&&r[a])}}else o=[];return n&&(n[s]=o),o}const Eg=t=>t?jS(t)?Bf(t)||t.proxy:Eg(t.parent):null,kc=Qt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Eg(t.parent),$root:t=>Eg(t.root),$emit:t=>t.emit,$options:t=>gb(t),$forceUpdate:t=>t.f||(t.f=()=>cb(t.update)),$nextTick:t=>t.n||(t.n=gn.bind(t.proxy)),$watch:t=>DF.bind(t)}),Dm=(t,e)=>t!==Dt&&!t.__isScriptSetup&&dt(t,e),GF={get({_:t},e){const{ctx:n,setupState:s,data:o,props:r,accessCache:i,type:a,appContext:l}=t;let c;if(e[0]!=="$"){const f=i[e];if(f!==void 0)switch(f){case 1:return s[e];case 2:return o[e];case 4:return n[e];case 3:return r[e]}else{if(Dm(s,e))return i[e]=1,s[e];if(o!==Dt&&dt(o,e))return i[e]=2,o[e];if((c=t.propsOptions[0])&&dt(c,e))return i[e]=3,r[e];if(n!==Dt&&dt(n,e))return i[e]=4,n[e];_g&&(i[e]=0)}}const u=kc[e];let d,h;if(u)return e==="$attrs"&&gs(t,"get",e),u(t);if((d=a.__cssModules)&&(d=d[e]))return d;if(n!==Dt&&dt(n,e))return i[e]=4,n[e];if(h=l.config.globalProperties,dt(h,e))return h[e]},set({_:t},e,n){const{data:s,setupState:o,ctx:r}=t;return Dm(o,e)?(o[e]=n,!0):s!==Dt&&dt(s,e)?(s[e]=n,!0):dt(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(r[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:s,appContext:o,propsOptions:r}},i){let a;return!!n[i]||t!==Dt&&dt(t,i)||Dm(e,i)||(a=r[0])&&dt(a,i)||dt(s,i)||dt(kc,i)||dt(o.config.globalProperties,i)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:dt(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function u1(t){return Be(t)?t.reduce((e,n)=>(e[n]=null,e),{}):t}let _g=!0;function HF(t){const e=gb(t),n=t.proxy,s=t.ctx;_g=!1,e.beforeCreate&&d1(e.beforeCreate,t,"bc");const{data:o,computed:r,methods:i,watch:a,provide:l,inject:c,created:u,beforeMount:d,mounted:h,beforeUpdate:f,updated:p,activated:m,deactivated:g,beforeDestroy:v,beforeUnmount:b,destroyed:y,unmounted:x,render:w,renderTracked:k,renderTriggered:S,errorCaptured:C,serverPrefetch:$,expose:T,inheritAttrs:E,components:_,directives:A,filters:O}=e;if(c&&jF(c,s,null),i)for(const V in i){const D=i[V];Ze(D)&&(s[V]=D.bind(n))}if(o){const V=o.call(n,n);Rt(V)&&(t.data=Jn(V))}if(_g=!0,r)for(const V in r){const D=r[V],U=Ze(D)?D.bind(n,n):Ze(D.get)?D.get.bind(n,n):vo,J=!Ze(D)&&Ze(D.set)?D.set.bind(n):vo,X=M({get:U,set:J});Object.defineProperty(s,V,{enumerable:!0,configurable:!0,get:()=>X.value,set:te=>X.value=te})}if(a)for(const V in a)PS(a[V],s,n,V);if(l){const V=Ze(l)?l.call(n):l;Reflect.ownKeys(V).forEach(D=>{vn(D,V[D])})}u&&d1(u,t,"c");function F(V,D){Be(D)?D.forEach(U=>V(U.bind(n))):D&&V(D.bind(n))}if(F(fb,d),F(ir,h),F(MF,f),F(DS,p),F(_S,m),F(AS,g),F(zF,C),F(VF,k),F(BF,S),F(oo,b),F(FS,x),F(LF,$),Be(T))if(T.length){const V=t.exposed||(t.exposed={});T.forEach(D=>{Object.defineProperty(V,D,{get:()=>n[D],set:U=>n[D]=U})})}else t.exposed||(t.exposed={});w&&t.render===vo&&(t.render=w),E!=null&&(t.inheritAttrs=E),_&&(t.components=_),A&&(t.directives=A)}function jF(t,e,n=vo){Be(t)&&(t=Ag(t));for(const s in t){const o=t[s];let r;Rt(o)?"default"in o?r=vt(o.from||s,o.default,!0):r=vt(o.from||s):r=vt(o),Vt(r)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>r.value,set:i=>r.value=i}):e[s]=r}}function d1(t,e,n){Qs(Be(t)?t.map(s=>s.bind(e.proxy)):t.bind(e.proxy),e,n)}function PS(t,e,n,s){const o=s.includes(".")?$S(n,s):()=>n[s];if(Ht(t)){const r=e[t];Ze(r)&&ze(o,r)}else if(Ze(t))ze(o,t.bind(n));else if(Rt(t))if(Be(t))t.forEach(r=>PS(r,e,n,s));else{const r=Ze(t.handler)?t.handler.bind(n):e[t.handler];Ze(r)&&ze(o,r,t)}}function gb(t){const e=t.type,{mixins:n,extends:s}=e,{mixins:o,optionsCache:r,config:{optionMergeStrategies:i}}=t.appContext,a=r.get(e);let l;return a?l=a:!o.length&&!n&&!s?l=e:(l={},o.length&&o.forEach(c=>Nh(l,c,i,!0)),Nh(l,e,i)),Rt(e)&&r.set(e,l),l}function Nh(t,e,n,s=!1){const{mixins:o,extends:r}=e;r&&Nh(t,r,n,!0),o&&o.forEach(i=>Nh(t,i,n,!0));for(const i in e)if(!(s&&i==="expose")){const a=KF[i]||n&&n[i];t[i]=a?a(t[i],e[i]):e[i]}return t}const KF={data:h1,props:f1,emits:f1,methods:mc,computed:mc,beforeCreate:Xn,created:Xn,beforeMount:Xn,mounted:Xn,beforeUpdate:Xn,updated:Xn,beforeDestroy:Xn,beforeUnmount:Xn,destroyed:Xn,unmounted:Xn,activated:Xn,deactivated:Xn,errorCaptured:Xn,serverPrefetch:Xn,components:mc,directives:mc,watch:XF,provide:h1,inject:qF};function h1(t,e){return e?t?function(){return Qt(Ze(t)?t.call(this,this):t,Ze(e)?e.call(this,this):e)}:e:t}function qF(t,e){return mc(Ag(t),Ag(e))}function Ag(t){if(Be(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function Xn(t,e){return t?[...new Set([].concat(t,e))]:e}function mc(t,e){return t?Qt(Object.create(null),t,e):e}function f1(t,e){return t?Be(t)&&Be(e)?[...new Set([...t,...e])]:Qt(Object.create(null),u1(t),u1(e!=null?e:{})):e}function XF(t,e){if(!t)return e;if(!e)return t;const n=Qt(Object.create(null),t);for(const s in e)n[s]=Xn(t[s],e[s]);return n}function MS(){return{app:null,config:{isNativeTag:ID,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let YF=0;function ZF(t,e){return function(s,o=null){Ze(s)||(s=Qt({},s)),o!=null&&!Rt(o)&&(o=null);const r=MS(),i=new Set;let a=!1;const l=r.app={_uid:YF++,_component:s,_props:o,_container:null,_context:r,_instance:null,version:SO,get config(){return r.config},set config(c){},use(c,...u){return i.has(c)||(c&&Ze(c.install)?(i.add(c),c.install(l,...u)):Ze(c)&&(i.add(c),c(l,...u))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,u){return u?(r.components[c]=u,l):r.components[c]},directive(c,u){return u?(r.directives[c]=u,l):r.directives[c]},mount(c,u,d){if(!a){const h=I(s,o);return h.appContext=r,u&&e?e(h,c):t(h,c,d),a=!0,l._container=c,c.__vue_app__=l,Bf(h.component)||h.component.proxy}},unmount(){a&&(t(null,l._container),delete l._container.__vue_app__)},provide(c,u){return r.provides[c]=u,l},runWithContext(c){Eh=l;try{return c()}finally{Eh=null}}};return l}}let Eh=null;function vn(t,e){if(kn){let n=kn.provides;const s=kn.parent&&kn.parent.provides;s===n&&(n=kn.provides=Object.create(s)),n[t]=e}}function vt(t,e,n=!1){const s=kn||Es;if(s||Eh){const o=s?s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:Eh._context.provides;if(o&&t in o)return o[t];if(arguments.length>1)return n&&Ze(e)?e.call(s&&s.proxy):e}}function QF(t,e,n,s=!1){const o={},r={};Sh(r,Lf,1),t.propsDefaults=Object.create(null),LS(t,e,o,r);for(const i in t.propsOptions[0])i in o||(o[i]=void 0);n?t.props=s?o:fS(o):t.type.props?t.props=o:t.props=r,t.attrs=r}function JF(t,e,n,s){const{props:o,attrs:r,vnode:{patchFlag:i}}=t,a=Qe(o),[l]=t.propsOptions;let c=!1;if((s||i>0)&&!(i&16)){if(i&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let h=u[d];if(Df(t.emitsOptions,h))continue;const f=e[h];if(l)if(dt(r,h))f!==r[h]&&(r[h]=f,c=!0);else{const p=eo(h);o[p]=Rg(l,a,p,f,t,!1)}else f!==r[h]&&(r[h]=f,c=!0)}}}else{LS(t,e,o,r)&&(c=!0);let u;for(const d in a)(!e||!dt(e,d)&&((u=Rl(d))===d||!dt(e,u)))&&(l?n&&(n[d]!==void 0||n[u]!==void 0)&&(o[d]=Rg(l,a,d,void 0,t,!0)):delete o[d]);if(r!==a)for(const d in r)(!e||!dt(e,d)&&!0)&&(delete r[d],c=!0)}c&&xr(t,"set","$attrs")}function LS(t,e,n,s){const[o,r]=t.propsOptions;let i=!1,a;if(e)for(let l in e){if(ph(l))continue;const c=e[l];let u;o&&dt(o,u=eo(l))?!r||!r.includes(u)?n[u]=c:(a||(a={}))[u]=c:Df(t.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,i=!0)}if(r){const l=Qe(n),c=a||Dt;for(let u=0;u<r.length;u++){const d=r[u];n[d]=Rg(o,l,d,c[d],t,!dt(c,d))}}return i}function Rg(t,e,n,s,o,r){const i=t[n];if(i!=null){const a=dt(i,"default");if(a&&s===void 0){const l=i.default;if(i.type!==Function&&!i.skipFactory&&Ze(l)){const{propsDefaults:c}=o;n in c?s=c[n]:(dl(o),s=c[n]=l.call(null,e),Yi())}else s=l}i[0]&&(r&&!a?s=!1:i[1]&&(s===""||s===Rl(n))&&(s=!0))}return s}function BS(t,e,n=!1){const s=e.propsCache,o=s.get(t);if(o)return o;const r=t.props,i={},a=[];let l=!1;if(!Ze(t)){const u=d=>{l=!0;const[h,f]=BS(d,e,!0);Qt(i,h),f&&a.push(...f)};!n&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!r&&!l)return Rt(t)&&s.set(t,Ja),Ja;if(Be(r))for(let u=0;u<r.length;u++){const d=eo(r[u]);p1(d)&&(i[d]=Dt)}else if(r)for(const u in r){const d=eo(u);if(p1(d)){const h=r[u],f=i[d]=Be(h)||Ze(h)?{type:h}:Qt({},h);if(f){const p=v1(Boolean,f.type),m=v1(String,f.type);f[0]=p>-1,f[1]=m<0||p<m,(p>-1||dt(f,"default"))&&a.push(d)}}}const c=[i,a];return Rt(t)&&s.set(t,c),c}function p1(t){return t[0]!=="$"}function m1(t){const e=t&&t.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:t===null?"null":""}function g1(t,e){return m1(t)===m1(e)}function v1(t,e){return Be(e)?e.findIndex(n=>g1(n,t)):Ze(e)&&g1(e,t)?0:-1}const VS=t=>t[0]==="_"||t==="$stable",vb=t=>Be(t)?t.map(Vo):[Vo(t)],eO=(t,e,n)=>{if(e._n)return e;const s=pe((...o)=>vb(e(...o)),n);return s._c=!1,s},zS=(t,e,n)=>{const s=t._ctx;for(const o in t){if(VS(o))continue;const r=t[o];if(Ze(r))e[o]=eO(o,r,s);else if(r!=null){const i=vb(r);e[o]=()=>i}}},WS=(t,e)=>{const n=vb(e);t.slots.default=()=>n},tO=(t,e)=>{if(t.vnode.shapeFlag&32){const n=e._;n?(t.slots=Qe(e),Sh(e,"_",n)):zS(e,t.slots={})}else t.slots={},e&&WS(t,e);Sh(t.slots,Lf,1)},nO=(t,e,n)=>{const{vnode:s,slots:o}=t;let r=!0,i=Dt;if(s.shapeFlag&32){const a=e._;a?n&&a===1?r=!1:(Qt(o,e),!n&&a===1&&delete o._):(r=!e.$stable,zS(e,o)),i=e}else e&&(WS(t,e),i={default:1});if(r)for(const a in o)!VS(a)&&!(a in i)&&delete o[a]};function Dg(t,e,n,s,o=!1){if(Be(t)){t.forEach((h,f)=>Dg(h,e&&(Be(e)?e[f]:e),n,s,o));return}if(gh(s)&&!o)return;const r=s.shapeFlag&4?Bf(s.component)||s.component.proxy:s.el,i=o?null:r,{i:a,r:l}=t,c=e&&e.r,u=a.refs===Dt?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(Ht(c)?(u[c]=null,dt(d,c)&&(d[c]=null)):Vt(c)&&(c.value=null)),Ze(l))ei(l,a,12,[i,u]);else{const h=Ht(l),f=Vt(l);if(h||f){const p=()=>{if(t.f){const m=h?dt(d,l)?d[l]:u[l]:l.value;o?Be(m)&&Xv(m,r):Be(m)?m.includes(r)||m.push(r):h?(u[l]=[r],dt(d,l)&&(d[l]=u[l])):(l.value=[r],t.k&&(u[t.k]=l.value))}else h?(u[l]=i,dt(d,l)&&(d[l]=i)):f&&(l.value=i,t.k&&(u[t.k]=i))};i?(p.id=-1,cs(p,n)):p()}}}const cs=RF;function sO(t){return oO(t)}function oO(t,e){const n=Sg();n.__VUE__=!0;const{insert:s,remove:o,patchProp:r,createElement:i,createText:a,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:h,setScopeId:f=vo,insertStaticContent:p}=t,m=(R,P,j,ee=null,se=null,le=null,me=!1,ve=null,ge=!!P.dynamicChildren)=>{if(R===P)return;R&&!Vi(R,P)&&(ee=z(R),te(R,se,le,!0),R=null),P.patchFlag===-2&&(ge=!1,P.dynamicChildren=null);const{type:fe,ref:$e,shapeFlag:Ie}=P;switch(fe){case uu:g(R,P,j,ee);break;case bo:v(R,P,j,ee);break;case Fm:R==null&&b(P,j,ee,me);break;case ot:_(R,P,j,ee,se,le,me,ve,ge);break;default:Ie&1?w(R,P,j,ee,se,le,me,ve,ge):Ie&6?A(R,P,j,ee,se,le,me,ve,ge):(Ie&64||Ie&128)&&fe.process(R,P,j,ee,se,le,me,ve,ge,re)}$e!=null&&se&&Dg($e,R&&R.ref,le,P||R,!P)},g=(R,P,j,ee)=>{if(R==null)s(P.el=a(P.children),j,ee);else{const se=P.el=R.el;P.children!==R.children&&c(se,P.children)}},v=(R,P,j,ee)=>{R==null?s(P.el=l(P.children||""),j,ee):P.el=R.el},b=(R,P,j,ee)=>{[R.el,R.anchor]=p(R.children,P,j,ee,R.el,R.anchor)},y=({el:R,anchor:P},j,ee)=>{let se;for(;R&&R!==P;)se=h(R),s(R,j,ee),R=se;s(P,j,ee)},x=({el:R,anchor:P})=>{let j;for(;R&&R!==P;)j=h(R),o(R),R=j;o(P)},w=(R,P,j,ee,se,le,me,ve,ge)=>{me=me||P.type==="svg",R==null?k(P,j,ee,se,le,me,ve,ge):$(R,P,se,le,me,ve,ge)},k=(R,P,j,ee,se,le,me,ve)=>{let ge,fe;const{type:$e,props:Ie,shapeFlag:Te,transition:Oe,dirs:je}=R;if(ge=R.el=i(R.type,le,Ie&&Ie.is,Ie),Te&8?u(ge,R.children):Te&16&&C(R.children,ge,null,ee,se,le&&$e!=="foreignObject",me,ve),je&&Ai(R,null,ee,"created"),S(ge,R,R.scopeId,me,ee),Ie){for(const rt in Ie)rt!=="value"&&!ph(rt)&&r(ge,rt,null,Ie[rt],le,R.children,ee,se,Y);"value"in Ie&&r(ge,"value",null,Ie.value),(fe=Ie.onVnodeBeforeMount)&&Po(fe,ee,R)}je&&Ai(R,null,ee,"beforeMount");const it=(!se||se&&!se.pendingBranch)&&Oe&&!Oe.persisted;it&&Oe.beforeEnter(ge),s(ge,P,j),((fe=Ie&&Ie.onVnodeMounted)||it||je)&&cs(()=>{fe&&Po(fe,ee,R),it&&Oe.enter(ge),je&&Ai(R,null,ee,"mounted")},se)},S=(R,P,j,ee,se)=>{if(j&&f(R,j),ee)for(let le=0;le<ee.length;le++)f(R,ee[le]);if(se){let le=se.subTree;if(P===le){const me=se.vnode;S(R,me,me.scopeId,me.slotScopeIds,se.parent)}}},C=(R,P,j,ee,se,le,me,ve,ge=0)=>{for(let fe=ge;fe<R.length;fe++){const $e=R[fe]=ve?Hr(R[fe]):Vo(R[fe]);m(null,$e,P,j,ee,se,le,me,ve)}},$=(R,P,j,ee,se,le,me)=>{const ve=P.el=R.el;let{patchFlag:ge,dynamicChildren:fe,dirs:$e}=P;ge|=R.patchFlag&16;const Ie=R.props||Dt,Te=P.props||Dt;let Oe;j&&Ri(j,!1),(Oe=Te.onVnodeBeforeUpdate)&&Po(Oe,j,P,R),$e&&Ai(P,R,j,"beforeUpdate"),j&&Ri(j,!0);const je=se&&P.type!=="foreignObject";if(fe?T(R.dynamicChildren,fe,ve,j,ee,je,le):me||D(R,P,ve,null,j,ee,je,le,!1),ge>0){if(ge&16)E(ve,P,Ie,Te,j,ee,se);else if(ge&2&&Ie.class!==Te.class&&r(ve,"class",null,Te.class,se),ge&4&&r(ve,"style",Ie.style,Te.style,se),ge&8){const it=P.dynamicProps;for(let rt=0;rt<it.length;rt++){const Nt=it[rt],Kn=Ie[Nt],Do=Te[Nt];(Do!==Kn||Nt==="value")&&r(ve,Nt,Kn,Do,se,R.children,j,ee,Y)}}ge&1&&R.children!==P.children&&u(ve,P.children)}else!me&&fe==null&&E(ve,P,Ie,Te,j,ee,se);((Oe=Te.onVnodeUpdated)||$e)&&cs(()=>{Oe&&Po(Oe,j,P,R),$e&&Ai(P,R,j,"updated")},ee)},T=(R,P,j,ee,se,le,me)=>{for(let ve=0;ve<P.length;ve++){const ge=R[ve],fe=P[ve],$e=ge.el&&(ge.type===ot||!Vi(ge,fe)||ge.shapeFlag&70)?d(ge.el):j;m(ge,fe,$e,null,ee,se,le,me,!0)}},E=(R,P,j,ee,se,le,me)=>{if(j!==ee){if(j!==Dt)for(const ve in j)!ph(ve)&&!(ve in ee)&&r(R,ve,j[ve],null,me,P.children,se,le,Y);for(const ve in ee){if(ph(ve))continue;const ge=ee[ve],fe=j[ve];ge!==fe&&ve!=="value"&&r(R,ve,fe,ge,me,P.children,se,le,Y)}"value"in ee&&r(R,"value",j.value,ee.value)}},_=(R,P,j,ee,se,le,me,ve,ge)=>{const fe=P.el=R?R.el:a(""),$e=P.anchor=R?R.anchor:a("");let{patchFlag:Ie,dynamicChildren:Te,slotScopeIds:Oe}=P;Oe&&(ve=ve?ve.concat(Oe):Oe),R==null?(s(fe,j,ee),s($e,j,ee),C(P.children,j,$e,se,le,me,ve,ge)):Ie>0&&Ie&64&&Te&&R.dynamicChildren?(T(R.dynamicChildren,Te,j,se,le,me,ve),(P.key!=null||se&&P===se.subTree)&&bb(R,P,!0)):D(R,P,j,$e,se,le,me,ve,ge)},A=(R,P,j,ee,se,le,me,ve,ge)=>{P.slotScopeIds=ve,R==null?P.shapeFlag&512?se.ctx.activate(P,j,ee,me,ge):O(P,j,ee,se,le,me,ge):B(R,P,ge)},O=(R,P,j,ee,se,le,me)=>{const ve=R.component=mO(R,ee,se);if(Of(R)&&(ve.ctx.renderer=re),gO(ve),ve.asyncDep){if(se&&se.registerDep(ve,F),!R.el){const ge=ve.subTree=I(bo);v(null,ge,P,j)}return}F(ve,R,P,j,se,le,me)},B=(R,P,j)=>{const ee=P.component=R.component;if(EF(R,P,j))if(ee.asyncDep&&!ee.asyncResolved){V(ee,P,j);return}else ee.next=P,wF(ee.update),ee.update();else P.el=R.el,ee.vnode=P},F=(R,P,j,ee,se,le,me)=>{const ve=()=>{if(R.isMounted){let{next:$e,bu:Ie,u:Te,parent:Oe,vnode:je}=R,it=$e,rt;Ri(R,!1),$e?($e.el=je.el,V(R,$e,me)):$e=je,Ie&&mh(Ie),(rt=$e.props&&$e.props.onVnodeBeforeUpdate)&&Po(rt,Oe,$e,je),Ri(R,!0);const Nt=Am(R),Kn=R.subTree;R.subTree=Nt,m(Kn,Nt,d(Kn.el),z(Kn),R,se,le),$e.el=Nt.el,it===null&&_F(R,Nt.el),Te&&cs(Te,se),(rt=$e.props&&$e.props.onVnodeUpdated)&&cs(()=>Po(rt,Oe,$e,je),se)}else{let $e;const{el:Ie,props:Te}=P,{bm:Oe,m:je,parent:it}=R,rt=gh(P);if(Ri(R,!1),Oe&&mh(Oe),!rt&&($e=Te&&Te.onVnodeBeforeMount)&&Po($e,it,P),Ri(R,!0),Ie&&Ce){const Nt=()=>{R.subTree=Am(R),Ce(Ie,R.subTree,R,se,null)};rt?P.type.__asyncLoader().then(()=>!R.isUnmounted&&Nt()):Nt()}else{const Nt=R.subTree=Am(R);m(null,Nt,j,ee,R,se,le),P.el=Nt.el}if(je&&cs(je,se),!rt&&($e=Te&&Te.onVnodeMounted)){const Nt=P;cs(()=>Po($e,it,Nt),se)}(P.shapeFlag&256||it&&gh(it.vnode)&&it.vnode.shapeFlag&256)&&R.a&&cs(R.a,se),R.isMounted=!0,P=j=ee=null}},ge=R.effect=new tb(ve,()=>cb(fe),R.scope),fe=R.update=()=>ge.run();fe.id=R.uid,Ri(R,!0),fe()},V=(R,P,j)=>{P.component=R;const ee=R.vnode.props;R.vnode=P,R.next=null,JF(R,P.props,ee,j),nO(R,P.children,j),Dl(),i1(),Fl()},D=(R,P,j,ee,se,le,me,ve,ge=!1)=>{const fe=R&&R.children,$e=R?R.shapeFlag:0,Ie=P.children,{patchFlag:Te,shapeFlag:Oe}=P;if(Te>0){if(Te&128){J(fe,Ie,j,ee,se,le,me,ve,ge);return}else if(Te&256){U(fe,Ie,j,ee,se,le,me,ve,ge);return}}Oe&8?($e&16&&Y(fe,se,le),Ie!==fe&&u(j,Ie)):$e&16?Oe&16?J(fe,Ie,j,ee,se,le,me,ve,ge):Y(fe,se,le,!0):($e&8&&u(j,""),Oe&16&&C(Ie,j,ee,se,le,me,ve,ge))},U=(R,P,j,ee,se,le,me,ve,ge)=>{R=R||Ja,P=P||Ja;const fe=R.length,$e=P.length,Ie=Math.min(fe,$e);let Te;for(Te=0;Te<Ie;Te++){const Oe=P[Te]=ge?Hr(P[Te]):Vo(P[Te]);m(R[Te],Oe,j,null,se,le,me,ve,ge)}fe>$e?Y(R,se,le,!0,!1,Ie):C(P,j,ee,se,le,me,ve,ge,Ie)},J=(R,P,j,ee,se,le,me,ve,ge)=>{let fe=0;const $e=P.length;let Ie=R.length-1,Te=$e-1;for(;fe<=Ie&&fe<=Te;){const Oe=R[fe],je=P[fe]=ge?Hr(P[fe]):Vo(P[fe]);if(Vi(Oe,je))m(Oe,je,j,null,se,le,me,ve,ge);else break;fe++}for(;fe<=Ie&&fe<=Te;){const Oe=R[Ie],je=P[Te]=ge?Hr(P[Te]):Vo(P[Te]);if(Vi(Oe,je))m(Oe,je,j,null,se,le,me,ve,ge);else break;Ie--,Te--}if(fe>Ie){if(fe<=Te){const Oe=Te+1,je=Oe<$e?P[Oe].el:ee;for(;fe<=Te;)m(null,P[fe]=ge?Hr(P[fe]):Vo(P[fe]),j,je,se,le,me,ve,ge),fe++}}else if(fe>Te)for(;fe<=Ie;)te(R[fe],se,le,!0),fe++;else{const Oe=fe,je=fe,it=new Map;for(fe=je;fe<=Te;fe++){const qn=P[fe]=ge?Hr(P[fe]):Vo(P[fe]);qn.key!=null&&it.set(qn.key,fe)}let rt,Nt=0;const Kn=Te-je+1;let Do=!1,zd=0;const Fo=new Array(Kn);for(fe=0;fe<Kn;fe++)Fo[fe]=0;for(fe=Oe;fe<=Ie;fe++){const qn=R[fe];if(Nt>=Kn){te(qn,se,le,!0);continue}let Oo;if(qn.key!=null)Oo=it.get(qn.key);else for(rt=je;rt<=Te;rt++)if(Fo[rt-je]===0&&Vi(qn,P[rt])){Oo=rt;break}Oo===void 0?te(qn,se,le,!0):(Fo[Oo-je]=fe+1,Oo>=zd?zd=Oo:Do=!0,m(qn,P[Oo],j,null,se,le,me,ve,ge),Nt++)}const Wd=Do?rO(Fo):Ja;for(rt=Wd.length-1,fe=Kn-1;fe>=0;fe--){const qn=je+fe,Oo=P[qn],Z0=qn+1<$e?P[qn+1].el:ee;Fo[fe]===0?m(null,Oo,j,Z0,se,le,me,ve,ge):Do&&(rt<0||fe!==Wd[rt]?X(Oo,j,Z0,2):rt--)}}},X=(R,P,j,ee,se=null)=>{const{el:le,type:me,transition:ve,children:ge,shapeFlag:fe}=R;if(fe&6){X(R.component.subTree,P,j,ee);return}if(fe&128){R.suspense.move(P,j,ee);return}if(fe&64){me.move(R,P,j,re);return}if(me===ot){s(le,P,j);for(let Ie=0;Ie<ge.length;Ie++)X(ge[Ie],P,j,ee);s(R.anchor,P,j);return}if(me===Fm){y(R,P,j);return}if(ee!==2&&fe&1&&ve)if(ee===0)ve.beforeEnter(le),s(le,P,j),cs(()=>ve.enter(le),se);else{const{leave:Ie,delayLeave:Te,afterLeave:Oe}=ve,je=()=>s(le,P,j),it=()=>{Ie(le,()=>{je(),Oe&&Oe()})};Te?Te(le,je,it):it()}else s(le,P,j)},te=(R,P,j,ee=!1,se=!1)=>{const{type:le,props:me,ref:ve,children:ge,dynamicChildren:fe,shapeFlag:$e,patchFlag:Ie,dirs:Te}=R;if(ve!=null&&Dg(ve,null,j,R,!0),$e&256){P.ctx.deactivate(R);return}const Oe=$e&1&&Te,je=!gh(R);let it;if(je&&(it=me&&me.onVnodeBeforeUnmount)&&Po(it,P,R),$e&6)ce(R.component,j,ee);else{if($e&128){R.suspense.unmount(j,ee);return}Oe&&Ai(R,null,P,"beforeUnmount"),$e&64?R.type.remove(R,P,j,se,re,ee):fe&&(le!==ot||Ie>0&&Ie&64)?Y(fe,P,j,!1,!0):(le===ot&&Ie&384||!se&&$e&16)&&Y(ge,P,j),ee&&ie(R)}(je&&(it=me&&me.onVnodeUnmounted)||Oe)&&cs(()=>{it&&Po(it,P,R),Oe&&Ai(R,null,P,"unmounted")},j)},ie=R=>{const{type:P,el:j,anchor:ee,transition:se}=R;if(P===ot){ue(j,ee);return}if(P===Fm){x(R);return}const le=()=>{o(j),se&&!se.persisted&&se.afterLeave&&se.afterLeave()};if(R.shapeFlag&1&&se&&!se.persisted){const{leave:me,delayLeave:ve}=se,ge=()=>me(j,le);ve?ve(R.el,le,ge):ge()}else le()},ue=(R,P)=>{let j;for(;R!==P;)j=h(R),o(R),R=j;o(P)},ce=(R,P,j)=>{const{bum:ee,scope:se,update:le,subTree:me,um:ve}=R;ee&&mh(ee),se.stop(),le&&(le.active=!1,te(me,R,P,j)),ve&&cs(ve,P),cs(()=>{R.isUnmounted=!0},P),P&&P.pendingBranch&&!P.isUnmounted&&R.asyncDep&&!R.asyncResolved&&R.suspenseId===P.pendingId&&(P.deps--,P.deps===0&&P.resolve())},Y=(R,P,j,ee=!1,se=!1,le=0)=>{for(let me=le;me<R.length;me++)te(R[me],P,j,ee,se)},z=R=>R.shapeFlag&6?z(R.component.subTree):R.shapeFlag&128?R.suspense.next():h(R.anchor||R.el),ae=(R,P,j)=>{R==null?P._vnode&&te(P._vnode,null,null,!0):m(P._vnode||null,R,P,null,null,null,j),i1(),kS(),P._vnode=R},re={p:m,um:te,m:X,r:ie,mt:O,mc:C,pc:D,pbc:T,n:z,o:t};let he,Ce;return e&&([he,Ce]=e(re)),{render:ae,hydrate:he,createApp:ZF(ae,he)}}function Ri({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function bb(t,e,n=!1){const s=t.children,o=e.children;if(Be(s)&&Be(o))for(let r=0;r<s.length;r++){const i=s[r];let a=o[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=o[r]=Hr(o[r]),a.el=i.el),n||bb(i,a)),a.type===uu&&(a.el=i.el)}}function rO(t){const e=t.slice(),n=[0];let s,o,r,i,a;const l=t.length;for(s=0;s<l;s++){const c=t[s];if(c!==0){if(o=n[n.length-1],t[o]<c){e[s]=o,n.push(s);continue}for(r=0,i=n.length-1;r<i;)a=r+i>>1,t[n[a]]<c?r=a+1:i=a;c<t[n[r]]&&(r>0&&(e[s]=n[r-1]),n[r]=s)}}for(r=n.length,i=n[r-1];r-- >0;)n[r]=i,i=e[i];return n}const iO=t=>t.__isTeleport,Sc=t=>t&&(t.disabled||t.disabled===""),b1=t=>typeof SVGElement<"u"&&t instanceof SVGElement,Fg=(t,e)=>{const n=t&&t.to;return Ht(n)?e?e(n):null:n},aO={__isTeleport:!0,process(t,e,n,s,o,r,i,a,l,c){const{mc:u,pc:d,pbc:h,o:{insert:f,querySelector:p,createText:m,createComment:g}}=c,v=Sc(e.props);let{shapeFlag:b,children:y,dynamicChildren:x}=e;if(t==null){const w=e.el=m(""),k=e.anchor=m("");f(w,n,s),f(k,n,s);const S=e.target=Fg(e.props,p),C=e.targetAnchor=m("");S&&(f(C,S),i=i||b1(S));const $=(T,E)=>{b&16&&u(y,T,E,o,r,i,a,l)};v?$(n,k):S&&$(S,C)}else{e.el=t.el;const w=e.anchor=t.anchor,k=e.target=t.target,S=e.targetAnchor=t.targetAnchor,C=Sc(t.props),$=C?n:k,T=C?w:S;if(i=i||b1(k),x?(h(t.dynamicChildren,x,$,o,r,i,a),bb(t,e,!0)):l||d(t,e,$,T,o,r,i,a,!1),v)C||Xd(e,n,w,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const E=e.target=Fg(e.props,p);E&&Xd(e,E,null,c,0)}else C&&Xd(e,k,S,c,1)}US(e)},remove(t,e,n,s,{um:o,o:{remove:r}},i){const{shapeFlag:a,children:l,anchor:c,targetAnchor:u,target:d,props:h}=t;if(d&&r(u),(i||!Sc(h))&&(r(c),a&16))for(let f=0;f<l.length;f++){const p=l[f];o(p,e,n,!0,!!p.dynamicChildren)}},move:Xd,hydrate:lO};function Xd(t,e,n,{o:{insert:s},m:o},r=2){r===0&&s(t.targetAnchor,e,n);const{el:i,anchor:a,shapeFlag:l,children:c,props:u}=t,d=r===2;if(d&&s(i,e,n),(!d||Sc(u))&&l&16)for(let h=0;h<c.length;h++)o(c[h],e,n,2);d&&s(a,e,n)}function lO(t,e,n,s,o,r,{o:{nextSibling:i,parentNode:a,querySelector:l}},c){const u=e.target=Fg(e.props,l);if(u){const d=u._lpa||u.firstChild;if(e.shapeFlag&16)if(Sc(e.props))e.anchor=c(i(t),e,a(t),n,s,o,r),e.targetAnchor=d;else{e.anchor=i(t);let h=d;for(;h;)if(h=i(h),h&&h.nodeType===8&&h.data==="teleport anchor"){e.targetAnchor=h,u._lpa=e.targetAnchor&&i(e.targetAnchor);break}c(d,e,u,n,s,o,r)}US(e)}return e.anchor&&i(e.anchor)}const cO=aO;function US(t){const e=t.ctx;if(e&&e.ut){let n=t.children[0].el;for(;n!==t.targetAnchor;)n.nodeType===1&&n.setAttribute("data-v-owner",e.uid),n=n.nextSibling;e.ut()}}const ot=Symbol.for("v-fgt"),uu=Symbol.for("v-txt"),bo=Symbol.for("v-cmt"),Fm=Symbol.for("v-stc"),Ic=[];let mo=null;function We(t=!1){Ic.push(mo=t?null:[])}function uO(){Ic.pop(),mo=Ic[Ic.length-1]||null}let Mc=1;function y1(t){Mc+=t}function GS(t){return t.dynamicChildren=Mc>0?mo||Ja:null,uO(),Mc>0&&mo&&mo.push(t),t}function es(t,e,n,s,o,r){return GS(Ct(t,e,n,s,o,r,!0))}function ht(t,e,n,s,o){return GS(I(t,e,n,s,o,!0))}function Og(t){return t?t.__v_isVNode===!0:!1}function Vi(t,e){return t.type===e.type&&t.key===e.key}const Lf="__vInternal",HS=({key:t})=>t!=null?t:null,vh=({ref:t,ref_key:e,ref_for:n})=>(typeof t=="number"&&(t=""+t),t!=null?Ht(t)||Vt(t)||Ze(t)?{i:Es,r:t,k:e,f:!!n}:t:null);function Ct(t,e=null,n=null,s=0,o=null,r=t===ot?0:1,i=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&HS(e),ref:e&&vh(e),scopeId:Ff,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Es};return a?(yb(l,n),r&128&&t.normalize(l)):n&&(l.shapeFlag|=Ht(n)?8:16),Mc>0&&!i&&mo&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&mo.push(l),l}const I=dO;function dO(t,e=null,n=null,s=0,o=null,r=!1){if((!t||t===OS)&&(t=bo),Og(t)){const a=wr(t,e,!0);return n&&yb(a,n),Mc>0&&!r&&mo&&(a.shapeFlag&6?mo[mo.indexOf(t)]=a:mo.push(a)),a.patchFlag|=-2,a}if(wO(t)&&(t=t.__vccOpts),e){e=hO(e);let{class:a,style:l}=e;a&&!Ht(a)&&(e.class=Qv(a)),Rt(l)&&(pS(l)&&!Be(l)&&(l=Qt({},l)),e.style=_f(l))}const i=Ht(t)?1:AF(t)?128:iO(t)?64:Rt(t)?4:Ze(t)?2:0;return Ct(t,e,n,s,o,i,r,!0)}function hO(t){return t?pS(t)||Lf in t?Qt({},t):t:null}function wr(t,e,n=!1){const{props:s,ref:o,patchFlag:r,children:i}=t,a=e?Ue(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&HS(a),ref:e&&e.ref?n&&o?Be(o)?o.concat(vh(e)):[o,vh(e)]:vh(e):o,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:i,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ot?r===-1?16:r|16:r,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&wr(t.ssContent),ssFallback:t.ssFallback&&wr(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function gt(t=" ",e=0){return I(uu,null,t,e)}function Cn(t="",e=!1){return e?(We(),ht(bo,null,t)):I(bo,null,t)}function Vo(t){return t==null||typeof t=="boolean"?I(bo):Be(t)?I(ot,null,t.slice()):typeof t=="object"?Hr(t):I(uu,null,String(t))}function Hr(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:wr(t)}function yb(t,e){let n=0;const{shapeFlag:s}=t;if(e==null)e=null;else if(Be(e))n=16;else if(typeof e=="object")if(s&65){const o=e.default;o&&(o._c&&(o._d=!1),yb(t,o()),o._c&&(o._d=!0));return}else{n=32;const o=e._;!o&&!(Lf in e)?e._ctx=Es:o===3&&Es&&(Es.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Ze(e)?(e={default:e,_ctx:Es},n=32):(e=String(e),s&64?(n=16,e=[gt(e)]):n=8);t.children=e,t.shapeFlag|=n}function Ue(...t){const e={};for(let n=0;n<t.length;n++){const s=t[n];for(const o in s)if(o==="class")e.class!==s.class&&(e.class=Qv([e.class,s.class]));else if(o==="style")e.style=_f([e.style,s.style]);else if(Tf(o)){const r=e[o],i=s[o];i&&r!==i&&!(Be(r)&&r.includes(i))&&(e[o]=r?[].concat(r,i):i)}else o!==""&&(e[o]=s[o])}return e}function Po(t,e,n,s=null){Qs(t,e,7,[n,s])}const fO=MS();let pO=0;function mO(t,e,n){const s=t.type,o=(e?e.appContext:t.appContext)||fO,r={uid:pO++,vnode:t,type:s,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,scope:new nS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:BS(s,o),emitsOptions:IS(s,o),emit:null,emitted:null,propsDefaults:Dt,inheritAttrs:s.inheritAttrs,ctx:Dt,data:Dt,props:Dt,attrs:Dt,slots:Dt,refs:Dt,setupState:Dt,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=SF.bind(null,r),t.ce&&t.ce(r),r}let kn=null;const xb=()=>kn||Es;let wb,Ba,x1="__VUE_INSTANCE_SETTERS__";(Ba=Sg()[x1])||(Ba=Sg()[x1]=[]),Ba.push(t=>kn=t),wb=t=>{Ba.length>1?Ba.forEach(e=>e(t)):Ba[0](t)};const dl=t=>{wb(t),t.scope.on()},Yi=()=>{kn&&kn.scope.off(),wb(null)};function jS(t){return t.vnode.shapeFlag&4}let Lc=!1;function gO(t,e=!1){Lc=e;const{props:n,children:s}=t.vnode,o=jS(t);QF(t,n,o,e),tO(t,s);const r=o?vO(t,e):void 0;return Lc=!1,r}function vO(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=mS(new Proxy(t.ctx,GF));const{setup:s}=n;if(s){const o=t.setupContext=s.length>1?yO(t):null;dl(t),Dl();const r=ei(s,t,0,[t.props,o]);if(Fl(),Yi(),Zk(r)){if(r.then(Yi,Yi),e)return r.then(i=>{w1(t,i,e)}).catch(i=>{Rf(i,t,0)});t.asyncDep=r}else w1(t,r,e)}else KS(t,e)}function w1(t,e,n){Ze(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Rt(e)&&(t.setupState=yS(e)),KS(t,n)}let C1;function KS(t,e,n){const s=t.type;if(!t.render){if(!e&&C1&&!s.render){const o=s.template||gb(t).template;if(o){const{isCustomElement:r,compilerOptions:i}=t.appContext.config,{delimiters:a,compilerOptions:l}=s,c=Qt(Qt({isCustomElement:r,delimiters:a},i),l);s.render=C1(o,c)}}t.render=s.render||vo}dl(t),Dl(),HF(t),Fl(),Yi()}function bO(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(e,n){return gs(t,"get","$attrs"),e[n]}}))}function yO(t){const e=n=>{t.exposed=n||{}};return{get attrs(){return bO(t)},slots:t.slots,emit:t.emit,expose:e}}function Bf(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(yS(mS(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in kc)return kc[n](t)},has(e,n){return n in e||n in kc}}))}function xO(t,e=!0){return Ze(t)?t.displayName||t.name:t.name||e&&t.__name}function wO(t){return Ze(t)&&"__vccOpts"in t}const M=(t,e)=>bF(t,e,Lc);function lr(t,e,n){const s=arguments.length;return s===2?Rt(e)&&!Be(e)?Og(e)?I(t,null,[e]):I(t,e):I(t,null,e):(s>3?n=Array.prototype.slice.call(arguments,2):s===3&&Og(n)&&(n=[n]),I(t,e,n))}const CO=Symbol.for("v-scx"),kO=()=>vt(CO),SO="3.3.4",IO="http://www.w3.org/2000/svg",zi=typeof document<"u"?document:null,k1=zi&&zi.createElement("template"),$O={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,s)=>{const o=e?zi.createElementNS(IO,t):zi.createElement(t,n?{is:n}:void 0);return t==="select"&&s&&s.multiple!=null&&o.setAttribute("multiple",s.multiple),o},createText:t=>zi.createTextNode(t),createComment:t=>zi.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>zi.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,s,o,r){const i=n?n.previousSibling:e.lastChild;if(o&&(o===r||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),n),!(o===r||!(o=o.nextSibling)););else{k1.innerHTML=s?`<svg>${t}</svg>`:t;const a=k1.content;if(s){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,n)}return[i?i.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function TO(t,e,n){const s=t._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function NO(t,e,n){const s=t.style,o=Ht(n);if(n&&!o){if(e&&!Ht(e))for(const r in e)n[r]==null&&Pg(s,r,"");for(const r in n)Pg(s,r,n[r])}else{const r=s.display;o?e!==n&&(s.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(s.display=r)}}const S1=/\s*!important$/;function Pg(t,e,n){if(Be(n))n.forEach(s=>Pg(t,e,s));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const s=EO(t,e);S1.test(n)?t.setProperty(Rl(s),n.replace(S1,""),"important"):t[s]=n}}const I1=["Webkit","Moz","ms"],Om={};function EO(t,e){const n=Om[e];if(n)return n;let s=eo(e);if(s!=="filter"&&s in t)return Om[e]=s;s=Er(s);for(let o=0;o<I1.length;o++){const r=I1[o]+s;if(r in t)return Om[e]=r}return e}const $1="http://www.w3.org/1999/xlink";function _O(t,e,n,s,o){if(s&&e.startsWith("xlink:"))n==null?t.removeAttributeNS($1,e.slice(6,e.length)):t.setAttributeNS($1,e,n);else{const r=MD(e);n==null||r&&!eS(n)?t.removeAttribute(e):t.setAttribute(e,r?"":n)}}function AO(t,e,n,s,o,r,i){if(e==="innerHTML"||e==="textContent"){s&&i(s,o,r),t[e]=n==null?"":n;return}const a=t.tagName;if(e==="value"&&a!=="PROGRESS"&&!a.includes("-")){t._value=n;const c=a==="OPTION"?t.getAttribute("value"):t.value,u=n==null?"":n;c!==u&&(t.value=u),n==null&&t.removeAttribute(e);return}let l=!1;if(n===""||n==null){const c=typeof t[e];c==="boolean"?n=eS(n):n==null&&c==="string"?(n="",l=!0):c==="number"&&(n=0,l=!0)}try{t[e]=n}catch{}l&&t.removeAttribute(e)}function ja(t,e,n,s){t.addEventListener(e,n,s)}function RO(t,e,n,s){t.removeEventListener(e,n,s)}function DO(t,e,n,s,o=null){const r=t._vei||(t._vei={}),i=r[e];if(s&&i)i.value=s;else{const[a,l]=FO(e);if(s){const c=r[e]=MO(s,o);ja(t,a,c,l)}else i&&(RO(t,a,i,l),r[e]=void 0)}}const T1=/(?:Once|Passive|Capture)$/;function FO(t){let e;if(T1.test(t)){e={};let s;for(;s=t.match(T1);)t=t.slice(0,t.length-s[0].length),e[s[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Rl(t.slice(2)),e]}let Pm=0;const OO=Promise.resolve(),PO=()=>Pm||(OO.then(()=>Pm=0),Pm=Date.now());function MO(t,e){const n=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=n.attached)return;Qs(LO(s,n.value),e,5,[s])};return n.value=t,n.attached=PO(),n}function LO(t,e){if(Be(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(s=>o=>!o._stopped&&s&&s(o))}else return e}const N1=/^on[a-z]/,BO=(t,e,n,s,o=!1,r,i,a,l)=>{e==="class"?TO(t,s,o):e==="style"?NO(t,n,s):Tf(e)?qv(e)||DO(t,e,n,s,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):VO(t,e,s,o))?AO(t,e,s,r,i,a,l):(e==="true-value"?t._trueValue=s:e==="false-value"&&(t._falseValue=s),_O(t,e,s,o))};function VO(t,e,n,s){return s?!!(e==="innerHTML"||e==="textContent"||e in t&&N1.test(e)&&Ze(n)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||N1.test(e)&&Ht(n)?!1:e in t}const Br="transition",nc="animation",Cr=(t,{slots:e})=>lr(OF,XS(t),e);Cr.displayName="Transition";const qS={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},zO=Cr.props=Qt({},NS,qS),Di=(t,e=[])=>{Be(t)?t.forEach(n=>n(...e)):t&&t(...e)},E1=t=>t?Be(t)?t.some(e=>e.length>1):t.length>1:!1;function XS(t){const e={};for(const _ in t)_ in qS||(e[_]=t[_]);if(t.css===!1)return e;const{name:n="v",type:s,duration:o,enterFromClass:r=`${n}-enter-from`,enterActiveClass:i=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:l=r,appearActiveClass:c=i,appearToClass:u=a,leaveFromClass:d=`${n}-leave-from`,leaveActiveClass:h=`${n}-leave-active`,leaveToClass:f=`${n}-leave-to`}=t,p=WO(o),m=p&&p[0],g=p&&p[1],{onBeforeEnter:v,onEnter:b,onEnterCancelled:y,onLeave:x,onLeaveCancelled:w,onBeforeAppear:k=v,onAppear:S=b,onAppearCancelled:C=y}=e,$=(_,A,O)=>{Ur(_,A?u:a),Ur(_,A?c:i),O&&O()},T=(_,A)=>{_._isLeaving=!1,Ur(_,d),Ur(_,f),Ur(_,h),A&&A()},E=_=>(A,O)=>{const B=_?S:b,F=()=>$(A,_,O);Di(B,[A,F]),_1(()=>{Ur(A,_?l:r),fr(A,_?u:a),E1(B)||A1(A,s,m,F)})};return Qt(e,{onBeforeEnter(_){Di(v,[_]),fr(_,r),fr(_,i)},onBeforeAppear(_){Di(k,[_]),fr(_,l),fr(_,c)},onEnter:E(!1),onAppear:E(!0),onLeave(_,A){_._isLeaving=!0;const O=()=>T(_,A);fr(_,d),ZS(),fr(_,h),_1(()=>{!_._isLeaving||(Ur(_,d),fr(_,f),E1(x)||A1(_,s,g,O))}),Di(x,[_,O])},onEnterCancelled(_){$(_,!1),Di(y,[_])},onAppearCancelled(_){$(_,!0),Di(C,[_])},onLeaveCancelled(_){T(_),Di(w,[_])}})}function WO(t){if(t==null)return null;if(Rt(t))return[Mm(t.enter),Mm(t.leave)];{const e=Mm(t);return[e,e]}}function Mm(t){return AD(t)}function fr(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.add(n)),(t._vtc||(t._vtc=new Set)).add(e)}function Ur(t,e){e.split(/\s+/).forEach(s=>s&&t.classList.remove(s));const{_vtc:n}=t;n&&(n.delete(e),n.size||(t._vtc=void 0))}function _1(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let UO=0;function A1(t,e,n,s){const o=t._endId=++UO,r=()=>{o===t._endId&&s()};if(n)return setTimeout(r,n);const{type:i,timeout:a,propCount:l}=YS(t,e);if(!i)return s();const c=i+"end";let u=0;const d=()=>{t.removeEventListener(c,h),r()},h=f=>{f.target===t&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},a+1),t.addEventListener(c,h)}function YS(t,e){const n=window.getComputedStyle(t),s=p=>(n[p]||"").split(", "),o=s(`${Br}Delay`),r=s(`${Br}Duration`),i=R1(o,r),a=s(`${nc}Delay`),l=s(`${nc}Duration`),c=R1(a,l);let u=null,d=0,h=0;e===Br?i>0&&(u=Br,d=i,h=r.length):e===nc?c>0&&(u=nc,d=c,h=l.length):(d=Math.max(i,c),u=d>0?i>c?Br:nc:null,h=u?u===Br?r.length:l.length:0);const f=u===Br&&/\b(transform|all)(,|$)/.test(s(`${Br}Property`).toString());return{type:u,timeout:d,propCount:h,hasTransform:f}}function R1(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((n,s)=>D1(n)+D1(t[s])))}function D1(t){return Number(t.slice(0,-1).replace(",","."))*1e3}function ZS(){return document.body.offsetHeight}const QS=new WeakMap,JS=new WeakMap,eI={name:"TransitionGroup",props:Qt({},zO,{tag:String,moveClass:String}),setup(t,{slots:e}){const n=xb(),s=TS();let o,r;return DS(()=>{if(!o.length)return;const i=t.moveClass||`${t.name||"v"}-move`;if(!qO(o[0].el,n.vnode.el,i))return;o.forEach(HO),o.forEach(jO);const a=o.filter(KO);ZS(),a.forEach(l=>{const c=l.el,u=c.style;fr(c,i),u.transform=u.webkitTransform=u.transitionDuration="";const d=c._moveCb=h=>{h&&h.target!==c||(!h||/transform$/.test(h.propertyName))&&(c.removeEventListener("transitionend",d),c._moveCb=null,Ur(c,i))};c.addEventListener("transitionend",d)})}),()=>{const i=Qe(t),a=XS(i);let l=i.tag||ot;o=r,r=e.default?db(e.default()):[];for(let c=0;c<r.length;c++){const u=r[c];u.key!=null&&Pc(u,Oc(u,a,s,n))}if(o)for(let c=0;c<o.length;c++){const u=o[c];Pc(u,Oc(u,a,s,n)),QS.set(u,u.el.getBoundingClientRect())}return I(l,null,r)}}},GO=t=>delete t.mode;eI.props;const tI=eI;function HO(t){const e=t.el;e._moveCb&&e._moveCb(),e._enterCb&&e._enterCb()}function jO(t){JS.set(t,t.el.getBoundingClientRect())}function KO(t){const e=QS.get(t),n=JS.get(t),s=e.left-n.left,o=e.top-n.top;if(s||o){const r=t.el.style;return r.transform=r.webkitTransform=`translate(${s}px,${o}px)`,r.transitionDuration="0s",t}}function qO(t,e,n){const s=t.cloneNode();t._vtc&&t._vtc.forEach(i=>{i.split(/\s+/).forEach(a=>a&&s.classList.remove(a))}),n.split(/\s+/).forEach(i=>i&&s.classList.add(i)),s.style.display="none";const o=e.nodeType===1?e:e.parentNode;o.appendChild(s);const{hasTransform:r}=YS(s);return o.removeChild(s),r}const F1=t=>{const e=t.props["onUpdate:modelValue"]||!1;return Be(e)?n=>mh(e,n):e};function XO(t){t.target.composing=!0}function O1(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const YO={created(t,{modifiers:{lazy:e,trim:n,number:s}},o){t._assign=F1(o);const r=s||o.props&&o.props.type==="number";ja(t,e?"change":"input",i=>{if(i.target.composing)return;let a=t.value;n&&(a=a.trim()),r&&(a=kg(a)),t._assign(a)}),n&&ja(t,"change",()=>{t.value=t.value.trim()}),e||(ja(t,"compositionstart",XO),ja(t,"compositionend",O1),ja(t,"change",O1))},mounted(t,{value:e}){t.value=e==null?"":e},beforeUpdate(t,{value:e,modifiers:{lazy:n,trim:s,number:o}},r){if(t._assign=F1(r),t.composing||document.activeElement===t&&t.type!=="range"&&(n||s&&t.value.trim()===e||(o||t.type==="number")&&kg(t.value)===e))return;const i=e==null?"":e;t.value!==i&&(t.value=i)}},ZO=["ctrl","shift","alt","meta"],QO={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>ZO.some(n=>t[`${n}Key`]&&!e.includes(n))},Cb=(t,e)=>(n,...s)=>{for(let o=0;o<e.length;o++){const r=QO[e[o]];if(r&&r(n,e))return}return t(n,...s)},mi={beforeMount(t,{value:e},{transition:n}){t._vod=t.style.display==="none"?"":t.style.display,n&&e?n.beforeEnter(t):sc(t,e)},mounted(t,{value:e},{transition:n}){n&&e&&n.enter(t)},updated(t,{value:e,oldValue:n},{transition:s}){!e!=!n&&(s?e?(s.beforeEnter(t),sc(t,!0),s.enter(t)):s.leave(t,()=>{sc(t,!1)}):sc(t,e))},beforeUnmount(t,{value:e}){sc(t,e)}};function sc(t,e){t.style.display=e?t._vod:"none"}const JO=Qt({patchProp:BO},$O);let P1;function eP(){return P1||(P1=sO(JO))}const tP=(...t)=>{const e=eP().createApp(...t),{mount:n}=e;return e.mount=s=>{const o=nP(s);if(!o)return;const r=e._component;!Ze(r)&&!r.render&&!r.template&&(r.template=o.innerHTML),o.innerHTML="";const i=n(o,!1,o instanceof SVGElement);return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),i},e};function nP(t){return Ht(t)?document.querySelector(t):t}const nI={theme:"maestro",onlyShowLegalMoves:!0,showActivation:!0,maxMoves:8,autoPlay:{black:!0,white:!1},show:{autoencoder:!1,continuation:!1,capturedPieces:!0,neuralOutput:!0,evaluation:!0,infoboxes:!0},orientation:"white",temperature:.5,playModelName:"50M_first",evaluationModelName:"20mevaltrain-1024neurons-4layers",autoencoderModelName:"256-64-autoencoder"};let Bc=Object.assign({},nI,JSON.parse(localStorage.getItem("settings")||"{}"));function sI(){return kb(Bc)}function un(t){if(!Bc.hasOwnProperty(t))throw new Error(`Invalid setting key: ${t}`);return Bc[t]}function sP(t){Bc=kb(t),localStorage.setItem("settings",JSON.stringify(Bc))}function oP(){return kb(nI)}function kb(t){return JSON.parse(JSON.stringify(t))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rP=1e-7,iP=1e-4;class oI{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class Sb{refCount(e){return ls("refCount")}incRef(e){return ls("incRef")}timerAvailable(){return!0}time(e){return ls("time")}read(e){return ls("read")}readSync(e){return ls("readSync")}readToGPU(e,n){return ls("readToGPU")}numDataIds(){return ls("numDataIds")}disposeData(e,n){return ls("disposeData")}write(e,n,s){return ls("write")}move(e,n,s,o,r){return ls("move")}createTensorFromGPUData(e,n,s){return ls("createTensorFromGPUData")}memory(){return ls("memory")}floatPrecision(){return ls("floatPrecision")}epsilon(){return this.floatPrecision()===32?rP:iP}dispose(){return ls("dispose")}}function ls(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aP(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,Ka(t,e,n)}function na(t,e,n){return Math.max(t,Math.min(e,n))}function Ib(t){return t%2===0?t:t+1}function Ka(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function lP(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function N(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function $b(t,e,n=""){N(mt(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function rI(t){N(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function oe(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function mt(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function hl(t){return t%1===0}function Mg(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function sl(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function M1(t,e=o=>0,n,s){return new Promise((o,r)=>{let i=0;const a=()=>{if(t()){o();return}i++;const l=e(i);if(n!=null&&i>=n){r();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function iI(t,e){let n=1,s=-1;for(let r=0;r<t.length;++r)if(t[r]>=0)n*=t[r];else if(t[r]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${r}`);s=r}else if(t[r]<0)throw Error(`Shapes can not be < 0. Found ${t[r]} at dim ${r}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const o=t.slice();return o[s]=e/n,o}function tt(t,e){const n=e.length;return t=t==null?e.map((s,o)=>o):[].concat(t),N(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),N(t.every(s=>hl(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function gi(t,e){const n=[],s=[],o=e!=null&&Array.isArray(e)&&e.length===0,r=e==null||o?null:tt(e,t).sort();let i=0;for(let a=0;a<t.length;++a){if(r!=null){if(r[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(r[i]==null||r[i]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),r[i]<=a&&i++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function An(t,e){return Ut(t,e)}function Ut(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function cP(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function uP(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function aI(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function _h(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function dP(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function du(t){return typeof t=="string"||t instanceof String}function hP(t){return typeof t=="boolean"}function Lg(t){return typeof t=="number"}function Ol(t){return Array.isArray(t)?Ol(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Lg(t)?"float32":du(t)?"string":hP(t)?"bool":"float32"}function Bg(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Vg(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Ae(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function lI(t,e,n,s=!1){const o=new Array;if(e.length===1){const r=e[0]*(s?2:1);for(let i=0;i<r;i++)o[i]=n[t+i]}else{const r=e[0],i=e.slice(1),a=i.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<r;l++)o[l]=lI(t+l*a,i,n,s)}return o}function yo(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((o,r)=>o*r)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return lI(0,t,e,n)}function fP(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Tb(t,e){const n=Rn(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function Rn(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function cI(t,e){const n=t.reduce((s,o)=>s*o,1);if(e==null||e==="float32")return yo(t,new Float32Array(n));if(e==="int32")return yo(t,new Int32Array(n));if(e==="bool")return yo(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Ar(t){t.forEach(e=>{N(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Ko(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let o=0;o<t.length-1;++o)s+=n[o]*t[o];return s}function Pl(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let o=0;o<s.length-1;++o)s[o]=Math.floor(t/n[o]),t-=s[o]*n[o];return s[s.length-1]=t,s}function Nb(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L1="tfjsflags";class pP{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=mP,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const o=this.urlFlags[e];Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${o}.`),this.set(e,o)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Nb(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);L1 in e&&e[L1].split(",").forEach(s=>{const[o,r]=s.split(":");this.urlFlags[o]=vP(o,r)})}}function mP(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(gP(e,s[0],s[1]),s.join("="))),e}function gP(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function vP(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function Q(){return uI}let uI=null;function bP(t){uI=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let Lm;function dI(){if(Lm==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");Lm=t}return Lm}function yP(){const t=dI();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Eb(t,e){const n=yP();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Vf="Abs",hu="Acos",fu="Acosh",Ml="Add",_b="AddN",Ab="All",Rb="Any",zf="ArgMax",Wf="ArgMin",pu="Asin",mu="Asinh",gu="Atan",vu="Atanh",bu="Atan2",Uf="AvgPool",Db="AvgPoolGrad",Gf="AvgPool3D",Fb="AvgPool3DGrad",Hf="BatchMatMul",jf="BatchToSpaceND",Ob="Bincount",Pb="BitwiseAnd",xP="BroadcastTo",hI="BroadcastArgs",yu="Cast",xu="Ceil",wu="ClipByValue",Mb="Complex",Kf="ComplexAbs",qf="Concat",Xf="Conv2D",Lb="Conv2DBackpropFilter",Yf="Conv2DBackpropInput",Zf="Conv3D",Bb="Conv3DBackpropFilterV2",Vb="Conv3DBackpropInputV2",Cu="Cos",ku="Cosh",zb="Cumprod",Qf="Cumsum",Wb="CropAndResize",Ub="DenseBincount",Gb="DepthToSpace",Jf="DepthwiseConv2dNative",Hb="DepthwiseConv2dNativeBackpropFilter",jb="DepthwiseConv2dNativeBackpropInput",fI="Diag",ep="Dilation2D",zg="Dilation2DBackpropInput",Wg="Dilation2DBackpropFilter",wP="Draw",Su="RealDiv",Kb="Einsum",Iu="Elu",qb="EluGrad",$u="Erf",tp="Equal",Tu="Exp",np="ExpandDims",Nu="Expm1",Xb="FFT",Yb="Fill",Zb="FlipLeftRight",Eu="Floor",_u="FloorDiv",sp="FusedBatchNorm",op="GatherV2",pI="GatherNd",rp="Greater",Au="GreaterEqual",Ru="Identity",Qb="IFFT",Jb="Imag",Du="IsFinite",Fu="IsInf",Ou="IsNan",ip="LeakyRelu",ap="Less",lp="LessEqual",mI="LinSpace",Pu="Log",Mu="Log1p",cp="LogicalAnd",up="LogicalNot",dp="LogicalOr",CP="LogSoftmax",hp="LRN",ey="LRNGrad",fp="Max",Lu="Maximum",pp="MaxPool",ty="MaxPoolGrad",mp="MaxPool3D",ny="MaxPool3DGrad",gI="MaxPoolWithArgmax",gp="Mean",vp="Min",Bu="Minimum",bp="MirrorPad",Vu="Mod",vI="Multinomial",zu="Multiply",yp="Neg",xp="NotEqual",sy="NonMaxSuppressionV3",oy="NonMaxSuppressionV4",ry="NonMaxSuppressionV5",wp="OnesLike",Cp="OneHot",kp="Pack",Sp="PadV2",Wu="Pow",Ip="Prelu",$p="Prod",bI="RaggedGather",yI="RaggedRange",xI="RaggedTensorToTensor",iy="Range",ay="Real",Uu="Reciprocal",Gu="Relu",Tp="Reshape",Np="ResizeNearestNeighbor",ly="ResizeNearestNeighborGrad",Ep="ResizeBilinear",cy="ResizeBilinearGrad",Hu="Relu6",_p="Reverse",ju="Round",Ku="Rsqrt",wI="ScatterNd",CI="TensorScatterUpdate",kI="SearchSorted",Ap="Select",qu="Selu",Rp="Slice",Xu="Sin",Yu="Sinh",Zu="Sign",Qu="Sigmoid",Ju="Softplus",ed="Sqrt",Dp="Sum",Fp="SpaceToBatchND",Op="SplitV",Pp="Softmax",SI="SparseFillEmptyRows",II="SparseReshape",$I="SparseSegmentMean",TI="SparseSegmentSum",NI="SparseToDense",td="SquaredDifference",uy="Square",dy="StaticRegexReplace",hy="StridedSlice",EI="StringNGrams",_I="StringSplit",AI="StringToHashBucketFast",nd="Sub",sd="Tan",od="Tanh",rd="Tile",fy="TopK",py="Transform",ol="Transpose",my="Unique",Mp="Unpack",Lp="UnsortedSegmentSum",Bp="ZerosLike",id="Step",kP="FromPixels",gy="RotateWithOffset",Ah="_FusedMatMul",Rh="FusedConv2D",RI="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(...t){Q().getBool("IS_TEST")||Q().getBool("PROD")||console.warn(...t)}function SP(...t){Q().getBool("IS_TEST")||Q().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dh=Eb("kernelRegistry",()=>new Map),Ug=Eb("gradRegistry",()=>new Map);function B1(t,e){const n=FI(t,e);return Dh.get(n)}function V1(t){return Ug.get(t)}function z1(t){const e=Dh.entries(),n=[];for(;;){const{done:s,value:o}=e.next();if(s)break;const[r,i]=o,[a]=r.split("_");a===t&&n.push(i)}return n}function DI(t){const{kernelName:e,backendName:n}=t,s=FI(e,n);Dh.has(s)&&Ts(`The kernel '${e}' for backend '${n}' is already registered`),Dh.set(s,t)}function IP(t){const{kernelName:e}=t;Ug.has(e)&&Q().getBool("DEBUG")&&Ts(`Overriding the gradient for '${e}'`),Ug.set(e,t)}function FI(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OI(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $P(t){var e=t.default;if(typeof e=="function"){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var o=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:function(){return t[s]}})}),n}var Gg=_t,js=null;try{js=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function _t(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}_t.prototype.__isLong__;Object.defineProperty(_t.prototype,"__isLong__",{value:!0});function Cs(t){return(t&&t.__isLong__)===!0}_t.isLong=Cs;var W1={},U1={};function xa(t,e){var n,s,o;return e?(t>>>=0,(o=0<=t&&t<256)&&(s=U1[t],s)?s:(n=At(t,(t|0)<0?-1:0,!0),o&&(U1[t]=n),n)):(t|=0,(o=-128<=t&&t<128)&&(s=W1[t],s)?s:(n=At(t,t<0?-1:0,!1),o&&(W1[t]=n),n))}_t.fromInt=xa;function Ks(t,e){if(isNaN(t))return e?ji:qs;if(e){if(t<0)return ji;if(t>=PI)return BI}else{if(t<=-H1)return fs;if(t+1>=H1)return LI}return t<0?Ks(-t,e).neg():At(t%fl|0,t/fl|0,e)}_t.fromNumber=Ks;function At(t,e,n){return new _t(t,e,n)}_t.fromBits=At;var Fh=Math.pow;function vy(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return qs;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return vy(t.substring(1),e,n).neg();for(var o=Ks(Fh(n,8)),r=qs,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+a),n);if(a<8){var c=Ks(Fh(n,a));r=r.mul(c).add(Ks(l))}else r=r.mul(o),r=r.add(Ks(l))}return r.unsigned=e,r}_t.fromString=vy;function No(t,e){return typeof t=="number"?Ks(t,e):typeof t=="string"?vy(t,e):At(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}_t.fromValue=No;var G1=1<<16,TP=1<<24,fl=G1*G1,PI=fl*fl,H1=PI/2,j1=xa(TP),qs=xa(0);_t.ZERO=qs;var ji=xa(0,!0);_t.UZERO=ji;var Za=xa(1);_t.ONE=Za;var MI=xa(1,!0);_t.UONE=MI;var Hg=xa(-1);_t.NEG_ONE=Hg;var LI=At(-1,2147483647,!1);_t.MAX_VALUE=LI;var BI=At(-1,-1,!0);_t.MAX_UNSIGNED_VALUE=BI;var fs=At(0,-2147483648,!1);_t.MIN_VALUE=fs;var we=_t.prototype;we.toInt=function(){return this.unsigned?this.low>>>0:this.low};we.toNumber=function(){return this.unsigned?(this.high>>>0)*fl+(this.low>>>0):this.high*fl+(this.low>>>0)};we.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(fs)){var n=Ks(e),s=this.div(n),o=s.mul(n).sub(this);return s.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=Ks(Fh(e,6),this.unsigned),i=this,a="";;){var l=i.div(r),c=i.sub(l.mul(r)).toInt()>>>0,u=c.toString(e);if(i=l,i.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};we.getHighBits=function(){return this.high};we.getHighBitsUnsigned=function(){return this.high>>>0};we.getLowBits=function(){return this.low};we.getLowBitsUnsigned=function(){return this.low>>>0};we.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&(e&1<<n)==0;n--);return this.high!=0?n+33:n+1};we.isZero=function(){return this.high===0&&this.low===0};we.eqz=we.isZero;we.isNegative=function(){return!this.unsigned&&this.high<0};we.isPositive=function(){return this.unsigned||this.high>=0};we.isOdd=function(){return(this.low&1)===1};we.isEven=function(){return(this.low&1)===0};we.equals=function(e){return Cs(e)||(e=No(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};we.eq=we.equals;we.notEquals=function(e){return!this.eq(e)};we.neq=we.notEquals;we.ne=we.notEquals;we.lessThan=function(e){return this.comp(e)<0};we.lt=we.lessThan;we.lessThanOrEqual=function(e){return this.comp(e)<=0};we.lte=we.lessThanOrEqual;we.le=we.lessThanOrEqual;we.greaterThan=function(e){return this.comp(e)>0};we.gt=we.greaterThan;we.greaterThanOrEqual=function(e){return this.comp(e)>=0};we.gte=we.greaterThanOrEqual;we.ge=we.greaterThanOrEqual;we.compare=function(e){if(Cs(e)||(e=No(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};we.comp=we.compare;we.negate=function(){return!this.unsigned&&this.eq(fs)?fs:this.not().add(Za)};we.neg=we.negate;we.add=function(e){Cs(e)||(e=No(e));var n=this.high>>>16,s=this.high&65535,o=this.low>>>16,r=this.low&65535,i=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,d=0,h=0,f=0;return f+=r+c,h+=f>>>16,f&=65535,h+=o+l,d+=h>>>16,h&=65535,d+=s+a,u+=d>>>16,d&=65535,u+=n+i,u&=65535,At(h<<16|f,u<<16|d,this.unsigned)};we.subtract=function(e){return Cs(e)||(e=No(e)),this.add(e.neg())};we.sub=we.subtract;we.multiply=function(e){if(this.isZero())return qs;if(Cs(e)||(e=No(e)),js){var n=js.mul(this.low,this.high,e.low,e.high);return At(n,js.get_high(),this.unsigned)}if(e.isZero())return qs;if(this.eq(fs))return e.isOdd()?fs:qs;if(e.eq(fs))return this.isOdd()?fs:qs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(j1)&&e.lt(j1))return Ks(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,o=this.high&65535,r=this.low>>>16,i=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,d=0,h=0,f=0,p=0;return p+=i*u,f+=p>>>16,p&=65535,f+=r*u,h+=f>>>16,f&=65535,f+=i*c,h+=f>>>16,f&=65535,h+=o*u,d+=h>>>16,h&=65535,h+=r*c,d+=h>>>16,h&=65535,h+=i*l,d+=h>>>16,h&=65535,d+=s*u+o*c+r*l+i*a,d&=65535,At(f<<16|p,d<<16|h,this.unsigned)};we.mul=we.multiply;we.divide=function(e){if(Cs(e)||(e=No(e)),e.isZero())throw Error("division by zero");if(js){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?js.div_u:js.div_s)(this.low,this.high,e.low,e.high);return At(n,js.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ji:qs;var s,o,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ji;if(e.gt(this.shru(1)))return MI;r=ji}else{if(this.eq(fs)){if(e.eq(Za)||e.eq(Hg))return fs;if(e.eq(fs))return Za;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(qs)?e.isNegative()?Za:Hg:(o=this.sub(e.mul(s)),r=s.add(o.div(e)),r)}else if(e.eq(fs))return this.unsigned?ji:qs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=qs}for(o=this;o.gte(e);){s=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:Fh(2,a-48),c=Ks(s),u=c.mul(e);u.isNegative()||u.gt(o);)s-=l,c=Ks(s,this.unsigned),u=c.mul(e);c.isZero()&&(c=Za),r=r.add(c),o=o.sub(u)}return r};we.div=we.divide;we.modulo=function(e){if(Cs(e)||(e=No(e)),js){var n=(this.unsigned?js.rem_u:js.rem_s)(this.low,this.high,e.low,e.high);return At(n,js.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};we.mod=we.modulo;we.rem=we.modulo;we.not=function(){return At(~this.low,~this.high,this.unsigned)};we.and=function(e){return Cs(e)||(e=No(e)),At(this.low&e.low,this.high&e.high,this.unsigned)};we.or=function(e){return Cs(e)||(e=No(e)),At(this.low|e.low,this.high|e.high,this.unsigned)};we.xor=function(e){return Cs(e)||(e=No(e)),At(this.low^e.low,this.high^e.high,this.unsigned)};we.shiftLeft=function(e){return Cs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?At(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):At(0,this.low<<e-32,this.unsigned)};we.shl=we.shiftLeft;we.shiftRight=function(e){return Cs(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?At(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):At(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};we.shr=we.shiftRight;we.shiftRightUnsigned=function(e){if(Cs(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return At(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?At(n,0,this.unsigned):At(n>>>e-32,0,this.unsigned)};we.shru=we.shiftRightUnsigned;we.shr_u=we.shiftRightUnsigned;we.toSigned=function(){return this.unsigned?At(this.low,this.high,!1):this};we.toUnsigned=function(){return this.unsigned?this:At(this.low,this.high,!0)};we.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};we.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};we.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};_t.fromBytes=function(e,n,s){return s?_t.fromBytesLE(e,n):_t.fromBytesBE(e,n)};_t.fromBytesLE=function(e,n){return new _t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};_t.fromBytesBE=function(e,n){return new _t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const NP=SD({__proto__:null,default:Gg},[Gg]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wi=Gg||NP;function Vp(t){return Wi.fromString(t,!0,16)}const VI=Vp("c3a5c85c97cb3127"),Mi=Vp("b492b66fbe98f273"),Bn=Vp("9ae16a3b2f90404f");function jg(t){return t.xor(t.shru(47))}function zI(t,e,n){const s=t.slice(e,e+n);return Wi.fromBytes(Array.from(s),!0,!0)}function St(t,e){return zI(t,e,8)}function K1(t,e){return zI(t,e,4)}function dn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function ti(t,e,n=Vp("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let o=e.xor(s).mul(n);return o=o.xor(o.shru(47)),o=o.mul(n),o}function EP(t,e,n,s,o,r){o=o.add(t),r=dn(r.add(o).add(s),21);const i=o;return o=o.add(e),o=o.add(n),r=r.add(dn(o,44)),[o.add(s),r.add(i)]}function Yd(t,e,n,s){return EP(St(t,e),St(t,e+8),St(t,e+16),St(t,e+24),n,s)}function _P(t,e=t.length){if(e>=8){const n=Bn.add(e*2),s=St(t,0).add(Bn),o=St(t,e-8),r=dn(o,37).mul(n).add(s),i=dn(s,25).add(o).mul(n);return ti(r,i,n)}if(e>=4){const n=Bn.add(e*2),s=K1(t,0);return ti(s.shl(3).add(e),K1(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],o=t[e-1],r=n+(s<<8),i=e+(o<<2);return jg(Bn.mul(r).xor(VI.mul(i))).mul(Bn)}return Bn}function AP(t,e=t.length){const n=Bn.add(e*2),s=St(t,0).mul(Mi),o=St(t,8),r=St(t,e-8).mul(n),i=St(t,e-16).mul(Bn);return ti(dn(s.add(o),43).add(dn(r,30)).add(i),s.add(dn(o.add(Bn),18)).add(r),n)}function RP(t,e=t.length){const n=Bn.add(e*2),s=St(t,0).mul(Bn),o=St(t,8),r=St(t,e-8).mul(n),i=St(t,e-16).mul(Bn),a=dn(s.add(o),43).add(dn(r,30)).add(i),l=ti(a,s.add(dn(o.add(Bn),18)).add(r),n),c=St(t,16).mul(n),u=St(t,24),d=a.add(St(t,e-32)).mul(n),h=l.add(St(t,e-24)).mul(n);return ti(dn(c.add(u),43).add(dn(d,30)).add(h),c.add(dn(u.add(s),18)).add(d),n)}function DP(t,e=t.length){const n=Wi.fromNumber(81,!0);if(e<=32)return e<=16?_P(t,e):AP(t,e);if(e<=64)return RP(t,e);let s=n,o=n.mul(Mi).add(113),r=jg(o.mul(Bn).add(113)).mul(Bn),i=[Wi.UZERO,Wi.UZERO],a=[Wi.UZERO,Wi.UZERO];s=s.mul(Bn).add(St(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do s=dn(s.add(o).add(i[0]).add(St(t,l+8)),37).mul(Mi),o=dn(o.add(i[1]).add(St(t,l+48)),42).mul(Mi),s=s.xor(a[1]),o=o.add(i[0]).add(St(t,l+40)),r=dn(r.add(a[0]),33).mul(Mi),i=Yd(t,l,i[1].mul(Mi),s.add(a[0])),a=Yd(t,l+32,r.add(a[1]),o.add(St(t,l+16))),[r,s]=[s,r],l+=64;while(l!==c);const d=Mi.add(r.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=dn(s.add(o).add(i[0]).add(St(t,l+8)),37).mul(d),o=dn(o.add(i[1]).add(St(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(St(t,l+40))),r=dn(r.add(a[0]),33).mul(d),i=Yd(t,l,i[1].mul(d),s.add(a[0])),a=Yd(t,l+32,r.add(a[1]),o.add(St(t,l+16))),[r,s]=[s,r],ti(ti(i[0],a[0],d).add(jg(o).mul(VI)).add(r),ti(i[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vi(t,e){return e==="string"?ni(t):wa([t],e)}function FP(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function wa(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=sa(t)),Q().getBool("DEBUG")&&cP(t,e),FP(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Yn(){return Q().platform.now()}function ni(t,e="utf-8"){return e=e||"utf-8",Q().platform.encode(t,e)}function ai(t,e="utf-8"){return e=e||"utf-8",Q().platform.decode(t,e)}function to(t){return Q().platform.isTypedArray!=null?Q().platform.isTypedArray(t):OI(t)}function sa(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Nb(t)||t==null||to(t)&&n)e.push(t);else if(Array.isArray(t)||to(t))for(let s=0;s<t.length;++s)sa(t[s],e,n);else{let s=-1;for(const o of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(o)&&(s=Math.max(s,Number(o)));for(let o=0;o<=s;o++)sa(t[o],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OP{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new MP)}profileKernel(e,n,s){let o;const r=()=>{o=s()};let i;const a=Yn();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(r);else{r();for(const c of o)c.dataSync();i=Promise.resolve({kernelMs:Yn()-a})}if(Q().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){const u=o[c];u.data().then(d=>{PP(d,u.dtype,e)})}return{kernelName:e,outputs:o,inputs:n,timeMs:i.then(c=>c.kernelMs),extraInfo:i.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:o,inputs:r,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),o,i]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],r,l[2])})})}}function PP(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const o=t[s];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${n}'`),!0}return!1}class MP{logKernelProfile(e,n,s,o,r,i){const a=typeof o=="number"?sl(`${o}ms`,9):o.error,l=sl(e,25),c=n.rank,u=n.size,d=sl(n.shape.toString(),14);let h="";for(const f in r){const p=r[f];if(p!=null){const m=p.shape||n.shape,g=m.length;h+=`${f}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${h}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(t,e,n){const s={},o={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const d in u){const h=u[d];let f=!1;for(let p=0;p<e.length;p++)if(s[h.id]){c.outputs.forEach(m=>s[m.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}const r={};r[n.id]=!0;const i={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(r[c.outputs[d].id]){for(const h in u)r[u[h].id]=!0,i[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(o[c.id]&&i[c.id]){const u={};for(const h in c.inputs){const f=c.inputs[h];s[f.id]&&(u[h]=f)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function BP(t,e,n,s){for(let o=e.length-1;o>=0;o--){const r=e[o],i=[];if(r.outputs.forEach(l=>{const c=t[l.id];c!=null?i.push(c):i.push(null)}),r.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${r.kernelName}.`);const a=r.gradient(i);for(const l in r.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=r.inputs[l];if(!mt(c.shape,u.shape))throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const d=t[u.id];t[u.id]=s(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q1=20,oc=3,Bm=7;function VP(t,e,n,s){const o=Ae(e),r=zP(t,e,n,o),i=e.length,a=bh(t,e,n,o,r),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function zP(t,e,n,s){const o=oe(e),r=s[s.length-1],i=new Array(r).fill(0),a=e.length,l=n==="complex64"?vc(t):t;if(a>1)for(let c=0;c<o/r;c++){const u=c*r;for(let d=0;d<r;d++)i[d]=Math.max(i[d],gc(l[u+d],0,n).length)}return i}function gc(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(Bm))} + ${parseFloat(t[1].toFixed(Bm))}j`:du(t)?s=`'${t}'`:n==="bool"?s=WI(t):s=parseFloat(t.toFixed(Bm)).toString(),sl(s,e)}function WI(t){return t===0?"false":"true"}function bh(t,e,n,s,o,r=!0){const i=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=vc(t);return[gc(m[0],0,n)]}return n==="bool"?[WI(t[0])]:[t[0].toString()]}if(l===1){if(a>q1){const g=oc*i;let v=Array.from(t.slice(0,g)),b=Array.from(t.slice((a-oc)*i,a*i));return n==="complex64"&&(v=vc(v),b=vc(b)),["["+v.map((y,x)=>gc(y,o[x],n)).join(", ")+", ..., "+b.map((y,x)=>gc(y,o[a-oc+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?vc(t):Array.from(t)).map((g,v)=>gc(g,o[v],n)).join(", ")+"]"]}const c=e.slice(1),u=s.slice(1),d=s[0]*i,h=[];if(a>q1){for(let m=0;m<oc;m++){const g=m*d,v=g+d;h.push(...bh(t.slice(g,v),c,n,u,o,!1))}h.push("...");for(let m=a-oc;m<a;m++){const g=m*d,v=g+d;h.push(...bh(t.slice(g,v),c,n,u,o,m===a-1))}}else for(let m=0;m<a;m++){const g=m*d,v=g+d;h.push(...bh(t.slice(g,v),c,n,u,o,m===a-1))}const f=l===2?",":"";h[0]="["+(a>0?h[0]+f:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+f;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(r?"":p),h}function vc(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class In{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=oe(e),s!=null){const o=s.length;N(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Ut(n,this.size),this.strides=Ae(e)}set(e,...n){n.length===0&&(n=[0]),N(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const o of e){if(o<0||o>=this.shape[n]){const r=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(r)}n++}let s=e[e.length-1];for(let o=0;o<e.length-1;++o)s+=this.strides[o]*e[o];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return ho().makeTensor(this.values,this.shape,this.dtype)}}let ho=null,qa=null;function WP(t){ho=t}function UP(t){qa=t}class Yt{constructor(e,n,s,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=oe(e),this.strides=Ae(e),this.dataId=s,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return qa.buffer(this.shape,this.dtype,e)}bufferSync(){return qa.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return yo(this.shape,e,this.dtype==="complex64")}arraySync(){return yo(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=ho().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ai(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),ho().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=ho().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ai(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await ho().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),ho().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return qa.print(this,e)}clone(){return this.throwIfDisposed(),qa.clone(this)}toString(e=!1){const n=this.dataSync();return VP(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),qa.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),ho().makeVariable(this,e,n,s)}}Object.defineProperty(Yt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function ne(){return Eb("Tensor",()=>Yt)}ne();class Oh extends Yt{constructor(e,n,s,o){super(e.shape,e.dtype,e.dataId,o),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!mt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);ho().disposeTensor(this),this.dataId=e.dataId,ho().incRef(this,null)}dispose(){ho().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Oh,Symbol.hasInstance,{value:t=>t instanceof Yt&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var X1;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(X1||(X1={}));var Kg;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(Kg||(Kg={}));var qg;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(qg||(qg={}));var Xg;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(Xg||(Xg={}));var Yg;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(Yg||(Yg={}));const GP={float32:Xg,int32:Kg,bool:qg,complex64:Yg};function vs(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return GP[t][e]}function by(t){return vs(t,"int32")}function UI(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function GI(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jt(t,e){if(t.dtype===e.dtype)return[t,e];const n=vs(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function HI(t){const e=[];return jI(t,e,new Set),e}function jI(t,e,n){if(t==null)return;if(t instanceof Yt){e.push(t);return}if(!HP(t))return;const s=t;for(const o in s){const r=s[o];n.has(r)||(n.add(r),jI(r,e,n))}}function HP(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vm(t){return t.kernelName!=null}class Y1{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class pl{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Y1}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(Ts(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new OP(this.backendInstance),!0}setupRegisteredKernels(){z1(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){z1(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof Sb)&&typeof s.then=="function"){const o=++this.pendingBackendInitId,r=s.then(i=>o<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,Ts(`Initialization of backend ${e} failed`),Ts(i.stack||i.message)),!1));return this.pendingBackendInit=r,{success:r,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Ts(`Initialization of backend ${e} failed`),Ts(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:o,asyncInit:r}=this.initializeBackend(s);if(r||o)return{name:s,asyncInit:r}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),o=s.backend,r=this.readSync(n),i=o.refCount(n);o.disposeData(n,!0),s.backend=e,e.move(n,r,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let o;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(o),()=>(o=n(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(e,n,s){e();try{const o=s();return n(),o}catch(o){throw n(),o}}nextTensorId(){return pl.nextTensorId++}nextVariableId(){return pl.nextVariableId++}clone(e){const n=H.runKernel(Ru,{x:e}),s={x:e},o=i=>({x:()=>{const a="float32",l={x:i},c={dtype:a};return H.runKernel(yu,l,c)}}),r=[];return this.addTapeNode(this.state.activeScope.name,s,[n],o,r,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(B1(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const o=this.backend.numDataIds();let r=0;s.forEach(l=>{r+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=o-n-r-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const o=this.isTapeOn(),r=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=Vm(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Vm(e)){const{kernelName:p,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const v=B1(p,this.backendName);N(v!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();l=v.kernelFunc({inputs:m,attrs:g,backend:this.backend});const y=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,y);const x=y.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(o){const w=this.getTensorsForGradient(p,m,x);s=this.saveTensorsForBackwardMode(w)}return x}}else{const{forwardFunc:p}=e,m=g=>{!o||(s=g.map(v=>this.keep(this.clone(v))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const v=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,g,v),v}}const{inputs:u,attrs:d}=e,h=Vm(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(f=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),o&&this.addTapeNode(c,u,n,h,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-r,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const o=V1(e);if(o!=null){const r=o.inputsToSave||[],i=o.outputsToSave||[];let a;o.saveAllInputs?(N(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=r.map(c=>n[c]);const l=s.filter((c,u)=>i[u]);return a.concat(l)}return[]}makeTensor(e,n,s,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",o=o||this.backend;let r=e;s==="string"&&du(e[0])&&(r=e.map(l=>ni(l)));const i=o.write(r,n,s),a=new Yt(n,s,i,this.nextTensorId());if(this.trackTensor(a,o),s==="string"){const l=this.state.tensorInfo.get(i),c=dP(r);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,o){s=s||"float32";const r={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(r,o)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:o,dtype:r}=e,i=new Yt(o,r,s,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(e,n=!0,s,o){s=s||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.cast(o));const r=new Oh(e,n,s,this.nextTensorId());if(this.state.registeredVariables[r.name]!=null)throw new Error(`Variable with name ${r.name} was already registered`);return this.state.registeredVariables[r.name]=r,this.incRef(r,this.backend),r}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*_h(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Oh||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*_h(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,o,r,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:r},l=V1(e);l!=null&&(o=l.gradFunc),o!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const h=s[d],f=Rn(h.size,h.dtype);return this.makeTensor(f,h.shape,h.dtype)}return u}),o(c.length>1?c:c[0],r,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=HI(e),s=new Set(n.map(r=>r.id));for(let r=0;r<this.state.activeScope.track.length;r++){const i=this.state.activeScope.track[r];!i.kept&&!s.has(i.id)&&i.dispose()}const o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(r=>{!r.kept&&r.scopeId===o.id&&this.track(r)})}gradients(e,n,s,o=!1){if(N(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const r=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));N(r instanceof Yt,()=>"The result y returned by f() must be a tensor.");const i=LP(this.state.activeTape,n,r);if(!o&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[r.id]=s==null?jP(r.shape):s,BP(a,i,c=>this.tidy(c),KP);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:r,grads:l}})}customGrad(e){return N(Bg(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{N(n.every(a=>a instanceof Yt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const o={};n.forEach((a,l)=>{o[l]=a});const r=(a,l)=>(s=e(...n,l),N(s.value instanceof Yt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),N(Bg(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const c=s.gradFunc(a,l),u=Array.isArray(c)?c:[c];N(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),N(u.every(h=>h instanceof Yt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((h,f)=>{d[f]=()=>h}),d};return this.runKernelFunc({forwardFunc:r,backwardsFunc:i,inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Yn(),s=await this.backend.time(e);return s.wallMs=Yn()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Y1;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}pl.nextTensorId=0;pl.nextVariableId=0;function jP(t){const e=Tb(oe(t),"float32");return H.makeTensor(e,t,"float32")}function KI(){const t=dI();if(t._tfengine==null){const e=new pP(t);t._tfengine=new pl(e)}return bP(t._tfengine.ENV),WP(()=>t._tfengine),t._tfengine}const H=KI();function KP(t,e){const n={a:t,b:e};return H.runKernel(Ml,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qP(){return typeof navigator<"u"&&navigator!=null}function qI(t){if(t||qP()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function XI(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const os=Q();os.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});os.registerFlag("IS_BROWSER",()=>XI());os.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");os.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));os.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));os.registerFlag("PROD",()=>!1);os.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>os.getBool("DEBUG"));os.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);os.registerFlag("IS_TEST",()=>!1);os.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>os.getBool("DEBUG"));os.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);os.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);os.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zp(t,e){let n=t;if(to(t))return e==="string"?[]:[t.length];if(UI(t)){const o=t.channels||"RGBA";return[t.height,t.width*o.length]}else if(GI(t))return[t.buffer.size/(e==null?4:_h(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||to(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&Q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&YI(t,s,[]),s}function YI(t,e,n){if(n=n||[],!Array.isArray(t)&&!to(t)){N(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}N(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),N(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let o=0;o<t.length;++o)YI(t[o],s,n.concat(o))}function Z1(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function L(t,e,n,s="numeric"){if(t instanceof Yt)return Z1(s,t.dtype,e,n),t;let o=Ol(t);if(o!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(o=s),Z1(s,o,e,n),t==null||!to(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const r=zp(t,o);!to(t)&&!Array.isArray(t)&&(t=[t]);const a=o!=="string"?wa(t,o):sa(t,[],!0);return H.makeTensor(a,r,o)}function ZI(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((r,i)=>L(r,`${e}[${i}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XP="__op";function q(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+XP;const o=(...r)=>{H.startScope(n);try{const i=s(...r);return Nb(i)&&console.error("Cannot return a Promise inside of tidy."),H.endScope(i),i}catch(i){throw H.endScope(null),i}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(t,e){const n=L(t,"real","complex"),s=L(e,"imag","complex");$b(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const o={real:n,imag:s};return H.runKernel(Mb,o)}const oa=q({complex_:YP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wp(t,e,n,s){if(s==null)s=Ol(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(GI(t)||UI(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return H.backend.createTensorFromGPUData(t,e||n,s)}if(!to(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Ar(e);const o=oe(e),r=oe(n);N(o===r,()=>`Based on the provided shape, [${e}], the tensor should have ${o} values but has ${r}`);for(let i=0;i<n.length;++i){const a=n[i],l=i===n.length-1?a!==oe(e.slice(i)):!0;N(n[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!to(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?wa(t,s):sa(t,[],!0),H.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rl(t,e,n){const s=zp(t,n);return Wp(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q1={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Rr{static join(e){return new Rr(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>to(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const o=e[s];s!==e.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const r=n+o.byteLength;this.shards.push({buffer:o,start:n,end:r}),n=r}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const o=n-e,r=new ArrayBuffer(o),i=new Uint8Array(r);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,h=a,p=Math.min(n,c.end)-c.start,m=new Uint8Array(c.buffer,d,p-d);if(i.set(m,h),a+=m.length,n<c.end)break}return r}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(o){return e<o.start?-1:e>=o.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=ZP(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function ZP(t,e){let n=0,s=t.length;for(;n<=s;){const o=Math.floor((s-n)/2)+n,r=e(t[o]);if(r===0)return o;r<0?s=o:n=o+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ph=4;async function J1(t,e){const n=[],s=[],o=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<o.length;++i){const a=o[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const h=await l.bytes(),f=h.reduce((g,v)=>g+v.length,0)+Ph*h.length,p=new Uint8Array(f);let m=0;for(let g=0;g<h.length;g++){const v=h[g],b=new Uint8Array(new Uint32Array([v.length]).buffer);p.set(b,m),m+=Ph,p.set(v,m),m+=v.length}d(p)});s.push(u)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const r=await Promise.all(s);return{data:JP(r),specs:n}}function QP(t,e){const n=new Rr(t),s={};let o,r=0;for(const i of e){const a=i.name,l=i.dtype,c=i.shape,u=oe(c);let d;if("quantization"in i){const h=i.quantization;if(h.dtype==="uint8"||h.dtype==="uint16"){if(!("min"in h&&"scale"in h))throw new Error(`Weight ${i.name} with quantization ${h.dtype} doesn't have corresponding metadata min and scale.`)}else if(h.dtype==="float16"){if(l!=="float32")throw new Error(`Weight ${i.name} is quantized with ${h.dtype} which only supports weights of type float32 not ${l}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${h.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const f=Q1[h.dtype],p=n.slice(r,r+u*f),m=h.dtype==="uint8"?new Uint8Array(p):new Uint16Array(p);if(l==="float32")if(h.dtype==="uint8"||h.dtype==="uint16"){d=new Float32Array(m.length);for(let g=0;g<m.length;g++){const v=m[g];d[g]=v*h.scale+h.min}}else if(h.dtype==="float16")o===void 0&&(o=cM()),d=o(m);else throw new Error(`Unsupported quantization type ${h.dtype} for weight type float32.`);else if(l==="int32"){if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error(`Unsupported quantization type ${h.dtype} for weight type int32.`);d=new Int32Array(m.length);for(let g=0;g<m.length;g++){const v=m[g];d[g]=Math.round(v*h.scale+h.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${l}`);r+=u*f}else if(l==="string"){const h=oe(i.shape);d=[];for(let f=0;f<h;f++){const p=new Uint32Array(n.slice(r,r+Ph))[0];r+=Ph;const m=new Uint8Array(n.slice(r,r+p));d.push(m),r+=p}}else{const h=Q1[l],f=n.slice(r,r+u*h);if(l==="float32")d=new Float32Array(f);else if(l==="int32")d=new Int32Array(f);else if(l==="bool")d=new Uint8Array(f);else if(l==="complex64"){d=new Float32Array(f);const p=new Float32Array(d.length/2),m=new Float32Array(d.length/2);for(let b=0;b<p.length;b++)p[b]=d[b*2],m[b]=d[b*2+1];const g=rl(p,c,"float32"),v=rl(m,c,"float32");s[a]=oa(g,v),g.dispose(),v.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${l}`);r+=u*h}l!=="complex64"&&(s[a]=rl(d,c,l))}return s}function JP(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(r=>{if(e+=r.byteLength,n.push(r.byteLength===r.buffer.byteLength?r:new r.constructor(r)),!(r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${r.constructor.name}`)});const s=new Uint8Array(e);let o=0;return n.forEach(r=>{s.set(new Uint8Array(r.buffer),o),o+=r.byteLength}),s.buffer}const yy=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ew(t){return yy?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function eM(t){if(yy)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,o=e.length;s<o;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function tM(t){if(yy){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function nM(t){return Rr.join(t)}function QI(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function sM(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function oM(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),sM(t,n,s)}function Up(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:ew(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:ew(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Rr(t.weightData).byteLength}}function rM(t){const e=[];for(const n of t)e.push(...n.weights);return e}function iM(){const t=n=>{let s=n<<13,o=0;for(;(s&8388608)===0;)o-=8388608,s<<=1;return s&=-8388609,o+=947912704,s|o},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function aM(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function lM(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function cM(){const t=iM(),e=aM(),n=lM();return s=>{const o=new ArrayBuffer(4*s.length),r=new Uint32Array(o);for(let i=0;i<s.length;i++){const a=s[i],l=t[n[a>>10]+(a&1023)]+e[a>>10];r[i]=l}return new Float32Array(o)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class en{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return en.instance==null&&(en.instance=new en),en.instance}static registerSaveRouter(e){en.getInstance().saveRouters.push(e)}static registerLoadRouter(e){en.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return en.getHandlers(e,"save")}static getLoadHandlers(e,n){return en.getHandlers(e,"load",n)}static getHandlers(e,n,s){const o=[];return(n==="load"?en.getInstance().loadRouters:en.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&o.push(a)}),o}}const uM=t=>en.getSaveHandlers(t),dM=(t,e)=>en.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zg="tensorflowjs",Qg=1,Ki="models_store",Xr="model_info_store";function JI(){if(!Q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Jg(t){const e=t.result;e.createObjectStore(Ki,{keyPath:"modelPath"}),e.createObjectStore(Xr,{keyPath:"modelPath"})}class ra{constructor(e){if(this.indexedDB=JI(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,o)=>{const r=this.indexedDB.open(Zg,Qg);r.onupgradeneeded=()=>Jg(r),r.onsuccess=()=>{const i=r.result;if(n==null){const a=i.transaction(Ki,"readonly"),c=a.objectStore(Ki).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return i.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=u=>(i.close(),o(c.error)),a.oncomplete=()=>i.close()}else{n.weightData=Rr.join(n.weightData);const a=Up(n),l=i.transaction(Xr,"readwrite");let c=l.objectStore(Xr),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return o(h)}let d;u.onsuccess=()=>{d=i.transaction(Ki,"readwrite");const h=d.objectStore(Ki);let f;try{f=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return o(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{c=l.objectStore(Xr);const m=c.delete(this.modelPath);m.onsuccess=()=>(i.close(),o(f.error)),m.onerror=g=>(i.close(),o(f.error))}},u.onerror=h=>(i.close(),o(u.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},r.onerror=i=>o(r.error)})}}ra.URL_SCHEME="indexeddb://";const e$=t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ra.URL_SCHEME)?hM(t.slice(ra.URL_SCHEME.length)):null;en.registerSaveRouter(e$);en.registerLoadRouter(e$);function hM(t){return new ra(t)}function fM(t){return t.startsWith(ra.URL_SCHEME)?t.slice(ra.URL_SCHEME.length):t}class pM{constructor(){this.indexedDB=JI()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(Zg,Qg);s.onupgradeneeded=()=>Jg(s),s.onsuccess=()=>{const o=s.result,r=o.transaction(Xr,"readonly"),a=r.objectStore(Xr).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(o.close(),n(a.error)),r.oncomplete=()=>o.close()},s.onerror=o=>n(s.error)})}async removeModel(e){return e=fM(e),new Promise((n,s)=>{const o=this.indexedDB.open(Zg,Qg);o.onupgradeneeded=()=>Jg(o),o.onsuccess=()=>{const r=o.result,i=r.transaction(Xr,"readwrite"),a=i.objectStore(Xr),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return r.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=r.transaction(Ki,"readwrite");const f=c.objectStore(Ki).delete(e);f.onsuccess=()=>n(l.result.modelArtifactsInfo),f.onerror=p=>s(l.error)};u.onsuccess=d,u.onerror=h=>(d(),r.close(),s(l.error))}},l.onerror=u=>(r.close(),s(l.error)),i.oncomplete=()=>{c==null?r.close():c.oncomplete=()=>r.close()}},o.onerror=r=>s(o.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gr="/",Xa="tensorflowjs_models",t$="info",mM="model_topology",gM="weight_specs",vM="weight_data",bM="model_metadata";function n$(t){return{info:[Xa,t,t$].join(gr),topology:[Xa,t,mM].join(gr),weightSpecs:[Xa,t,gM].join(gr),weightData:[Xa,t,vM].join(gr),modelMetadata:[Xa,t,bM].join(gr)}}function s$(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function yM(t){const e=t.split(gr);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(gr)}function xM(t){return t.startsWith(ia.URL_SCHEME)?t.slice(ia.URL_SCHEME.length):t}class ia{constructor(e){if(!Q().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=n$(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),o=Up(e),r=Rr.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,eM(r));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:o}}catch{throw s$(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=o;const r=this.LS.getItem(this.keys.modelMetadata);if(r!=null){const a=JSON.parse(r);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=tM(i),n}}ia.URL_SCHEME="localstorage://";const o$=t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ia.URL_SCHEME)?wM(t.slice(ia.URL_SCHEME.length)):null;en.registerSaveRouter(o$);en.registerLoadRouter(o$);function wM(t){return new ia(t)}class CM{constructor(){N(Q().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),N(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Xa+gr,s=gr+t$;for(let o=0;o<this.LS.length;++o){const r=this.LS.key(o);if(r.startsWith(n)&&r.endsWith(s)){const i=yM(r);e[i]=JSON.parse(this.LS.getItem(r))}}return e}async removeModel(e){e=xM(e);const n=n$(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return s$(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tw="://";class Lo{constructor(){this.managers={}}static getInstance(){return Lo.instance==null&&(Lo.instance=new Lo),Lo.instance}static registerManager(e,n){N(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(tw)&&(e=e.slice(0,e.indexOf(tw))),N(e.length>0,()=>"scheme must not be an empty string.");const s=Lo.getInstance();N(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=Lo.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Lo.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kM{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!Q().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const o=this.functionRefs[s.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return OI(e)}}if(Q().get("IS_BROWSER")){Q().setPlatform("browser",new kM);try{Lo.registerManager(ia.URL_SCHEME,new CM)}catch{}try{Lo.registerManager(ra.URL_SCHEME,new pM)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM={importFetch:()=>require("node-fetch")};let zm;class IM{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return Q().global.fetch!=null?Q().global.fetch(e,n):(zm==null&&(zm=SM.importFetch()),zm(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}Q().get("IS_NODE")&&!Q().get("IS_BROWSER")&&Q().setPlatform("node",new IM);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function et(t,e="float32",n){return e=e||"float32",Ar(t),new In(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $M(t,e){const n=L(t,"x","cast");if(!uP(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},o={dtype:e};return H.runKernel(yu,s,o)}const Se=q({cast_:$M});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TM(t){const n={x:L(t,"x","clone","string_or_numeric")};return H.runKernel(Ru,n)}const Zi=q({clone_:TM});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NM(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */KI();const EM={buffer:et,cast:Se,clone:Zi,print:NM};UP(EM);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mo(){return H}function ev(){return H.memory()}function Z(t,e){return H.tidy(t,e)}function Je(t){HI(t).forEach(n=>n.dispose())}function qo(t){return H.keep(t)}function r$(t,e,n=1){return H.registerBackend(t,e,n)}function _M(){return H.backend}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AM(t,e){let n=L(t,"a","add"),s=L(e,"b","add");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(Ml,o)}const be=q({add_:AM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RM(t,e){let n=L(t,"a","floorDiv"),s=L(e,"b","floorDiv");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(_u,o)}const i$=q({floorDiv_:RM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DM(t,e){let n=L(t,"a","div"),s=L(e,"b","div");if([n,s]=jt(n,s),n.dtype==="int32"&&s.dtype==="int32")return i$(n,s);const o={a:n,b:s},r={};return H.runKernel(Su,o,r)}const Me=q({div_:DM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FM(t,e){let n=L(t,"a","mul"),s=L(e,"b","mul");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(zu,o)}const G=q({mul_:FM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OM(t){const e=L(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return H.runKernel(Kf,n)}else{const n={x:e};return H.runKernel(Vf,n)}}const Mn=q({abs_:OM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PM(t){const n={x:L(t,"x","acos")};return H.runKernel(hu,n)}const MM=q({acos_:PM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LM(t){const n={x:L(t,"x","acosh")};return H.runKernel(fu,n)}const BM=q({acosh_:LM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VM(t,e=null,n=!1){const o={x:L(t,"x","all","bool")},r={axis:e,keepDims:n};return H.runKernel(Ab,o,r)}const a$=q({all_:VM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zM(t,e=null,n=!1){const o={x:L(t,"x","any","bool")},r={axis:e,keepDims:n};return H.runKernel(Rb,o,r)}const tv=q({any_:zM});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WM(t,e=0){const s={x:L(t,"x","argMax")},o={axis:e};return H.runKernel(zf,s,o)}const Vc=q({argMax_:WM});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UM(t,e=0){const s={x:L(t,"x","argMin")},o={axis:e};return H.runKernel(Wf,s,o)}const GM=q({argMin_:UM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HM(t){const n={x:L(t,"x","asin")};return H.runKernel(pu,n)}const jM=q({asin_:HM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KM(t){const n={x:L(t,"x","asinh")};return H.runKernel(mu,n)}const qM=q({asinh_:KM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XM(t){const n={x:L(t,"x","atan")};return H.runKernel(gu,n)}const YM=q({atan_:XM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZM(t,e){let n=L(t,"a","atan2"),s=L(e,"b","atan2");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(bu,o)}const QM=q({atan2_:ZM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JM(t){const n={x:L(t,"x","atanh")};return H.runKernel(vu,n)}const eL=q({atanh_:JM});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ad(t,e,n,s,o="NHWC",r){const i=t[3],a=[...e,i],l=Fr(o);return Tn(t,a,n,r,s,null,null,l)}function ro(t,e,n,s,o,r,i="channelsLast"){const[a,l]=zc(e);let c;if(i==="channelsLast")c=[a,l,t[3],t[3]];else if(i==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return Tn(t,c,n,s,o,r,!1,i)}function Dr(t,e,n,s,o,r,i="NDHWC"){const[a,l,c]=nv(e);let u,d;if(i==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(i==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return bi(t,u,n,s,o,!1,d,r)}function Tn(t,e,n,s,o,r,i=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[h,f,,p]=e,[m,g]=zc(n),[v,b]=zc(s),y=il(h,v),x=il(f,b),{padInfo:w,outHeight:k,outWidth:S}=sL(o,c,u,m,g,y,x,r,a),C=i?p*d:p;let $;return a==="channelsFirst"?$=[l,C,k,S]:a==="channelsLast"&&($=[l,k,S,C]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:k,outWidth:S,outChannels:C,padInfo:w,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:f,effectiveFilterHeight:y,effectiveFilterWidth:x,dilationHeight:v,dilationWidth:b,inShape:t,outShape:$,filterShape:e}}function bi(t,e,n,s,o,r=!1,i="channelsLast",a){let[l,c,u,d,h]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,c,u,d,h]=t;else if(i==="channelsFirst")[l,h,c,u,d]=t;else throw new Error(`Unknown dataFormat ${i}`);const[f,p,m,,g]=e,[v,b,y]=nv(n),[x,w,k]=nv(s),S=il(f,x),C=il(p,w),$=il(m,k),{padInfo:T,outDepth:E,outHeight:_,outWidth:A}=oL(o,c,u,d,v,b,y,S,C,$,a),O=r?g*h:g;let B;return i==="channelsFirst"?B=[l,O,E,_,A]:i==="channelsLast"&&(B=[l,E,_,A,O]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:u,inWidth:d,inChannels:h,outDepth:E,outHeight:_,outWidth:A,outChannels:O,padInfo:T,strideDepth:v,strideHeight:b,strideWidth:y,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:C,effectiveFilterWidth:$,dilationDepth:x,dilationHeight:w,dilationWidth:k,inShape:t,outShape:B,filterShape:e}}function tL(t,e,n,s,o){s==null&&(s=xy(t,e,n));const r=t[0],i=t[1],a=Wc((r-e+2*s)/n+1,o),l=Wc((i-e+2*s)/n+1,o);return[a,l]}function nL(t,e,n,s,o,r){o==null&&(o=xy(t,e[0],s[0]));const i=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*o>=e[a]&&(i[a]=Wc((t[a]-e[a]+2*o)/s[a]+1,r));return i}function xy(t,e,n,s=1){const o=il(e,s);return Math.floor((t[0]*(n-1)-n+o)/2)}function zc(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function nv(t){return typeof t=="number"?[t,t,t]:t}function il(t,e){return e<=1?t:t+(t-1)*(e-1)}function sL(t,e,n,s,o,r,i,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=tL([e,n],r,s,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(e/s),d=Math.ceil(n/o);const h=Math.max(0,(u-1)*s+r-e),f=Math.max(0,(d-1)*o+i-n),p=Math.floor(h/2),m=h-p,g=Math.floor(f/2),v=f-g;c={top:p,bottom:m,left:g,right:v,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-r+1)/s),d=Math.ceil((n-i+1)/o);else if(typeof t=="object"){const h=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];c={top:h,bottom:f,left:p,right:m,type:h===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},u=Wc((e-r+h+f)/s+1,a),d=Wc((n-i+p+m)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function oL(t,e,n,s,o,r,i,a,l,c,u){let d,h,f,p;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=nL([e,n,s,1],[a,l,c],1,[o,r,i],t,u);h=g[0],f=g[1],p=g[2]}else if(t==="same"){h=Math.ceil(e/o),f=Math.ceil(n/r),p=Math.ceil(s/i);const m=(h-1)*o+a-e,g=(f-1)*r+l-n,v=(p-1)*i+c-s,b=Math.floor(m/2),y=m-b,x=Math.floor(g/2),w=g-x,k=Math.floor(v/2),S=v-k;d={top:x,bottom:w,left:k,right:S,front:b,back:y,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}function Wc(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function aa(t){const[e,n,s]=zc(t);return e===1&&n===1&&s===1}function Dn(t,e){return aa(t)||aa(e)}function la(t){return zc(t).every(e=>e>0)}function Fr(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function is(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")N(hl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(o=>{N(hl(o),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${o}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rL(t,e){const s={x:L(t,"x","reshape","string_or_numeric")},o={shape:e};return H.runKernel(Tp,s,o)}const K=q({reshape_:rL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iL(t,e,n,s,o){const r=L(t,"x","avgPool","float32"),i=1;N(Dn(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let a=r,l=!1;r.rank===3&&(l=!0,a=K(r,[1,r.shape[0],r.shape[1],r.shape[2]])),N(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),is("avgPool",s,o);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:o};let d=H.runKernel(Uf,c,u);return d=Se(d,r.dtype),l?K(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const wy=q({avgPool_:iL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(t,e,n,s,o,r="NDHWC"){const i=L(t,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=K(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),N(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),N(r==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),N(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),is("avgPool3d",s,o);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:o,dataFormat:r};let d=H.runKernel(Gf,c,u);return d=Se(d,a.dtype),l?K(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const lL=q({avgPool3d_:aL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(t,e=0){N(t.length>=1,()=>"Pass at least one tensor to concat");const n=ZI(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(r=>{if(r.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${r.dtype}. `)}),n.length===1)return Zi(n[0]);const s=n,o={axis:e};return H.runKernel(qf,s,o)}const ns=q({concat_:cL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uL(t,e,n=!1,s=!1){let o=L(t,"a","matMul"),r=L(e,"b","matMul");[o,r]=jt(o,r);const i={a:o,b:r},a={transposeA:n,transposeB:s};return H.runKernel(Hf,i,a)}const ft=q({matMul_:uL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(t){const n={x:L(t,"x","sigmoid","float32")};return H.runKernel(Qu,n)}const Ll=q({sigmoid_:dL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hL(t,e,n){const s=L(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const o={x:s},r={begin:e,size:n};return H.runKernel(Rp,o,r)}const It=q({slice_:hL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(t){const n={x:L(t,"x","tanh","float32")};return H.runKernel(od,n)}const Cy=q({tanh_:fL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pL(t,e,n){const s=L(t,"x","batchToSpaceND"),o=e.reduce((a,l)=>a*l);N(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),N(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),N(s.shape[0]%o===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${o}`);const r={x:s},i={blockShape:e,crops:n};return H.runKernel(jf,r,i)}const ky=q({batchToSpaceND_:pL});function mL(t){let e;return t.rank===0||t.rank===1?e=K(t,[1,1,1,t.size]):t.rank===2?e=K(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=K(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gL(t,e,n,s,o,r){r==null&&(r=.001);const i=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let c;o!=null&&(c=L(o,"scale","batchNorm"));let u;s!=null&&(u=L(s,"offset","batchNorm")),N(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),N(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),N(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:mL(i),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:r},p=H.runKernel(sp,h,f);return K(p,i.shape)}const Gp=q({batchNorm_:gL});function vL(t,e,n,s,o,r){const i=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let c;o!=null&&(c=L(o,"scale","batchNorm"));let u;return s!=null&&(u=L(s,"offset","batchNorm")),N(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),N(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),N(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&N(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&N(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Gp(i,a,l,u,c,r)}const bL=q({batchNorm2d_:vL});function yL(t,e,n,s,o,r){const i=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let c;o!=null&&(c=L(o,"scale","batchNorm"));let u;return s!=null&&(u=L(s,"offset","batchNorm")),N(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),N(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),N(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&N(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&N(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Gp(i,a,l,u,c,r)}const xL=q({batchNorm3d_:yL});function wL(t,e,n,s,o,r){const i=L(t,"x","batchNorm"),a=L(e,"mean","batchNorm"),l=L(n,"variance","batchNorm");let c;o!=null&&(c=L(o,"scale","batchNorm"));let u;return s!=null&&(u=L(s,"offset","batchNorm")),N(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),N(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),N(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&N(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&N(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Gp(i,a,l,u,c,r)}const CL=q({batchNorm4d_:wL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(t,e,n){const s=L(t,"x","bincount"),o=L(e,"weights","bincount");N(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),N(n>=0,()=>`size must be non-negative, but got ${n}.`),N(o.size===s.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${o.shape}.`);const r={x:s,weights:o},i={size:n};return H.runKernel(Ob,r,i)}const SL=q({bincount_:kL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IL(t,e){let n=L(t,"broadcastTo","x");const s=n.shape;if(Ar(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=K(n,c)}const o=n.shape,r=Array.from(e);for(let c=e.length-1;c>=0;c--)if(o[c]===e[c])r[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(r.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Zi(n);const a={x:n},l={reps:r};return H.runKernel(rd,a,l)}const $c=q({broadcastTo_:IL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $L(t){const n={x:L(t,"x","ceil","float32")};return H.runKernel(xu,n)}const TL=q({ceil_:$L});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hp(t,e,n){Ar(t),n=n||Ol(e);const s={shape:t,value:e,dtype:n};return H.runKernel(Yb,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(t,e,n){const s=L(t,"x","clipByValue");if(N(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Hp(s.shape,e,s.dtype);const o={x:s},r={clipValueMin:e,clipValueMax:n};return H.runKernel(wu,o,r)}const Rs=q({clipByValue_:NL});function EL(t){return ns(t,0)}const _L=q({concat1d_:EL});function AL(t,e){return ns(t,e)}const RL=q({concat2d_:AL});function DL(t,e){return ns(t,e)}const FL=q({concat3d_:DL});function OL(t,e){return ns(t,e)}const PL=q({concat4d_:OL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ML(t,e,n,s,o="NHWC",r=[1,1],i){const a=L(t,"x","conv2d","float32"),l=L(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=K(a,[1,a.shape[0],a.shape[1],a.shape[2]])),N(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),N(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),is("conv2d",s,i);const d=o==="NHWC"?c.shape[3]:c.shape[1];N(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),N(Dn(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),N(la(r),()=>"Error in conv2D: Dilated rates should be larger than 0."),N(la(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:c,filter:l},f={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i},p=H.runKernel(Xf,h,f);return u?K(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const ca=q({conv2d_:ML});function LL(t,e,n,s,o="NWC",r=1,i){const a=L(t,"x","conv1d"),l=L(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=K(a,[1,a.shape[0],a.shape[1]])),N(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),N(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),is("conv1d",s,i),N(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),N(Dn(n,r),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${r}'`),N(la(r),()=>"Error in conv1D: Dilated rates should be larger than 0."),N(la(n),()=>"Error in conv1D: Stride should be larger than 0."),N(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);const d=K(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=K(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=ca(h,d,[1,n],s,"NHWC",[1,r],i);return u?K(g,[g.shape[2],g.shape[3]]):K(g,[g.shape[0],g.shape[2],g.shape[3]])}const l$=q({conv1d_:LL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BL(t,e,n,s,o,r="NHWC",i){N(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=K(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),N(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),N(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),N(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=r==="NHWC"?a[3]:a[1],d=r==="NHWC"?l.shape[3]:l.shape[1];N(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),N(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),is("conv2dDerInput",o,i);const h={dy:l,filter:n},f={strides:s,pad:o,dataFormat:r,dimRoundingMode:i,inputShape:a},p=H.runKernel(Yf,h,f);return c?K(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Sy=q({conv2DBackpropInput_:BL});function VL(t,e,n,s,o,r){const i=L(t,"x","conv2dTranspose"),a=L(e,"filter","conv2dTranspose");return Sy(n,i,a,s,o,"NHWC",r)}const c$=q({conv2dTranspose_:VL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(t,e,n,s,o="NDHWC",r=[1,1,1]){const i=L(t,"x","conv3d"),a=L(e,"filter","conv3d");let l=i,c=!1;i.rank===4&&(c=!0,l=K(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),N(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),N(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),N(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),N(Dn(n,r),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`),N(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),N(la(r),()=>"Error in conv3D: Dilated rates should be larger than 0."),N(la(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:n,pad:s,dataFormat:o,dilations:r},h=H.runKernel(Zf,u,d);return c?K(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const WL=q({conv3d_:zL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(t,e,n,s,o){N(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let r=t,i=e,a=!1;e.rank===4&&(a=!0,i=K(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),r=[1,t[0],t[1],t[2],t[3]]);const l=r[4],c=i.shape[4];N(r.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${r.length}.`),N(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),N(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),N(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),N(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:i,filter:n},d={pad:o,strides:s,inputShape:r},h=H.runKernel(Vb,u,d);return a?K(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const u$=q({conv3DBackpropInput_:UL});function GL(t,e,n,s,o){const r=L(t,"x","conv3dTranspose"),i=L(e,"filter","conv3dTranspose");return u$(n,r,i,s,o)}const HL=q({conv3dTranspose_:GL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jL(t){const n={x:L(t,"x","cos","float32")};return H.runKernel(Cu,n)}const Iy=q({cos_:jL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(t){const n={x:L(t,"x","cosh","float32")};return H.runKernel(ku,n)}const d$=q({cosh_:KL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(t,e=0,n=!1,s=!1){const r={x:L(t,"x","cumprod")},i={axis:e,exclusive:n,reverse:s};return H.runKernel(zb,r,i)}const sv=q({cumprod_:qL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(t,e=0,n=!1,s=!1){const r={x:L(t,"x","cumsum")},i={axis:e,exclusive:n,reverse:s};return H.runKernel(Qf,r,i)}const h$=q({cumsum_:XL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(t,e,n,s=!1){const o=L(t,"x","denseBincount"),r=L(e,"weights","denseBincount");N(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),N(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),N(n>=0,()=>`size must be non-negative, but got ${n}.`),N(r.size===o.size||r.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${r.shape}.`);const i={x:o,weights:r},a={size:n,binaryOutput:s};return H.runKernel(Ub,i,a)}const nw=q({denseBincount_:YL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(t,e,n="NHWC"){const s=L(t,"x","depthToSpace","float32"),o=n==="NHWC"?s.shape[1]:s.shape[2],r=n==="NHWC"?s.shape[2]:s.shape[3],i=n==="NHWC"?s.shape[3]:s.shape[1];N(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),N(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e}  for depthToSpace with input shape
    ${s.shape}`),N(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e} for depthToSpace with input shape
        ${s.shape}`),N(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return H.runKernel(Gb,a,l)}const QL=q({depthToSpace_:ZL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(t,e,n,s,o="NHWC",r=[1,1],i){const a=L(t,"x","depthwiseConv2d","float32"),l=L(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=K(a,[1,a.shape[0],a.shape[1],a.shape[2]])),N(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),N(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=o==="NHWC"?c.shape[3]:c.shape[1];N(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),is("depthwiseConv2d",s,i);const h={x:c,filter:l},f={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i},p=H.runKernel(Jf,h,f);return u?K(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const $y=q({depthwiseConv2d_:JL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3(t,e,n,s,o=[1,1],r="NHWC"){const i=L(t,"x","dilation2d"),a=L(e,"filter","dilation2d");N(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),N(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),N(r==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${r}`);let l=i,c=!1;i.rank===3&&(l=K(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0),N(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:n,pad:s,dilations:o},h=H.runKernel(ep,u,d);return c?K(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const t3=q({dilation2d_:e3});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ml(t,e){const n=t.length,s=[];for(let o=0;o<n;o++){const r=n-1-o,i=t[r]||1;(e[e.length-1-o]||1)>1&&i===1&&s.unshift(r)}return s}function ln(t,e){const n=[];for(let s=0;s<e.length;s++){const o=t[t.length-s-1],r=e.length-s-1,i=e[r];(o==null||o===1&&i>1)&&n.unshift(r)}return n}function qe(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let o=0;o<n;o++){let r=t[t.length-o-1];r==null&&(r=1);let i=e[e.length-o-1];if(i==null&&(i=1),r===1)s[n-o-1]=i;else if(i===1)s[n-o-1]=r;else if(r!==i){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-o-1]=r}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n3(t,e){let n=L(t,"a","equal","string_or_numeric"),s=L(e,"b","equal","string_or_numeric");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(tp,o)}const er=q({equal_:n3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s3(t,e,n){const s=L(e,"a","where"),o=L(n,"b","where"),r=L(t,"condition","where","bool"),i=qe(qe(r.shape,s.shape),o.shape),a=$c(r,i),l=$c(s,i),c=$c(o,i),u={condition:a,t:l,e:c};return H.runKernel(Ap,u)}const Wn=q({where_:s3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o3(t){const n={x:L(t,"x","zerosLike")};return H.runKernel(Bp,n)}const lt=q({zerosLike_:o3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r3(t,e){let n=L(t,"a","div"),s=L(e,"b","div");[n,s]=jt(n,s);const o=Me(n,s),r=lt(o),i=er(s,r);return Wn(i,r,o)}const i3=q({divNoNan_:r3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a3(t,e){const n=L(t,"t1","dot"),s=L(e,"t2","dot");N((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const o=n.rank===1?n.size:n.shape[1],r=s.rank===1?s.size:s.shape[0];if(N(o===r,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${r}.`),n.rank===1&&s.rank===1){const i=K(n,[1,-1]),a=K(s,[-1,1]),l=ft(i,a);return K(l,[])}else if(n.rank===1&&s.rank===2){const i=K(n,[1,-1]),a=K(s,[s.shape[0],s.shape[1]]),l=ft(i,a);return K(l,[l.size])}else if(n.rank===2&&s.rank===1){const i=K(s,[-1,1]),a=ft(n,i);return K(a,[a.size])}else{const i=K(s,[s.shape[0],s.shape[1]]);return ft(n,i)}}const l3=q({dot_:a3});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c3(t,...e){const n=e.map((o,r)=>L(o,`tensors${r}`,"einsum")),s={equation:t};return H.runKernel(Kb,n,s)}const rc=q({einsum_:c3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u3(t){const n={x:L(t,"x","elu","float32")};return H.runKernel(Iu,n)}const jp=q({elu_:u3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d3(t){let e=L(t,"x","erf");N(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Se(e,"float32"));const n={x:e};return H.runKernel($u,n)}const h3=q({erf_:d3});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ty(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function f$(t,e,n){const s=t.length+e.length,o=[];let r=0,i=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?o.push(t[r++]):o.push(e[i++]);return o}function bn(t,e){const n=[],s=t.length;for(let r=0;r<s;r++)e.indexOf(r)===-1&&n.push(t[r]);const o=e.map(r=>t[r]);return[n,o]}function Jt(t,e){const n=e.map(s=>1);return f$(t,n,e)}function Nn(t,e,n){N(Ty(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Lt(t,e){if(Ty(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function yi(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function Kt(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f3(t,e=null,n=!1){const o={x:L(t,"x","max")},r={reductionIndices:e,keepDims:n};return H.runKernel(fp,o,r)}const xo=q({max_:f3});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p3(t,e=null,n=!1){const o={x:L(t,"x","min")},r={axis:e,keepDims:n};return H.runKernel(vp,o,r)}const Mh=q({min_:p3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m3(t,e){let n=L(t,"base","pow"),s=L(e,"exp","pow");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(Wu,o)}const gl=q({pow_:m3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pt(t,e){if((to(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&to(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Wp(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g3(t){const n={x:L(t,"x","sqrt","float32")};return H.runKernel(ed,n)}const Un=q({sqrt_:g3});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v3(t){const e=L(t,"x","square"),n={};return H.runKernel("Square",{x:e},n)}const Et=q({square_:v3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b3(t,e=null,n=!1){let s=L(t,"x","sum");s.dtype==="bool"&&(s=Se(s,"int32"));const o={x:s},r={axis:e,keepDims:n};return H.runKernel(Dp,o,r)}const De=q({sum_:b3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y3(t,e="euclidean",n=null,s=!1){t=L(t,"x","norm");const o=p$(t,e,n);let r=o.shape;if(s){const i=tt(n,t.shape);r=Jt(o.shape,i)}return K(o,r)}function p$(t,e,n=null){if(t.rank===0)return Mn(t);if(t.rank!==1&&n===null)return p$(K(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return De(Mn(t),n);if(e===1/0)return xo(Mn(t),n);if(e===-1/0)return Mh(Mn(t),n);if(e==="euclidean"||e===2)return Un(De(gl(Mn(t),pt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return xo(De(Mn(t),n[0]),n[1]-1);if(e===1/0)return xo(De(Mn(t),n[1]),n[0]);if(e===-1/0)return Mh(De(Mn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return Un(De(Et(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Kp=q({norm_:y3});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x3(t,e=null,n=!1){return Kp(t,"euclidean",e,n)}const w3=q({euclideanNorm_:x3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C3(t){const n={x:L(t,"x","exp")};return H.runKernel(Tu,n)}const tr=q({exp_:C3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k3(t,e=0){const n=L(t,"x","expandDims","string_or_numeric");N(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},o={dim:e};return H.runKernel(np,s,o)}const Zn=q({expandDims_:k3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S3(t){const n={x:L(t,"x","expm1")};return H.runKernel(Nu,n)}const I3=q({expm1_:S3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $3(t,e){const n=L(t,"x","tile","string_or_numeric");N(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},o={reps:e};return H.runKernel(rd,s,o)}const go=q({tile_:$3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T3(t,e,n,s="float32"){e==null&&(e=t);const o=et([t,e],s),r=t<=e?t:e;for(let a=0;a<r;++a)o.set(1,a,a);const i=K(o.toTensor(),[t,e]);if(n==null)return i;if(n.length===1)return go(Zn(i,0),[n[0],1,1]);if(n.length===2)return go(Zn(Zn(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return go(Zn(Zn(Zn(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const m$=q({eye_:T3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N3(t){const n={x:L(t,"x","floor","float32")};return H.runKernel(Eu,n)}const qp=q({floor_:N3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E3(t,e,n=0,s=0){const o=L(t,"x","gather"),r=L(e,"indices","gather","int32"),i={x:o,indices:r},a={axis:n,batchDims:s};return H.runKernel(op,i,a)}const Ny=q({gather_:E3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _3(t,e){let n=L(t,"a","greater","string_or_numeric"),s=L(e,"b","greater","string_or_numeric");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(rp,o)}const Fs=q({greater_:_3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A3(t,e){let n=L(t,"a","greaterEqual","string_or_numeric"),s=L(e,"b","greaterEqual","string_or_numeric");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(Au,o)}const Ca=q({greaterEqual_:A3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R3(t){const n={input:L(t,"input","imag")};return H.runKernel(Jb,n)}const Ey=q({imag_:R3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D3(t){const n={x:L(t,"x","isFinite")};return H.runKernel(Du,n)}const F3=q({isFinite_:D3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O3(t){const n={x:L(t,"x","isInf")};return H.runKernel(Fu,n)}const P3=q({isInf_:O3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M3(t){const n={x:L(t,"x","isNaN")};return H.runKernel(Ou,n)}const L3=q({isNaN_:M3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B3(t,e=.2){const s={x:L(t,"x","leakyRelu")},o={alpha:e};return H.runKernel(ip,s,o)}const _y=q({leakyRelu_:B3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V3(t,e){let n=L(t,"a","less","string_or_numeric"),s=L(e,"b","less","string_or_numeric");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(ap,o)}const Lh=q({less_:V3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z3(t,e){let n=L(t,"a","lessEqual","string_or_numeric"),s=L(e,"b","lessEqual","string_or_numeric");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(lp,o)}const Bl=q({lessEqual_:z3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W3(t,e=5,n=1,s=1,o=.5){const r=L(t,"x","localResponseNormalization");N(r.rank===4||r.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${r.rank}.`),N(hl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=r,a=!1;r.rank===3&&(a=!0,i=K(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={x:i},c={depthRadius:e,bias:n,alpha:s,beta:o},u=H.runKernel(hp,l,c);return a?K(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const U3=q({localResponseNormalization_:W3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G3(t){const n={x:L(t,"x","log","float32")};return H.runKernel(Pu,n)}const nr=q({log_:G3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H3(t){const n={x:L(t,"x","log1p")};return H.runKernel(Mu,n)}const g$=q({log1p_:H3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j3(t,e){N(Bg(t),()=>"The f passed in variableGrads(f) must be a function"),N(e==null||Array.isArray(e)&&e.every(c=>c instanceof Oh),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in H.registeredVariables)e.push(H.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,o=e.length;e=e.filter(c=>c.trainable),N(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);const r=!0,{value:i,grads:a}=H.gradients(t,e,null,r);N(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),N(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:i,grads:l}}function vl(t){return H.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K3(t){const n={x:L(t,"x","neg")};return H.runKernel(yp,n)}const Gt=q({neg_:K3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q3(t){const n={x:L(t,"x","softplus")};return H.runKernel(Ju,n)}const ld=q({softplus_:q3});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X3(t){const e=L(t,"x","logSigmoid");return vl(s=>({value:Gt(ld(Gt(s))),gradFunc:i=>G(i,Ll(Gt(s)))}))(e)}const Y3=q({logSigmoid_:X3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z3(t,e){let n=L(t,"a","sub"),s=L(e,"b","sub");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(nd,o)}const Le=q({sub_:Z3});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3(t,e=-1){const n=L(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return vl((o,r)=>{const a=xo(o,e,!0),l=Le(o,a),c=Le(Se(l,"float32"),nr(De(tr(l),e,!0)));return r([c]),{value:c,gradFunc:(d,h)=>{const[f]=h,p=!0,m=tr(f);return Le(d,G(De(d,e,p),m))}}})(n)}const v$=q({logSoftmax_:Q3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J3(t,e=null,n=!1){const s=L(t,"x","logSumExp"),o=tt(e,s.shape),r=xo(s,o,!0),i=Le(s,r),a=tr(i),l=De(a,o),c=nr(l),u=be(K(r,c.shape),c);if(n){const d=Jt(u.shape,o);return K(u,d)}return u}const b$=q({logSumExp_:J3});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(t,e){const n=L(t,"a","logicalAnd","bool"),s=L(e,"b","logicalAnd","bool");qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(cp,o)}const kr=q({logicalAnd_:eB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tB(t){const n={x:L(t,"x","logicalNot","bool")};return H.runKernel(up,n)}const Ay=q({logicalNot_:tB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(t,e){const n=L(t,"a","logicalOr","bool"),s=L(e,"b","logicalOr","bool");qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(dp,o)}const y$=q({logicalOr_:nB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sB(t,e){const n=L(t,"a","logicalXor","bool"),s=L(e,"b","logicalXor","bool");return qe(n.shape,s.shape),kr(y$(t,e),Ay(kr(t,e)))}const oB=q({logicalXor_:sB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(t,e,n,s,o){const r=L(t,"x","maxPool"),i=1;let a=r,l=!1;r.rank===3&&(l=!0,a=K(r,[1,r.shape[0],r.shape[1],r.shape[2]])),N(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),N(Dn(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),is("maxPool",s,o);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:o},d=H.runKernel(pp,c,u);return l?K(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Ry=q({maxPool_:rB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(t,e=[1,1,1],n,s,o,r="NDHWC"){const i=L(t,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=K(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),N(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),N(r==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`),is("maxPool3d",s,o);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:o,dataFormat:r},d=H.runKernel(mp,c,u);return l?K(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const aB=q({maxPool3d_:iB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(t,e){let n=L(t,"a","maximum"),s=L(e,"b","maximum");[n,s]=jt(n,s),n.dtype==="bool"&&(n=Se(n,"int32"),s=Se(s,"int32")),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(Lu,o)}const xi=q({maximum_:lB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cB(t,e=null,n=!1){const o={x:L(t,"x","mean")},r={axis:e,keepDims:n};return H.runKernel(gp,o,r)}const Zt=q({mean_:cB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hn(t,e="float32"){if(Ar(t),e==="complex64"){const s=hn(t,"float32"),o=hn(t,"float32");return oa(s,o)}const n=Rn(oe(t),e);return H.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wi(t,e="float32"){if(Ar(t),e==="complex64"){const s=wi(t,"float32"),o=hn(t,"float32");return oa(s,o)}const n=Tb(oe(t),e);return H.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(t,e){let n=L(t,"a","minimum"),s=L(e,"b","minimum");[n,s]=jt(n,s),n.dtype==="bool"&&(n=Se(n,"int32"),s=Se(s,"int32")),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(Bu,o)}const Uc=q({minimum_:uB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(t,e,n){N(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=L(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");N(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const o=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)N(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),N(e[a][0]>=0&&e[a][0]<=s.shape[a]-o&&e[a][1]>=0&&e[a][1]<=s.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-o} or less than 0 for input of shape ${s.shape}`);const r={paddings:e,mode:n},i={x:s};return H.runKernel(bp,i,r)}const hB=q({mirrorPad_:dB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(t,e){let n=L(t,"a","mod"),s=L(e,"b","mod");[n,s]=jt(n,s);const o={a:n,b:s};return H.runKernel(Vu,o)}const pB=q({mod_:fB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(t,e=null,n=!1){t=L(t,"x","moments");const s=tt(e,t.shape),o=Zt(t,s,n);let r=o.shape;n||(r=Jt(o.shape,s));const i=Et(Le(Se(t,"float32"),K(o,r))),a=Zt(i,s,n);return{mean:o,variance:a}}const Dy=q({moments_:mB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(t,e){let n=L(t,"a","notEqual","string_or_numeric"),s=L(e,"b","notEqual","string_or_numeric");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s};return H.runKernel(xp,o)}const Bh=q({notEqual_:gB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(t,e,n=1,s=0,o="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:L(t,"indices","oneHot","int32")},a={dtype:o,depth:e,onValue:n,offValue:s};return H.runKernel(Cp,i,a)}const x$=q({oneHot_:vB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(t){const n={x:L(t,"x","onesLike")};return H.runKernel(wp,n)}const no=q({onesLike_:bB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(t,e,n=0){const s=L(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const o={paddings:e,constantValue:n},r={x:s};return H.runKernel(Sp,r,o)}const Fy=q({pad_:yB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(t,e,n){const s=L(t,"x","spaceToBatchND");N(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),N(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),N(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const o={x:s},r={blockShape:e,paddings:n};return H.runKernel(Fp,o,r)}const Oy=q({spaceToBatchND_:xB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(t,e,n,s,o,r,i){o==null&&(o=[1,1]),r==null&&(r=1),s===0&&(s="valid");const a=L(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=K(a,[1,a.shape[0],a.shape[1],a.shape[2]])),N(Dn(r,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${r} and dilations '${o}'`);const u=ro(l.shape,e,r,o,s),d=[u.dilationHeight,u.dilationWidth];let h;s==="same"?h=kB([u.filterHeight,u.filterWidth],d):h=[[0,0],[0,0]];const f=d[0]===1&&d[1]===1,[p,m]=CB([u.inHeight,u.inWidth],d,h),g=f?s:"valid",v=f?l:Oy(l,d,p),y=(n==="avg"?()=>wy(v,e,r,g,i):()=>Ry(v,e,r,g,i))(),x=f?y:ky(y,d,m);return c?K(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function CB(t,e,n){const s=n.map(u=>u[0]),o=n.map(u=>u[1]),r=t.concat(s,o),i=e.map((u,d)=>(u-r[d]%u)%u),a=o.map((u,d)=>u+i[d]),l=e.map((u,d)=>[s[d],a[d]]),c=e.map((u,d)=>[0,i[d]]);return[l,c]}function kB(t,e){const s=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),o=s.map(i=>Math.floor(i/2)),r=s.map((i,a)=>i-o[a]);return s.map((i,a)=>[o[a],r[a]])}const SB=q({pool_:wB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(t,e){const n=L(t,"x","prelu"),s=L(e,"alpha","prelu"),o={x:n,alpha:s};return H.runKernel(Ip,o)}const Py=q({prelu_:IB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(t,e=null,n=!1){let s=L(t,"x","prod");s.dtype==="bool"&&(s=Se(s,"int32"));const o={x:s},r={axis:e,keepDims:n};return H.runKernel($p,o,r)}const TB=q({prod_:$B});var w$={exports:{}};(function(t){(function(e,n,s){function o(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function r(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function i(l,c){var u=new o(l),d=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&r(d,u),h.state=function(){return r(u,{})}),h}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=i:s&&s.amd?s(function(){return i}):this.alea=i})(ya,t,!1)})(w$);var C$={exports:{}};(function(t){(function(e,n,s){function o(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&r(u,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=i:s&&s.amd?s(function(){return i}):this.xor128=i})(ya,t,!1)})(C$);var k$={exports:{}};(function(t){(function(e,n,s){function o(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function r(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&r(u,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=i:s&&s.amd?s(function(){return i}):this.xorwow=i})(ya,t,!1)})(k$);var S$={exports:{}};(function(t){(function(e,n,s){function o(a){var l=this;l.next=function(){var u=l.x,d=l.i,h,f;return h=u[d],h^=h>>>7,f=h^h<<24,h=u[d+1&7],f^=h^h>>>10,h=u[d+3&7],f^=h^h>>>3,h=u[d+4&7],f^=h^h<<7,h=u[d+7&7],h=h^h<<13,f^=h^h<<9,u[d]=f,l.i=d+1&7,f};function c(u,d){var h,f=[];if(d===(d|0))f[0]=d;else for(d=""+d,h=0;h<d.length;++h)f[h&7]=f[h&7]<<15^d.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],u.x=f,u.i=0,h=256;h>0;--h)u.next()}c(l,a)}function r(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.x&&r(u,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=i:s&&s.amd?s(function(){return i}):this.xorshift7=i})(ya,t,!1)})(S$);var I$={exports:{}};(function(t){(function(e,n,s){function o(a){var l=this;l.next=function(){var u=l.w,d=l.X,h=l.i,f,p;return l.w=u=u+1640531527|0,p=d[h+34&127],f=d[h=h+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=d[h]=p^f,l.i=h,p+(u^u>>>16)|0};function c(u,d){var h,f,p,m,g,v=[],b=128;for(d===(d|0)?(f=d,d=null):(d=d+"\0",f=0,b=Math.max(b,d.length)),p=0,m=-32;m<b;++m)d&&(f^=d.charCodeAt((m+32)%d.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,h=v[m&127]^=f+g,p=h==0?p+1:0);for(p>=128&&(v[(d&&d.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=v[p+34&127],h=v[p=p+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,v[p]=f^h;u.w=g,u.X=v,u.i=p}c(l,a)}function r(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.X&&r(u,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=i:s&&s.amd?s(function(){return i}):this.xor4096=i})(ya,t,!1)})(I$);var $$={exports:{}};(function(t){(function(e,n,s){function o(a){var l=this,c="";l.next=function(){var d=l.b,h=l.c,f=l.d,p=l.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-f|0,l.d=f<<16^h>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function r(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var c=new o(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&r(u,c),d.state=function(){return r(c,{})}),d}n&&n.exports?n.exports=i:s&&s.amd?s(function(){return i}):this.tychei=i})(ya,t,!1)})($$);var T$={exports:{}};const NB={},EB=Object.freeze(Object.defineProperty({__proto__:null,default:NB},Symbol.toStringTag,{value:"Module"})),_B=$P(EB);(function(t){(function(e,n,s){var o=256,r=6,i=52,a="random",l=s.pow(o,r),c=s.pow(2,i),u=c*2,d=o-1,h;function f(x,w,k){var S=[];w=w==!0?{entropy:!0}:w||{};var C=v(g(w.entropy?[x,y(n)]:x==null?b():x,3),S),$=new p(S),T=function(){for(var E=$.g(r),_=l,A=0;E<c;)E=(E+A)*o,_*=o,A=$.g(1);for(;E>=u;)E/=2,_/=2,A>>>=1;return(E+A)/_};return T.int32=function(){return $.g(4)|0},T.quick=function(){return $.g(4)/4294967296},T.double=T,v(y($.S),n),(w.pass||k||function(E,_,A,O){return O&&(O.S&&m(O,$),E.state=function(){return m($,{})}),A?(s[a]=E,_):E})(T,C,"global"in w?w.global:this==s,w.state)}function p(x){var w,k=x.length,S=this,C=0,$=S.i=S.j=0,T=S.S=[];for(k||(x=[k++]);C<o;)T[C]=C++;for(C=0;C<o;C++)T[C]=T[$=d&$+x[C%k]+(w=T[C])],T[$]=w;(S.g=function(E){for(var _,A=0,O=S.i,B=S.j,F=S.S;E--;)_=F[O=d&O+1],A=A*o+F[d&(F[O]=F[B=d&B+_])+(F[B]=_)];return S.i=O,S.j=B,A})(o)}function m(x,w){return w.i=x.i,w.j=x.j,w.S=x.S.slice(),w}function g(x,w){var k=[],S=typeof x,C;if(w&&S=="object")for(C in x)try{k.push(g(x[C],w-1))}catch{}return k.length?k:S=="string"?x:x+"\0"}function v(x,w){for(var k=x+"",S,C=0;C<k.length;)w[d&C]=d&(S^=w[d&C]*19)+k.charCodeAt(C++);return y(w)}function b(){try{var x;return h&&(x=h.randomBytes)?x=x(o):(x=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(x)),y(x)}catch{var w=e.navigator,k=w&&w.plugins;return[+new Date,e,k,e.screen,y(n)]}}function y(x){return String.fromCharCode.apply(0,x)}if(v(s.random(),n),t.exports){t.exports=f;try{h=_B}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:ya,[],Math)})(T$);var AB=w$.exports,RB=C$.exports,DB=k$.exports,FB=S$.exports,OB=I$.exports,PB=$$.exports,ka=T$.exports;ka.alea=AB;ka.xor128=RB;ka.xorwow=DB;ka.xorshift7=FB;ka.xor4096=OB;ka.tychei=PB;var My=ka;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N${constructor(e,n,s,o,r){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=r||Math.random();this.random=My.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const o=this.nextVal;return this.nextVal=NaN,o}let e,n,s=!1;for(;!s;){let o,r,i;do o=2*this.random()-1,r=2*this.random()-1,i=o*o+r*r;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*a,n=this.mean+this.stdDev*r*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class MB{constructor(e=0,n=1,s,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=My.alea(o)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(t,e=0,n=1,s,o){if(Ar(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const r=new N$(e,n,s,!1,o),i=et(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=r.nextValue();return i.toTensor()}const BB=q({randomNormal_:LB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(t,e=0,n=1,s="float32",o){Ar(t);const r=et(t,s),i=new MB(e,n,null,o);for(let a=0;a<r.values.length;a++)r.values[a]=i.nextValue();return r.toTensor()}const cd=q({randomUniform_:VB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gc(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const o={start:t,stop:e,step:n,dtype:s};return H.runKernel(iy,{},o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(t){const n={input:L(t,"input","real")};return H.runKernel(ay,n)}const Vh=q({real_:zB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(t){const n={x:L(t,"x","reciprocal")};return H.runKernel(Uu,n)}const UB=q({reciprocal_:WB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(t){const n={x:L(t,"x","relu")};return H.runKernel(Gu,n)}const Sa=q({relu_:GB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(t){const n={x:L(t,"x","relu6")};return H.runKernel(Hu,n)}const E$=q({relu6_:HB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(t,e){const s={x:L(t,"x","reverse")},o={dims:e};return H.runKernel(_p,s,o)}const ua=q({reverse_:jB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(t){const n={x:L(t,"x","round")};return H.runKernel(ju,n)}const _$=q({round_:KB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(t){const n={x:L(t,"x","rsqrt","float32")};return H.runKernel(Ku,n)}const A$=q({rsqrt_:qB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB(t){const n={x:L(t,"x","selu")};return H.runKernel(qu,n)}const R$=q({selu_:XB});function YB(t,e,n,s,o,r=[1,1],i="NHWC"){const a=L(t,"x","separableConv2d"),l=L(e,"depthwiseFilter","separableConv2d"),c=L(n,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=K(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");N(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),N(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),N(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),N(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),N(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const h=l.shape[2],f=l.shape[3];N(c.shape[2]===h*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*f}, but got ${c.shape[2]}.`);const p=$y(u,l,s,o,i,r),g=ca(p,c,1,"valid",i);return d?K(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const D$=q({separableConv2d_:YB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(t){const n={x:L(t,"x","sign")};return H.runKernel(Zu,n)}const QB=q({sign_:ZB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(t){const n={x:L(t,"x","sin","float32")};return H.runKernel(Xu,n)}const F$=q({sin_:JB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(t){const n={x:L(t,"x","sinh")};return H.runKernel(Yu,n)}const O$=q({sinh_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(t,e,n){const s=L(t,"x","slice1d");return N(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),It(s,[e],[n])}const Ly=q({slice1d_:tV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nV(t,e,n){const s=L(t,"x","slice2d");return N(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),It(s,e,n)}const P$=q({slice2d_:nV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(t,e,n){const s=L(t,"x","slice3d");return N(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),It(s,e,n)}const By=q({slice3d_:sV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(t,e,n){const s=L(t,"x","slice4d");return N(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),It(s,e,n)}const zh=q({slice4d_:oV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(t,e=-1){const n=L(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},o={dim:e};return H.runKernel(Pp,s,o)}const Vy=q({softmax_:rV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(t){N(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return H.runKernel(Xb,e)}const M$=q({fft_:iV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(t){N(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return H.runKernel(Qb,e)}const ov=q({ifft_:aV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const o=K(t,[n,e]);s=ov(o)}else{const o=[n,2*(e-1)],r=K(Vh(t),[n,e]),i=K(Ey(t),[n,e]),a=ua(It(r,[0,1],[n,e-2]),1),l=G(ua(It(i,[0,1],[n,e-2]),1),pt(-1)),c=ns([r,a],1),u=ns([i,l],1),d=K(oa(c,u),[o[0],o[1]]);s=ov(d)}if(s=Vh(s),t.rank===3&&t.shape[0]!==0){const o=s,r=t.shape[0];s=K(s,[r,s.shape[0]/r,s.shape[1]]),o.dispose()}return s}const cV=q({irfft_:lV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(t,e,n=0){const o={x:L(t,"x","split")},r={numOrSizeSplits:e,axis:n};return H.runKernel(Op,o,r)}const As=q({split_:uV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dV(t,e){N(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let o;if(e!=null&&e<n){const p=t.shape.map(g=>0),m=t.shape.map(g=>g);m[t.shape.length-1]=e,o=It(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,o=ns([t,hn(p)],t.shape.length-1),n=e}else o=t;const r=lt(o),i=K(oa(o,r),[s,n]),a=M$(i),l=Math.floor(n/2)+1,c=Vh(a),u=Ey(a),d=As(c,[l,n-l],c.shape.length-1),h=As(u,[l,n-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,K(oa(d[0],h[0]),f)}const hV=q({rfft_:dV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(t,e){let n=L(t,"a","squaredDifference"),s=L(e,"b","squaredDifference");[n,s]=jt(n,s),qe(n.shape,s.shape);const o={a:n,b:s},r={};return H.runKernel(td,o,r)}const pV=q({squaredDifference_:fV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mV(t,e){const n=L(t,"x","squeeze","string_or_numeric");return K(n,gi(n.shape,e).newShape)}const ud=q({squeeze_:mV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(t,e=0){const n=ZI(t,"tensors","stack","string_or_numeric");N(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&N(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,o={axis:e};return H.runKernel(kp,s,o)}const Sr=q({stack_:gV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(t,e=0){const s={x:L(t,"x","step")},o={alpha:e};return H.runKernel(id,s,o)}const dd=q({step_:vV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(t,e,n,s,o=0,r=0,i=0,a=0,l=0){const u={x:L(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:o,endMask:r,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return H.runKernel(hy,u,d)}const yV=q({stridedSlice_:bV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(t){const n={x:L(t,"x","tan","float32")};return H.runKernel(sd,n)}const wV=q({tan_:xV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ps(t,e){rI(t);const n=zp(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Wp(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wm(t,e,n){if(rI(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=zp(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Wp(t,e,s,n)}function L$(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,r=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${o}.`;if(n.rank<o)throw new Error(r+` update.rank < ${o}. `);if(t.length<s+(n.rank-o))throw new Error(r+` Output shape length < ${s+(n.rank-o)}`);if(n.rank!==o+t.length-s)throw new Error(r+` update.rank != ${o+t.length-s}`);for(let i=0;i<o;++i)if(n.shape[i]!==e.shape[i])throw new Error(r+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<n.rank-o;++i)if(n.shape[i+o]!==t[i+s])throw new Error(r+` updates.shape[${i+o}] (${n.shape[i+o]}) != shape[${i+o}] (${t[i+o]})`)}function CV(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}L$(n,e,t)}function Ia(t,e,n){const s=e.shape.length,o=s>1?e.shape[s-1]:1,r=n.length;let i=1;for(let d=o;d<r;++d)i*=n[d];const a=o<1?1:o,l=oe(e.shape)/a,c=[...Ae(n.slice(0,o)),1],u=oe(n);return{sliceRank:o,numUpdates:l,sliceSize:i,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(t,e=1,n=!0){const s=L(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const o=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${e}`);const r={x:s},i={k:e,sorted:n},[a,l]=H.runKernel(fy,r,i);return{values:a,indices:l}}const SV=q({topk_:kV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(t,e=0,n=1,s,o){if(Ar(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const r=new N$(e,n,s,!0,o),i=et(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=r.nextValue();return i.toTensor()}const B$=q({truncatedNormal_:IV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(t,e=0){const n=L(t,"x","unique","string_or_numeric");N(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},o={axis:e},[r,i]=H.runKernel(my,s,o);return{values:r,indices:i}}const TV=q({unique_:$V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(t,e,n){const s=L(t,"x","unsortedSegmentSum"),o=L(e,"segmentIds","unsortedSegmentSum","int32");N(hl(n),()=>"numSegments must be of dtype int");const r={x:s,segmentIds:o},i={numSegments:n};return H.runKernel(Lp,r,i)}const V$=q({unsortedSegmentSum_:NV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(t,e=0){const n=L(t,"x","unstack","string_or_numeric");N(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},o={axis:e};return H.runKernel(Mp,s,o)}const da=q({unstack_:EV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(t,e=!0,n,s){return H.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$(t,e){const n=[];for(let r=0;r<e.length;r++)e[r]&&n.push(r);const s=et(t,"int32"),o=et([n.length,t.length],"int32");for(let r=0;r<n.length;r++){const i=s.indexToLoc(n[r]),a=r*t.length;o.values.set(i,a)}return o.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(t,e,n){const s=L(t,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),N(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{N(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const o={x:s},r={perm:e};return s.dtype==="complex64"?Z(()=>{let i=Vh(s),a=Ey(s);return i=H.runKernel(ol,{x:i},r),a=H.runKernel(ol,{x:a},r),n&&(a=Gt(a)),oa(i,a)}):H.runKernel(ol,o,r)}const at=q({transpose_:AV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(t,e){if(e==null)return t.shape.slice();if(mt(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(t,e,n,s){const o=L(t,"x","dropout");if(N(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),N(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Yt?o.clone():o;const r=RV(o,n),i=1-e,a=Me(qp(be(cd(r,0,1,"float32",s),i)),i);return G(o,a)}const FV=q({dropout_:DV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(t,e,n,s,o,r="NHWC",i){let a=t;t.rank===3&&(a=K(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=K(e,[1,e.shape[0],e.shape[1],e.shape[2]])),N(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),N(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),N(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=r==="NHWC"?a.shape[3]:a.shape[1],u=r==="NHWC"?l.shape[3]:l.shape[1];N(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),N(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),is("conv2dDerFilter",o,i);const d={x:a,dy:l},h={strides:s,pad:o,dataFormat:r,dimRoundingMode:i,filterShape:n};return H.runKernel(Lb,d,h)}const zy=q({conv2DBackpropFilter_:OV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wy(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return G(t,dd(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Uy(t,e){let n=e;const s=ln(t.shape,e.shape);return s.length>0&&(n=De(n,s)),K(n,t.shape)}function Gy(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Sa(t);if(e==="elu")return jp(t);if(e==="relu6")return E$(t);if(e==="prelu")return Py(t,n);if(e==="leakyrelu")return _y(t,s);if(e==="sigmoid")return Ll(t);throw new Error(`Unknown fused activation ${e}.`)}const Hy=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV({x:t,filter:e,strides:n,pad:s,dataFormat:o="NHWC",dilations:r=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Hy(H.state.gradientDepth,l)===!1){N(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let k=ca(t,e,n,s,o,r,i);return a!=null&&(k=be(k,a)),Gy(k,l,c,u)}const d=L(t,"x","conv2d","float32"),h=L(e,"filter","conv2d","float32");let f=d,p=!1;d.rank===3&&(p=!0,f=K(d,[1,d.shape[0],d.shape[1],d.shape[2]])),N(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),N(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),is("fused conv2d",s,i);const m=o==="NHWC"?f.shape[3]:f.shape[1];N(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),N(Dn(n,r),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`);const g=Tn(f.shape,h.shape,n,r,s,i);let v;a!=null&&(v=L(a,"bias","fused conv2d"),[v]=jt(v,d),o==="NHWC"?qe(g.outShape,v.shape):(N(v.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${v.shape.length}.`),N(v.shape.length===0||v.shape[0]===g.outChannels||v.shape[0]===1,()=>`Error in fused conv2d: bias shape (${v.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let b;if(c!=null){const k=c.shape;if(N(k.length<=1||k.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${k.length}.`),k.length===1)N(k[0]===1||k[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${k}) is not compatible with the number of output channels (${g.outChannels}).`);else if(k.length===3)try{qe(k,g.outShape)}catch{const C=`Error in fused conv2d: PReLU activation weights (${k}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(C)}b=L(c,"prelu weights","fused conv2d")}const y=(k,S)=>{N(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);const[C,$,T,E]=S,_=Wy(k,T,l);N(aa(r),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const A=Sy($.shape,_,C,n,s),O=zy($,_,C.shape,n,s),B=[A,O];if(E!=null){const F=Uy(E,_);B.push(F)}return B},x={x:f,filter:h,bias:v,preluActivationWeights:b},w={strides:n,pad:s,dataFormat:o,dilations:r,dimRoundingMode:i,activation:l,leakyreluAlpha:u};return a==null?vl((S,C,$)=>{let T=H.runKernel(Rh,x,w);return $([C,S,T]),p&&(T=K(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:y}})(f,h):vl((S,C,$,T)=>{let E=H.runKernel(Rh,x,w);return T([C,S,E,$]),p&&(E=K(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:y}})(f,h,v)}const MV=q({fusedConv2d_:PV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(t,e,n,s,o,r=[1,1],i){let a=t;t.rank===3&&(a=K(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=K(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:s,pad:o,dimRoundingMode:i,dilations:r,filterShape:n};return H.runKernel(Hb,c,u)}const BV=q({depthwiseConv2dNativeBackpropFilter_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t,e,n,s,o,r=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=K(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:s,pad:o,dimRoundingMode:i,dilations:r,inputShape:t},d=H.runKernel(jb,c,u);return l?K(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const zV=q({depthwiseConv2dNativeBackpropInput_:VV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WV({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:o,activation:r="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(Hy(H.state.gradientDepth,r)===!1){let E=ft(t,e,n,s);return o!=null&&(E=be(E,o)),Gy(E,r,i,a)}let l=L(t,"a","fused matMul"),c=L(e,"b","fused matMul");[l,c]=jt(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=s?c.shape[c.rank-2]:c.shape[c.rank-1],p=l.shape.slice(0,-2),m=c.shape.slice(0,-2),g=oe(p),v=oe(m);N(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const y=qe(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,f]),x=n?K(l,[g,u,h]):K(l,[g,h,u]),w=s?K(c,[v,f,d]):K(c,[v,d,f]);let k;o!=null&&(k=L(o,"bias","fused matMul"),[k]=jt(k,l),qe(y,k.shape));let S;i!=null&&(S=L(i,"prelu weights","fused matMul"));const C=(E,_)=>{const[A,O,B,F]=_,V=Wy(K(E,B.shape),B,r);let D,U;if(!n&&!s?(D=ft(V,O,!1,!0),U=ft(A,V,!0,!1)):!n&&s?(D=ft(V,O,!1,!1),U=ft(V,A,!0,!1)):n&&!s?(D=ft(O,V,!1,!0),U=ft(A,V,!1,!1)):(D=ft(O,V,!0,!0),U=ft(V,A,!0,!0)),o!=null){const J=Uy(F,V);return[D,U,J]}else return[D,U]},$={a:x,b:w,bias:k,preluActivationWeights:S},T={transposeA:n,transposeB:s,activation:r,leakyreluAlpha:a};return o==null?vl((_,A,O)=>{const B=H.runKernel(Ah,$,T);return O([_,A,B]),{value:K(B,y),gradFunc:C}})(x,w):vl((_,A,O,B)=>{const F=H.runKernel(Ah,$,T);return B([_,A,F,O]),{value:K(F,y),gradFunc:C}})(x,w,k)}const sw=q({fusedMatMul_:WV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(t,e,n,s,o="bilinear",r=0){const i=L(t,"image","cropAndResize"),a=L(e,"boxes","cropAndResize","float32"),l=L(n,"boxInd","cropAndResize","int32"),c=a.shape[0];N(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),N(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),N(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),N(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),N(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),N(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);const u={image:i,boxes:a,boxInd:l},d={method:o,extrapolationValue:r,cropSize:s};return H.runKernel(Wb,u,d)}const GV=q({cropAndResize_:UV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(t){const e=L(t,"image","flipLeftRight","float32");N(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return H.runKernel(Zb,n,{})}const jV=q({flipLeftRight_:HV});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(t){const e=L(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];N(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),N(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const o=new Array(e.rank);return o.fill(1,0,n),o[n]=3,go(e,o)}const qV=q({grayscaleToRGB_:KV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(t){const e=L(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];N(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),N(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const o=e.dtype,r=Se(e,"float32"),i=ps([.2989,.587,.114]);let a;switch(e.rank){case 2:a=rc("ij,j->i",r,i);break;case 3:a=rc("ijk,k->ij",r,i);break;case 4:a=rc("ijkl,l->ijk",r,i);break;case 5:a=rc("ijklm,m->ijkl",r,i);break;case 6:a=rc("ijklmn,n->ijklm",r,i);break;default:throw new Error("Not a valid tensor rank.")}return a=Zn(a,-1),Se(a,o)}const YV=q({rgbToGrayscale_:XV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(t,e,n=0,s=.5){const o=L(t,"image","rotateWithOffset","float32");N(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);const r={image:o},i={radians:e,fillValue:n,center:s};return H.runKernel(gy,r,i)}const QV=q({rotateWithOffset_:ZV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vl(t,e,n,s,o,r){s==null&&(s=.5),o==null&&(o=Number.NEGATIVE_INFINITY),r==null&&(r=0);const i=t.shape[0];return n=Math.min(n,i),N(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),N(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),N(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),N(e.rank===1,()=>"scores must be a 1D tensor"),N(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),N(0<=r&&r<=1,()=>`softNmsSigma must be in [0, 1], but was '${r}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:o,softNmsSigma:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY){const r=L(t,"boxes","nonMaxSuppression","float32"),i=L(e,"scores","nonMaxSuppression","float32"),a=Vl(r,i,n,s,o);n=a.maxOutputSize,s=a.iouThreshold,o=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:o};return H.runKernel(sy,{boxes:r,scores:i},l)}const ez=q({nonMaxSuppression_:JV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tz(t,e,n){const s=nz(t,e,n),o=s<0?-(s+1):s;t.splice(o,0,e)}function nz(t,e,n){return oz(t,e,n||sz)}function sz(t,e){return t>e?1:t<e?-1:0}function oz(t,e,n){let s=0,o=t.length,r=0,i=!1;for(;s<o;){r=s+(o-s>>>1);const a=n(e,t[r]);a>0?s=r+1:(o=r,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jy(t,e,n,s,o){return Xy(t,e,n,s,o,0)}function Ky(t,e,n,s,o,r){return Xy(t,e,n,s,o,0,!1,r,!0)}function qy(t,e,n,s,o,r){return Xy(t,e,n,s,o,r,!0)}function Xy(t,e,n,s,o,r,i=!1,a=!1,l=!1){const c=[];for(let g=0;g<e.length;g++)e[g]>o&&c.push({score:e[g],boxIndex:g,suppressBeginIndex:0});c.sort(ow);const u=r>0?-.5/r:0,d=[],h=[];for(;d.length<n&&c.length>0;){const g=c.pop(),{score:v,boxIndex:b,suppressBeginIndex:y}=g;if(v<o)break;let x=!1;for(let w=d.length-1;w>=y;--w){const k=rz(t,b,d[w]);if(k>=s){x=!0;break}if(g.score=g.score*iz(s,u,k),g.score<=o)break}g.suppressBeginIndex=d.length,x||(g.score===v?(d.push(b),h.push(g.score)):g.score>o&&tz(c,g,ow))}const f=d.length,p=n-f;a&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const m={selectedIndices:d};return i&&(m.selectedScores=h),l&&(m.validOutputs=f),m}function rz(t,e,n){const s=t.subarray(e*4,e*4+4),o=t.subarray(n*4,n*4+4),r=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),h=Math.max(o[1],o[3]),f=(a-r)*(l-i),p=(d-c)*(h-u);if(f<=0||p<=0)return 0;const m=Math.max(r,c),g=Math.max(i,u),v=Math.min(a,d),b=Math.min(l,h),y=Math.max(v-m,0)*Math.max(b-g,0);return y/(f+p-y)}function iz(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function ow(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function az(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY){const r=L(t,"boxes","nonMaxSuppressionAsync"),i=L(e,"scores","nonMaxSuppressionAsync"),a=Vl(r,i,n,s,o);n=a.maxOutputSize,s=a.iouThreshold,o=a.scoreThreshold;const l=await Promise.all([r.data(),i.data()]),c=l[0],u=l[1],{selectedIndices:d}=jy(c,u,n,s,o);return r!==t&&r.dispose(),i!==e&&i.dispose(),ps(d,"int32")}const lz=az;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cz(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=0){const i=L(t,"boxes","nonMaxSuppression"),a=L(e,"scores","nonMaxSuppression"),l=Vl(i,a,n,s,o,r);n=l.maxOutputSize,s=l.iouThreshold,o=l.scoreThreshold,r=l.softNmsSigma;const c={boxes:i,scores:a},u={maxOutputSize:n,iouThreshold:s,scoreThreshold:o,softNmsSigma:r},d=H.runKernel(ry,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const uz=q({nonMaxSuppressionWithScore_:cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function dz(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=0){const i=L(t,"boxes","nonMaxSuppressionAsync"),a=L(e,"scores","nonMaxSuppressionAsync"),l=Vl(i,a,n,s,o,r);n=l.maxOutputSize,s=l.iouThreshold,o=l.scoreThreshold,r=l.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:h,selectedScores:f}=qy(u,d,n,s,o,r);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ps(h,"int32"),selectedScores:ps(f)}}const hz=dz;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fz(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=!1){const i=L(t,"boxes","nonMaxSuppression"),a=L(e,"scores","nonMaxSuppression"),l=Vl(i,a,n,s,o,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h={boxes:i,scores:a},f={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:r},p=H.runKernel(oy,h,f);return{selectedIndices:p[0],validOutputs:p[1]}}const pz=q({nonMaxSuppressionPadded_:fz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function mz(t,e,n,s=.5,o=Number.NEGATIVE_INFINITY,r=!1){const i=L(t,"boxes","nonMaxSuppressionAsync"),a=L(e,"scores","nonMaxSuppressionAsync"),l=Vl(i,a,n,s,o,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[h,f]=await Promise.all([i.data(),a.data()]),{selectedIndices:p,validOutputs:m}=Ky(h,f,c,u,d,r);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ps(p,"int32"),validOutputs:pt(m,"int32")}}const gz=mz;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vz(t,e,n=!1,s=!1){const o=L(t,"images","resizeBilinear");N(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),N(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),N(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let r=o,i=!1;o.rank===3&&(i=!0,r=K(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},c=H.runKernel(Ep,a,l);return i?K(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const W$=q({resizeBilinear_:vz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bz(t,e,n=!1,s=!1){const o=L(t,"images","resizeNearestNeighbor");N(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),N(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),N(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),N(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let r=o,i=!1;o.rank===3&&(i=!0,r=K(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const a={images:r},l={alignCorners:n,halfPixelCenters:s,size:e},c=H.runKernel(Np,a,l);return i?K(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const U$=q({resizeNearestNeighbor_:bz});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yz(t,e="binary",n=!1,s=.5){const o=L(t,"image","threshold"),r=.2989,i=.587,a=.114,l=o.shape[0]*o.shape[1];let c=G(ps([s]),255),u,d,h,f;if(N(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),N(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),N(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),N(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),o.shape[2]===3){[u,d,h]=As(o,[1,1,1],-1);const g=G(u,r),v=G(d,i),b=G(h,a);f=be(be(g,v),b)}else f=t;if(e==="otsu"){const g=SL(Se(_$(f),"int32"),rl([]),256);c=xz(g,l)}const p=n?Bl(f,c):Fs(f,c);return Se(G(p,255),"int32")}function xz(t,e){let n=ps([-1]),s=ps([0]),o=ps([0]),r,i,a,l,c,u;for(let d=0;d<t.size-1;d++){r=It(t,0,d+1),i=It(t,d+1),c=Me(De(r),e),u=Me(De(i),e);const h=De(G(r,Gc(0,r.size)));a=Me(h,De(r));const f=Hp(i.shape,r.size),p=be(Gc(0,i.size),f),m=G(i,p);l=Me(De(m),De(i));const g=Le(a,l),v=Le(a,l),b=G(c,u);o=G(G(b,g),v);const y=Fs(o,s);s=Wn(y,o,s),n=Wn(y,ps([d]),n)}return n}const wz=q({threshold_:yz});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cz(t,e,n="nearest",s="constant",o=0,r){const i=L(t,"image","transform","float32"),a=L(e,"transforms","transform","float32");N(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),N(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),N(r==null||r.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${r}.`);const l={image:i,transforms:a},c={interpolation:n,fillMode:s,fillValue:o,outputShape:r};return H.runKernel(py,l,c)}const kz=q({transform_:Cz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sz(t,e,n){const s=L(t,"a","bandPart");N(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const o=s.shape,[r,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(N(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),N(e<=r,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${r}).`),a=L(e<0?r:e,"numLower","bandPart")):(N(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Wn(Lh(e,0),r,Uc(e,r))),typeof n=="number"?(N(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),N(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),l=L(n<0?i:n,"numUpper","bandPart")):(N(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Wn(Lh(n,0),i,Uc(n,i)));const c=K(Gc(0,r,1,"int32"),[-1,1]),u=Gc(0,i,1,"int32"),d=Le(c,u),h=kr(Bl(d,a),Ca(d,Gt(l))),f=hn([r,i],s.dtype);return K(Sr(da(K(s,[-1,r,i])).map(p=>Wn(h,p,f))),o)}const Iz=q({bandPart_:Sz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $z(t){let e;if(Array.isArray(t)){e=!1,N(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const o=t[0].shape[0];for(let r=1;r<t.length;++r)N(t[r].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[r].shape[0]} vs. ${o})`)}else e=!0,t=As(t,t.shape[0],0).map(o=>ud(o,[0]));N(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let o=0;o<t.length;++o)n.push(H.tidy(()=>{let r=s[o];if(o>0)for(let i=0;i<o;++i){const a=G(De(G(n[i],r)),n[i]);r=Le(r,a)}return Me(r,Kp(r,"euclidean"))}));return e?Sr(n,0):n}const Tz=q({gramSchmidt_:$z});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nz(t,e=!1){if(N(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return rw(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=da(K(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],r=[];s.forEach(l=>{const[c,u]=rw(l,e);o.push(c),r.push(u)});const i=K(Sr(o,0),t.shape),a=K(Sr(r,0),t.shape);return[i,a]}}function rw(t,e=!1){return H.tidy(()=>{N(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let o=m$(n),r=Zi(t);const i=Wm([[1]],[1,1]);let a=Zi(i);const l=n>=s?s:n;for(let c=0;c<l;++c){const u=r,d=a,h=o;[a,r,o]=H.tidy(()=>{const f=It(r,[c,c],[n-c,1]),p=Kp(f),m=It(r,[c,c],[1,1]),g=Wn(Fs(m,0),Wm([[-1]]),Wm([[1]])),v=Le(m,G(g,p)),b=Me(f,v);b.shape[0]===1?a=Zi(i):a=ns([i,It(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const y=Gt(Me(ft(g,v),p)),x=It(r,[c,0],[n-c,s]),w=G(y,a),k=at(a);if(c===0)r=Le(x,ft(w,ft(k,x)));else{const $=Le(x,ft(w,ft(k,x)));r=ns([It(r,[0,0],[c,s]),$],0)}const S=at(w),C=It(o,[0,c],[n,o.shape[1]-c]);if(c===0)o=Le(C,ft(ft(C,a),S));else{const $=Le(C,ft(ft(C,a),S));o=ns([It(o,[0,0],[n,c]),$],1)}return[a,r,o]}),Je([u,d,h])}return!e&&n>s&&(o=It(o,[0,0],[n,s]),r=It(r,[0,0],[s,s])),[o,r]})}const Ez=q({qr_:Nz});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var iw;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(iw||(iw={}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const br={flipLeftRight:jV,grayscaleToRGB:qV,resizeNearestNeighbor:U$,resizeBilinear:W$,rgbToGrayscale:YV,rotateWithOffset:QV,cropAndResize:GV,nonMaxSuppression:ez,nonMaxSuppressionAsync:lz,nonMaxSuppressionWithScore:uz,nonMaxSuppressionWithScoreAsync:hz,nonMaxSuppressionPadded:pz,nonMaxSuppressionPaddedAsync:gz,threshold:wz,transform:kz},_z={bandPart:Iz,gramSchmidt:Tz,qr:Ez};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Az=new Map,Rz=new Map;class zl{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Hs{constructor(){this.classNameMap={}}static getMap(){return Hs.instance==null&&(Hs.instance=new Hs),Hs.instance}static register(e){Hs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function de(t,e,n){N(t.className!=null,()=>"Class being registered does not have the static className property defined."),N(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),N(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,o=e+">"+s;return Hs.register(t),Az.set(o,t),Rz.set(t,o),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ci extends zl{minimize(e,n=!1,s){const{value:o,grads:r}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:r[a.name]}));this.applyGradients(i)}else this.applyGradients(r);return Je(r),n?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return j3(e,n)}dispose(){this.iterations_!=null&&Je(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:pt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Ci,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class G$ extends Ci{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=H.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=H.registeredVariables[s],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${s}/accum_grad`,variable:Z(()=>lt(r).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${s}/accum_var`,variable:Z(()=>lt(r).variable(i))});const a=Array.isArray(e)?e[o].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[o].variable,c=this.accumulatedUpdates[o].variable;Z(()=>{const u=be(G(l,this.rho),G(Et(a),1-this.rho)),d=G(Me(Un(be(c,this.epsilon)),Un(be(l,this.epsilon))),a),h=be(G(c,this.rho),G(Et(d),1-this.rho));l.assign(u),c.assign(h);const f=be(G(d,-this.learningRate),r);r.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Je(this.accumulatedGrads.map(e=>e.variable)),Je(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H$ extends Ci{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=H.registeredVariables[s];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${s}/accumulator`,variable:Z(()=>Hp(r.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[o].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[o].variable;Z(()=>{const l=be(a,Et(i));a.assign(l);const c=be(G(Me(i,Un(be(l,H.backend.epsilon()))),-this.learningRate),r);r.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Je(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j$ extends Ci{static get className(){return"Adam"}constructor(e,n,s,o=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Z(()=>{this.accBeta1=pt(n).variable(),this.accBeta2=pt(s).variable()}),o==null&&(this.epsilon=H.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Z(()=>{const s=Le(1,this.accBeta1),o=Le(1,this.accBeta2);n.forEach((r,i)=>{const a=H.registeredVariables[r],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${r}/m`,variable:Z(()=>lt(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${r}/v`,variable:Z(()=>lt(a).variable(l))});const c=Array.isArray(e)?e[i].tensor:e[r];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,h=be(G(u,this.beta1),G(c,1-this.beta1)),f=be(G(d,this.beta2),G(Et(c),1-this.beta2)),p=Me(h,s),m=Me(f,o);u.assign(h),d.assign(f);const g=be(G(Me(p,be(Un(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(G(this.accBeta1,this.beta1)),this.accBeta2.assign(G(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Je(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Je(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),Z(()=>{this.accBeta1.assign(gl(this.beta1,this.iterations_+1)),this.accBeta2.assign(gl(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K$ extends Ci{static get className(){return"Adamax"}constructor(e,n,s,o=null,r=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=o,this.decay=r,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Z(()=>{this.iteration=pt(0).variable(),this.accBeta1=pt(n).variable()}),o==null&&(this.epsilon=H.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);Z(()=>{const s=Le(1,this.accBeta1),o=Me(-this.learningRate,be(G(this.iteration,this.decay),1));n.forEach((r,i)=>{const a=H.registeredVariables[r],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${r}/m`,variable:lt(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${r}/v`,variable:lt(a).variable(l)});const c=Array.isArray(e)?e[i].tensor:e[r];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,h=be(G(u,this.beta1),G(c,1-this.beta1)),f=G(d,this.beta2),p=Mn(c),m=xi(f,p);u.assign(h),d.assign(m);const g=be(G(Me(o,s),Me(h,be(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(be(this.iteration,1)),this.accBeta1.assign(G(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Je(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Je(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yy extends Ci{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=Array.isArray(e)?e[o].tensor:e[s];if(r==null)return;const i=H.registeredVariables[s];Z(()=>{const a=be(G(this.c,r),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=qo(pt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q$ extends Yy{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=pt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=H.registeredVariables[s];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${s}/momentum`,variable:Z(()=>lt(r).variable(!1))});const i=this.accumulations[o].variable,a=Array.isArray(e)?e[o].tensor:e[s];a!=null&&Z(()=>{let l;const c=be(G(this.m,i),a);this.useNesterov?l=be(G(this.c,be(a,G(c,this.m))),r):l=be(G(this.c,c),r),i.assign(c),r.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Je(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class X$ extends Ci{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,o=null,r=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=r,o==null&&(this.epsilon=H.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,o)=>{const r=H.registeredVariables[s],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${s}/rms`,variable:Z(()=>lt(r).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${s}/momentum`,variable:Z(()=>lt(r).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${s}/mg`,variable:Z(()=>lt(r).variable(i))});const a=Array.isArray(e)?e[o].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[o].variable,c=this.accumulatedMoments[o].variable;Z(()=>{const u=be(G(l,this.decay),G(Et(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[o].variable,h=be(G(d,this.decay),G(a,1-this.decay)),f=Me(G(a,this.learningRate),Un(Le(u,be(Et(h),this.epsilon)))),p=be(G(c,this.momentum),f);l.assign(u),d.assign(h),c.assign(p);const m=Le(r,p);r.assign(m)}else{const d=be(G(l,this.decay),G(Et(a),1-this.decay)),h=be(G(c,this.momentum),Me(G(a,this.learningRate),Un(be(d,this.epsilon))));l.assign(d),c.assign(h);const f=Le(r,h);r.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Je(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Je(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Je(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(o=>({originalName:o.name,variable:o.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dz=[G$,H$,j$,K$,q$,X$,Yy];function Fz(){for(const t of Dz)de(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oz="model",Pz=".json",Mz=".weights.bin";function aw(t){return new Promise(e=>setTimeout(e)).then(t)}class ha{constructor(e){if(!Q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(ha.URL_SCHEME)&&(e=e.slice(ha.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Oz),this.modelJsonFileName=e+Pz,this.weightDataFileName=e+Mz}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Rr.join(e.weightData),s=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],r=QI(e,o),i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=i,await aw(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=s,await aw(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Up(e)}}}}ha.URL_SCHEME="downloads://";const Lz=t=>Q().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ha.URL_SCHEME)?Bz(t.slice(ha.URL_SCHEME.length)):null;en.registerSaveRouter(Lz);function Bz(t="model"){return new ha(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lw(t,e,n,s){i(t),n=n==null?0:n,s=s==null?1:s,a(n,s);let o=0;const r=l=>(l.then(c=>{const u=n+ ++o/t.length*(s-n);return e(u),c}),l);function i(l){N(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){N(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),N(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),N(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Vz(t,e){e==null&&(e={});const n=e.fetchFunc==null?Q().platform.fetch:e.fetchFunc,s=t.map(d=>n(d,e.requestInit,{isBinary:!0})),o=0,r=.5,a=(e.onProgress==null?await Promise.all(s):await lw(s,e.onProgress,o,r)).map(d=>d.arrayBuffer()),l=.5,c=1;return e.onProgress==null?await Promise.all(a):await lw(a,e.onProgress,l,c)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zz="application/octet-stream",Wz="application/json";class Zy{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(N(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Q().platform.fetch,N(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&N(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o=QI(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(o)],{type:Wz}),"model.json"),e.weightData!=null){const i=Rr.join(e.weightData);n.body.append("model.weights.bin",new Blob([i],{type:zz}),"model.weights.bin")}const r=await this.fetch(this.path,n);if(r.ok)return{modelArtifactsInfo:Up(e),responses:[r]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${r.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=n.modelTopology,o=n.weightsManifest;if(s==null&&o==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return oM(n,r=>this.loadWeights(r))}async loadWeights(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,o]=Uz(n),r=this.weightPathPrefix||s,i=rM(e),a=[],l=[];for(const u of e)for(const d of u.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(d)):a.push(r+d+o);this.weightUrlConverter&&a.push(...await Promise.all(l));const c=await Vz(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[i,c]}}Zy.URL_SCHEME_REGEX=/^https?:\/\//;function Uz(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),o=n>e?t.substring(n):"";return[s+"/",o]}function cw(t){return t.match(Zy.URL_SCHEME_REGEX)!=null}const Y$=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>cw(s)):n=cw(t),n)return Z$(t,e)}return null};en.registerSaveRouter(Y$);en.registerLoadRouter(Y$);function Z$(t,e){return new Zy(t,e)}function Gz(t,e){return Z$(t,e)}function Qy(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(oe(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const o=e.shape,r=o[o.length-1];let i=1;for(let d=0;d<o.length-1;++d)i*=o[d];const a=t.shape,l=o.slice();l.pop();let c=1;for(let d=r;d<n;++d)c*=a[d],l.push(a[d]);const u=[...Ae(t.shape).map(d=>d/c),1].slice(0,r);return[l,i,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rv=-2,Hz=-1;function Jy(t,e,n){const s=t.shape.length;N(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),N(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let o=0;o<s;++o)N(e[o]+n[o]<=t.shape[o],()=>`Error in slice${s}D: begin[${o}] + size[${o}] (${e[o]+n[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function jz(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function ex(t,e,n){const s=[];for(let o=0;o<t.length;o++)s[o]=Math.ceil((e[o]-t[o])/n[o]);return s}function Q$(t,e,n,s){const o=[...t];for(let r=o.length;r<s.length;r++)o.push(1);for(let r=0;r<n;r++)r===0?o[e]=1:(o.splice(e,0,1),o.pop());return o}function J$(t,e,n){return n<=t?n:n-(e-1)}function e2(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function Kz(t,e,n,s,o,r,i,a,l){const c=t.length;let u=new Array(c),d=new Array(c),h=new Array(c);if(e.length&&n>0){const f=e[0],p=n+1;u=t2(i,f,p,s,t),d=n2(a,f,p,o,t),h=Q$(r,f,p,t)}else for(let f=0;f<c;f++)u[f]=o2(i,s,r,t,f,l),d[f]=r2(a,o,r,t,f,l),h[f]=s2(r,f,l);return{begin:u,end:d,strides:h}}function t2(t,e,n,s,o){const r=[...o],i=e2(n,e);for(let a=0;a<r.length;a++)if(i.indexOf(a)>-1)r[a]=0;else{const l=J$(e,n,a);let c=s[l];t&1<<l&&(c=0),r[a]=c}return r}function n2(t,e,n,s,o){const r=[...o],i=e2(n,e);for(let a=0;a<r.length;a++)if(i.indexOf(a)>-1)r[a]=Number.MAX_SAFE_INTEGER;else{const l=J$(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),r[a]=c}for(let a=0;a<r.length;a++){const l=o[a];r[a]<0&&(r[a]+=l),r[a]=na(0,r[a],o[a])}return r}function s2(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function o2(t,e,n,s,o,r){let i=e[o];const a=n[o]||1;(t&1<<o||r&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[o];return i<0&&(i+=l),i=na(0,i,l-1),i}function r2(t,e,n,s,o,r){let i=e[o];const a=n[o]||1;(t&1<<o||r&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[o];return i<0&&(i+=l),a>0?i=na(0,i,l):i=na(-1,i,l-1),i}function tx(t,e,n){let s=n.length;for(let o=0;o<n.length;o++)if(n[o]>1){s=o;break}for(let o=s+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function nx(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function Xp(t,e,n){let s;const o=t.shape.length;typeof e=="number"?s=[e,...new Array(o-1).fill(0)]:e.length<o?s=e.concat(new Array(o-e.length).fill(0)):s=e.slice(),s.forEach(i=>{N(i!==-1,()=>"slice() does not support negative begin indexing.")});let r;return n==null?r=new Array(o).fill(-1):typeof n=="number"?r=[n,...new Array(o-1).fill(-1)]:n.length<o?r=n.concat(new Array(o-n.length).fill(-1)):r=n,r=r.map((i,a)=>i>=0?i:(N(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,r]}function sx(t,e,n,s,o,r,i,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:o,endMask:r,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let y=0;y<d.dims;y++)u&&(1<<y&a)!==0&&d.numAddAxisAfterEllipsis++,1<<y&i&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};qz(d,h);let f=!0,p=!0,m=!0;const g=[],v=[];for(let y=0;y<t.length;++y){if(h.strides[y]===0)throw Error(`strides[${y}] must be non-zero`);const x=!!(h.shrinkAxisMask&1<<y),w=t[y];if(w===-1){g.push(x?1:-1);continue}const k=[h.beginMask&1<<y,h.endMask&1<<y],S=[h.strides[y]>0?0:-1,h.strides[y]>0?w:w-1];if(x&&h.strides[y]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&h.strides[y]===1;const C=!!(h.beginMask&1<<y&&h.endMask&1<<y);if(h.beginValid&&h.endValid){if(x){const _=h.begin[y]<0?w+h.begin[y]:h.begin[y];if(h.begin[y]=_,h.end[y]=h.begin[y]+1,_<0||_>=w)throw Error(`slice index ${h.begin[y]} of dimension ${y} out of bounds.`)}else h.begin[y]=uw(h.begin[y],0,h.strides[y],w,k,S),h.end[y]=uw(h.end[y],1,h.strides[y],w,k,S);const E=h.strides[y]===1&&h.begin[y]===0&&h.end[y]===w;f=f&&E,p=p&&(y===0&&h.strides[y]===1||E)}else f=f&&h.strides[y]===1&&C,p=p&&(y===0&&h.strides[y]===1||C);let $,T=!1;if(h.beginValid&&h.endValid?($=h.end[y]-h.begin[y],T=!0):x?($=1,T=!0):C&&w>=0&&(h.strides[y]<0?$=-w:$=w,T=!0),T){let E;$===0||$<0!=h.strides[y]<0?E=0:E=Math.trunc($/h.strides[y])+($%h.strides[y]!==0?1:0),g.push(E)}else g.push(-1)}for(let y=0;y<h.finalShapeGatherIndices.length;++y){const x=h.finalShapeGatherIndices[y];x>=0?v.push(g[x]):x===rv&&v.push(1)}return{finalShapeSparse:v.filter((y,x)=>h.finalShapeGatherIndices[x]!==rv),finalShape:v,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function qz(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const o=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<o;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(rv),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(Hz),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function uw(t,e,n,s,o,r){if(o[e])return n>0?r[e]:r[e+1&1];{const i=t<0?s+t:t;return i<r[0]?r[0]:i>r[1]?r[1]:i}}const Xz=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Jy,maskToAxes:jz,computeOutShape:ex,stridesWithElidedDims:Q$,getNormalizedAxes:Kz,startIndicesWithElidedDims:t2,stopIndicesWithElidedDims:n2,stridesForAxis:s2,startForAxis:o2,stopForAxis:r2,isSliceContinous:tx,computeFlatOffset:nx,parseSliceParams:Xp,sliceInfo:sx},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yz{static sgd(e){return new Yy(e)}static momentum(e,n,s=!1){return new q$(e,n,s)}static rmsprop(e,n=.9,s=0,o=null,r=!1){return new X$(e,n,s,o,r)}static adam(e=.001,n=.9,s=.999,o=null){return new j$(e,n,s,o)}static adadelta(e=.001,n=.95,s=null){return new G$(e,n,s)}static adamax(e=.002,n=.9,s=.999,o=null,r=0){return new K$(e,n,s,o,r)}static adagrad(e,n=.1){return new H$(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Va=Yz;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zz=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t())();function i2(){return new Promise(t=>Zz(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ox(t,e){const n=t[0].length;t.forEach((o,r)=>{N(o.length===n,()=>`Error in concat${n}D: rank of tensors[${r}] must be the same as the rank of the rest (${n})`)}),N(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((o,r)=>{for(let i=0;i<n;i++)N(i===e||o[i]===s[i],()=>`Error in concat${n}D: Shape of tensors[${r}] (${o}) does not match the shape of the rest (${s}) along the non-concatenated axis ${r}.`)})}function Xo(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fo;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(fo||(fo={}));function a2(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let o=1;o<n.length;++o){const r=n[o],i=s[s.length-n.length+o],a=s[i];if(r>=0)if(a>=0){if(a!==r)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${o+t}] = ${r} but shape[${o+t}] = ${a}`)}else s[i]=r}return s}function l2(t){const e={FIRST_DIM_SIZE:fo.FIRST_DIM_SIZE,VALUE_ROWIDS:fo.VALUE_ROWIDS,ROW_LENGTHS:fo.ROW_LENGTHS,ROW_SPLITS:fo.ROW_SPLITS,ROW_LIMITS:fo.ROW_LIMITS,ROW_STARTS:fo.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function c2(t){return t.length===0?0:t[0]===fo.FIRST_DIM_SIZE?t.length-1:t.length}function u2(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let o=0;o<Math.min(n,s-1);++o){const r=t[o],i=e[o+1];if(r>=0&&i>=0&&r!==1&&r!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${o-t.length}] = ${r} but ragged tensor input.flatValues.shape[${o-t.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rx=30;function Yp(t){return t<=rx?t:Vg(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ix(t,e,n){const s=n*(typeof t=="number"?t:t[0]),o=e*(typeof t=="number"?t:t[1]);return[s,o]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hd(t,e,n,s=!0){let o=[];if(s)o=o.concat(e.slice(0)),o.push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);const r=e.length;for(let i=0;i<r;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(r+1))}return o}function fd(t,e,n=!0){const s=[];if(n){s.push(e);for(let o=e+1;o<t;++o)o<=2*e?(s.push(o),s.push(o-(e+1))):s.push(o)}else{const o=[],r=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?r.push(i):o.push(i);s.push(...o),s.push(0),s.push(...r)}return s}function pd(t,e,n,s=!0){const o=[];s?o.push(t[0]/n):o.push(t[0]*n);for(let r=1;r<t.length;++r)r<=e.length?s?o.push(e[r-1]*t[r]):o.push(t[r]/e[r-1]):o.push(t[r]);return o}function ax(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function lx(t,e,n){const s=t.slice(0,1);for(let o=0;o<n;++o)s.push(t[o+1]-e[o][0]-e[o][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zp=1.7580993408473768,Qp=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cx=.3275911,ux=.254829592,dx=-.284496736,hx=1.421413741,fx=-1.453152027,px=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ir(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function d2(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function h2(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],s[Math.floor(o/4)]=t[o+1];return{real:n,imag:s}}function f2(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],s[Math.floor(o/4)]=t[o+1];return{real:n,imag:s}}function mx(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function p2(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function m2(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){const r=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(r),s[o]=Math.sin(r)}return{real:n,imag:s}}function g2(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),o=Math.cos(s),r=Math.sin(s);return{real:o,imag:r}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Um="->",Qz=/->/g,dw=",",hw="...";function gx(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Qz,"").length)/Um.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Um}").`);const[s,o]=t.split(Um);N(s.indexOf(hw)===-1,()=>`The ellipsis notation ("${hw}") is not supported yet.`);const r=s.split(dw),i=r.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<o.length;++h){const f=o[h];if(!r.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let h=0;h<s.length;++h){const f=s[h];a.indexOf(f)===-1&&f!==dw&&a.push(f)}const l=new Array(r.length);for(let h=0;h<i;++h){if(new Set(r[h].split("")).size!==r[h].length)throw new Error(`Found duplicate axes in input component ${r[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let f=0;f<r[h].length;++f)l[h].push(a.indexOf(r[h][f]))}const c=a.length,u=o.length,d=[];for(let h=u;h<c;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function vx(t,e){let n=new Array(t);n.fill(-1);for(let o=0;o<e.length;++o)n[e[o]]=o;const s=[];for(let o=0;o<t;++o)n[o]===-1&&s.push(o);return n=n.filter(o=>o!==-1),{permutationIndices:n,expandDims:s}}function bx(t,e,n){const s=new Array(t);for(let o=0;o<n.length;++o){const r=n[o].shape;for(let i=0;i<e[o].length;++i)s[e[o][i]]===void 0?s[e[o][i]]=r[i]:N(s[e[o][i]]===r[i],()=>`Expected dimension ${s[e[o][i]]} at axis ${i} of input shaped ${JSON.stringify(r)}, but got dimension ${r[i]}`)}}function yx(t,e){const n=t,s=[];let o=0;t.length===0&&n.push(-1),o=t.length+1;for(let i=0;i<o;++i)s.push([]);const r=[];for(let i=0;i<n.length;++i){const a=n[i],l=Jz(e,a);for(const c of l)r.indexOf(c)===-1&&(s[i].push(c),r.push(c))}return{path:n,steps:s}}function xx(t){return t.every((e,n)=>e===n)}function Jz(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function wx(t,e,n=0){let s=[];if(typeof e=="number")N(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const o=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);N(o<=1,()=>"There should be only one negative value in split array.");const r=e.indexOf(-1);if(r!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[r]=t.shape[n]-i}N(t.shape[n]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function b2(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function y2(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function w2(t,e){return`size ${t} must be non-negative, not ${e}`}function C2(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function k2(t,e){const n=oe(t),s=oe(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function S2(t,e){const n=oe(t),s=oe(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iv(){return"segment ids must be >= 0"}function I2(){return"segment ids are not increasing"}function $2(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function T2(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N2(t,e){let n=!1,s;for(t<=rx?(s=t,n=!0):s=Vg(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Vg(t,s+1);return s}function E2(t,e,n){const s=[],o=t.length;for(let r=0;r<o;r++)r!==e?s.push(t[r]):s.push(n);return s}function Cx(t,e,n,s){const o=e.shape.length,r=t.shape.length;if(s!==0&&(s<-o||s>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${s}`);if(s<0&&(s+=o),s>r)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${r}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const i=t.shape[n],a=[];let l=1,c=1,u=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=s;d<o;d++)a.push(e.shape[d]);for(let d=n+1;d<r;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:i,outputShape:a}}const e4=Object.freeze(Object.defineProperty({__proto__:null,segOpComputeOptimalWindowSize:N2,computeOutShape:E2,collectGatherOpShapeInfo:Cx},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $r(t){try{return t.map(e=>ai(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function _2(t){return t.map(e=>ni(e))}const t4=Object.freeze(Object.defineProperty({__proto__:null,slice_util:Xz,segment_util:e4,fromUint8ToStringArray:$r,fromStringArrayToUint8:_2,upcastType:vs,axesAreInnerMostDims:Ty,combineLocations:f$,computeOutAndReduceShapes:bn,expandShapeToKeepDim:Jt,assertAxesAreInnerMostDims:Nn,getAxesPermutation:Lt,getUndoAxesPermutation:yi,getInnerMostAxes:Kt,getBroadcastDims:ml,getReductionAxes:ln,assertAndGetBroadcastShape:qe,assertParamsConsistent:ox,computeOutShape:Xo,computeDilation2DInfo:ad,computePool2DInfo:ro,computePool3DInfo:Dr,computeConv2DInfo:Tn,computeConv3DInfo:bi,computeDefaultPad:xy,tupleValuesAreOne:aa,eitherStridesOrDilationsAreOne:Dn,stridesOrDilationsArePositive:la,convertConv2DDataFormat:Fr,checkPadOnDimRoundingMode:is,getFusedDyActivation:Wy,getFusedBiasGradient:Uy,applyActivation:Gy,shouldFuse:Hy,get RowPartitionType(){return fo},combineRaggedTensorToTensorShapes:a2,getRowPartitionTypesHelper:l2,getRaggedRank:c2,validateDefaultValueShape:u2,PARALLELIZE_THRESHOLD:rx,computeOptimalWindowSize:Yp,getImageCenter:ix,getReshaped:hd,getPermuted:fd,getReshapedPermuted:pd,getSliceBeginCoords:ax,getSliceSize:lx,prepareAndValidate:Qy,validateUpdateShape:L$,validateInput:CV,calculateShapes:Ia,SELU_SCALEALPHA:Zp,SELU_SCALE:Qp,ERF_P:cx,ERF_A1:ux,ERF_A2:dx,ERF_A3:hx,ERF_A4:fx,ERF_A5:px,warn:Ts,log:SP,mergeRealAndImagArrays:Ir,splitRealAndImagArrays:d2,complexWithEvenIndex:h2,complexWithOddIndex:f2,getComplexWithIndex:mx,assignToTypedArray:p2,exponents:m2,exponent:g2,decodeEinsumEquation:gx,getEinsumPermutation:vx,checkEinsumDimSizes:bx,getEinsumComputePath:yx,isIdentityPermutation:xx,prepareSplitSize:wx,getSparseFillEmptyRowsIndicesDenseShapeMismatch:v2,getSparseFillEmptyRowsNegativeIndexErrorMessage:b2,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:y2,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:x2,getSparseReshapeNegativeOutputDimErrorMessage:w2,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:C2,getSparseReshapeInputOutputMultipleErrorMessage:k2,getSparseReshapeInputOutputMismatchErrorMessage:S2,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:iv,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:I2,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:$2,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:T2},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Fz();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2={kernelName:Vf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,dd(Se(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n4={kernelName:hu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Et(Se(n,"float32")),o=Un(Le(pt(1),s));return Gt(Me(t,o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s4={kernelName:fu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Un(Le(Et(Se(n,"float32")),1));return Me(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o4={kernelName:Ml,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{let a=t;const l=ln(n.shape,o);return l.length>0&&(a=De(a,l)),K(a,n.shape)},b:()=>{let a=t;const l=ln(s.shape,o);return l.length>0&&(a=De(a,l)),K(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r4={kernelName:_b,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,o)=>{n[o]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i4={kernelName:zf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>lt(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a4={kernelName:Wf,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>lt(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l4={kernelName:pu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Un(Le(pt(1),Et(Se(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c4={kernelName:mu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Un(be(pt(1),Et(Se(n,"float32"))));return Me(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u4={kernelName:bu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{const a=be(Et(n),Et(s));let l=G(t,Me(s,a));const c=ln(n.shape,o);return c.length>0&&(l=De(l,c)),K(l,n.shape)},b:()=>{const a=be(Et(n),Et(s));let l=Gt(G(t,Me(n,a)));const c=ln(s.shape,o);return c.length>0&&(l=De(l,c)),K(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d4={kernelName:gu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,be(Et(Se(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h4={kernelName:vu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Le(pt(1),Et(Se(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4(t,e,n,s,o,r){const i=L(t,"dy","avgPool3dGrad"),a=L(e,"input","avgPool3dGrad");let l=i,c=a,u=!1;a.rank===4&&(u=!0,l=K(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),c=K(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),N(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),N(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),is("avgPool3dGrad",o,r);const d={dy:l,input:c},h={filterSize:n,strides:s,pad:o,dimRoundingMode:r},f=H.runKernel(Fb,d,h);return u?K(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const p4=q({avgPool3dGrad_:f4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m4={kernelName:Gf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:o,strides:r,pad:i,dimRoundingMode:a}=n;return{x:()=>p4(t,s,o,r,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4(t,e,n,s,o){const r=L(t,"dy","avgPoolGrad"),i=L(e,"input","avgPoolGrad");N(i.rank===r.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${r.rank})`);let a=i,l=r,c=!1;i.rank===3&&(c=!0,a=K(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=K(r,[1,r.shape[0],r.shape[1],r.shape[2]])),N(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),N(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:n,strides:s,pad:o},h=H.runKernel(Db,u,d);return c?K(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const v4=q({avgPoolGrad_:g4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b4={kernelName:Uf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:o,strides:r,pad:i}=n;return{x:()=>v4(t,s,o,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y4={kernelName:Hf,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,o]=e,{transposeA:r,transposeB:i}=n;return!r&&!i?{a:()=>ft(t,o,!1,!0),b:()=>ft(s,t,!0,!1)}:!r&&i?{a:()=>ft(t,o,!1,!1),b:()=>ft(t,s,!0,!1)}:r&&!i?{a:()=>ft(o,t,!1,!0),b:()=>ft(s,t,!1,!1)}:{a:()=>ft(o,t,!0,!0),b:()=>ft(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x4={kernelName:jf,gradFunc:(t,e,n)=>{const{blockShape:s,crops:o}=n;return{x:()=>Oy(t,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w4={kernelName:xP,gradFunc:(t,e,n)=>{const s=n,o=s.inputShape,r=s.shape,i=Array.from(r);for(let l=o.length-1;l>=0;l--)if(o[l]===r[l])i[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${r}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>De(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C4={kernelName:yu,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k4={kernelName:xu,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S4={kernelName:wu,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:o,clipValueMax:r}=n;return{x:()=>Wn(kr(Ca(s,o),Bl(s,r)),t,lt(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I4={kernelName:Kf,inputsToSave:["x"],gradFunc:A2.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $4={kernelName:qf,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:o}=n,r=tt(o,e[0].shape)[0],i=s.map(l=>l[r]);return As(t,i,r).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T4={kernelName:Xf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,o]=e,{dilations:r,strides:i,pad:a,dataFormat:l}=n;return N(aa(r),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`),{x:()=>Sy(s.shape,t,o,i,a,l),filter:()=>zy(s,t,o.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N4={kernelName:Yf,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,o]=e,{strides:r,pad:i,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>ca(t,o,r,i,a,1,l),filter:()=>zy(t,s,o.shape,r,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E4(t,e,n,s,o){let r=t;t.rank===4&&(r=K(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=K(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),N(r.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${r.shape}.`),N(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),N(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),N(r.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${r.shape[4]}) must match input depth in filter (${n[3]}.`),N(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:r,dy:i},l={strides:s,pad:o,filterShape:n};return H.runKernel(Bb,a,l)}const _4=q({conv3DBackpropFilter_:E4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A4={kernelName:Zf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:o,pad:r}=n;N(aa(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>u$(i.shape,t,a,o,r),filter:()=>_4(i,t,a.shape,o,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R4={kernelName:Cu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(Gt(F$(Se(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D4={kernelName:ku,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(O$(Se(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F4={kernelName:Qf,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:o,exclusive:r,reverse:i}=n;return{x:()=>{const a=Lt([o],s.rank);let l=h$(t,o,r,!i);return a!=null&&(l=at(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O4={kernelName:Jf,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:o,pad:r,dimRoundingMode:i}=n,a=s==null?[1,1]:s;N(aa(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return N(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),N(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),N(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),N(Dn(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),is("depthwiseConv2d",r,i),{x:()=>zV(l.shape,t,c,o,r,a,i),filter:()=>BV(l,t,c.shape,o,r,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P4={kernelName:ep,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,o]=e,r={x:s,filter:o,dy:t},i={x:s,filter:o,dy:t};return{x:()=>H.runKernel(zg,r,n),filter:()=>H.runKernel(Wg,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M4={kernelName:Iu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>H.runKernel(qb,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L4={kernelName:$u,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=G(tr(Gt(Et(n))),2/Math.sqrt(Math.PI));return{x:()=>G(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B4={kernelName:Tu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V4={kernelName:np,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>K(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z4={kernelName:Nu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,tr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W4={kernelName:Eu,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U4={kernelName:_u,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{const a=Me(t,Se(s,"float32")),l=ln(n.shape,o);return l.length>0?K(De(a,l),n.shape):a},b:()=>{let a=G(t,Se(n,"float32"));const l=ln(s.shape,o);l.length>0&&(a=K(De(a,l),s.shape));const c=Et(s);return Gt(Me(a,Se(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G4={kernelName:sp,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[o,r,i,a]=e,l=a==null?pt(1):a,c=ln(r.shape,o.shape),u=[];if(r.rank===1){for(let x=0;x<o.shape.length-1;++x)u.push(o.shape[x]);u.push(1)}const d=Le(o,r),h=G(t,l),f=A$(be(i,pt(s))),p=G(G(G(f,f),f),pt(-.5));return{x:()=>r.rank===1?K(G(G(t,go(K(f,[1,1,1,r.shape[0]]),u)),l),o.shape):K(G(G(t,f),l),o.shape),mean:()=>{let x=G(G(f,pt(-1)),h);return r.rank===1&&(x=De(x,c)),K(x,r.shape)},variance:()=>{let x=G(G(p,d),h);return r.rank===1&&(x=De(x,c)),K(x,r.shape)},scale:()=>{const x=G(d,f);let w=G(t,x);return r.rank===1&&(w=De(w,c)),K(w,r.shape)},offset:()=>{let x=t;return r.rank===1&&(x=De(x,c)),K(x,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H4={kernelName:op,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,o]=e,{axis:r,batchDims:i}=n,a=tt(r,s.shape)[0],l=(c,u,d)=>()=>{const h=c.shape,f=u.size,p=h.slice(0,a),m=p.length,g=h.slice(r,h.length).slice(1),v=g.length,b=fw(0,m),y=fw(m+1,m+1+v),x=pw([p,[f],g]),w=K(d,x),k=K(u,[f]),S=pw([[m],b,y]),C=at(w,S);let $=V$(C,k,c.shape[a]);const T=yi(S);return $=at($,T),$};if(i===1){const c=s.shape[0],u=s.split(c,0);return{x:()=>Sr(u.map((f,p)=>l(f,o.slice(p,1),t.slice(p,1))())).reshape(s.shape),indices:()=>o}}else return{x:l(s,o,t),indices:()=>o}}};function fw(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function pw(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j4={kernelName:Au,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>lt(n),b:()=>lt(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K4={kernelName:Ru,gradFunc:t=>({x:()=>Se(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q4={kernelName:Du,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X4={kernelName:Fu,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y4={kernelName:Ou,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z4={kernelName:ip,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:o}=n,r=Fs(s,0);return{x:()=>Wn(r,t,G(t,o))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q4={kernelName:Mu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,be(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J4={kernelName:Pu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Se(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eW={kernelName:CP,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:o}=n;return{logits:()=>{const i=tr(s);return Le(t,G(De(t,o,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(t,e,n,s=5,o=1,r=1,i=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:o,alpha:r,beta:i};return H.runKernel(ey,a,l)}const nW=q({localResponseNormalizationBackprop_:tW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sW={kernelName:hp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,o]=e,{depthRadius:r,bias:i,alpha:a,beta:l}=n;return{x:()=>nW(s,o,t,r,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R2(t,e,n,s){return e.rank<n.rank&&(e=K(e,Jt(e.shape,s))),t.rank<n.rank&&(t=K(t,Jt(t.shape,s))),{x:()=>G(t,Se(er(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mw={kernelName:fp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:o}=s,r=e[0],i=e[1],a=tt(o,r.shape),l=R2(t,i,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oW={kernelName:Lu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>G(t,Se(Ca(n,s),"float32")),b:()=>G(t,Se(Lh(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(t,e,n,s,o,r,i){const a=L(t,"dy","maxPool3dGrad"),l=L(e,"input","maxPool3dGrad"),c=L(n,"output","maxPool3dGrad");let u=a,d=l,h=c,f=!1;l.rank===4&&(f=!0,u=K(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=K(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=K(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),N(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),N(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),N(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),is("maxPool3dGrad",r,i);const p={dy:u,input:d,output:h},m={filterSize:s,strides:o,pad:r,dimRoundingMode:i},g=H.runKernel(ny,p,m);return f?K(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const iW=q({maxPool3dGrad_:rW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aW={kernelName:mp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,o]=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=n;return{x:()=>iW(t,s,o,r,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(t,e,n,s,o,r,i){const a=L(t,"dy","maxPoolGrad"),l=L(e,"input","maxPoolGrad"),c=L(n,"output","maxPoolGrad");N(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),N(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),N(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),is("maxPoolGrad",r,i);const u={dy:a,input:l,output:c},d={filterSize:s,strides:o,pad:r,dimRoundingMode:i};return H.runKernel(ty,u,d)}const cW=q({maxPoolGrad_:lW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uW={kernelName:pp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,o]=e,{filterSize:r,strides:i,pad:a}=n;return{x:()=>cW(t,s,o,r,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dW={kernelName:gp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:o}=n,r=tt(o,s.shape),a=bn(s.shape,r)[1],l=oe(a);return{x:()=>{const u=s.shape.slice();r.forEach(f=>{u[f]=1});const d=K(t,u);return Me(G(d,wi(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hW={kernelName:vp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:o}=s,[r,i]=e,a=tt(o,r.shape),l=R2(t,i,r,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fW={kernelName:Bu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>G(t,Se(Bl(n,s),"float32")),b:()=>G(t,Se(Fs(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pW={kernelName:bp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:o}=n,r=o.map(i=>i[0]);return{x:()=>It(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mW={kernelName:Vu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{const a=ln(n.shape,o);return a.length>0?K(De(t,a),n.shape):t},b:()=>{const a=G(t,Gt(qp(Me(n,s)))),l=ln(s.shape,o);return l.length>0?K(De(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gW={kernelName:zu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{const a=G(t,Se(s,"float32")),l=ln(n.shape,o);return l.length>0?K(De(a,l),n.shape):a},b:()=>{const a=G(t,Se(n,"float32")),l=ln(s.shape,o);return l.length>0?K(De(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vW={kernelName:yp,gradFunc:t=>({x:()=>Gt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bW={kernelName:Cp,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>hn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yW={kernelName:wp,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xW={kernelName:kp,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return da(t,s).map(r=>()=>r)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gw={kernelName:Sp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:o}=n,r=o.map(i=>i[0]);return{x:()=>It(t,r,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wW={kernelName:Wu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,o]=e,r=n,i=s,a=qe(r.shape,i.shape);return{a:()=>{const u=Se(i,"float32");let d=G(t,G(u,gl(r,Le(u,pt(1)))));const h=ln(r.shape,a);return h.length>0&&(d=De(d,h)),K(d,r.shape)},b:()=>{const u=Fs(r,0),d=Wn(u,nr(r),lt(r));let h=G(t,G(o,d));const f=ln(i.shape,a);return f.length>0&&(h=De(h,f)),K(h,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CW={kernelName:Ip,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,o=Fs(n,0);return{x:()=>Wn(o,t,G(t,s)),alpha:()=>{let r=Wn(o,lt(t),G(t,n));const i=ln(s.shape,t.shape);return i.length>0&&(r=De(r,i)),K(r,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kW(t,e,n){const s=t.shape.slice();s[n]=1;const o=K(e,s),r=sv(t,n,!0,!1),i=sv(t,n,!0,!0),a=G(r,i);return G(o,a)}function SW(t,e,n){const s=t.shape.length,o=s-n.length,r=Lt(n,s);let i=t;r!=null&&(i=at(t,r));const a=i.shape.slice(),c=a.splice(s-n.length,n.length).reduce((h,f)=>h*f,1);a.push(c);const u=i.reshape(a);let d=kW(u,e,o);if(d=d.reshape(i.shape),r!=null){const h=yi(r);d=at(d,h)}return d}const IW={kernelName:$p,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:o}=n;let r=[];return o==null?r=s.shape.map((i,a)=>a):typeof o=="number"?r=[o]:r=o,{x:()=>SW(s,t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $W={kernelName:Su,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{const a=Me(t,Se(s,"float32")),l=ln(n.shape,o);return l.length>0?K(De(a,l),n.shape):a},b:()=>{let a=G(t,Se(n,"float32"));const l=ln(s.shape,o);l.length>0&&(a=K(De(a,l),s.shape));const c=Et(s);return Gt(Me(a,Se(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TW={kernelName:Uu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Gt(Et(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NW={kernelName:Hu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=G(Bl(n,6),dd(n));return{x:()=>G(t,Se(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EW={kernelName:Gu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,Se(dd(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _W={kernelName:Tp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>K(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AW={kernelName:Ep,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,o={dy:t,images:s};return{images:()=>H.runKernel(cy,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RW={kernelName:Np,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,o={dy:t,images:s};return{images:()=>H.runKernel(ly,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DW={kernelName:_p,gradFunc:(t,e,n)=>{const{dims:s}=n,o=tt(s,t.shape);return{x:()=>ua(t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FW={kernelName:ju,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OW={kernelName:Ku,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Gt(Me(t,G(gl(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PW={kernelName:Ap,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>Se(lt(n),"float32"),t:()=>G(t,Se(n,t.dtype)),e:()=>G(t,Se(Ay(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MW={kernelName:qu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Fs(n,pt(0)),o=pt(Zp),r=pt(Qp),i=G(t,r),a=G(G(t,o),tr(Se(n,"float32")));return Wn(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LW={kernelName:Qu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,G(n,Le(pt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BW={kernelName:Zu,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VW={kernelName:Xu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(Iy(Se(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zW={kernelName:Yu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(d$(Se(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WW={kernelName:Rp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:o,size:r}=n,i=s.shape,[a,l]=Xp(s,o,r),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],i[u]-a[u]-l[u]]);return{x:()=>Fy(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW={kernelName:Pp,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:o}=n,r=!0,i=G(t,s);return{logits:()=>Le(i,G(De(i,[o],r),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW={kernelName:Ju,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,Ll(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vw={kernelName:Fp,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:o}=n;return{x:()=>ky(t,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bw={kernelName:Op,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>ns(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HW={kernelName:ed,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,G(Un(Se(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jW={kernelName:uy,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(t,G(Se(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KW={kernelName:td,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=pt(2);return{a:()=>G(t,G(o,Le(n,s))),b:()=>G(t,G(o,Le(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qW={kernelName:id,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XW={kernelName:nd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,o=qe(n.shape,s.shape);return{a:()=>{let a=t;const l=ln(n.shape,o);return l.length>0&&(a=De(a,l)),K(a,n.shape)},b:()=>{let a=t;const l=ln(s.shape,o);return l.length>0&&(a=De(a,l)),K(Gt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW={kernelName:Dp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,o=s.shape.slice(),{axis:r}=n;tt(r,s.shape).forEach(c=>{o[c]=1});const a=K(t,o),l=G(a,wi(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZW={kernelName:sd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Me(t,Et(Iy(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QW={kernelName:od,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>G(Le(pt(1),Et(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JW={kernelName:rd,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:o}=n;return{x:()=>{let i=lt(s);if(s.rank===1)for(let a=0;a<o[0];++a)i=be(i,It(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)i=be(i,It(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)i=be(i,It(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)i=be(i,It(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eU={kernelName:ol,gradFunc:(t,e,n)=>{const s=n,{perm:o}=s,r=yi(o);return{x:()=>at(t,r)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tU={kernelName:Mp,gradFunc:(t,e,n)=>{const s=n,{axis:o}=s;return{value:()=>Sr(t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU={kernelName:Lp,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>sU(t,n)}}};function sU(t,e){const n=xi(e,lt(e)),s=Ny(t,n);let o=Ca(e,pt(0,"int32"));const r=s.rank-o.rank;for(let a=0;a<r;++a)o=Zn(o,a+1);o=kr(o,wi(s.shape,"bool"));const i=lt(s);return Wn(o,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU={kernelName:Bp,gradFunc:t=>({x:()=>lt(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU=[A2,n4,s4,o4,r4,i4,a4,l4,c4,u4,d4,h4,m4,b4,y4,x4,w4,C4,k4,S4,I4,$4,N4,T4,A4,R4,D4,F4,O4,P4,$W,M4,L4,B4,V4,z4,U4,W4,G4,H4,j4,K4,q4,X4,Y4,Z4,Q4,J4,eW,sW,mw,mw,oW,aW,uW,dW,hW,fW,pW,mW,gW,vW,bW,yW,xW,gw,gw,wW,CW,IW,TW,NW,EW,_W,AW,RW,DW,FW,OW,PW,MW,LW,BW,VW,zW,WW,UW,GW,vw,vw,bw,bw,HW,KW,jW,qW,XW,YW,ZW,QW,JW,eU,tU,nU,oU];for(const t of rU)IP(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.abs=function(){return this.throwIfDisposed(),Mn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.acos=function(){return this.throwIfDisposed(),MM(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.acosh=function(){return this.throwIfDisposed(),BM(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.add=function(t){return this.throwIfDisposed(),be(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.all=function(t,e){return this.throwIfDisposed(),a$(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.any=function(t,e){return this.throwIfDisposed(),tv(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.argMax=function(t){return this.throwIfDisposed(),Vc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.argMin=function(t){return this.throwIfDisposed(),GM(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asScalar=function(){return this.throwIfDisposed(),N(this.size===1,()=>"The array must have only 1 element."),K(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asType=function(t){return this.throwIfDisposed(),Se(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as1D=function(){return this.throwIfDisposed(),K(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as2D=function(t,e){return this.throwIfDisposed(),K(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),K(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),K(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as5D=function(t,e,n,s,o){return this.throwIfDisposed(),K(this,[t,e,n,s,o])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asin=function(){return this.throwIfDisposed(),jM(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asinh=function(){return this.throwIfDisposed(),qM(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.atan=function(){return this.throwIfDisposed(),YM(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.atan2=function(t){return this.throwIfDisposed(),QM(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.atanh=function(){return this.throwIfDisposed(),eL(this)};ne().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),wy(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),ky(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.batchNorm=function(t,e,n,s,o){return this.throwIfDisposed(),Gp(this,t,e,n,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.broadcastTo=function(t){return this.throwIfDisposed(),$c(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cast=function(t){return this.throwIfDisposed(),Se(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.ceil=function(){return this.throwIfDisposed(),TL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Rs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Yt&&(t=[t]),ns([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.conv1d=function(t,e,n,s,o,r){return this.throwIfDisposed(),l$(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.conv2dTranspose=function(t,e,n,s,o){return this.throwIfDisposed(),c$(this,t,e,n,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.conv2d=function(t,e,n,s,o,r){return this.throwIfDisposed(),ca(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cos=function(){return this.throwIfDisposed(),Iy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cosh=function(){return this.throwIfDisposed(),d$(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),sv(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),h$(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),QL(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.depthwiseConv2d=function(t,e,n,s,o,r){return this.throwIfDisposed(),$y(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.dilation2d=function(t,e,n,s,o){return this.throwIfDisposed(),t3(this,t,e,n,s,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.divNoNan=function(t){return this.throwIfDisposed(),i3(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.div=function(t){return this.throwIfDisposed(),Me(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.dot=function(t){return this.throwIfDisposed(),l3(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.elu=function(){return this.throwIfDisposed(),jp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.equal=function(t){return this.throwIfDisposed(),er(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.erf=function(){return this.throwIfDisposed(),h3(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),w3(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.exp=function(){return this.throwIfDisposed(),tr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.expandDims=function(t){return this.throwIfDisposed(),Zn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.expm1=function(){return this.throwIfDisposed(),I3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.fft=function(){return this.throwIfDisposed(),M$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.flatten=function(){return this.throwIfDisposed(),K(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.floor=function(){return this.throwIfDisposed(),qp(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.floorDiv=function(t){return this.throwIfDisposed(),i$(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Ny(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ca(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.greater=function(t){return this.throwIfDisposed(),Fs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.ifft=function(){return this.throwIfDisposed(),ov(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.irfft=function(){return this.throwIfDisposed(),cV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.isFinite=function(){return this.throwIfDisposed(),F3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.isInf=function(){return this.throwIfDisposed(),P3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.isNaN=function(){return this.throwIfDisposed(),L3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.leakyRelu=function(t){return this.throwIfDisposed(),_y(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.lessEqual=function(t){return this.throwIfDisposed(),Bl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.less=function(t){return this.throwIfDisposed(),Lh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),U3(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logSigmoid=function(){return this.throwIfDisposed(),Y3(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logSoftmax=function(t){return this.throwIfDisposed(),v$(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),b$(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.log=function(){return this.throwIfDisposed(),nr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.log1p=function(){return this.throwIfDisposed(),g$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalAnd=function(t){return this.throwIfDisposed(),kr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalNot=function(){return this.throwIfDisposed(),Ay(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalOr=function(t){return this.throwIfDisposed(),y$(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalXor=function(t){return this.throwIfDisposed(),oB(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),ft(this,t,e,n)};ne().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),Ry(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.max=function(t,e){return this.throwIfDisposed(),xo(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.maximum=function(t){return this.throwIfDisposed(),xi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mean=function(t,e){return this.throwIfDisposed(),Zt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.min=function(t,e){return this.throwIfDisposed(),Mh(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.minimum=function(t){return this.throwIfDisposed(),Uc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),hB(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mod=function(t){return this.throwIfDisposed(),pB(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mul=function(t){return this.throwIfDisposed(),G(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.neg=function(){return this.throwIfDisposed(),Gt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Kp(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.notEqual=function(t){return this.throwIfDisposed(),Bh(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),x$(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.onesLike=function(){return this.throwIfDisposed(),no(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.pad=function(t,e){return this.throwIfDisposed(),Fy(this,t,e)};ne().prototype.pool=function(t,e,n,s,o,r){return this.throwIfDisposed(),SB(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.pow=function(t){return this.throwIfDisposed(),gl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.prelu=function(t){return this.throwIfDisposed(),Py(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.prod=function(t,e){return this.throwIfDisposed(),TB(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reciprocal=function(){return this.throwIfDisposed(),UB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.relu=function(){return this.throwIfDisposed(),Sa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.relu6=function(){return this.throwIfDisposed(),E$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reshapeAs=function(t){return this.throwIfDisposed(),K(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reshape=function(t){return this.throwIfDisposed(),K(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),W$(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),U$(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reverse=function(t){return this.throwIfDisposed(),ua(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.rfft=function(){return this.throwIfDisposed(),hV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.round=function(){return this.throwIfDisposed(),_$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.rsqrt=function(){return this.throwIfDisposed(),A$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.selu=function(){return this.throwIfDisposed(),R$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.separableConv2d=function(t,e,n,s,o,r){return this.throwIfDisposed(),D$(this,t,e,n,s,o,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sigmoid=function(){return this.throwIfDisposed(),Ll(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sign=function(){return this.throwIfDisposed(),QB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sin=function(){return this.throwIfDisposed(),F$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sinh=function(){return this.throwIfDisposed(),O$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.slice=function(t,e){return this.throwIfDisposed(),It(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.softmax=function(t){return this.throwIfDisposed(),Vy(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.softplus=function(){return this.throwIfDisposed(),ld(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Oy(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.split=function(t,e){return this.throwIfDisposed(),As(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sqrt=function(){return this.throwIfDisposed(),Un(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.square=function(){return this.throwIfDisposed(),Et(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.squaredDifference=function(t){return this.throwIfDisposed(),pV(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.squeeze=function(t){return this.throwIfDisposed(),ud(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Yt?[this,t]:[this,...t];return Sr(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.step=function(t){return this.throwIfDisposed(),dd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.stridedSlice=function(t,e,n,s,o,r,i,a){return this.throwIfDisposed(),yV(this,t,e,n,s,o,r,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sub=function(t){return this.throwIfDisposed(),Le(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sum=function(t,e){return this.throwIfDisposed(),De(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.tan=function(){return this.throwIfDisposed(),wV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.tanh=function(){return this.throwIfDisposed(),Cy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.tile=function(t){return this.throwIfDisposed(),go(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.toBool=function(){return this.throwIfDisposed(),Se(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.toFloat=function(){return this.throwIfDisposed(),Se(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.toInt=function(){return this.throwIfDisposed(),Se(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.topk=function(t,e){return this.throwIfDisposed(),SV(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.transpose=function(t){return this.throwIfDisposed(),at(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.unique=function(t){return this.throwIfDisposed(),TV(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),V$(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.unstack=function(t){return this.throwIfDisposed(),da(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.where=function(t,e){return this.throwIfDisposed(),Wn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.zerosLike=function(){return this.throwIfDisposed(),lt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zo extends Error{constructor(e){super(e),Object.setPrototypeOf(this,zo.prototype)}}class Xs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Xs.prototype)}}class W extends Error{constructor(e){super(e),Object.setPrototypeOf(this,W.prototype)}}class Xe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Xe.prototype)}}class kx extends Error{constructor(e){super(e),Object.setPrototypeOf(this,kx.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class D2{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fa(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Wo(t,e){if(!t)throw new kx(e)}function yw(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Qn(t){return t.length===1?t[0]:t}function wt(t){return Array.isArray(t)?t:[t]}function mr(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Ui(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Bs={};function Sx(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function av(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>av(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:av(s))}}}function md(t,e={},n={},s="object",o=!1){if(typeof t=="string"){const r=t;let i;if(r in n)i=n[r];else if(r in Bs)i=Bs[r];else if(i=e[r],i==null)throw new W(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const r=t;if(r.className==null||r.config==null)throw new W(`${s}: Improper config format: ${JSON.stringify(r)}.
'className' and 'config' must set.`);const i=r.className;let a,l;if(i in n?[a,l]=n[i]:i in Bs?[a,l]=Bs.className:i in e&&([a,l]=e[i]),a==null)throw new W(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const f of Object.keys(Bs))c[f]=Bs[f];for(const f of Object.keys(n))c[f]=n[f];const u=r.config;u.customObjects=c;const d=Object.assign({},Bs);for(const f of Object.keys(n))Bs[f]=n[f];av(r.config);const h=l(a,r.config,n,o);return Bs=Object.assign({},d),h}else{const c=Object.assign({},Bs);for(const d of Object.keys(n))Bs[d]=n[d];const u=new a(r.config);return Bs=Object.assign({},c),u}}}function iU(t,e){return t<e?-1:t>e?1:0}function Zd(t,e){return-1*iU(t,e)}function si(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function aU(t){if(t==null)throw new W(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function $a(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new W(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Ix(t,e,n=0,s=1/0){return Wo(n>=0),Wo(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(o=>typeof o===e)}function fn(t,e){Array.isArray(t)?(N(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>fn(n,`element ${s+1} of ${e}`))):N(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${F2(t)}.`)}function F2(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>F2(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function lU(t,e,n){let s=n!=null?n():Yn(),o;return(...i)=>{const a=n!=null?n():Yn();return a-s<e||(s=a,o=t(...i)),o}}function O2(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let cU=0;function P2(){return cU++}const Qd={};function Jp(t=""){return t in Qd||(Qd[t]=0),Qd[t]+=1,t+Qd[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const uU=["channelsFirst","channelsLast"],dU=["nearest","bilinear"],hU=["valid","same","causal"],fU=["max","avg"],pU=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const za=new Map;function qt(t){$a(uU,"DataFormat",t)}function mU(t){$a(dU,"InterpolationFormat",t)}function Os(t){$a(hU,"PaddingMode",t)}function M2(t){$a(fU,"PoolMode",t)}const Tc=[],xw="/";function Qi(t,e){Tc.push(t);try{const n=e();return Tc.pop(),n}catch(n){throw Tc.pop(),n}}function gU(){return Tc.length===0?"":Tc.join(xw)+xw}function L2(t){if(!V2(t))throw new Error("Not a valid tensor name: '"+t+"'");return gU()+t}function B2(t){if(!V2(t))throw new Error("Not a valid tensor name: '"+t+"'");za.has(t)||za.set(t,0);const e=za.get(t);if(za.set(t,za.get(t)+1),e>0){const n=`${t}_${e}`;return za.set(n,1),n}else return t}const vU=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function V2(t){return!!t.match(vU)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bU(t){return t===parseInt(t.toString(),10)}function oi(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let o=e;o<n;++o)s*=t[o];return s}function bl(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function li(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Co(t,e){if(e<t)throw new W(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Gm;function nn(){return Gm==null&&(Gm=_M().epsilon()),Gm}function ko(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Yo(t,e){return Se(t,e)}function gd(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),K(t,n)}function yU(t,e){return Z(()=>{if(t.shape.length!==2)throw new W(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=gd(t,1);return lv(n,[1,e,1])})}function xU(t){const e=[oi(t.shape)];return K(t,e)}function wU(t){if(t.rank<=1)throw new W(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],oi(t.shape,1)];return K(t,e)}function Ji(t,e,n){return Z(()=>{switch(t.rank){case 1:return Ly(t,e,n);case 2:return P$(t,[e,0],[n,t.shape[1]]);case 3:return By(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return zh(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return It(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return It(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new W(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Hm(t,e,n){return Z(()=>{switch(t.rank){case 1:return Ly(t,e,n);case 2:return P$(t,[0,e],[t.shape[0],n]);case 3:return By(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return zh(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new W(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Jd(t,e,n,s){return Z(()=>{switch(t.rank){case 1:return Ly(t,e,n);case 2:switch(s){case 1:return Ji(t,e,n);case 2:return Hm(t,e,n);default:throw new W(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Ji(t,e,n);case 2:return By(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Hm(t,e,n);default:throw new W(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Ji(t,e,n);case 2:return zh(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return zh(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Hm(t,e,n);default:throw new W(`The axis is not within the rank of the tensor ${s}`)}default:throw new W(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function $x(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),ns(t,e)}function ww(t,e){switch(t.rank){case 1:return _L([t,e]);case 2:return RL([t,e],0);case 3:return FL([t,e],0);case 4:return PL([t,e],0);default:throw new W(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function lv(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new W(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return go(t,e)}function em(t,e=0,n=1,s,o){return BB(t,e,n,s,o)}function Zo(t,e,n,s){if(t.rank<2||e.rank<2)throw new Xe(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const o=t.shape.slice(-1)[0],r=e.shape.slice(-2)[0];if(o!==r)throw new Xe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return sw({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?cv(t.rank,s,ko()):null,activation:n});{const o=t.shape.slice(),r=o.pop();t=K(t,[-1,r]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),c=[...i,a],u=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=K(at(e,u),[l,-1]);const d=[...o,...c];return K(sw({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?cv(t.rank,s,ko()):null,activation:n}),d)}}function z2(t,e,n){return Z(()=>(Array.isArray(e)?e=ps(e,"int32"):e=Se(e,"int32"),Ny(t,e,n)))}function vd(t){return G(t,t)}function cv(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new W(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?K(e,[1,s[0],1,1,1]):K(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?K(e,[1,1,1,1,s[0]]):K(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?K(e,[1,s[0],1,1]):K(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?K(e,[1,1,1,s[0]]):K(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?K(e,[1,s[0],1]):K(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?K(e,[1,1,s[0]]):K(e,[1].concat(s))}else if(t<3)return e;throw new W(`Unsupported input rank by biasAdd: ${e.rank}`)}function Eo(t,e,n){return Z(()=>(n==null&&(n=ko()),qt(n),be(t,cv(t.rank,e,n))))}function CU(t,e=1){if(e!==1)throw new Xe(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return jp(t)}function kU(t){return Z(()=>Me(t,be(Mn(t),1)))}function W2(t,e,n,s){return Z(()=>FV(t,e,n,s))}function SU(t){return Z(()=>{const e=be(.5,G(.2,t));return Rs(e,0,1)})}function bd(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const IU=["fanIn","fanOut","fanAvg"],$U=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TU(t){$a(IU,"FanMode",t)}function NU(t){$a($U,"Distribution",t)}class io extends zl{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class U2 extends io{apply(e,n){return hn(e,n)}}U2.className="Zeros";de(U2);class Tx extends io{apply(e,n){return wi(e,n)}}Tx.className="Ones";de(Tx);class G2 extends io{constructor(e){if(super(),typeof e!="object")throw new W(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new W(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return Z(()=>G(pt(this.value),wi(e,n)))}getConfig(){return{value:this.value}}}G2.className="Constant";de(G2);class H2 extends io{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return cd(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}H2.className="RandomUniform";de(H2);class j2 extends io{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Xe(`randomNormal does not support dType ${n}.`);return em(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}j2.className="RandomNormal";de(j2);class K2 extends io{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Xe(`truncatedNormal does not support dType ${n}.`);return B$(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}K2.className="TruncatedNormal";de(K2);class q2 extends io{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return Z(()=>{if(e.length!==2||e[0]!==e[1])throw new W("Identity matrix initializer can only be used for 2D square matrices.");return G(this.gain,m$(e[0]))})}getConfig(){return{gain:this.gain}}}q2.className="Identity";de(q2);function EU(t,e="channelsLast"){let n,s;if(qt(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const o=oi(t,2);n=t[1]*o,s=t[0]*o}else if(e==="channelsLast"){const o=oi(t,0,t.length-2);n=t[t.length-2]*o,s=t[t.length-1]*o}}else{const o=oi(t);n=Math.sqrt(o),s=Math.sqrt(o)}return[n,s]}class bs extends io{constructor(e){if(super(),e.scale<0)throw new W(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,TU(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,NU(this.distribution),this.seed=e.seed}apply(e,n){const s=EU(e),o=s[0],r=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,o):this.mode==="fanOut"?i/=Math.max(1,r):i/=Math.max(1,(o+r)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Xe(`${this.getClassName()} does not support dType ${n}.`);return B$(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*i);return cd(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}bs.className="VarianceScaling";de(bs);class Nx extends bs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return bs.className}}Nx.className="GlorotUniform";de(Nx);class Ex extends bs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return bs.className}}Ex.className="GlorotNormal";de(Ex);class _x extends bs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return bs.className}}_x.className="HeNormal";de(_x);class Ax extends bs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return bs.className}}Ax.className="HeUniform";de(Ax);class Rx extends bs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return bs.className}}Rx.className="LeCunNormal";de(Rx);class Dx extends bs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return bs.className}}Dx.className="LeCunUniform";de(Dx);class X2 extends io{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return Z(()=>{if(e.length<2)throw new Xe("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=oe(e.slice(0,-1)),o=e[e.length-1],r=s*o;r>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${r}) elements: Slowness may result.`);const i=[Math.max(o,s),Math.min(o,s)],a=em(i,0,1,n,this.seed),l=_z.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(o,s)*Math.min(o,s)],[Math.min(o,s)+1]);return c=G(c,d.sign()),s<o&&(c=c.transpose()),G(pt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}X2.className="Orthogonal";de(X2);const Cw={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function kw(t,e={}){return md(t,Hs.getMap().classNameMap,e,"initializer")}function Pt(t){return Sx(t)}function Ft(t){if(typeof t=="string"){const e=t in Cw?Cw[t]:t;if(e==="GlorotNormal")return new Ex;if(e==="GlorotUniform")return new Nx;if(e==="HeNormal")return new _x;if(e==="HeUniform")return new Ax;if(e==="LeCunNormal")return new Rx;if(e==="LeCunUniform")return new Dx;{const n={};return n.className=e,n.config={},kw(n)}}else return t instanceof io?t:kw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function uv(t){return Array.isArray(t)&&Array.isArray(t[0])}function Wh(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ve(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new W(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function ut(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new W(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uh(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,o)=>s*o);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Sw="Variable";class _U{constructor(e,n="float32",s=Sw,o=!0,r=null){this.dtype=n==null?"float32":n,this.shape=e.shape,this.id=P2(),s=s==null?Sw:s,this.originalName=L2(s),this.name=B2(this.originalName),this.trainable_=o,this.constraint=r,this.val=_V(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),AU(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function AU(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function dv(t){return t.map(e=>e.read())}function Fx(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class sr{constructor(e,n,s,o,r,i,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=o,this.callArgs=r,this.outputTensorIndex=a,this.id=P2(),i!=null&&(this.originalName=L2(i),this.name=B2(this.originalName)),this.rank=n.length}}let RU=0;class tm{constructor(e,n){this.callArgs=n,this.id=RU++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let DU=0;class nt extends zl{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=DU++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=mr(s)+"_"+Jp(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),s=[r].concat(e.inputShape)}this.batchInputShape=s;let o=e.dtype;o==null&&(o=e.inputDType),o==null&&(o="float32"),this.dtype=o}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Xs(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new W(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Qn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Qn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new zo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new zo(`Layer ${this.name} is not connected, no input to return.`);return Qn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new zo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new zo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Qn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=wt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=wt(this.inputSpec);if(n.length!==s.length)throw new W(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let o=0;o<n.length;o++){const r=n[o],i=s[o];if(i==null)continue;const a=r.rank;if(i.ndim!=null&&a!==i.ndim)throw new W(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new W(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new W(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&r.dtype!==i.dtype)throw new W(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${r.dtype}.`);if(i.axes){const l=r.shape;for(const c in i.axes){const u=Number(c),d=i.axes[c],h=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(h)===-1)throw new W(`Input ${o} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const c=i.shape[l],u=r.shape[l];if(c!=null&&u!=null&&c!==u)throw new W(`Input ${o} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${r.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=wt(e),o=PU(e),r=MU(e);if(o===r)throw new W("Arguments to apply() must be all SymbolicTensors or all Tensors");return Qi(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of wt(e))i.push(a.shape);this.build(Qn(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&r&&(this._refCount=1)}if(this.assertInputCompatibility(e),r){let i=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,i);const a=wt(i),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(i=Qn(l),this.activityRegularizer!=null)throw new Xe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=FU(e),a=this.computeOutputShape(i);let l;const c=OU(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new sr(c,u,this,wt(e),n,this.name,d)):l=new sr(c,a,this,wt(e),n,this.name),this.addInboundNode(e,l,null,null,i,a,n),this._refCount++,this.activityRegularizer!=null)throw new Xe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,o)=>{s!=null&&e[o]!=null&&e[o]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new zo(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new zo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Xs(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Uh(this.weights)}build(e){this.built=!0}getWeights(e=!1){return dv(e?this.trainableWeights:this.weights)}setWeights(e){Z(()=>{const n=this.weights;if(n.length!==e.length)throw new W(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],o=dv(n);for(let r=0;r<o.length;++r){const i=o[r],a=n[r],l=e[r];if(!mt(i.shape,l.shape))throw new W(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Fx(s)})}addWeight(e,n,s,o,r,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new W(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():Ft("zeros"));const c=o.apply(n,s),u=new _U(c,s,e,i,a);return c.dispose(),r!=null&&this.addLoss(()=>r.apply(u.read())),i==null&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=wt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const o=this.computeMask(e,s);if(n instanceof Array&&o instanceof Array){if(n.length!==o.length)throw new Error(`${this.name} outputs ${n.length} tensors but ${o.length} masks for those tensors`);for(let r=0;r<n.length;r++)n[r].kerasMask=o[r]}else{if(o instanceof Array)throw new Error(`{this.name} outputs a single tensor but ${o.length} masks`);if(n instanceof Array)throw new Error(`{this.name} outputs ${n.length} tensors but only one mask`);n.kerasMask=o}}addInboundNode(e,n,s,o,r,i,a=null){const l=wt(e);n=wt(n),s=wt(s),o=wt(o),r=Wh(r),i=Wh(i);const c=[],u=[],d=[];for(const h of l)c.push(h.sourceLayer),u.push(h.nodeIndex),d.push(h.tensorIndex);new tm({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:o,inputShapes:r,outputShapes:i},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function FU(t){t=wt(t);const e=[];for(const n of t)e.push(n.shape);return Qn(e)}function OU(t){return"float32"}function Y2(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const o=[];for(let r=0;r<s.inboundLayers.length;r++){const i=s.inputTensors[r],a=s.inboundLayers[r],l=s.nodeIndices[r],c=Y2(i,a,l);for(const u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}function PU(t){let e=!0;for(const n of wt(t))if(!(n instanceof sr)){e=!1;break}return e}function MU(t){let e=!0;for(const n of wt(t))if(n instanceof sr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yd extends nt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Jp("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new W("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new W("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new W("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const o=new sr(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new tm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new W(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}yd.className="InputLayer";de(yd);function LU(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new W("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new yd({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BU(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Se(e,t.dtype)}catch{throw new W(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class Yr{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Yr)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=BU(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new W(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof sr){if(this.id2Value[e.id]==null)throw new W(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new W(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof sr){if(this.id2Value[e.id]==null)throw new W(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new W(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Je(this.id2Mask)}}const Gh=new D2,Hh=new D2;function VU(t){Gh!=null&&Gh.setMaxEntries(t),Hh!=null&&Hh.setMaxEntries(t)}function bc(t,e,n,s){const o=n==null?!1:n.training,r=Array.isArray(t),i=r?t:[t],a=i.map(p=>p.name),l=[],c=e.names();for(const p of a)c.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const u=a.join(",")+"|"+e.names().sort().join(",");let d=Gh.get(u),h;if(d==null){const p=zU(i,e);d=p.sorted,h=p.recipientCounts,Gh.put(u,d),Hh.put(u,h)}h={},o||Object.assign(h,Hh.get(u));const f=new Yr(e);for(let p=0;p<d.length;++p){if(s!=null){const $=ev().numTensors;$>s.maxNumTensors&&(s.maxNumTensors=$),$<s.minNumTensors&&(s.minNumTensors=$)}const m=d[p],g=m.sourceLayer;if(g instanceof yd)continue;const v=[],b=[],y=[];let x=!1;for(const $ of m.inputs){const T=f.getValue($),E=f.getMask($);v.push(T),b.push(E),E!=null&&(x=!0),o||(h[$.name]--,h[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!T.isDisposed&&$.sourceLayer.stateful!==!0&&y.push(T))}x&&(n=n||{},n.mask=b[0]);const w=wt(g.apply(v,n));let k=null;g.supportsMasking&&(k=g.computeMask(v,b));const S=UU(m),C=Array.isArray(S)?S:[S];for(let $=0;$<C.length;++$){f.hasKey(C[$])||f.add(C[$],w[$],Array.isArray(k)?k[0]:k);const T=a.indexOf(C[$].name);T!==-1&&(l[T]=w[$])}o||Je(y)}return f.disposeMasks(),r?l:l[0]}function zU(t,e){N(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const o=Iw(t[0],e);n=o.sorted,s=o.recipientMap}else{const o=new Set;for(const r of t){const{sorted:i,recipientMap:a}=Iw(r,e);for(const l of i)o.has(l.name)||(n.push(l),o.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:n,recipientCounts:WU(s)}}function WU(t){const e={};for(const n in t)e[n]=t[n].size;return e}function Iw(t,e){const n=new Set,s=[],o={};for(const a of e.names())n.add(a);const r=[],i=[];for(r.push(t);r.length>0;){const a=r[r.length-1];if(n.has(a.name)){r.pop();continue}const l=i[i.length-1]===r.length-1;if(a.inputs.length===0||l)r.pop(),s.push(a),n.add(a.name),l&&i.pop();else{i.push(r.length-1);for(const c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!n.has(c.name)&&r.push(c)}}return{sorted:s,recipientMap:o}}function UU(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const o of t.sourceLayer.inboundNodes[s].outputTensors)if(o.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU=Q();GU.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,VU);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ox(t,e){return Z(()=>Un(De(G(t,t),e,!0)))}class xd extends zl{getConfig(){return{}}}class Z2 extends xd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Z(()=>{const n=Ox(e,this.axis),s=Rs(n,0,this.maxValue);return G(e,Me(s,be(nn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Z2.className="MaxNorm";de(Z2);class Q2 extends xd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Z(()=>Me(e,be(nn(),Ox(e,this.axis))))}getConfig(){return{axis:this.axis}}}Q2.className="UnitNorm";de(Q2);class J2 extends xd{apply(e){return Sa(e)}}J2.className="NonNeg";de(J2);class eT extends xd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return Z(()=>{const n=Ox(e,this.axis),s=be(G(this.rate,Rs(n,this.minValue,this.maxValue)),G(1-this.rate,n));return G(e,Me(s,be(nn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}eT.className="MinMaxNorm";de(eT);const $w={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function rn(t){return Sx(t)}function Tw(t,e={}){return md(t,Hs.getMap().classNameMap,e,"constraint")}function an(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in $w?$w[t]:t,config:{}};return Tw(n)}else return t instanceof xd?t:Tw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Fi(t){if(t==null)return;const e=[],n=[],s=[];for(const o in t){const r=t[o];if(typeof r!="number"){const i=r;e.push(i.data()),n.push(o),s.push(i)}}if(e.length>0){const o=await Promise.all(e);for(let r=0;r<o.length;++r)t[n[r]]=o[r][0];Je(s)}}function tT(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var Nw;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(Nw||(Nw={}));const HU=125;class Hc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class jU{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class KU extends Hc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const o in n){const r=n[o];if(typeof r=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+r*s;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;const a=Z(()=>be(this.totals[o],G(r,s)));this.totals[o]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:Z(()=>{const o=G(Me(1,this.seen),this.totals[s]);n[s]=o,this.totals[s].dispose(),qo(n[s])}))}}class qU extends Hc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const r in this.history){const i=this.history[r];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),n.push(r),s.push(a)}}const o=await Promise.all(e);for(let r=0;r<o.length;++r)this.history[n[r]][s[r]].dispose(),this.history[n[r]][s[r]]=o[r][0]}}class XU extends Hc{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||i2,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=HU),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Lg(this.yieldEvery)&&(this.maybeWait=lU(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const o=[];this.yield!=null&&(await Fi(s),o.push(this.yield(e,n,s))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Fi(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await Fi(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Fi(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await Fi(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Lg(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Fi(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Fi(e),await this.trainEnd(e))}}function nT(t,e){return t==null&&(t={}),t instanceof Hc?[t]:Array.isArray(t)&&t[0]instanceof Hc?t:wt(t).map(s=>new XU(s,e))}class Us{constructor(){}static registerCallbackConstructor(e,n){N(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Us.checkForDuplicate(n),Us.constructors[e]==null&&(Us.constructors[e]=[]),Us.constructors[e].push(n)}static checkForDuplicate(e){for(const n in Us.constructors)Us.constructors[+n].forEach(o=>{if(o===e)throw new W("Duplicate callback constructor.")})}static clear(){Us.constructors={}}static createCallbacks(e){const n=[];for(const s in Us.constructors){const o=+s;e>=o&&n.push(...Us.constructors[o])}return n.map(s=>new s)}}Us.constructors={};function sT(t,e,n,s,o,r,i,a,l){const c=new qU,u=[new KU,...Us.createCallbacks(e)];t!=null&&u.push(...t),u.push(c);const d=new jU(u);return d.setParams({epochs:n,initialEpoch:s,samples:o,steps:r,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qo(t,e={},n=!1){return md(t,Hs.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jh(t,e){return Z(()=>{t.dtype!=="float32"&&(t=Se(t,"float32"));const n=De(vd(t),e,!0),s=Hp(n.shape,nn()),o=Un(xi(n,s));return Me(t,o)})}function nm(t,e){return Z(()=>Zt(vd(Le(e,t)),-1))}function Px(t,e){return Z(()=>Zt(Mn(Le(e,t)),-1))}function Mx(t,e){return Z(()=>{const n=Le(t,e),s=Rs(Mn(t),nn(),Number.MAX_VALUE),o=Mn(Me(n,s));return G(100,Zt(o,-1))})}function YU(t,e){return Z(()=>{const n=Rs(e,nn(),Number.MAX_VALUE),s=nr(be(1,n)),o=Rs(t,nn(),Number.MAX_VALUE),r=nr(be(1,o));return Zt(vd(Le(s,r)),-1)})}function ZU(t,e){return Z(()=>{const n=xi(0,Le(1,G(t,e)));return Zt(vd(n),-1)})}function QU(t,e){return Z(()=>{const n=xi(0,Le(1,G(t,e)));return Zt(n,-1)})}function JU(t,e){return Z(()=>{const n=De(G(t,e),-1),s=xo(G(Le(1,t),e),-1);return xi(0,be(1,Le(s,n)))})}function eG(t,e){return Z(()=>{const n=Math.log(2),s=Le(e,t),o=Le(be(s,ld(G(-2,s))),n);return Zt(o,-1)})}function jc(t,e,n=!1){return Z(()=>{if(n)e=Vy(e);else{const s=De(e,e.shape.length-1,!0);e=Me(e,s)}return e=Rs(e,nn(),1-nn()),Gt(De(G(Se(t,"float32"),nr(e)),e.shape.length-1))})}function Kh(t,e,n=!1){return Z(()=>{const s=Se(qp(xU(t)),"int32");e=Rs(e,nn(),1-nn());const o=e.shape,r=K(x$(s,o[o.length-1]),o);return jc(r,e,n)})}function tG(t,e){if(!mt(t.shape,e.shape))throw new W(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return Z(()=>{const n=Sa(e),s=Gt(Mn(e));return be(Le(n,G(e,t)),g$(tr(s)))})}function sm(t,e){return Z(()=>{let n;return n=Rs(e,nn(),1-nn()),n=nr(Me(n,Le(1,n))),Zt(tG(t,n),-1)})}function nG(t,e){return Z(()=>{const n=Rs(t,nn(),1),s=Rs(e,nn(),1);return De(G(t,nr(Me(n,s))),-1)})}function sG(t,e){return Z(()=>{const n=nr(be(nn(),e));return Zt(Le(e,G(t,n)),-1)})}function oT(t,e){return Z(()=>{const n=jh(t,-1),s=jh(e,-1),o=G(n,s);return Gt(De(o,-1))})}const qh={meanSquaredError:nm,meanAbsoluteError:Px,meanAbsolutePercentageError:Mx,meanSquaredLogarithmicError:YU,squaredHinge:ZU,hinge:QU,categoricalHinge:JU,logcosh:eG,categoricalCrossentropy:jc,sparseCategoricalCrossentropy:Kh,binaryCrossentropy:sm,kullbackLeiblerDivergence:nG,poisson:sG,cosineProximity:oT};function jm(t){if(typeof t=="string"){if(t in qh)return qh[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new W(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rT(t,e){return Z(()=>{const n=G(.5,no(e)),s=Yo(Fs(e,n),t.dtype);return Zt(er(t,s),-1)})}function iT(t,e){return Z(()=>Yo(er(Vc(t,-1),Vc(e,-1)),"float32"))}function oG(t,e){return Z(()=>Se(De(kr(er(t,1),er(e,1))),"float32"))}function rG(t,e){return Z(()=>Se(De(kr(er(t,0),er(e,1))),"float32"))}function iG(t,e){return Z(()=>{const n=oG(t,e),s=rG(t,e),o=be(n,s);return Se(Wn(Fs(o,0),Me(n,o),0),"float32")})}function aG(t,e){return sm(t,e)}function lG(t,e){return t.rank===e.rank&&(t=ud(t,[t.rank-1])),e=Vc(e,-1),e.dtype!==t.dtype&&(e=Se(e,t.dtype)),Se(er(t,e),"float32")}const cG=nm,uG=nm,dG=Px,hG=Px,fG=Mx,pG=Mx,aT=jc,mG=oT,lT=Kh,Xh={binaryAccuracy:rT,categoricalAccuracy:iT,precision:iG,categoricalCrossentropy:aT,sparseCategoricalCrossentropy:lT,mse:cG,MSE:uG,mae:dG,MAE:hG,mape:fG,MAPE:pG,cosine:mG};function gG(t){if(typeof t=="string"&&t in Xh)return Xh[t];if(typeof t!="string"&&t!=null)return t;throw new W(`Unknown metric ${t}`)}function eh(t){if(Wo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(qh))if(qh[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Xh))if(Xh[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vG(t){const e={Adagrad:()=>Va.adagrad(.01),Adadelta:()=>Va.adadelta(1,.95,nn()),Adam:()=>Va.adam(.001,.9,.999,nn()),Adamax:()=>Va.adamax(.002,.9,.999,nn(),0),RMSProp:()=>Va.rmsprop(.001,.9,0,nn()),SGD:()=>Va.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new W(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Ew=1*1024*1024;function _w(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!hv(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>Ew&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Ew}.`)}}function hv(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!hv(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!hv(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function bG(t,e,n,s=console.log){const o=xG(t),r=["Layer (type)","Input Shape","Output shape","Param #"];o?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(e*u)));let i;if(!o){r.push("Receives inputs"),i=[];for(const u in t.nodesByDepth)i.push(...t.nodesByDepth[u])}s("_".repeat(e)),Yh(r,n,s),s("=".repeat(e));const a=t.layers;for(let u=0;u<a.length;++u)o?wG(a[u],n,s):CG(a[u],n,i,s),s((u===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=yG(t),c=Uh(t.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function yG(t){let e;return t.collectedTrainableWeights!=null?e=Uh(t.collectedTrainableWeights):e=Uh(t.trainableWeights),e}function xG(t){let e=!0;const n=[],s=[];for(const o in t.nodesByDepth)n.push(t.nodesByDepth[o]);for(const o of n){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){e=!1;break}s.push(...o)}if(e)for(const o of t.layers){let r=!1;for(const i of o.inboundNodes)if(s.indexOf(i)!==-1)if(r){e=!1;break}else r=!0;if(!e)break}return e}function Yh(t,e,n=console.log){let s="";for(let o=0;o<t.length;++o)o>0&&(s=s.slice(0,s.length-1)+" "),s+=t[o],s=s.slice(0,e[o]),s+=" ".repeat(e[o]-s.length);n(s)}function wG(t,e,n){let s,o;try{o=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const r=t.name,i=t.getClassName(),a=[`${r} (${i})`,o,s,t.countParams().toString()];Yh(a,e,n)}function CG(t,e,n,s){let o,r;try{r=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{r="multiple"}try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}const i=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const f=d.inboundLayers[h].name,p=d.nodeIndices[h],m=d.tensorIndices[h];i.push(`${f}[${p}][${m}]`)}const a=t.name,l=t.getClassName(),c=i.length===0?"":i[0],u=[`${a} (${l})`,r,o,t.countParams().toString(),c];Yh(u,e,s);for(let d=1;d<i.length;++d)Yh(["","","","",i[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cT(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Zh(t,e){if(t===null)return null;if(typeof t=="string")return Ui(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let o=0;o<s;++o){const r=t[o];cT(e,o,r)?n.push(r):n.push(Zh(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const o=t[s];if(s==="name"&&typeof o=="string")n[s]=o;else{const r=Ui(s);n[r]=Zh(o,r)}}return n}}function fv(t,e){if(t==null)return null;if(typeof t=="string")return mr(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let o=0;o<s;++o){const r=t[o];cT(e,o,r)?n.push(r):n.push(fv(r,e))}return n}else{const n={};for(const s of Object.keys(t)){const o=t[s],r=mr(s);(s==="name"||s==="className")&&typeof o=="string"?n[r]=o:n[r]=fv(o,s)}return n}}/** @license See the LICENSE file. */const uT="4.12.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const kG=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class uo extends nt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=Jp(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],si(this.inputs).length!==this.inputs.length)throw new W(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);si(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const y=b.sourceLayer,x=b.nodeIndex,w=b.tensorIndex;this.outputLayers.push(y),this.outputLayersNodeIndices.push(x),this.outputLayersTensorIndices.push(w)}for(const b of this.inputs){const y=b.sourceLayer,x=b.nodeIndex,w=b.tensorIndex;Wo(x===0,"input layer has >1 nodes"),Wo(w===0,"input layer has >1 tensors"),this.inputLayers.push(y),this.inputLayersNodeIndices.push(x),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const y=this.inputLayers[b];if(!(y instanceof yd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${b} (0-based) originates from layer type ${y.getClassName()}.`);this.inputNames.push(y.name),this.feedInputShapes.push(y.batchInputShape),this.feedInputNames.push(y.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},s={},o={},r={},i={},a=[],l=(b,y,x,w,k,S)=>{(w==null||k==null||S==null)&&(w=b.sourceLayer,k=b.nodeIndex,S=b.tensorIndex);const C=w.inboundNodes[k];if(x.indexOf(C)!==-1)throw new Xs(`The tensor ${b.name} at layer "${w.name}" is part of a cycle.`);if(y.indexOf(C)!==-1)return;this.containerNodes.add(uo.nodeKey(w,k)),w.id in i||(i[w.id]=Object.keys(i).length),x.indexOf(C)===-1&&x.push(C);const $=C.inboundLayers.length;for(let T=0;T<$;T++){const E=C.inputTensors[T],_=C.inboundLayers[T],A=C.nodeIndices[T],O=C.tensorIndices[T];l(E,y,x,_,A,O)}for(y.push(C);x.indexOf(C)>=0;)x.splice(x.indexOf(C),1);a.push(C)},c=[],u=[];for(const b of this.outputs)l(b,c,u);const d=a.slice().reverse();for(const b of d){s[b.id]=b,b.id in n||(n[b.id]=0);let y=n[b.id];const x=o[b.outboundLayer.id]==null?0:o[b.outboundLayer.id];y=Math.max(y,x),o[b.outboundLayer.id]=y,r[b.outboundLayer.id]=b.outboundLayer,n[b.id]=y;for(let w=0;w<b.inboundLayers.length;w++){const k=b.inboundLayers[w],S=b.nodeIndices[w],C=k.inboundNodes[S],$=n[C.id]==null?0:n[C.id];n[C.id]=Math.max(y+1,$),s[C.id]=C}}const h={};for(const b in n){const y=n[b];y in h||(h[y]=[]),h[y].push(s[b])}const f={};for(const b in o){const y=o[b];y in f||(f[y]=[]),f[y].push(r[b])}let p=Object.keys(f).map(b=>parseInt(b,10)).sort(Zd);this.layers=[];for(const b of p){const y=f[b];y.sort((x,w)=>{const k=i[x.id],S=i[w.id];return k<S?-1:k>S?1:0});for(const x of y)x instanceof uo&&this.internalContainerRefs.push(x),this.layers.push(x)}this.layersByDepth=f,p=Object.keys(h).map(b=>parseInt(b,10)).sort(Zd);const m=this.inputs.slice(),g=[];for(const b of p)for(const y of h[b]){const x=y.outboundLayer;if(x!=null){for(const w of y.inputTensors)if(m.indexOf(w)===-1)throw new Xs(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${x.name}". The following previous layers were accessed without issue: ${g}`);for(const w of y.outputTensors)m.push(w);g.push(x.name)}}this.nodesByDepth=h;const v=this.layers.map(b=>b.name);for(const b of v){const y=v.filter(x=>x===b).length;if(y!==1)throw new Xs(`The name "${b}" is used ${y} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(v))}this.outboundNodes=[],this.inboundNodes=[],new tm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new W("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let o=0;const r=kG(e);r&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=r?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[u]!=null)throw new W(`Duplicate weight name: ${u}`);s[u]=c,o++}const i=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(n)throw new W(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new W(`${a.length} of ${o} weights are not set: ${a}`)}Fx(i)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),o=["vars","layer_checkpoint_dependencies"],r=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!o.includes(i)).join("/");r!==n&&(e[r]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${uT}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=fv(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return Z(()=>{e=wt(e);const s=new Yr;for(let o=0;o<this.inputs.length;++o)s.add(this.inputs[o],e[o]);return bc(this.outputs,s,n)})}computeMask(e,n){return Z(()=>{e=wt(e);let s;return n==null?s=fa(null,e.length):s=wt(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=Wh(e);if(n.length!==this.inputLayers.length)throw new W(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],u=l.name+"_0_0";s[u]=c}const o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Zd);if(o.length>1)for(const a of o){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;const d=[];for(let m=0;m<c.inboundLayers.length;m++){const g=c.inboundLayers[m],v=c.nodeIndices[m],b=c.tensorIndices[m],y=`${g.name}_${v}_${b}`,x=s[y];d.push(x)}const h=u.computeOutputShape(Qn(d)),f=Wh(h),p=u.inboundNodes.indexOf(c);for(let m=0;m<f.length;m++){const g=`${u.name}_${p}_${m}`;s[g]=f[m]}}}const r=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];Wo(l in s),r.push(s[l])}return Qn(r)}runInternalGraph(e,n){n==null&&(n=fa(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=n[l];s[c.id]=[u,d]}const o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Zd);for(const l of o){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,h=u.inputTensors,f=u.outputTensors,p=new Array;for(const m of h)m.id in s&&p.push(s[m.id]);if(p.length===h.length){let m={},g,v,b,y;if(u.callArgs!=null&&(m=u.callArgs),p.length===1){const[x,w]=p[0];m.mask==null&&(m.mask=w),b=wt(d.call(x,m)),y=wt(d.computeMask(x,w)),g=[x],v=[w]}else g=p.map(x=>x[0]),v=p.map(x=>x[1]),m.mask==null&&(m.mask=v),b=wt(d.call(g,m)),y=wt(d.computeMask(g,v));if(d.activityRegularizer)throw new Xe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let x=0;x<f.length;++x){const w=f[x],k=b[x],S=y[x];s[w.id]=[k,S]}}}}const r=[],i=[],a=[];for(const l of this.outputs){Wo(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=s[l.id];a.push(c.shape),r.push(c),i.push(u)}return[r,i,a]}buildNodeConversionMap(e){const n={};let s;for(const o of this.layers){s=o instanceof uo?1:0;for(let r=0;r<o.inboundNodes.length;r++){const i=uo.nodeKey(o,r);this.containerNodes.has(i)&&(n[i]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new W("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new W(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new W(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return Z(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const o=uo.nodeKey(n,s);this.containerNodes.has(o)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),c=[];for(let d=0;d<i.inboundNodes.length;d++){const h=i.inboundNodes[d],f=uo.nodeKey(i,d);let p={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const m=[];for(let g=0;g<h.inboundLayers.length;g++){const v=h.inboundLayers[g],b=h.nodeIndices[g],y=h.tensorIndices[g],x=uo.nodeKey(v,b);let w=n[x];w==null&&(w=0),m.push([v.name,w,y,p])}c.push(m)}}}const u={};u.name=i.name,u.className=a,u.config=l,u.inboundNodes=c,s.push(u)}e.layers=s;const o=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],c=uo.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[i];o.push([a.name,u,d])}e.inputLayers=o;const r=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],c=uo.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[i];r.push([a.name,u,d])}return e.outputLayers=r,e}static fromConfig(e,n,s={},o=!1){const r={},i={};function a(g,v){g.name in i?i[g.name].push(v):i[g.name]=[v]}function l(g,v){const b=[];let y;for(const x of v){const w=x[0],k=x[1],S=x[2];if(y=x[3]==null?{}:x[3],!(w in r)){a(g,v);return}const C=r[w];if(C.inboundNodes.length<=k){a(g,v);return}const $=C.inboundNodes[k];b.push($.outputTensors[S])}b.length>0&&g.apply(Qn(b),y)}function c(g){const v=g.name,b=Qo(g,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(o),r[v]=b,g.inboundNodes.forEach(x=>{if(!(x instanceof Array))throw new W(`Corrupted configuration, expected array for nodeData: ${x}`);a(b,x)})}const u=n.name,d=n.layers;for(const g of d)c(g);for(;!aU(i);)for(const g of d){const v=r[g.name];if(v.name in i){const b=i[v.name];delete i[v.name];for(const y of b)l(v,y)}}const h=[],f=[],p=n.inputLayers;for(const g of p){const v=g[0],b=g[1],y=g[2];Wo(v in r);const w=r[v].inboundNodes[b].outputTensors;h.push(w[y])}const m=n.outputLayers;for(const g of m){const v=g[0],b=g[1],y=g[2];Wo(v in r);const w=r[v].inboundNodes[b].outputTensors;f.push(w[y])}return new e({inputs:h,outputs:f,name:u})}get stateful(){if(this._stateful)throw new W("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){Z(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function SG(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(o=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const o=[];return e.forEach(r=>{r in t?o.push(t[r]):o.push(null)}),o}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function dT(t,e){return SG(t,e,"classWeight")}async function hT(t,e,n,s){if(e!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const o=Z(()=>{if(t.shape.length===1)return Zi(t);if(t.shape.length===2){if(t.shape[1]>1)return Vc(t,1);if(t.shape[1]===1)return K(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),r=Array.from(await o.data());Je(o);const i=[];return r.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(n[a])}),ps(i,"float32")}else return null}function IG(t,e){return G(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const $G=32;function fT(t,e){let n,s;const o=e;n=o.xs,s=o.ys,N(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const r=Aw("input",t.inputNames,n),i=Aw("output",t.outputNames,s),a=r[0].shape[0];N(r.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${r.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),N(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<r.length;l++)N(r[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${r[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)N(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:r,ys:i}}function Aw(t,e,n){if(n instanceof Yt)return[n];if(Array.isArray(n))return N(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const o of e){if(n[o]==null)throw new W(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);s.push(n[o])}return s}}function TG(t){if(t.length===3)throw new Xe("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function NG(t,e,n){const s=n.batchesPerEpoch!=null;if(N(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),N(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),N(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),N(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),N(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const o=n.validationData!=null;let r,i;if(o)if(Rw(n.validationData))N(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=TG(n.validationData);r=g.xs,i=g.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();const u=nT(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:h,history:f}=sT(u,d,n.epochs,null,null,EG(e,n),null,o,c);h.setModel(t),t.history=f,await h.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const g={};await h.onEpochBegin(p);let v=0,b=0;for(s||(m=await e.iterator());!s||v<n.batchesPerEpoch;){const y=await m.next();if(s&&y.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${v} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(y.value!=null){const{xs:x,ys:w}=fT(t,y.value),k={};k.batch=b,k.size=x[0].shape[0],await h.onBatchBegin(b,k);const S=[];if(n.classWeight!=null){const T=dT(n.classWeight,t.outputNames);for(let E=0;E<T.length;++E)S.push(await hT(w[E],null,T[E]))}const C=x.concat(w).concat(S),$=a(C);Je(C);for(let T=0;T<l.length;++T){const E=l[T],_=$[T];k[E]=_,qo(_)}await h.onBatchEnd(b,k),tT(k),b++,v++}if(s?v>=n.batchesPerEpoch:y.done){if(o){let x;Rw(n.validationData)?x=wt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):x=wt(t.evaluate(r,i,{batchSize:n.validationBatchSize==null?$G:n.validationBatchSize,verbose:0}));for(let w=0;w<t.metricsNames.length;++w)g[`val_${t.metricsNames[w]}`]=x[w]}break}if(t.stopTraining_)break}if(await h.onEpochEnd(p,g),p++,t.stopTraining_)break}return await h.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function EG(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function Rw(t){return typeof t.iterator=="function"}function _G(t){return typeof t.next=="function"}async function AG(t,e,n){n=n||{};const s=n.batches!=null,o=t.testFunction;let r=[];if(n.verbose>0)throw new Xe("Verbose mode is not implemented yet.");N(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const i=_G(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const c=await i.next();if(r=Z(()=>{if(c.value){const{xs:u,ys:d}=fT(t,c.value),h=u.concat(d),f=Z(()=>o(h));if(Je(h),l===0)for(let m=0;m<f.length;++m)r.push(pt(0));const p=h[0].shape[0];for(let m=0;m<f.length;++m){const g=f[m],v=r[m];r[m]=Z(()=>be(r[m],G(p,g))),l>0&&Je(v)}Je(f),a+=p,++l}return r}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<r.length;++c){const u=r[c];r[c]=Me(r[c],a),Je(u)}return Qn(r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Km(t){N(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function ic(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>Ji(s,e,n-e)):Ji(t,e,n-e)}function pv(t,e){return Z(()=>t==null?null:Array.isArray(t)?t.map(n=>pv(n,e)):z2(t,e.dtype==="int32"?e:Se(e,"int32")))}function qm(t,e){const n=[];let s=0,o=null;for(;s<t;)o=s+e,o>=t&&(o=t),n.push([s,o]),s=o;return n}function pT(t){const e=[];t instanceof Yt&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(gd(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function co(t,e){if(t==null)return;const n=[];if(e instanceof Yt)n.push(e.id);else if(Array.isArray(e))e.forEach(o=>n.push(o.id));else if(e!=null)for(const o in e){const r=e[o];n.push(r.id)}const s=[];if(t instanceof Yt)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(o=>{n.indexOf(o.id)===-1&&s.push(o)});else if(t!=null)for(const o in t){const r=t[o];n.indexOf(r.id)===-1&&s.push(r)}s.forEach(o=>{o.isDisposed||o.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function RG(t){return t instanceof Yt}function mv(t){return Array.isArray(t)}function Dw(t){return!RG(t)&&!mv(t)}function Fw(t,e,n,s=!0,o=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(mv(t)&&t.length>0)i=!0;else if(Dw(t)){for(const a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new W(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let r;if(Dw(t)){t=t,r=[];for(const i of e){if(t[i]==null)throw new W(`No data provided for "${i}". Need data for each key in: ${e}`);r.push(t[i])}}else if(mv(t)){if(t=t,t.length!==e.length)throw new W(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);r=t}else{if(t=t,e.length>1)throw new W(`The model ${o} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);r=[t]}if(r=pT(r),n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=r[i];if(a.shape.length!==n[i].length)throw new W(`Error when checking ${o}: expected ${e[i]} to have ${n[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[i][l];if(u!=null&&u>=0&&c!==u)throw new W(`${o} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return r}function DG(t,e,n){const s=si(t.map(r=>r.shape[0]));s.sort();const o=si(e.map(r=>r.shape[0]));if(o.sort(),s.length>1)throw new W(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(r=>r.shape))}`);if(o.length>1)throw new W(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(r=>r.shape))}`);if(s.length>0&&o.length>0&&!mt(s,o))throw new W(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${o[0]} target sample(s).`)}function FG(t,e,n){const s=[nm,sm,jc];for(let o=0;o<t.length;++o){const r=t[o],i=e[o],a=n[o];if(i!=null){if(i===jc&&r.shape[r.shape.length-1]===1)throw new W(`You are passing a target array of shape ${r.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=r.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],h=c[u];if(h!=null&&d!==h)throw new W(`A target Tensor with shape ${r.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Ow(t,e,n,s=!0,o=""){let r;if(Array.isArray(t)){if(t.length!==e.length)throw new W(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);r=t}else{if(e.length>1)throw new W(`The model expects ${e.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);r=[t]}if(n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=r[i];if(a.shape.length!==n[i].length)throw new W(`Error when checking ${o}: expected ${e[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[i][l];if(u!=null&&u!==c)throw new W(`Error when checking ${o}: expected ${e[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function OG(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const o of e){let r=n.hasOwnProperty(o)?n[o]:[];Array.isArray(r)||(r=[r]),s.push(r)}return s}}const PG="layers-model";class al extends uo{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new W("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");bG(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=vG(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Ci))throw new W("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new W(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),n.push(jm(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new W(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>jm(a))}else{const i=jm(e.loss);this.outputs.forEach(a=>{n.push(i)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Qi("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const o=OG(e.metrics,this.outputNames),r=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};Qi("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=o[i];(c=>{const u="";let d,h,f;for(const p of c){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[i];g[g.length-1]===1||this.lossFunctions[i]===sm?["accuracy","acc"].indexOf(p)!==-1?h=rT:["crossentropy","ce"].indexOf(p)!==-1&&(h=aG):this.lossFunctions[i]===Kh?["accuracy","acc"].indexOf(p)!==-1?h=lG:["crossentropy","ce"].indexOf(p)!==-1&&(h=lT):["accuracy","acc"].indexOf(p)!==-1?h=iT:["crossentropy","ce"].indexOf(p)!==-1&&(h=aT);let v;["accuracy","acc"].indexOf(p)!==-1?v="acc":["crossentropy","ce"].indexOf(p)!==-1&&(v="ce"),f=h,d=u+v}else f=gG(p),d=u+eh(p);let m;Qi(d,()=>{m=f}),r(i,d,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const o=s.batchSize==null?32:s.batchSize;Km(o);const r=!0,i=this.standardizeUserDataXY(e,n,r,o);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,o,s.verbose,s.steps);return Qn(c)}finally{co(i[0],e),co(i[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),AG(this,e,n)}checkNumSamples(e,n,s,o="steps"){let r;if(s!=null){if(r=null,n!=null)throw new W(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?r=e[0].shape[0]:r=e.shape[0];else throw new W(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return r}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new W("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),o=s?n:[n],r=this.retrieveSymbolicTensors(o),i=new Yr;if(e instanceof Yt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new W(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new W(`No value is provided for the model's input ${l.name}`);i.add(l,c)}const a=bc(r,i);return s?a:a[0]}retrieveSymbolicTensors(e){const n=fa(null,e.length);let s=e.length;for(const o of this.layers){const r=Array.isArray(o.output)?o.output:[o.output],i=r.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(n[a]=r[l],s--),s===0)break}if(s===0)break}if(s>0){const o=[];throw n.forEach((r,i)=>{r==null&&o.push(e[i])}),new W(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return n}predictLoop(e,n=32,s=!1){return Z(()=>{const o=this.checkNumSamples(e);if(s)throw new Xe("Verbose predictLoop() is not implemented yet.");const r=qm(o,n),i=this.outputs.map(a=>[]);for(let a=0;a<r.length;++a)Z(()=>{const c=r[a][0],u=r[a][1],d=ic(e,c,u),h=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)h.push({key:this.inputs[p],value:d[p]});else h.push({key:this.inputs[0],value:d});const f=new Yr(h);return bc(this.outputs,f)}).forEach((c,u)=>i[u].push(c));return Qn(i.map(a=>ns(a,0)))})}predict(e,n={}){const s=pT(e);Ow(s,this.inputNames,this.feedInputShapes,!1);try{const o=n.batchSize==null?32:n.batchSize;return Km(o),this.predictLoop(s,o)}finally{co(s,e)}}predictOnBatch(e){Ow(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,o){if(this.optimizer_==null)throw new Xs("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const r=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Kh?r.push(a.slice(0,a.length-1).concat([1])):r.push(a)}if(e=Fw(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=Fw(n,this.feedOutputNames,r,!1,"target"),DG(e,n),FG(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&e[0].shape[0]%o!==0)throw new W(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,o,r=!0,i){const[a,l]=this.standardizeUserDataXY(e,n,r,i);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(o!=null){const u=dT(o,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await hT(l[d],null,u[d]))}return[a,l,c]}testLoop(e,n,s,o=0,r){return Z(()=>{const i=this.checkNumSamples(n,s,r,"steps"),a=[];if(o>0)throw new Xe("Verbose mode is not implemented yet.");if(r!=null)throw new Xe("steps mode in testLoop() is not implemented yet");{const l=qm(i,s),c=ps(Co(0,i));for(let u=0;u<l.length;++u){const d=l[u][0],h=l[u][1],f=Ji(c,d,h-d),p=pv(n,f),m=e(p);if(u===0)for(let g=0;g<m.length;++g)a.push(pt(0));for(let g=0;g<m.length;++g){const v=m[g];a[g]=be(a[g],G(h-d,v))}}for(let u=0;u<a.length;++u)a[u]=Me(a[u],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const o=e[s];let r=o;if(yw(e,o)>1){const i=yw(e.slice(0,s),o);r+=`_${i}`}n.push(r)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let m=0;m<this.inputs.length;++m)d.push({key:this.inputs[m],value:s[m]});const h=new Yr(d),f=bc(this.outputs,h,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let v=g(o[m],f[m]);r[m]!=null&&(v=IG(v,r[m]));const b=Zt(v);n.push(b),m===0?p=v:p=be(p,v)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const v=this.metricsTensors[m][0],b=this.metricsTensors[m][1];g=Zt(v(o[b],f[b]))}qo(g),i.push(g)}return p=Zt(p),this.calculateLosses().forEach(m=>{p=be(p,m)}),p},l=this.collectedTrainableWeights.map(d=>d.read()),c=!0;return[this.optimizer_.minimize(a,c,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>Z(()=>{const n=[];let s;const o=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let c=0;c<this.inputs.length;++c)i.push({key:this.inputs[c],value:o[c]});const a=new Yr(i),l=bc(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=Zt(u(r[c],l[c]));c===0?s=d:s=be(s,d),n.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],h=Zt(u(r[d],l[d]));n.push(h)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,r,i,a,l,c,u,d,h;try{const f=s.batchSize==null?32:s.batchSize;Km(f);const p=!1,m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,p,f);o=m[0],r=m[1],h=m[2];let g=!1,v;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new Xe("validationData including sample weights is not supported yet."):new W(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const $=!0,T=await this.standardizeUserData(l,c,null,null,$,f);u=T[0],d=T[1],v=u.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const $=Math.floor(o[0].shape[0]*(1-s.validationSplit)),T=o[0].shape[0];u=ic(o,$,T),i=o,o=ic(o,0,$),d=ic(r,$,T),a=r,r=ic(r,0,$),v=u.concat(d)}else s.validationSteps!=null&&(g=!0);const b=o.concat(r).concat(h);this.checkTrainableWeightsConsistency();const y=this.makeTrainFunction(),x=this.getDedupedMetricsNames();let w,k;g?(this.makeTestFunction(),w=this.testFunction,k=x.slice().concat(x.map($=>"val_"+$))):(w=null,v=[],k=x.slice());const S=nT(s.callbacks,s.yieldEvery);return await this.fitLoop(y,b,x,f,s.epochs,s.verbose,S,w,v,s.shuffle,k,s.initialEpoch,null,null)}finally{this.isTraining=!1,co(o,e),co(r,n),co(i,e),co(a,n),co(u,l),co(d,c),h!=null&&Je(h)}}async fitLoop(e,n,s,o,r,i,a,l,c,u,d,h,f,p){o==null&&(o=32),r==null&&(r=1),u==null&&(u=!0),h==null&&(h=0);let m=!1;if(l!=null&&c!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new W("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(n,o,f,"steps_per_epoch");let v;g!=null&&(v=Co(0,g)),i==null&&(i=1);const{callbackList:b,history:y}=sT(a,i,r,h,g,f,o,m,d);b.setModel(this),this.history=y,await b.onTrainBegin(),this.stopTraining_=!1;for(let x=h;x<r;++x){await b.onEpochBegin(x);const w={};if(f!=null)throw new Xe("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Xe("batch shuffling is not implemneted yet");u&&aP(v);const k=ps(v),S=qm(g,o);for(let C=0;C<S.length;++C){const $={};if(await b.onBatchBegin(C,$),Z(()=>{const T=S[C][0],E=S[C][1],_=Ji(k,T,E-T);$.batch=C,$.size=E-T;const A=pv(n,_),O=e(A);for(let B=0;B<s.length;++B){const F=s[B],V=O[B];$[F]=V,qo(V)}if(C===S.length-1&&m){const B=this.testLoop(l,c,o);for(let F=0;F<s.length;++F){const V=s[F],D=B[F];qo(D),w["val_"+V]=D}}}),await b.onBatchEnd(C,$),tT($),this.stopTraining_)break}k.dispose()}if(await b.onEpochEnd(x,w),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return NG(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),o=s[0],r=s[1],a=this.makeTrainFunction()(o.concat(r)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return Je(a),co(s[0],e),co(s[1],n),Qn(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,o=s?this.trainableWeights:this.weights,r=this.getWeights(s);for(let i=0;i<o.length;++i)s&&!o[i].trainable||n.push({name:o[i].originalName,tensor:r[i]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=ev().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-ev().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=mr(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>mr(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const o of n)if(typeof s[o]=="string")e[o]=mr(s[o]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[mr(eh(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>mr(eh(e)));{const e={};for(const n in this.metrics)e[n]=mr(eh(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Zh(e.optimizer_config),s=Qo(n);let o;if(typeof e.loss=="string")o=Ui(e.loss);else if(Array.isArray(e.loss))o=e.loss.map(i=>Ui(i));else if(e.loss!=null){o={};for(const i in e.loss)o[i]=Ui(e.loss[i])}let r;if(Array.isArray(e.metrics))r=e.metrics.map(i=>Ui(i));else if(e.metrics!=null){r={};for(const i in e.metrics)r[i]=Ui(e.metrics[i])}this.compile({loss:o,metrics:r,optimizer:s})}async save(e,n){if(typeof e=="string"){const c=uM(e);if(c.length===0)throw new W(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new W(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new W("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await J1(this.getNamedWeights(n)),o=!1,r=null,a={modelTopology:this.toJSON(r,o),format:PG,generatedBy:`TensorFlow.js tfjs-layers v${uT}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await J1(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=nM([s.data,u])}return this.userDefinedMetadata!=null&&(_w(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){_w(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}al.className="Model";de(al);class mT extends al{}mT.className="Functional";de(mT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function MG(t,e){if(e==null&&(e={}),typeof t=="string"){const n=dM(t,e);if(n.length===0)n.push(Gz(t,e));else if(n.length>1)throw new W(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return LG(t,void 0,e)}async function LG(t,e,n){if(n==null&&(n={}),t.load==null)throw new W("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let o=s.modelTopology;o.model_config!=null&&(o=o.model_config);const r=n.strict==null?!0:n.strict,i=s.weightData!=null&&s.weightSpecs!=null&&r,a=Qo(Zh(o),e,i),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new W("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=BG(s.weightData,s.weightSpecs);a.loadWeights(c,r),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Je(c),Je(u.map(d=>d.tensor))}return a}function BG(t,e){const n=QP(t,e),s={},o=[];return e.forEach(r=>{r.group==="optimizer"?o.push({name:r.name,tensor:n[r.name]}):s[r.name]=n[r.name]}),{modelWeights:s,optimizerWeights:o}}class Kc extends al{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Jp("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new W(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof Kc||e instanceof al;let s;if(n){if(s=e,s.outputs.length!==1)throw new W("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new W("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new W("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const o=LU({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(o)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new W(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new W("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Y2(this.outputs[0])}this.inboundNodes=[],new tm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:fa(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{const o=e.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(ut(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new al({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Xs("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Xs("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Xs("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Xs("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},o=!1){let r,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new W("Legacy serialization format not supported yet.");r=n}else N(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=n.layers,delete n.layers,i=n;const a=new e(i);if(!(a instanceof Kc))throw new Xe(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of r){const u=Qo(l,void 0,o);o&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new W("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new W("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Kc.className="Sequential";de(Kc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class as extends zl{getConfig(){return{}}}class gT extends as{apply(e,n=1){return CU(e,n)}}gT.className="elu";de(gT);class vT extends as{apply(e){return R$(e)}}vT.className="selu";de(vT);class bT extends as{apply(e){return Sa(e)}}bT.className="relu";de(bT);class yT extends as{apply(e){return Z(()=>Uc(6,Sa(e)))}}yT.className="relu6";de(yT);class xT extends as{apply(e){return e}}xT.className="linear";de(xT);class wT extends as{apply(e){return Ll(e)}}wT.className="sigmoid";de(wT);class CT extends as{apply(e){return SU(e)}}CT.className="hardSigmoid";de(CT);class kT extends as{apply(e){return ld(e)}}kT.className="softplus";de(kT);class ST extends as{apply(e){return kU(e)}}ST.className="softsign";de(ST);class IT extends as{apply(e){return Cy(e)}}IT.className="tanh";de(IT);class Lx extends as{apply(e,n=-1){return Vy(e,n)}}Lx.className="softmax";de(Lx);class $T extends as{apply(e,n=-1){return v$(e,n)}}$T.className="logSoftmax";de($T);class TT extends as{apply(e,n=1){return Z(()=>G(Ll(G(e,n)),e))}}TT.className="swish";de(TT);class NT extends as{apply(e){return Z(()=>G(e,Cy(ld(e))))}}NT.className="mish";de(NT);function ci(t){return t.getClassName()}function Xm(t,e={}){return md(t,Hs.getMap().classNameMap,e,"activation")}function ui(t){if(t==null){const e={};return e.className="linear",e.config={},Xm(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Xm(e)}else return t instanceof as?t:Xm(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function VG(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class ET extends zl{}class _T extends ET{constructor(e){super(),VG(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return Z(()=>{let n=hn([1]);return this.hasL1&&(n=be(n,De(G(this.l1,Mn(e))))),this.hasL2&&(n=be(n,De(G(this.l2,vd(e))))),K(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}_T.className="L1L2";de(_T);const Pw={l1l2:"L1L2"};function kt(t){return Sx(t)}function Mw(t,e={}){return md(t,Hs.getMap().classNameMap,e,"regularizer")}function Ot(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in Pw?Pw[t]:t,config:{}};return Mw(n)}else return t instanceof ET?t:Mw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AT extends nt{constructor(e){super(e==null?{}:e),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=Ve(e);let s=Sa(e);return this.maxValue!=null&&(s=Rs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}AT.className="ReLU";de(AT);class RT extends nt{constructor(e){super(e==null?{}:e),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ve(e);return _y(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}RT.className="LeakyReLU";de(RT);class DT extends nt{constructor(e){if(super(e==null?{}:e),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ft(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ot(e.alphaRegularizer),this.alphaConstraint=an(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new W(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=ut(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const o of this.sharedAxes)n[o-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let o=1;o<e.length;++o)s[o]=e[o];this.inputSpec=[new sn({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=Ve(e),Py(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Pt(this.alphaInitializer),alphaRegularizer:kt(this.alphaRegularizer),alphaConstraint:rn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}DT.className="PReLU";de(DT);class FT extends nt{constructor(e){if(super(e==null?{}:e),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Xe(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ve(e);return jp(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}FT.className="ELU";de(FT);class OT extends nt{constructor(e){super(e==null?{}:e),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=Ve(e);return G(s,Se(Fs(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}OT.className="ThresholdedReLU";de(OT);class PT extends nt{constructor(e){super(e==null?{}:e),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Lx().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return Z(()=>{let s=Ve(e);const o=n.mask;if(o!=null){const r=G(Le(wi(s.shape),Se(o,s.dtype)),pt(-1e9));s=be(s,r)}return this.axis instanceof Array?this.axis.length>1?tr(Le(s,b$(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}PT.className="Softmax";de(PT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ll(t,e,n){if(typeof t=="number")return fa(t,e);if(t.length!==e)throw new W(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const o=t[s];if(!bU(o))throw new W(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function wo(t,e,n,s,o=1){if(t==null)return t;const r=e+(e-1)*(o-1);let i;return n==="same"?i=t:i=t-r+1,Math.floor((i+s-1)/s)}function Uo(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+li([n-e,0]);else if(s==="same")t=t*e;else throw new W(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bx(t,e){return Z(()=>(qt(e),e==="channelsFirst"?at(t,[0,2,3,1]):t))}function MT(t,e){return Z(()=>(qt(e),e==="channelsFirst"?at(t,[0,2,3,4,1]):t))}function zG(t,e,n,s=1,o="valid",r,i=1){return Z(()=>{if(r==null&&(r=ko()),qt(r),t.shape.length!==3)throw new W(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new W(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new W(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(r==="channelsFirst"&&(t=at(t,[0,2,1])),o==="causal")throw new Xe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=l$(t,e,s,o==="same"?"same":"valid","NWC",i);return n!=null&&(a=Eo(a,n)),a})}function Lw(t,e,n,s=[1,1],o="valid",r,i,a=null){return Z(()=>{if(r==null&&(r=ko()),qt(r),t.rank!==3&&t.rank!==4)throw new W(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new W(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Bx(t,r);if(o==="causal")throw new Xe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=MV({x:l,filter:e,strides:s,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:a}),r==="channelsFirst"&&(l=at(l,[0,3,1,2])),l})}function WG(t,e,n,s=[1,1,1],o="valid",r,i){return Z(()=>{if(r==null&&(r=ko()),qt(r),t.rank!==4&&t.rank!==5)throw new W(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new W(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=MT(t,r);if(o==="causal")throw new Xe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=WL(a,e,s,o==="same"?"same":"valid","NDHWC",i),n!=null&&(a=Eo(a,n)),r==="channelsFirst"&&(a=at(a,[0,4,1,2,3])),a})}class om extends nt{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",om.verifyArgs(n),this.rank=e,fn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Xe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ll(n.kernelSize,e,"kernelSize"),this.strides=ll(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Os(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,qt(this.dataFormat),this.activation=ui(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Ft(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=an(n.biasConstraint),this.biasRegularizer=Ot(n.biasRegularizer),this.activityRegularizer=Ot(n.activityRegularizer),this.dilationRate=ll(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new W(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new W(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new W(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Wo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Ix(e.kernelSize,"number",1,3))throw new W(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ci(this.activation),useBias:this.useBias,biasInitializer:Pt(this.biasInitializer),biasRegularizer:kt(this.biasRegularizer),activityRegularizer:kt(this.activityRegularizer),biasConstraint:rn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Wl extends om{constructor(e,n){super(e,n),this.kernel=null,Wl.verifyArgs(n),this.filters=n.filters,fn(this.filters,"filters"),this.kernelInitializer=Ft(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=an(n.kernelConstraint),this.kernelRegularizer=Ot(n.kernelRegularizer)}build(e){e=ut(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new W(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],o=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return Z(()=>{e=Ve(e);let s;const o=this.bias==null?null:this.bias.read(),r=O2(this.activation.getClassName());if(r!=null&&this.rank===2)s=Lw(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,r);else{if(this.rank===1)s=zG(e,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=Lw(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=WG(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Xe("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=ut(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let r=0;r<s.length;++r){const i=wo(s[r],this.kernelSize[r],this.padding,this.strides[r],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[r]);n.push(i)}let o=[e[0]];return this.dataFormat==="channelsLast"?(o=o.concat(n),o.push(this.filters)):(o.push(this.filters),o=o.concat(n)),o}getConfig(){const e={filters:this.filters,kernelInitializer:Pt(this.kernelInitializer),kernelRegularizer:kt(this.kernelRegularizer),kernelConstraint:rn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new W(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class wd extends Wl{constructor(e){super(2,e),wd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ix(e.kernelSize,"number",1,2))throw new W(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}wd.className="Conv2D";de(wd);class Cd extends Wl{constructor(e){super(3,e),Cd.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new W(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Cd.className="Conv3D";de(Cd);class LT extends wd{constructor(e){if(super(e),this.inputSpec=[new sn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new W(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ut(e),e.length!==4)throw new W("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new W("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],o=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new sn({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return Z(()=>{let s=Ve(e);if(s.shape.length!==4)throw new W(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const o=s.shape,r=o[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=o[i],c=o[a],u=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],f=this.strides[1],p=Uo(l,h,u,this.padding),m=Uo(c,f,d,this.padding),g=[r,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=at(s,[0,2,3,1]));let v=c$(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=at(v,[0,3,1,2])),this.bias!=null&&(v=Eo(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=ut(e);const n=e.slice();let s,o,r;this.dataFormat==="channelsFirst"?(s=1,o=2,r=3):(s=3,o=1,r=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[s]=this.filters,n[o]=Uo(n[o],l,i,this.padding),n[r]=Uo(n[r],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}LT.className="Conv2DTranspose";de(LT);class BT extends Cd{constructor(e){if(super(e),this.inputSpec=[new sn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new W(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ut(e),e.length!==5)throw new W("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new W("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],o=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new sn({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return Z(()=>{let s=Ve(e);if(s.shape.length!==5)throw new W(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const o=s.shape,r=o[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const c=o[l],u=o[i],d=o[a],h=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],v=this.strides[2],b=Uo(c,m,h,this.padding),y=Uo(u,g,f,this.padding),x=Uo(d,v,p,this.padding),w=[r,b,y,x,this.filters];this.dataFormat!=="channelsLast"&&(s=at(s,[0,2,3,4,1]));let k=HL(s,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=at(k,[0,4,1,2,3])),this.bias!==null&&(k=Eo(k,this.bias.read(),this.dataFormat)),this.activation!==null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=ut(e);const n=e.slice();let s,o,r,i;this.dataFormat==="channelsFirst"?(s=1,o=2,r=3,i=4):(s=4,o=1,r=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],h=this.strides[2];return n[s]=this.filters,n[o]=Uo(n[o],u,a,this.padding),n[r]=Uo(n[r],d,l,this.padding),n[i]=Uo(n[i],h,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}BT.className="Conv3DTranspose";de(BT);class VT extends Wl{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new W("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new W("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new W(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Ft(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ot(n.depthwiseRegularizer),this.depthwiseConstraint=an(n.depthwiseConstraint),this.pointwiseInitializer=Ft(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ot(n.pointwiseRegularizer),this.pointwiseConstraint=an(n.pointwiseConstraint)}build(e){if(e=ut(e),e.length<this.rank+2)throw new W(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new W(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],o=this.kernelSize.concat([s,this.depthMultiplier]),r=[];for(let a=0;a<this.rank;++a)r.push(1);r.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",r,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new sn({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return Z(()=>{e=Ve(e);let s;if(this.rank===1)throw new Xe("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=at(e,[0,2,3,1])),s=D$(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Eo(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=at(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Pt(this.depthwiseInitializer),e.pointwiseInitializer=Pt(this.pointwiseInitializer),e.depthwiseRegularizer=kt(this.depthwiseRegularizer),e.pointwiseRegularizer=kt(this.pointwiseRegularizer),e.depthwiseConstraint=rn(this.depthwiseConstraint),e.pointwiseConstraint=rn(this.pointwiseConstraint),e}}VT.className="SeparableConv";class zT extends VT{constructor(e){super(2,e)}}zT.className="SeparableConv2D";de(zT);class rm extends Wl{constructor(e){super(1,e),rm.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Ix(e.kernelSize,"number",1,1))throw new W(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}rm.className="Conv1D";de(rm);class WT extends nt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return Z(()=>{if(e=Ve(e),this.dataFormat==="channelsLast"){const s=Jd(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Jd(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Jd(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Jd(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}WT.className="Cropping2D";de(WT);class UT extends nt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,mU(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return Z(()=>{let s=Ve(e);const o=s.shape;if(this.dataFormat==="channelsFirst"){s=at(s,[0,2,3,1]);const r=this.size[0]*o[2],i=this.size[1]*o[3],a=this.interpolation==="nearest"?br.resizeNearestNeighbor(s,[r,i]):br.resizeBilinear(s,[r,i]);return at(a,[0,3,1,2])}else{const r=this.size[0]*o[1],i=this.size[1]*o[2];return this.interpolation==="nearest"?br.resizeNearestNeighbor(s,[r,i]):br.resizeBilinear(s,[r,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}UT.className="UpSampling2D";de(UT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function UG(t,e,n=[1,1],s="valid",o,r){return Z(()=>{o==null&&(o=ko()),qt(o);let i=Bx(t,o);if(t.rank!==4)throw new W(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new W(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=$y(i,e,n,s==="same"?"same":"valid","NHWC",r),o==="channelsFirst"&&(i=at(i,[0,3,1,2])),i})}class GT extends om{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Ft(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=an(e.depthwiseConstraint),this.depthwiseRegularizer=Ot(e.depthwiseRegularizer)}build(e){if(e=ut(e),e.length<4)throw new W(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new W(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],o=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Z(()=>{e=Ve(e);let s=UG(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Eo(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=ut(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=wo(n,this.kernelSize[0],this.padding,this.strides[0]),i=wo(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],o,r,i]:[e[0],r,i,o]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Pt(this.depthwiseInitializer),e.depthwiseRegularizer=kt(this.depthwiseRegularizer),e.depthwiseConstraint=rn(this.depthwiseRegularizer),e}}GT.className="DepthwiseConv2D";de(GT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function HT(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new W("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(r){return r==null||Array.isArray(r)?r:[r]}return e=o(e),n=o(n),{inputs:t,initialState:e,constants:n}}function jT(t,e,n,s=!1,o,r,i=!1,a=!1){return Z(()=>{const l=e.shape.length;if(l<3)throw new W(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Co(2,l));if(e=at(e,c),r!=null)throw new Xe("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=Se(Se(o,"bool"),"float32"),o.rank===l-1&&(o=Zn(o,-1)),o=at(o,c)),s&&(e=ua(e,0),o!=null&&(o=ua(o,0)));const u=[];let d,h=n;const f=e.shape[0],p=da(e);let m;o!=null&&(m=da(o));for(let v=0;v<f;++v){const b=p[v],y=Z(()=>t(b,h));if(o==null)d=y[0],h=y[1];else{const x=Z(()=>{const w=m[v],k=Le(no(w),w),S=be(G(y[0],w),G(h[0],k)),C=h.map(($,T)=>be(G(y[1][T],w),G($,k)));return{output:S,newStates:C}});d=x.output,h=x.newStates}a&&u.push(d)}let g;return a&&(g=Sr(u,1)),[d,g,h]})}class ki extends nt{constructor(e){super(e);let n;if(e.cell==null)throw new W("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new Wx({cells:e.cell}):n=e.cell,n.stateSize==null)throw new W("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new sn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Co(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){uv(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let o;if(this.returnSequences?o=[e[0],e[1],s]:o=[e[0],s],this.returnState){const r=[];for(const i of n)r.push([e[0],i]);return[o].concat(r)}else return o}computeMask(e,n){return Z(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const o=this.states.map(r=>null);return[s].concat(o)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Xe("Constants support is not implemented in RNN yet.");uv(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new sn({shape:[n,null,...s]});const o=[e[0]].concat(e.slice(2));this.cell.build(o);let r;if(Array.isArray(this.cell.stateSize)?r=this.cell.stateSize:r=[this.cell.stateSize],this.stateSpec!=null){if(!mt(this.stateSpec.map(i=>i.shape[i.shape.length-1]),r))throw new W(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map(i=>new sn({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){Z(()=>{if(!this.stateful)throw new zo("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new W("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>hn([s,o])):this.states_=[hn([s,this.cell.stateSize])];else if(e==null)Je(this.states_),this.keptStates!=null&&(Je(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>hn([s,o])):this.states_[0]=hn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new W(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Je(this.states_);for(let o=0;o<this.states_.length;++o){const r=e[o],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,a=[s,i];if(!mt(r.shape,a))throw new W(`State ${o} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${r.shape}`);this.states_[o]=r}}this.states_=this.states_.map(o=>qo(o.clone()))})}apply(e,n){let s=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});const r=HT(e,s,o,this.numConstants);e=r.inputs,s=r.initialState,o=r.constants;let i=[],a=[];if(s!=null){n.initialState=s,i=i.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new sn({shape:c.shape}));a=a.concat(this.stateSpec)}if(o!=null&&(n.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof sr){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return Z(()=>{const s=n==null?null:n.mask,o=n==null?null:n.training;let r=n==null?null:n.initialState;e=Ve(e),r==null&&(this.stateful?r=this.states_:r=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(r.length!==i)throw new W(`RNN Layer has ${i} state(s) but was passed ${r.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:o},c=jT((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},e,r,this.goBackwards,s,null,this.unroll,this.returnSequences),u=c[0],d=c[1],h=c[2];this.stateful&&this.resetStates(h,o);const f=this.returnSequences?d:u;return this.returnState?[f].concat(h):f})}getInitialState(e){return Z(()=>{let n=hn(e.shape);return n=De(n,[1,2]),n=gd(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?lv(n,[1,s]):n):this.cell.stateSize>1?[lv(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===ki.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const o=n.cell,r=Qo(o,s);return new e(Object.assign(n,{cell:r}))}}ki.className="RNN";de(ki);class im extends nt{}class Vx extends im{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,fn(this.units,"units"),this.activation=ui(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ft(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ft(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ft(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ot(e.kernelRegularizer),this.recurrentRegularizer=Ot(e.recurrentRegularizer),this.biasRegularizer=Ot(e.biasRegularizer),this.kernelConstraint=an(e.kernelConstraint),this.recurrentConstraint=an(e.recurrentConstraint),this.biasConstraint=an(e.biasConstraint),this.dropout=bl([1,li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=bl([1,li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ut(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Z(()=>{if(e=e,e.length!==2)throw new W(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const o=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>no(e),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>no(s),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let r;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?r=Zo(G(e,i),this.kernel.read()):r=Zo(e,this.kernel.read()),this.bias!=null&&(r=Eo(r,this.bias.read())),a!=null&&(s=G(s,a));let l=be(r,Zo(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ci(this.activation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:kt(this.kernelRegularizer),recurrentRegularizer:kt(this.recurrentRegularizer),biasRegularizer:kt(this.biasRegularizer),activityRegularizer:kt(this.activityRegularizer),kernelConstraint:rn(this.kernelConstraint),recurrentConstraint:rn(this.recurrentConstraint),biasConstraint:rn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}Vx.className="SimpleRNNCell";de(Vx);class KT extends ki{constructor(e){e.cell=new Vx(e),super(e)}call(e,n){return Z(()=>{this.cell.dropoutMask!=null&&(Je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}static fromConfig(e,n){return new e(n)}}KT.className="SimpleRNN";de(KT);class zx extends im{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new W("GRUCell does not support reset_after parameter set to true.");this.units=e.units,fn(this.units,"units"),this.activation=ui(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ui(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ft(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ft(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ft(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ot(e.kernelRegularizer),this.recurrentRegularizer=Ot(e.recurrentRegularizer),this.biasRegularizer=Ot(e.biasRegularizer),this.kernelConstraint=an(e.kernelConstraint),this.recurrentConstraint=an(e.recurrentConstraint),this.biasConstraint=an(e.biasConstraint),this.dropout=bl([1,li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=bl([1,li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ut(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return Z(()=>{if(e=e,e.length!==2)throw new W(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let o=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>no(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>no(o),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const r=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=G(e,r[0]));let u=Zo(e,this.kernel.read());this.useBias&&(u=Eo(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=G(o,i[0]));const d=this.recurrentKernel.read(),[h,f]=As(d,[2*this.units,this.units],d.rank-1),p=Zo(o,h),[m,g,v]=As(u,3,u.rank-1),[b,y]=As(p,2,p.rank-1);a=this.recurrentActivation.apply(be(m,b)),l=this.recurrentActivation.apply(be(g,y));const x=Zo(G(l,o),f);c=this.activation.apply(be(v,x));const w=be(G(a,o),G(be(1,Gt(a)),c));return[w,w]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ci(this.activation),recurrentActivation:ci(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:kt(this.kernelRegularizer),recurrentRegularizer:kt(this.recurrentRegularizer),biasRegularizer:kt(this.biasRegularizer),activityRegularizer:kt(this.activityRegularizer),kernelConstraint:rn(this.kernelConstraint),recurrentConstraint:rn(this.recurrentConstraint),biasConstraint:rn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}zx.className="GRUCell";de(zx);class qT extends ki{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new zx(e),super(e)}call(e,n){return Z(()=>{this.cell.dropoutMask!=null&&(Je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}qT.className="GRU";de(qT);class am extends im{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,fn(this.units,"units"),this.activation=ui(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ui(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ft(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ft(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ft(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Ot(e.kernelRegularizer),this.recurrentRegularizer=Ot(e.recurrentRegularizer),this.biasRegularizer=Ot(e.biasRegularizer),this.kernelConstraint=an(e.kernelConstraint),this.recurrentConstraint=an(e.recurrentConstraint),this.biasConstraint=an(e.biasConstraint),this.dropout=bl([1,li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=bl([1,li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=ut(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){const r=this.biasInitializer,i=this.units;o=new(n=class extends io{apply(l,c){const u=r.apply([i]),d=new Tx().apply([i]),h=r.apply([i*2]);return ww(ww(u,d),h)}},n.className="CustomInit",n)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return Z(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new W(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=e[1];const r=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>no(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>no(o),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=G(e,i[0]));let h=Zo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=G(o,a[0])),h=be(h,Zo(o,this.recurrentKernel.read())),this.useBias&&(h=Eo(h,this.bias.read()));const[f,p,m,g]=As(h,4,h.rank-1);l=this.recurrentActivation.apply(f),c=this.recurrentActivation.apply(p),u=be(G(c,r),G(l,this.activation.apply(m))),d=this.recurrentActivation.apply(g);const v=G(d,this.activation.apply(u));return[v,v,u]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ci(this.activation),recurrentActivation:ci(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),recurrentInitializer:Pt(this.recurrentInitializer),biasInitializer:Pt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:kt(this.kernelRegularizer),recurrentRegularizer:kt(this.recurrentRegularizer),biasRegularizer:kt(this.biasRegularizer),activityRegularizer:kt(this.activityRegularizer),kernelConstraint:rn(this.kernelConstraint),recurrentConstraint:rn(this.recurrentConstraint),biasConstraint:rn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}am.className="LSTMCell";de(am);class XT extends ki{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new am(e),super(e)}call(e,n){return Z(()=>{this.cell.dropoutMask!=null&&(Je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}XT.className="LSTM";de(XT);class Wx extends im{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return Z(()=>{e=e;let s=e.slice(1);const o=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?o.push(s.splice(0,a.stateSize.length)):o.push(s.splice(0,1));o.reverse();const r=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=o[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,n),r.push(i.slice(1))}s=[];for(const a of r.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){uv(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,o)=>{Qi(`RNNCell_${o}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=r=>({className:r.getClassName(),config:r.getConfig()}),o={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),o)}static fromConfig(e,n,s={}){const o=[];for(const r of n.cells)o.push(Qo(r,s));return new e({cells:o})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return dv(e)}setWeights(e){const n=[];for(const s of this.cells){const o=s.weights.length,r=e.splice(o);for(let i=0;i<s.weights.length;++i)n.push([s.weights[i],r[i]])}Fx(n)}}Wx.className="StackedRNNCells";de(Wx);function di(t){const{ones:e,rate:n,training:s=!1,count:o=1,dropoutFunc:r}=t,i=()=>r!=null?r(e(),n):W2(e(),n),a=()=>bd(i,e,s);return!o||o<=1?qo(a().clone()):Array(o).fill(void 0).map(a).map(c=>qo(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var GG=globalThis&&globalThis.__rest||function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(t);o<s.length;o++)e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(n[s[o]]=t[s[o]]);return n};class YT extends ki{constructor(e){if(e.unroll)throw new Xe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Xe("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new sn({ndim:5})]}call(e,n){return Z(()=>{if(this.cell.dropoutMask!=null&&(Je(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Je(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new W("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,o=n==null?null:n.training,r=n==null?null:n.initialState;return super.call(e,{mask:s,training:o,initialState:r})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return Z(()=>{const{stateSize:n}=this.cell,s=e.shape,o=this.computeSingleOutputShape(s),r=[o[0],...o.slice(2)],i=hn(r);return Array.isArray(n)?Array(n.length).fill(i):[i]})}resetStates(e,n=!1){Z(()=>{if(!this.stateful)throw new zo("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,o=this.computeSingleOutputShape(s),r=[o[0],...o.slice(2)];if(s[0]==null)throw new W("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>hn(r)):this.states_=[hn(r)];else if(e==null)Je(this.states_),this.keptStates!=null&&(Je(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>hn(r)):this.states_[0]=hn(r);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new W(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Je(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=r;if(!mt(l.shape,c))throw new W(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>qo(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:o,padding:r,strides:i,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=wo(c,o[0],r,i[0],a[0]),h=wo(u,o[1],r,i[1],a[1]);return[...e.slice(0,2),...l?[s,d,h]:[d,h,s]]}}YT.className="ConvRNN2D";class Ux extends am{constructor(e){const{filters:n,kernelSize:s,strides:o,padding:r,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,fn(this.filters,"filters"),this.kernelSize=ll(s,2,"kernelSize"),this.kernelSize.forEach(l=>fn(l,"kernelSize")),this.strides=ll(o||1,2,"strides"),this.strides.forEach(l=>fn(l,"strides")),this.padding=r||"valid",Os(this.padding),this.dataFormat=i||"channelsLast",qt(this.dataFormat),this.dilationRate=ll(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>fn(l,"dilationRate"))}build(e){var n;e=ut(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new W(`The channel dimension of the input should be defined. Found ${e[s]}`);const o=e[s],r=4,i=this.kernelSize.concat([o,this.filters*r]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*r]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(n=class extends io{apply(h,f){const p=c.apply([u]),m=wi([u]),g=c.apply([u*2]);return $x([p,m,g])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*r],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return Z(()=>{if(e.length!==3)throw new W(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,o=e[0],r=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=di({ones:()=>no(o),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(J,X,te)=>!X||!X[te]?J:G(X[te],J);let u=c(o,l,0),d=c(o,l,1),h=c(o,l,2),f=c(o,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=di({ones:()=>no(r),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=c(r,p,0),g=c(r,p,1),v=c(r,p,2),b=c(r,p,3);const y=3,[x,w,k,S]=As(this.kernel.read(),a,y),[C,$,T,E]=this.useBias?As(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,x,C,this.padding),d=this.inputConv(d,w,$,this.padding),h=this.inputConv(h,k,T,this.padding),f=this.inputConv(f,S,E,this.padding);const[_,A,O,B]=As(this.recurrentKernel.read(),a,y);m=this.recurrentConv(m,_),g=this.recurrentConv(g,A),v=this.recurrentConv(v,O),b=this.recurrentConv(b,B);const F=this.recurrentActivation.apply(be(u,m)),V=this.recurrentActivation.apply(be(d,g)),D=be(G(V,i),G(F,this.activation.apply(be(h,v)))),U=G(this.recurrentActivation.apply(be(f,b)),this.activation.apply(D));return[U,U,D]})}getConfig(){const e=super.getConfig(),n=GG(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,o){const r=ca(e,n,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Eo(r,s,this.dataFormat):r}recurrentConv(e,n){return ca(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Ux.className="ConvLSTM2DCell";de(Ux);class ZT extends YT{constructor(e){const n=new Ux(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}ZT.className="ConvLSTM2D";de(ZT);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gx extends nt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let o=0;o<this.noiseShape.length;++o)s.push(this.noiseShape[o]==null?n[o]:this.noiseShape[o]);return s}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e);if(0<this.rate&&this.rate<1){const o=n.training==null?!1:n.training,r=this.getNoiseShape(s);return bd(()=>W2(s,this.rate,r,this.seed),()=>s,o)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}Gx.className="Dropout";de(Gx);class QT extends Gx{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}QT.className="SpatialDropout1D";de(QT);class JT extends nt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,fn(this.units,"units"),this.activation=ui(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Ft(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ft(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=an(e.kernelConstraint),this.biasConstraint=an(e.biasConstraint),this.kernelRegularizer=Ot(e.kernelRegularizer),this.biasRegularizer=Ot(e.biasRegularizer),this.activityRegularizer=Ot(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=ut(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=ut(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e),o=O2(this.activation.getClassName());let r;return o!=null?r=Zo(s,this.kernel.read(),o,this.bias?this.bias.read():null):(r=Zo(s,this.kernel.read()),this.bias!=null&&(r=Eo(r,this.bias.read())),this.activation!=null&&(r=this.activation.apply(r))),r})}getConfig(){const e={units:this.units,activation:ci(this.activation),useBias:this.useBias,kernelInitializer:Pt(this.kernelInitializer),biasInitializer:Pt(this.biasInitializer),kernelRegularizer:kt(this.kernelRegularizer),biasRegularizer:kt(this.biasRegularizer),activityRegularizer:kt(this.activityRegularizer),kernelConstraint:rn(this.kernelConstraint),biasConstraint:rn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}JT.className="Dense";de(JT);class eN extends nt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=ut(e);for(const n of e.slice(1))if(n==null)throw new W(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],oi(e,1)]}call(e,n){return Z(()=>{this.invokeCallHook(e,n);let s=Ve(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const o=[0];for(let r=2;r<s.rank;++r)o.push(r);o.push(1),s=at(s,o)}return wU(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}eN.className="Flatten";de(eN);class tN extends nt{constructor(e){super(e),this.supportsMasking=!0,this.activation=ui(e.activation)}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e);return this.activation.apply(s)})}getConfig(){const e={activation:ci(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}tN.className="Activation";de(tN);class nN extends nt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return Z(()=>(e=Ve(e),yU(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}nN.className="RepeatVector";de(nN);class sN extends nt{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",o=n.slice();let r=1,i=null;for(let l=0;l<o.length;++l){const c=o[l];if(this.isUnknown(c))if(i===null)i=l;else throw new W("Can only specifiy one unknown dimension.");else r*=c}const a=oi(e);if(i!==null){if(r===0||a%r!==0)throw new W(s);o[i]=a/r}else if(a!==r)throw new W(s);return o}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e),o=s.shape,r=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return K(s,r)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}sN.className="Reshape";de(sN);class oN extends nt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Co(1,e.dims.length+1);if(!mt(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new sn({ndim:this.dims.length+1})]}computeOutputShape(e){e=ut(e);const n=e.slice();return this.dims.forEach((s,o)=>{n[o+1]=e[s]}),n}call(e,n){return at(Ve(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}oN.className="Permute";de(oN);class rN extends nt{constructor(e){super(e==null?{}:e),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=Ve(e),o=-1;return tv(Bh(s,this.maskValue),o)}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e),o=-1,r=!0,i=tv(Bh(s,this.maskValue),o,r);return G(s,Se(i,s.dtype))})}}rN.className="Masking";de(rN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class iN extends nt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(wt(e.inputLength))}this.inputDim=e.inputDim,fn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,fn(this.outputDim,"outputDim"),this.embeddingsInitializer=Ft(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ot(e.embeddingsRegularizer),this.activityRegularizer=Ot(e.activityRegularizer),this.embeddingsConstraint=an(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return Z(()=>this.maskZero?(e=Ve(e),Bh(e,lt(e))):null)}computeOutputShape(e){if(e=ut(e),this.inputLength==null)return[...e,this.outputDim];const n=wt(this.inputLength);if(n.length!==e.length-1)throw new W(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let o=0;o<n.length;++o){const r=n[o],i=e[o+1];if(r!=null&&i!=null&&r!==i)throw new W(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);r==null&&(n[s]=i),s++}}return[e[0],...n,this.outputDim]}call(e,n){return Z(()=>{this.invokeCallHook(e,n);let s=Ve(e);s.dtype!=="int32"&&(s=Yo(s,"int32"));const o=z2(this.embeddings.read(),K(s,[s.size]));return K(o,ut(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Pt(this.embeddingsInitializer),embeddingsRegularizer:kt(this.embeddingsRegularizer),activityRegularizer:kt(this.activityRegularizer),embeddingsConstraint:rn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}iN.className="Embedding";de(iN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ta extends nt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new Xe}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let o=0;o<n.length;++o){const r=e[e.length-n.length+o],i=n[o];if(r==null||i==null||r<0||i<0)s.push(null);else if(r===1)s.push(i);else if(i===1)s.push(r);else{if(r!==i)throw new W("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(r)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[ut(e)]),e=e,e.length<2)throw new W(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const r of e)r!=null&&r[0]!==null&&n.push(r[0]);if(n=si(n),n.length>1)throw new W(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const o=e.map(r=>r.length);e.indexOf(null)===-1&&si(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return Z(()=>{if(e=e,this.reshapeRequired){const s=[],o=e.map(r=>r.rank);if(o.indexOf(null)===-1){const r=li(o);for(let i of e){const a=i.rank;for(let l=0;l<r-a;++l)i=gd(i,1);s.push(i)}return this.mergeFunction(s)}else{let r=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],h=u.slice(1).concat([d]);let f=K(l,[d].concat(oi(u.slice(1))));f=at(f,[1,0]),f=K(f,h),s.push(f),r=!0}else if(c>1){const u=Co(1,c).concat([0]);s.push(at(l,u)),r=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(r){if(a==null){const l=i.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));i=K(at(K(i,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Co(0,a-1));i=at(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let o=1;o<e.length;++o){const r=e[o]==null?null:e[o].slice(1);n=this.computeElementwiseOpOutputShape(n,r)}let s=[];for(const o of e)o!=null&&o[0]!==null&&s.push(o[0]);return s=si(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return Z(()=>{if(n==null)return null;if(!Array.isArray(n))throw new W("`mask` should be an Array");if(!Array.isArray(e))throw new W("`inputs` should be an Array");if(n.length!==e.length)throw new W(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(o=>o==null))return null;n=n.map(o=>o==null?o:Zn(o,0));let s=n[0];for(let o=1;o<n.length-1;++o)s=kr(s,n[o]);return s})}}class aN extends Ta{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=be(n,e[s]);return n})}}aN.className="Add";de(aN);class lN extends Ta{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=G(n,e[s]);return n})}}lN.className="Multiply";de(lN);class cN extends Ta{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=be(n,e[s]);return G(1/e.length,n)})}}cN.className="Average";de(cN);class uN extends Ta{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=xi(n,e[s]);return n})}}uN.className="Maximum";de(uN);class dN extends Ta{constructor(e){super(e)}mergeFunction(e){return Z(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Uc(n,e[s]);return n})}}dN.className="Minimum";de(dN);class hN extends Ta{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new W("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const o of e)if(o!=null){n=!1;break}if(n)return;const s=[];for(let o=0;o<e.length;++o){const r=e[o].slice();r.splice(this.axis,1);let i=!1;for(const a of s)if(mt(a,r)){i=!0;break}i||s.push(r)}if(s.length>1)throw new W("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return Z(()=>$x(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new W("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),o=this.axis<0?s.length+this.axis:this.axis;for(const r of n.slice(1)){if(s[o]==null||r[o]==null){s[o]=null;break}s[o]+=r[o]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new W("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new W("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new W(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return Z(()=>{let s=!0;if(n.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const o=[];for(let i=0;i<e.length;++i)n[i]==null?o.push(Se(no(e[i]),"bool")):n[i].rank<e[i].rank?o.push(Zn(n[i],-1)):o.push(n[i]);const r=ns(o,this.axis);return a$(r,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}hN.className="Concatenate";de(hN);function ac(t,e){for(;t<0;)t+=e;return t}function HG(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Xe("batchDot is not implemented for tensors of 4D or higher rank yet");if(N(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),N(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new Xe("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,o=e.shape.length;n==null&&(n=[s-1,o-2]);const r=n;return Z(()=>{let i;if(s>o){i=s-o;const l=[];for(let c=0;c<i;++c)l.push(1);e=K(e,e.shape.concat(l))}else if(o>s){i=o-s;const l=[];for(let c=0;c<i;++c)l.push(1);t=K(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)r[0]===r[1]?a=De(G(t,e),r[0]):a=De(G(at(t,[1,0]),e),r[1]);else{const l=r[0]!==t.shape.length-1,c=r[1]===e.shape.length-1;a=ft(t,e,l,c)}if(i>0){let l;s>o?l=s+o-3:l=s-1;const c=[];for(let u=l;u<l+i;++u)c.push(u);a=ud(a,c)}return a.shape.length===1&&(a=Zn(a,1)),a})}class fN extends Ta{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){N(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new Xe("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(n,s);if(n[o[0]]!==s[o[1]])throw new W(`Dimension incompatibility: ${n[o[0]]} !== ${s[o[1]]}`)}mergeFunction(e){if(e.length!==2)throw new W(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],o;return Array.isArray(this.axes)?o=this.axes.map((r,i)=>ac(r,e[i].shape.length)):o=[ac(this.axes,n.shape.length),ac(this.axes,s.shape.length)],this.normalize&&(n=jh(n,o[0]),s=jh(s,o[1])),HG(n,s,o)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[ac(this.axes,e.length),ac(this.axes,n.length)],s}computeOutputShape(e){N(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new Xe("Dot layer does not support tensors of 4D or higher rank yet.");const o=this.interpretAxes(n,s);n.splice(o[0],1),s.splice(o[1],1),s.splice(0,1);const r=n.concat(s);return r.length===1&&r.push(1),r}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}fN.className="Dot";de(fN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pN extends nt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e);return bd(()=>be(em(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}pN.className="GaussianNoise";de(pN);class mN extends nt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Z(()=>{this.invokeCallHook(e,n);const s=Ve(e);return this.rate>0&&this.rate<1?bd(()=>{const r=Math.sqrt(this.rate/(1-this.rate));return G(s,em(s.shape,1,r))},()=>s,n.training||!1):s})}}mN.className="GaussianDropout";de(mN);class gN extends nt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ve(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return Z(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return bd(()=>{const r=Ve(e),i=1.6732632423543772,a=1.0507009873554805,l=-i*a;let c=Ca(cd(s),this.rate);c=Yo(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,h=be(G(r,c),G(be(c,-1),l));return be(G(h,u),d)},()=>Ve(e),n.training||!1)}return e})}}gN.className="AlphaDropout";de(gN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qc(t,e,n,s,o,r=.001){let i;if(t.rank===2)i=bL(t,e,n,s,o,r);else if(t.rank===3)i=xL(t,e,n,s,o,r);else if(t.rank===4)i=CL(t,e,n,s,o,r);else throw new Xe(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function jG(t,e,n,s,o=.001){return Z(()=>{const r=Dy(t,s),i=r.mean,a=r.variance;return[qc(t,i,a,n,e,o),i,a]})}function KG(t,e,n,s,o=.001){return Z(()=>{const r=Dy(t,s),i=r.mean,a=r.variance,l=[];for(const p of Co(0,t.rank))s.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const c=K(i,l),u=K(a,l),d=e==null?null:K(e,l),h=n==null?null:K(n,l);return[qc(t,c,u,h,d,o),i,a]})}function qG(t,e,n,s,o=.001){return mt(s.slice().sort(),Co(0,t.rank-1))?jG(t,e,n,s,o):KG(t,e,n,s,o)}class vN extends nt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ft(e.betaInitializer||"zeros"),this.gammaInitializer=Ft(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ft(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ft(e.movingVarianceInitializer||"ones"),this.betaConstraint=an(e.betaConstraint),this.gammaConstraint=an(e.gammaConstraint),this.betaRegularizer=Ot(e.betaRegularizer),this.gammaRegularizer=Ot(e.gammaRegularizer)}build(e){e=ut(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new W(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new sn({ndim:e.length,axes:{[n]:s}})];const o=[s];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return Z(()=>{const s=n.training==null?!1:n.training,o=Ve(e),r=o.shape,i=r.length,a=Co(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const c=fa(1,i);c[l]=r[l];const u=a.slice();u.sort();const d=!mt(u,Co(0,i).slice(0,i-1)),h=()=>{if(d){const b=K(this.movingMean.read(),c),y=K(this.movingVariance.read(),c),x=this.center?K(this.beta.read(),c):null,w=this.scale?K(this.gamma.read(),c):null;return qc(o,b,y,x,w,this.epsilon)}else return qc(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[f,p,m]=qG(o,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(b,y,x)=>{Z(()=>{const w=1-x,k=b.read(),S=G(Le(k,y),w);b.write(Le(k,S))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pt(this.betaInitializer),gammaInitializer:Pt(this.gammaInitializer),movingMeanInitializer:Pt(this.movingMeanInitializer),movingVarianceInitializer:Pt(this.movingVarianceInitializer),betaRegularizer:kt(this.betaRegularizer),gammaRegularizer:kt(this.gammaRegularizer),betaConstraint:rn(this.betaConstraint),gammaConstraint:rn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}vN.className="BatchNormalization";de(vN);class bN extends nt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ft(e.betaInitializer||"zeros"),this.gammaInitializer=Ft(e.gammaInitializer||"ones"),this.betaRegularizer=Ot(e.betaRegularizer),this.gammaRegularizer=Ot(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=ut(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let r=0;r<this.axis.length;++r)this.axis[r]<0&&(this.axis[r]+=n);for(const r of this.axis)if(r<0||r>=n)throw new Error(`Invalid axis: ${r}`);if(this.axis.length!==si(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(r=>e[r]),o=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(e,n){const s=Ve(e),o=s.shape,r=o.length;return Z(()=>{let{mean:a,variance:l}=Dy(s,this.axis,!0);const c=fa(1,r);for(const m of this.axis)c[m]=o[m];const u=m=>m!=null&&m.shape.length!==r?K(m,c):m;let d=this.scale?u(this.gamma.read()):null,h=this.center?u(this.beta.read()):null;const f=[],p=[];for(let m=0;m<r;++m)this.axis.indexOf(m)!==-1?(f.push(o[m]),p.push(1)):(f.push(1),p.push(o[m]));return a=go(a,f),l=go(l,f),d!=null&&(d=go(d,p)),h!=null&&(h=go(h,p)),qc(s,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pt(this.betaInitializer),gammaInitializer:Pt(this.gammaInitializer),betaRegularizer:kt(this.betaRegularizer),gammaRegularizer:kt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}bN.className="LayerNormalization";de(bN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XG(t,e,n){return Z(()=>{if(t.rank!==4)throw new W(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new W("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=ko()),n!=="channelsLast"&&n!=="channelsFirst")throw new W(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Fy(t,s)})}class yN extends nt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?ko():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new W(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new W(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new W(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new sn({ndim:4})]}computeOutputShape(e){e=ut(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return Z(()=>XG(Ve(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}yN.className="ZeroPadding2D";de(yN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lm(t,e,n,s,o,r){return Z(()=>{qt(o),M2(r),Os(s),n==null&&(n=[1,1]),s==null&&(s="valid"),o==null&&(o=ko()),r==null&&(r="max"),t=Bx(t,o);let i;const a=s==="same"?"same":"valid";return r==="max"?i=Ry(t,e,n,a):i=wy(t,e,n,a),o==="channelsFirst"&&(i=at(i,[0,3,1,2])),i})}function xN(t,e,n,s,o,r){return Z(()=>{qt(o),M2(r),Os(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),o==null&&(o=ko()),r==null&&(r="max"),t=MT(t,o);let i;const a=s==="same"?"same":"valid";return r==="max"?i=aB(t,e,n,a):i=lL(t,e,n,a),o==="channelsFirst"&&(i=at(i,[0,4,1,2,3])),i})}class wN extends nt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new W(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(fn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new W(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);fn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Os(this.padding),this.inputSpec=[new sn({ndim:3})]}computeOutputShape(e){e=ut(e);const n=wo(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return Z(()=>{this.invokeCallHook(e,n),e=gd(Ve(e),2);const s=this.poolingFunction(Ve(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ud(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class CN extends wN{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return qt(r),Os(o),lm(e,n,s,o,r,"max")}}CN.className="MaxPooling1D";de(CN);class kN extends wN{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return qt(r),Os(o),lm(e,n,s,o,r,"avg")}}kN.className="AveragePooling1D";de(kN);class SN extends nt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new W(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];fn(this.poolSize,"poolSize"),fn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),Os(this.padding),this.inputSpec=[new sn({ndim:4})]}computeOutputShape(e){e=ut(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=wo(n,this.poolSize[0],this.padding,this.strides[0]),s=wo(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return Z(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ve(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class IN extends SN{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return qt(r),Os(o),lm(e,n,s,o,r,"max")}}IN.className="MaxPooling2D";de(IN);class $N extends SN{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return qt(r),Os(o),lm(e,n,s,o,r,"avg")}}$N.className="AveragePooling2D";de($N);class TN extends nt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new W(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];fn(this.poolSize,"poolSize"),fn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),Os(this.padding),this.inputSpec=[new sn({ndim:5})]}computeOutputShape(e){e=ut(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=wo(n,this.poolSize[0],this.padding,this.strides[0]),s=wo(s,this.poolSize[1],this.padding,this.strides[1]),o=wo(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,o]:[e[0],n,s,o,e[4]]}call(e,n){return Z(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ve(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class NN extends TN{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return qt(r),Os(o),xN(e,n,s,o,r,"max")}}NN.className="MaxPooling3D";de(NN);class EN extends TN{constructor(e){super(e)}poolingFunction(e,n,s,o,r){return qt(r),Os(o),xN(e,n,s,o,r,"avg")}}EN.className="AveragePooling3D";de(EN);class _N extends nt{constructor(e){super(e),this.inputSpec=[new sn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new Xe}}class AN extends _N{constructor(e){super(e||{})}call(e,n){return Z(()=>{const s=Ve(e);return Zt(s,1)})}}AN.className="GlobalAveragePooling1D";de(AN);class RN extends _N{constructor(e){super(e||{})}call(e,n){return Z(()=>{const s=Ve(e);return xo(s,1)})}}RN.className="GlobalMaxPooling1D";de(RN);class DN extends nt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),this.inputSpec=[new sn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new Xe}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class FN extends DN{call(e,n){return Z(()=>{const s=Ve(e);return this.dataFormat==="channelsLast"?Zt(s,[1,2]):Zt(s,[2,3])})}}FN.className="GlobalAveragePooling2D";de(FN);class ON extends DN{call(e,n){return Z(()=>{const s=Ve(e);return this.dataFormat==="channelsLast"?xo(s,[1,2]):xo(s,[2,3])})}}ON.className="GlobalMaxPooling2D";de(ON);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class PN extends nt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const o=n.layer,r=Qo(o,s);delete n.layer;const i={layer:r};return Object.assign(i,n),new e(i)}}class MN extends PN{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=ut(e),e.length<3)throw new W(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=ut(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),o=e[1];return[s[0],o].concat(s.slice(1))}call(e,n){return Z(()=>(e=Ve(e),jT((i,a)=>[Ve(this.layer.call(i,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}MN.className="TimeDistributed";de(MN);function YG(t){$a(pU,"BidirectionalMergeMode",t)}const ZG="concat";class LN extends PN{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=Qo(s),n.goBackwards=n.goBackwards!==!0;const o={};if(o.className=e.layer.getClassName(),o.config=n,this.backwardLayer=Qo(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?ZG:e.mergeMode,YG(this.mergeMode),e.weights)throw new Xe("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,o,r;return this.returnState&&(r=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,o=[s]):this.mergeMode==null?o=[s,s.slice()]:o=[s],this.returnState?this.mergeMode==null?o.concat(r).concat(r.slice()):[s].concat(r).concat(r.slice()):Qn(o)}apply(e,n){let s=n==null?null:n.initialState,o=n==null?null:n.constants;n==null&&(n={});const r=HT(e,s,o,this.numConstants);if(e=r.inputs,s=r.initialState,o=r.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&o==null)return super.apply(e,n);const i=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new W("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,i.push(...s);const u=s.map(d=>new sn({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(o!=null)throw new Xe("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof sr;for(const c of i)if(c instanceof sr!==l)throw new W("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return Z(()=>{const s=n.initialState;let o,r;if(s==null)o=this.forwardLayer.call(e,n),r=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);o=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),r=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let i;this.returnState&&(Array.isArray(o)&&(i=o.slice(1).concat(r.slice(1))),o=o[0],r=r[0]),this.returnSequences&&(r=ua(r,1));let a;return this.mergeMode==="concat"?a=$x([o,r]):this.mergeMode==="sum"?a=be(o,r):this.mergeMode==="ave"?a=G(.5,be(o,r)):this.mergeMode==="mul"?a=G(o,r):this.mergeMode==null&&(a=[o,r]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Qi(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Qi(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const r=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(r).concat(r):[s].concat(r).concat(r)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=Qo(n.layer);if(delete n.layer,n.numConstants!=null)throw new Xe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const o=n;return o.layer=s,new e(o)}}LN.className="Bidirectional";de(LN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class BN extends nt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Z(()=>(e=Ve(e),e.dtype!=="float32"&&(e=Yo(e,"float32")),be(G(e,this.scale),this.offset)))}}BN.className="Rescaling";de(BN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:QG,cropAndResize:JG}=br;class VN extends nt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,o,r,i,a,l){return Z(()=>{let c,u=!1;const d=n/i,h=s/a,f=(o+n)/i,p=(r+s)/a,m=[d,h,f,p],g=[];e.rank===3?(u=!0,c=Sr([e])):c=e;for(let w=0;w<c.shape[0];w++)g.push(m);const v=rl(g,[g.length,4]),b=Gc(0,g.length,1,"int32"),x=JG(c,v,b,[o,r],"nearest");return Yo(u?Ve(da(x)):x,l)})}upsize(e,n,s,o){return Z(()=>{const r=QG(e,[n,s]);return Yo(r,o)})}call(e,n){return Z(()=>{const s=Ve(e),o=s.dtype,r=s.shape,i=r[r.length-3],a=r[r.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,i,a,o):this.upsize(e,this.height,this.width,o)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=ut(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}VN.className="CenterCrop";de(VN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eH(t,e,n,s){let o=Ve(t);if(o.dtype!=="int32"&&(o=Yo(o,"int32")),e==="int")return o;const r=o.shape;if(o.rank===0&&(o=Zn(o,-1)),e==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=Zn(o,-1)),o.rank>2)throw new W(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${r} which would result in output rank ${o.rank}.`);const i=["multiHot","oneHot"].includes(e),a=o;let l;if(typeof s<"u"&&e==="count"?l=nw(a,s,n,i):l=nw(a,[],n,i),e!=="tfIdf")return l;if(s)return G(l,s);throw new W("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zN extends nt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=ut(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return Z(()=>{e=Ve(e),e.dtype!=="int32"&&(e=Yo(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new W(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=Ve(n.countWeights)}const o=xo(e),r=Mh(e),i=Fs(this.numTokens,o).bufferSync().get(0),a=Ca(r,0).bufferSync().get(0);if(!(i&&a))throw new W(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return eH(e,this.outputMode,this.numTokens,s)})}}zN.className="CategoryEncoding";de(zN);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const tH=["bilinear","nearest"],Bw=new Set(tH);class WN extends nt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(Bw.has(e.interpolation))this.interpolation=e.interpolation;else throw new W(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){e=ut(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return Z(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return br.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return br.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...Bw]} are supported`)})}}WN.className="Resizing";de(WN);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UN{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}UN.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class GN extends nt{constructor(e){super(e),this.randomGenerator=new UN(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}GN.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const nH=["bilinear","nearest"],Vw=new Set(nH);class HN extends GN{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new W(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new W(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new W(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(Vw.has(s))this.interpolation=s;else throw new W(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=ut(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return Z(()=>{const s=Ve(e);this.imgHeight=s.shape[s.shape.length-3];const o=s.shape[s.shape.length-2];this.widthFactor=cd([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let r=this.widthFactor.dataSync()[0]*o;r=Math.round(r);const i=[this.imgHeight,r];switch(this.interpolation){case"bilinear":return br.resizeBilinear(e,i);case"nearest":return br.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...Vw]} are supported`)}})}}HN.className="RandomWidth";de(HN);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sH=Q();sH.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var zw;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(zw||(zw={}));var Ww;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(Ww||(Ww={}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var Uw;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(Uw||(Uw={}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ne(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&N(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oH=z$;class cm extends Sb{nextDataId(){return cm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new oI(this,Mo())}write(e,n,s){this.firstUse&&(this.firstUse=!1,Q().get("IS_NODE")&&Ts(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const o={id:this.nextDataId()};return this.data.set(o,{values:e,dtype:s,refCount:1}),o}makeTensorInfo(e,n,s){let o;if(n==="string"&&s!=null&&s.length>0&&du(s[0])){const r=s.map(i=>ni(i));o=this.write(r,e,n)}else o=this.write(s,e,n);return{dataId:o,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,o,r){this.data.set(e,{values:n,dtype:o,refCount:r})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const o=this.readSync(s.real.dataId),r=this.readSync(s.imag.dataId);return Ir(o,r)}return fP(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(o=>ai(o));return et(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return et(e.shape,e.dtype,n)}makeOutput(e,n,s){return Mo().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Yn();return e(),{kernelMs:Yn()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ne([e],"where");const n=this.readSync(e.dataId);return oH(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}cm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jN(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const rH=t=>{const{x:e}=t.inputs,n=t.backend;Ne(e,"abs");let s=new Float32Array(oe(e.shape));const o=n.data.get(e.dataId).values;return s=jN(o),n.makeOutput(s,e.shape,e.dtype)},iH={kernelName:Vf,backendName:"cpu",kernelFunc:rH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(t){return(e,n,s,o,r)=>{const i=qe(e,n),a=i.length,l=Ae(i),c=oe(i),u=An(r,c),d=e.length,h=n.length,f=Ae(e),p=Ae(n),m=ml(e,i),g=ml(n,i);if(m.length+g.length===0)for(let v=0;v<u.length;++v)u[v]=t(s[v%s.length],o[v%o.length]);else for(let v=0;v<u.length;++v){const b=Pl(v,a,l),y=b.slice(-d);m.forEach(S=>y[S]=0);const x=Ko(y,d,f),w=b.slice(-h);g.forEach(S=>w[S]=0);const k=Ko(w,h,p);u[v]=t(s[x],o[k])}return[u,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ds(t){const{inputs:e,backend:n}=t,{real:s,imag:o}=e,r=n.data.get(s.dataId).values,i=n.data.get(o.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",r),imag:n.makeTensorInfo(o.shape,"float32",i)},a}const aH={kernelName:Mb,backendName:"cpu",kernelFunc:ds};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qh(t,e,n="float32"){if(n==="complex64"){const o=Qh(t,e,"float32"),r=Qh(t,e,"float32");return ds({inputs:{real:o,imag:r},backend:t})}const s=Rn(oe(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function or(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const lH={kernelName:Ru,backendName:"cpu",kernelFunc:or};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pa(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.data.get(s.dataId).complexTensorInfos.real,r=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,r)}const cH={kernelName:ay,backendName:"cpu",kernelFunc:pa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KN(t,e,n,s){if(s==="int32"){const o=Int32Array.from(t);return[e,"int32",o]}if(s==="bool"){const o=wa([0],n),[r,i]=Xt((a,l)=>a!==l?1:0)(e,[],t,o,"bool");return[i,"bool",r]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function hi(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dtype:r}=s;if(r==="complex64"){if(o.dtype==="complex64")return or({inputs:{x:o},backend:n});const u=Qh(n,o.shape,o.dtype),d=hi({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),h=ds({inputs:{real:d,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),h}if(o.dtype==="complex64"){const u=pa({inputs:{input:o},backend:n}),d=hi({inputs:{x:u},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(u),d}if(!aI(o.dtype,r)){const u=or({inputs:{x:o},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:r}}const i=n.data.get(o.dataId).values,[a,l,c]=KN(i,o.shape,o.dtype,r);return n.makeTensorInfo(a,l,c)}const uH={kernelName:yu,backendName:"cpu",kernelFunc:hi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cn(t,e,n,s){return n==null?({inputs:o,backend:r})=>{const{a:i,b:a}=o,l=r;Ne([i,a],t);const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=i.dtype==="string"?$r(c):c,h=i.dtype==="string"?$r(u):u,f=s||i.dtype,[p,m]=e(i.shape,a.shape,d,h,f);return l.makeTensorInfo(m,f,p)}:({inputs:o,backend:r})=>{const{a:i,b:a}=o,l=r;if(i.dtype==="complex64"||a.dtype==="complex64"){const c=hi({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,p=l.data.get(h.dataId).values,m=hi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),v=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,y=l.data.get(v.dataId).values,x=l.data.get(b.dataId).values,[w,k,S]=n(i.shape,a.shape,f,p,y,x),C=l.makeTensorInfo(S,"float32",w),$=l.makeTensorInfo(S,"float32",k),T=ds({inputs:{real:C,imag:$},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(C),l.disposeIntermediateTensorInfo($),T}else{const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=s||i.dtype,[h,f]=e(i.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,h)}}}function Hx(t){return(e,n,s,o,r,i)=>{const a=qe(e,n),l=oe(a),c=a.length,u=Ae(a),d=An("float32",l),h=An("float32",l),f=ml(e,a),p=ml(n,a),m=Ir(s,o),g=Ir(r,i),v=e.length,b=Ae(e),y=n.length,x=Ae(n);if(f.length+p.length===0)for(let w=0;w<d.length;w++){const k=w%m.length,S=w%g.length,C=t(m[k*2],m[k*2+1],g[S*2],g[S*2+1]);d[w]=C.real,h[w]=C.imag}else for(let w=0;w<d.length;w++){const k=Pl(w,c,u),S=k.slice(-v);f.forEach(_=>S[_]=0);const C=Ko(S,v,b),$=k.slice(-y);p.forEach(_=>$[_]=0);const T=Ko($,y,x),E=t(m[C*2],m[C*2+1],g[T*2],g[T*2+1]);d[w]=E.real,h[w]=E.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qN=Xt((t,e)=>t+e),dH=Hx((t,e,n,s)=>({real:t+n,imag:e+s})),yl=cn(Ml,qN,dH),hH={kernelName:Ml,backendName:"cpu",kernelFunc:yl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jx(t,e,n,s,o){const r=oe(s),i=Rn(o,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(r>0?i[l]+=e[a]:i[l]+=1)}return i}function XN(t,e,n,s=!1){const o=t.shape[0],r=t.shape[1],i=et([o,n],e.dtype);for(let a=0;a<o;a++)for(let l=0;l<r;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?i.set(1,a,c):e.size>0?i.set(i.get(a,c)+e.get(a,l),a,c):i.set(i.get(a,c)+1,a,c))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YN=Xt((t,e)=>t&e),fH=cn(Pb,YN),pH={kernelName:Pb,backendName:"cpu",kernelFunc:fH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cr(t){return(e,n,s)=>{const o=Ut(n,e.length);for(let r=0;r<e.length;++r)o[r]=t(e[r],s);return o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bt(t,e,n){const s=cr(e);return Si(t,s,n)}function Si(t,e,n){return({inputs:s,attrs:o,backend:r})=>{const{x:i}=s;Ne(i,t);const a=r,l=a.data.get(i.dataId).values;let c;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=$r(l)}else c=l;const u=n||i.dtype,d=e(c,u,o);return a.makeTensorInfo(i.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZN=cr(t=>Math.ceil(t)),mH=Si(xu,ZN),gH={kernelName:xu,backendName:"cpu",kernelFunc:mH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QN(t,e,n,s){const o=Ut(n,oe(e));if(s&&n!=="string"){let r=0;t.forEach(i=>{const a=oe(i.shape);o.set(i.vals,r),r+=a})}else{let r=0;t.forEach(i=>{const a=n==="string"?$r(i.vals):i.vals;let l=0;for(let c=0;c<i.shape[0];++c){const u=c*e[1]+r;for(let d=0;d<i.shape[1];++d)o[u+d]=a[l++]}r+=i.shape[1]})}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JN=Xt((t,e)=>t===e?1:0),eE=cn(tp,JN,null,"bool"),vH={kernelName:tp,backendName:"cpu",kernelFunc:eE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tE=cr(t=>Math.exp(t)),nE=Si(Tu,tE,"float32"),bH={kernelName:Tu,backendName:"cpu",kernelFunc:nE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sE=cr(t=>Math.expm1(t)),yH=Si(Nu,sE),xH={kernelName:Nu,backendName:"cpu",kernelFunc:yH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oE=cr(t=>Math.floor(t)),wH=Si(Eu,oE),CH={kernelName:Eu,backendName:"cpu",kernelFunc:wH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rE=Xt((t,e)=>Math.floor(t/e)),kH=cn(_u,rE,null,"int32"),SH={kernelName:_u,backendName:"cpu",kernelFunc:kH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iE(t,e,n,s,o,r,i,a,l){const c=et([s,r],n);for(let u=0;u<s;u++){const d=[];let h=0;for(let f=0;f<o;f++){const p=t[u*o+f];h+=p*i[f],d.push(p)}if(h<0||h>=l/r)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let f=0;f<r;f++)c.values[u*r+f]=e.get(...e.indexToLoc(h*r+f))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aE(t,e,n){const s=et(n,t.dtype);for(let o=0;o<s.size;++o){const i=s.indexToLoc(o).slice(),a=i[0],l=i[2],c=e.locToIndex([a,l]);i[2]=e.values[c];const u=t.locToIndex(i);0<=u&&u<t.values.length&&(s.values[o]=t.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lE=Xt((t,e)=>t>e?1:0),IH=cn(rp,lE,null,"bool"),$H={kernelName:rp,backendName:"cpu",kernelFunc:IH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cE=Xt((t,e)=>t>=e?1:0),TH=cn(Au,cE,null,"bool"),NH={kernelName:Au,backendName:"cpu",kernelFunc:TH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uE=Xt((t,e)=>t<e?1:0),EH=cn(ap,uE,null,"bool"),_H={kernelName:ap,backendName:"cpu",kernelFunc:EH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dE=Xt((t,e)=>t<=e?1:0),AH=cn(lp,dE,null,"bool"),RH={kernelName:lp,backendName:"cpu",kernelFunc:AH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hE(t,e,n){const s=(e-t)/(n-1),o=Rn(n,"float32");o[0]=t;for(let r=1;r<o.length;r++)o[r]=o[r-1]+s;return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fE=cr(t=>Math.log(t)),DH=Si(Pu,fE),FH={kernelName:Pu,backendName:"cpu",kernelFunc:DH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pE(t,e,n,s){const o=An(s,oe(n));for(let r=0;r<o.length;++r){const i=r*e;let a=t[i];for(let l=0;l<e;++l){const c=t[i+l];(Number.isNaN(c)||c>a)&&(a=c)}o[r]=a}return o}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mE=Xt((t,e)=>Math.max(t,e)),OH=cn(Lu,mE),PH={kernelName:Lu,backendName:"cpu",kernelFunc:OH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gE=Xt((t,e)=>Math.min(t,e)),MH=cn(Bu,gE),LH={kernelName:Bu,backendName:"cpu",kernelFunc:MH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kx=Xt((t,e)=>t*e),BH=Hx((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),um=cn(zu,Kx,BH),VH={kernelName:zu,backendName:"cpu",kernelFunc:um};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vE(t,e,n){const s=vi(-1,n);return Kx([],e,s,t,n)}function zH(t){const{inputs:e,backend:n}=t,{x:s}=e;Ne(s,"neg");const o=n.data.get(s.dataId).values,[r,i]=vE(o,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,r)}const WH={kernelName:yp,backendName:"cpu",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bE=Xt((t,e)=>t!==e?1:0),UH=cn(xp,bE,null,"bool"),GH={kernelName:xp,backendName:"cpu",kernelFunc:UH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qx(t,e,n,s,o){const r=e.length,i=oe(e),a=Ae(e),l=Ae(o),c=An(n,oe(o));for(let u=0;u<i;++u){const d=Pl(u,r,a),h=new Array(d.length);for(let p=0;p<h.length;p++)h[p]=d[s[p]];const f=Ko(h,r,l);c[f]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(t){const{inputs:e,attrs:n,backend:s}=t,{x:o}=e,{perm:r}=n;Ne(o,"transpose");const i=o.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=o.shape[r[d]];const l=s.data.get(o.dataId).values,c=qx(l,o.shape,o.dtype,r,a);return{dataId:s.write(c,a,o.dtype),shape:a,dtype:o.dtype}}const HH={kernelName:ol,backendName:"cpu",kernelFunc:rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yE(t,e,n,s){const[o,r]=bn(t,s),i=vs(e,"int32"),a=Rn(oe(o),i),l=oe(r);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let h=0;h<l;++h)d*=n[u+h];a[c]=d}return{outVals:a,outShape:o,outDtype:i}}function jH(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Ne(o,"prod");const a=o.shape.length,l=tt(r,o.shape),c=Lt(l,a);let u=l,d=o;const h=[];c!=null&&(d=rs({inputs:{x:o},backend:n,attrs:{perm:c}}),h.push(d),u=Kt(u.length,a));const f=n.data.get(d.dataId).values,{outVals:p,outShape:m,outDtype:g}=yE(d.shape,d.dtype,f,u);let v=m;return i&&(v=Jt(m,l)),h.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(v,g,p)}const KH={kernelName:$p,backendName:"cpu",kernelFunc:jH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(t,e,n){t.forEach((s,o)=>{if(s<0||s>=n){const r=Pl(o,e.length,Ae(e)).join(",");throw new Error(`indices[${r}] = ${s} is not in [0, ${n})`)}})}function XH(t,e){for(let n=0;n<t.length;++n){const s=t[n],o=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>o)throw new Error("Ragged splits must not point past values");for(let r=1;r<s.length;++r)if(s[r-1]>s[r])throw new Error("Ragged splits must be sorted in ascending order")}}function YH(t,e,n,s){const o=[];let r=0;const i=e.length-1+n.length,a=new Array(i).fill(null).map(()=>[0]);XH(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<t.length;++c){let u=t[c],d=t[c]+1;for(let h=0;h<n.length;++h){const f=n[h],p=h+e.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-f[u];for(let v=u;v<d;++v)a[p].push(f[v+1]+g)}u=f[u],d=f[d]}d!==u&&(o.push([u,d]),r+=d-u)}return{outSplits:a,valueSlices:o,numValues:r}}function ZH(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,o=Ut("int32",s);e.push(o),t[n].forEach((r,i)=>o[i]=r)}return e}function Gw(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function QH(t,e,n,s,o,r){const i=Gw(e,2)[1],a=Gw(r,2)[1];let l=0;for(const c of n)for(let u=c[0];u<c[1];++u){for(let d=0;d<s;++d)o[l*a+d]=t[u*i+d];++l}}function JH(t,e,n,s,o){const r=e.slice();r[0]=o;const i=Ut(n,oe(r)),a=t.length,l=a===0?0:a/e[0];return QH(t,e,s,l,i,r),[i,r]}function xE(t,e,n,s,o,r,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(qH(r,i,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:u,valueSlices:d,numValues:h}=YH(r,i,t,c),f=ZH(u),p=JH(n,s,o,d,h);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hw=2147483647;function wE(t,e,n,s,o,r,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=o.length===0,c=i.length===0,u=[];a||u.push(e[0]),l||u.push(o[0]),c||u.push(i[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],h=Ut("int32",d+1);h[0]=0;for(let g=0;g<d;++g){const v=a?t[0]:t[g],b=l?s[0]:s[g],y=c?r[0]:r[g];if(y===0)throw new Error("Requires delta != 0");let x;if(y>0&&b<v||y<0&&b>v)x=0;else if(x=Math.ceil(Math.abs((b-v)/y)),x>Hw)throw new Error(`Requires ((limit - start) / delta) <= ${Hw}`);h[g+1]=h[g]+x}const f=h[d],p=Ut(n,f);let m=0;for(let g=0;g<d;++g){const v=h[g+1]-h[g];let b=a?t[0]:t[g];const y=c?r[0]:r[g];for(let x=0;x<v;++x)p[m++]=b,b+=y}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Vs=fo;class Jh{constructor(e,n,s,o,r,i,a,l,c,u){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=o,this.valuesDType=r,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=l2(u),this.raggedRank=c2(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Vs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Vs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Vs.VALUE_ROWIDS:return Jh.getMaxWidthValueRowID(n);case Vs.ROW_SPLITS:return Jh.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Vs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let o=0;o<n-1;++o){const r=e[o+1]-e[o];r>s&&(s=r)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,o=e[0],r=0;for(let i=1;i<n;++i){const a=e[i];a!==o&&(o=a,r=Math.max(i-s,r),s=i)}return Math.max(n-s,r)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Kw(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;u2(s,n);const o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=a2(this.raggedRank,o,n);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,n,s){const o=Math.min(e,s),r=[];let i=0;for(let a=0;a<o;++a,i+=n)r.push(i);for(let a=o;a<e;++a)r.push(-1);return N(r.length===e,()=>"Final length of result must be equal to firstDimension."),r}calculateOutputIndexRowSplit(e,n,s,o){const r=e.length,i=[];for(let a=0;a<r-1;++a){const l=e[a+1]-e[a];let c=Math.min(o,l),u=n[a];u===-1&&(c=0);for(let d=0;d<c;++d)i.push(u),u+=s;for(let d=0;d<l-c;++d)i.push(-1)}if(r>0&&i.length!==e[r-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,n,s,o){const r=e.length,i=[];if(r===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];i.push(c);for(let u=1;u<r;++u){const d=e[u];if(d===l)c>=0&&(++a,a<o?c+=s:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}i.push(c)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,n,s,o){const r=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Vs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(r,n,s,o);case Vs.ROW_SPLITS:if(r.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${r.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(r,n,s,o);default:throw new Error(`Unsupported partition type: ${Vs[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Vs.FIRST_DIM_SIZE:return e[0];case Vs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Vs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Vs[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*s[l+1];const r=Kw(s,!1),i=Ut(this.valuesDType,oe(r));if(o[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,o[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,o[c],s[c]);this.setOutput(this.raggedRank,l,i,r)}return[r,i]}setOutput(e,n,s,o){if(s.length===0)return;const r=this.values,i=s;let a=o.slice();a=a.slice(e+1);const l=oe(a),c=n.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const p=this.defaultValueShape;Z(()=>{const m=K(u,p);u=$c(m,a).dataSync()})}let d=0,h=0,f=0;for(let p=0;p<=c;++p){let m=p<c?n[p]:-1;if(m===f){++f;continue}if(h<f){const g=r.subarray(d*l),v=i.subarray(h*l),b=(f-h)*l;jw(v,g,b)}if(p>=c){const g=s.length;m=Math.floor(g/l)}if(m>f)if(this.defaultValue.length===1)i.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){const g=i.slice(f*l);jw(g,u,l),++f}m<0?(d=p+1,h=f):(d=p,h=f,f=h+1)}}}function jw(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function Kw(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function CE(t,e,n,s,o,r,i,a,l,c){return new Jh(t,e,n,s,o,r,i,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kE(t,e,n,s){const o=t===e,r=t<e&&n<0,i=e<t&&n>1;if(o||r||i)return Rn(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=Rn(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SE=cr(t=>1/Math.sqrt(t)),e6=Si(Ku,SE),t6={kernelName:Ku,backendName:"cpu",kernelFunc:e6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qi(t,e,n,s,o,r,i,a,l,c){const u=[s/o,o],d=t.values,h=e.values;if(s===0)return et(n,e.dtype);const f=l instanceof In?l:et(u,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<r;p++){const m=[];let g=0;for(let v=0;v<i;v++){const b=d[p*i+v];m.push(b),g+=b*a[v]}if(g<0||g>=s/o)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let v=0;v<o;v++)c?f.values[g*o+v]+=h[p*o+v]:f.values[g*o+v]=e.rank===0?h[0]:h[p*o+v]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n6=cr(t=>1/(1+Math.exp(-t))),IE=bt(Qu,t=>1/(1+Math.exp(-t))),s6={kernelName:Qu,backendName:"cpu",kernelFunc:IE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $E(t,e,n,s,o){const r=tx(s,e,n),i=oe(n),a=Ae(s);if(r){const d=nx(e,a);return o==="string"?t.slice(d,d+i):t.subarray(d,d+i)}const l=o==="string"?$r(t):t,c=et(s,o,l),u=et(n,o);for(let d=0;d<u.size;++d){const h=u.indexToLoc(d),f=h.map((p,m)=>p+e[m]);u.set(c.get(...f),...h)}return o==="string"?_2(u.values):u.values}function ma(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,size:i}=s;Ne(o,"slice");const[a,l]=Xp(o,r,i);Jy(o,a,l);const c=n.data.get(o.dataId).values,u=$E(c,a,l,o.shape,o.dtype);return n.makeTensorInfo(l,o.dtype,u)}const o6={kernelName:Rp,backendName:"cpu",kernelFunc:ma};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TE(t,e,n,s,o,r,i){const a=e[0],l=r[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(v2(a));const g=Ut(n,0),v=Ut(o,0);return[g,[0,d],v,c,u]}let h=!0,f=0;const p=new Array(l).fill(0);for(let g=0;g<a;++g){const v=t[g*d];if(v<0)throw new Error(b2(g,v));if(v>=l)throw new Error(y2(g,v,l));++p[v],h=h&&v>=f,f=v}let m=!0;for(let g=0;g<l;++g){const v=p[g]===0;c[g]=v,m=m&&!v,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&h){const g=t,v=s;for(let b=0;b<a;++b)u[b]=b;return[g,[a,d],v,c,u]}else{const g=p[l-1],v=Ut(n,g*d),b=Ut(o,g),y=new Array(l).fill(0);for(let x=0;x<a;++x){const w=t[x*d],k=y[w],S=(w===0?0:p[w-1])+k;y[w]++;for(let C=0;C<d;++C)v[S*d+C]=t[x*d+C];b[S]=s[x],u[x]=S}for(let x=0;x<l;++x)if(y[x]===0){const k=x===0?0:p[x-1];v[k*d+0]=x;for(let S=1;S<d;++S)v[k*d+S]=0;b[k]=i}return[v,[g,d],b,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NE(t,e,n,s,o){const r=oe(s),i=e[0],a=o.length,l=[];let c=1,u=-1;for(let g=0;g<a;++g){const v=o[g];if(v===-1){if(u!==-1)throw new Error(x2(u,g));u=g,l.push(1)}else{if(v<0)throw new Error(w2(g,v));c*=v,l.push(v)}}if(u!==-1){if(c<=0)throw new Error(C2());const g=Math.trunc(r/c);if(c*g!==r)throw new Error(k2(s,l));l[u]=g}if(oe(l)!==r)throw new Error(S2(s,l));const h=s.length,f=[];if(h>0){f[h-1]=1;for(let g=h-2;g>=0;--g)f[g]=f[g+1]*s[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*l[g+1]}const m=Ut(n,i*a);for(let g=0;g<i;++g){let v=0;for(let b=0;b<h;++b)v+=t[g*h+b]*f[b];for(let b=0;b<a;++b)m[g*a+b]=Math.trunc(v/p[b]),v%=p[b]}return[m,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xx(t,e,n,s,o,r=!1,i=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?o[a-1]+1:0;if(d<0)throw new Error(iv());const h=e.slice();h[0]=d;const f=h.reduce((y,x)=>y*x,1),p=Ut(n,f);if(a===0)return d>0&&p.fill(i),[p,h];if(d<=0)throw new Error(iv());let m=0,g=1,v=0,b=o[m];for(;;){let y=0;if(g<a){if(y=o[g],b===y){++g;continue}if(b>=y)throw new Error(I2())}if(b<0||b>=d)throw new Error($2(b,d));b>v&&p.fill(i,v*c,b*c);for(let x=m;x<g;++x){const w=s[x];if(w<0||w>=l[0])throw new Error(T2(x,s[x],l[0]));for(let k=0;k<c;k++)p[b*c+k]+=t[w*c+k]}if(r)for(let x=0;x<c;x++)p[b*c+x]/=g-m;if(m=g,++g,v=b+1,b=y,g>a)break}return v<d&&p.fill(i,v*c,d*c),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r6=cr(t=>Math.sqrt(t)),i6=bt(ed,t=>Math.sqrt(t)),a6={kernelName:ed,backendName:"cpu",kernelFunc:i6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EE=Xt((t,e)=>{const n=t-e;return n*n}),l6=cn(td,EE),c6={kernelName:td,backendName:"cpu",kernelFunc:l6};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _E=cr((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:o}=e;return t.replace(new RegExp(n,s?"g":""),o)}),u6=Si(dy,_E),d6={kernelName:dy,backendName:"cpu",kernelFunc:u6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AE(t,e,n,s){const o=et(t,e.dtype);for(let r=0;r<o.size;r++){const i=o.indexToLoc(r),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*n[l]+s[l];o.set(e.get(...a),...i)}return o}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h6{constructor(e,n,s,o,r,i){this.separator=ni(e),this.nGramWidths=n,this.leftPad=ni(s),this.rightPad=ni(o),this.padWidth=r,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,o,r,i){for(let a=0;a<r;++a){const l=this.getPadWidth(i),c=Math.max(0,l-a),u=Math.max(0,l-(r-(a+1))),d=i-(c+u),h=n+(c>0?0:a-l);let f=0;f+=c*this.leftPad.length;for(let b=0;b<d;++b)f+=e[h+b].length;f+=u*this.rightPad.length;const p=c+u+d-1;f+=p*this.separator.length,s[o+a]=new Uint8Array(f);const m=s[o+a];let g=0;const v=b=>b.forEach(y=>m[g++]=y);for(let b=0;b<c;++b)v(this.leftPad),v(this.separator);for(let b=0;b<d-1;++b)v(e[h+b]),v(this.separator);if(d>0){v(e[h+d-1]);for(let b=0;b<u;++b)v(this.separator),v(this.rightPad)}else{for(let b=0;b<u-1;++b)v(this.rightPad),v(this.separator);v(this.rightPad)}}}compute(e,n){const s=e.length,o=n.length;if(o>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<o;++c){let u=n[c]>=l;if(u=u&&n[c]<=s,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const r=o-1,i=Ut("int32",o);if(s===0||o===0){const l=new Array(s);for(let c=0;c<=r;++c)i[c]=0;return[l,i]}i[0]=0;for(let l=1;l<=r;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),i[l]=i[l-1]+u}const a=new Array(i[r]);for(let l=0;l<r;++l){const c=n[l];let u=i[l];if(this.nGramWidths.forEach(d=>{const h=n[l+1]-n[l],f=this.getNumNGrams(h,d);this.createNGrams(e,c,a,u,f,d),u+=f}),this.preserveShort&&u===i[l]){const d=n[l+1]-n[l];if(d===0)continue;const h=d+2*this.padWidth,f=1;this.createNGrams(e,c,a,u,f,h)}}return[a,i]}}function RE(t,e,n,s,o,r,i,a){return new h6(n,s,o,r,i,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f6(t,e,n,s){if(!t.length)return;if(e.length===0){for(let r=0;r<t.length;++r)s.push(t.subarray(r,r+1));return}if(e.length===1){const r=e[0];let i=t.indexOf(r);for(;i!==-1;){const a=t.subarray(0,i);(!n||a.length!==0)&&s.push(a),t=t.subarray(i+1),i=t.indexOf(r)}(!n||t.length!==0)&&s.push(t);return}let o=0;for(let r=0;r<t.length+1;r++)if(r===t.length||e.indexOf(t[r])!==-1){const i=t.subarray(o,r);(!n||i.length!==0)&&s.push(i),o=r+1}}function DE(t,e,n){const s=t.length,o=[];let r=0,i=0;const a=new Array(s);for(let h=0;h<s;++h){const f=o.length;f6(t[h],e,n,o);const p=o.length-f;a[h]=p,r+=p,i=Math.max(i,p)}const l=Ut("int32",r*2),c=new Array(r),u=[s,i];let d=0;for(let h=0;h<s;++h)for(let f=0;f<a[h];++f)l[d*2]=h,l[d*2+1]=f,c[d]=o[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FE(t,e){const n=Ut("int32",t.length);for(let s=0;s<t.length;++s)n[s]=DP(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OE=Xt((t,e)=>t-e),p6=Hx((t,e,n,s)=>({real:t-n,imag:e-s})),Yx=cn(nd,OE,p6),m6={kernelName:nd,backendName:"cpu",kernelFunc:Yx};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PE(t,e){const n=new Array(t.rank);for(let o=0;o<n.length;o++)n[o]=t.shape[o]*e[o];const s=et(n,t.dtype);for(let o=0;o<s.values.length;++o){const r=s.indexToLoc(o),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=r[l]%t.shape[l];const a=t.locToIndex(i);s.values[o]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yc=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function ME(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),h=Math.max(n,Math.floor(e-l*u/a+d)),f=Math.min(s,Math.floor(e+(a-l)*u/a+d));ME(t,e,h,f)}const o=t[e];let r=n,i=s;for(Ka(t,n,e),yc(t[s],o)>0&&Ka(t,n,s);r<i;){for(Ka(t,r,i),r++,i--;yc(t[r],o)<0;)r=r+1;for(;yc(t[i],o)>0;)i=i-1}yc(t[n],o)===0?Ka(t,n,i):(i=i+1,Ka(t,i,s)),i<=e&&(n=i+1),e<=i&&(s=i-1)}}function LE(t,e,n,s,o){const r=e[e.length-1],[i,a]=[t.length/r,r],l=An(n,i*s),c=An("int32",i*s);for(let d=0;d<i;d++){const h=d*a,f=t.subarray(h,h+a);let p=new Array(f.length);f.forEach((b,y)=>p[y]={value:b,index:y}),s<p.length&&(ME(p,s),p=p.slice(0,s)),o&&p.sort(yc);const m=d*s,g=l.subarray(m,m+s),v=c.subarray(m,m+s);for(let b=0;b<s;b++)g[b]=p[b].value,v[b]=p[b].index}const u=e.slice();return u[u.length-1]=s,[et(u,n,l),et(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BE(t,e,n,s){const o=tt(e,n)[0],r=[1,n[0],1];for(let p=0;p<o;p++)r[0]*=n[p];r[1]=n[o];for(let p=o+1;p<n.length;p++)r[2]*=n[p];const i=new Map,a=new Int32Array(n[o]),l=new In(r,s,t),c=[],u=r[0]===1&&r[2]===1;for(let p=0;p<n[o];p++){let m;if(u)m=t[p].toString();else{const v=[];for(let b=0;b<r[0];b++)for(let y=0;y<r[2];y++)v.push(l.get(b,p,y));m=v.join(",")}const g=i.get(m);if(g!=null)a[p]=g;else{const v=i.size;i.set(m,v),a[p]=v,c.push(p)}}const d=r.slice();d[1]=i.size;const h=new In(d,s);c.forEach((p,m)=>{for(let g=0;g<r[0];g++)for(let v=0;v<r[2];v++)h.set(l.get(g,p,v),g,m,v)});const f=n.slice();return f[o]=d[1],{outputValues:h.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6=Object.freeze(Object.defineProperty({__proto__:null,simpleAbsImpl:jN,addImpl:qN,bincountImpl:jx,bincountReduceImpl:XN,bitwiseAndImpl:YN,castImpl:KN,ceilImpl:ZN,concatImpl:QN,equalImpl:JN,expImpl:tE,expm1Impl:sE,floorImpl:oE,floorDivImpl:rE,gatherNdImpl:iE,gatherV2Impl:aE,greaterImpl:lE,greaterEqualImpl:cE,lessImpl:uE,lessEqualImpl:dE,linSpaceImpl:hE,logImpl:fE,maxImpl:pE,maximumImpl:mE,minimumImpl:gE,multiplyImpl:Kx,negImpl:vE,notEqualImpl:bE,prodImpl:yE,raggedGatherImpl:xE,raggedRangeImpl:wE,raggedTensorToTensorImpl:CE,rangeImpl:kE,rsqrtImpl:SE,scatterImpl:qi,sigmoidImpl:n6,sliceImpl:$E,sparseFillEmptyRowsImpl:TE,sparseReshapeImpl:NE,sparseSegmentReductionImpl:Xx,sqrtImpl:r6,squaredDifferenceImpl:EE,staticRegexReplaceImpl:_E,stridedSliceImpl:AE,stringNGramsImpl:RE,stringSplitImpl:DE,stringToHashBucketFastImpl:FE,subImpl:OE,tileImpl:PE,topKImpl:LE,transposeImpl:qx,uniqueImpl:BE},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */r$("cpu",()=>new cm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VE=bt(Iu,t=>t>=0?t:Math.exp(t)-1),v6={kernelName:Iu,backendName:"cpu",kernelFunc:VE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{alpha:r}=s;Ne([o],"leakyRelu");const i=oe(o.shape),a=n.data.get(o.dataId).values,l=An("float32",i);for(let c=0;c<a.length;c++)l[c]=a[c]<0?r*a[c]:a[c];return n.makeTensorInfo(o.shape,"float32",l)}const b6={kernelName:ip,backendName:"cpu",kernelFunc:zE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y6=Xt((t,e)=>t<0?e*t:t);function WE(t){const{inputs:e,backend:n}=t,{x:s,alpha:o}=e;Ne([s,o],"prelu");const r=n.data.get(s.dataId).values,i=n.data.get(o.dataId).values,[a,l]=y6(s.shape,o.shape,r,i,"float32");return n.makeTensorInfo(l,"float32",a)}const x6={kernelName:Ip,backendName:"cpu",kernelFunc:WE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UE=bt(Gu,t=>Math.max(0,t)),w6={kernelName:Gu,backendName:"cpu",kernelFunc:UE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GE=bt(Hu,t=>Math.min(Math.max(0,t),6)),C6={kernelName:Hu,backendName:"cpu",kernelFunc:GE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ef(t,e,n,s,o){if(n==="linear")return or({inputs:{x:e},backend:t});if(n==="relu")return UE({inputs:{x:e},backend:t});if(n==="elu")return VE({inputs:{x:e},backend:t});if(n==="relu6")return GE({inputs:{x:e},backend:t});if(n==="prelu")return WE({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return zE({inputs:{x:e},backend:t,attrs:{alpha:o}});if(n==="sigmoid")return IE({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tt(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{shape:r}=s,i=oe(o.shape),a=iI(r,i),l=oe(a);N(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(o.dataId);const c=n.data.get(o.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}const k6={kernelName:Tp,backendName:"cpu",kernelFunc:Tt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HE(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r}=e,{transposeA:i,transposeB:a}=s;Ne([o,r],"matMul");const l=o.shape.length,c=r.shape.length,u=i?o.shape[l-2]:o.shape[l-1],d=a?r.shape[c-1]:r.shape[c-2],h=i?o.shape[l-1]:o.shape[l-2],f=a?r.shape[c-2]:r.shape[c-1],p=o.shape.slice(0,-2),m=r.shape.slice(0,-2),g=oe(p),v=oe(m),y=qe(o.shape.slice(0,-2),r.shape.slice(0,-2)).concat([h,f]);N(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${r.shape} and transposeA=${i} and transposeB=${a} must match.`);const x=i?[g,u,h]:[g,h,u],w=a?[v,f,d]:[v,d,f],k=Tt({inputs:{x:o},backend:n,attrs:{shape:x}}),S=Tt({inputs:{x:r},backend:n,attrs:{shape:w}}),C=i?k.shape[1]:k.shape[2],$=i?k.shape[2]:k.shape[1],T=a?S.shape[1]:S.shape[2],E=Math.max(g,v),_=n.data.get(k.dataId).values,A=n.data.get(S.dataId).values,O=Ae(k.shape),B=Ae(S.shape),[F,V,D]=i?[O[0],1,O[1]]:[O[0],O[1],1],[U,J,X]=a?[1,B[1],B[0]]:[B[1],1,B[0]],te=$*T,ie=et([E,$,T],k.dtype),ue=ie.values,ce=n.blockSize;for(let Y=0;Y<E;Y++){const z=Y%g,ae=Y%v;for(let re=0;re<$;re+=ce){const he=Math.min(re+ce,$);for(let Ce=0;Ce<T;Ce+=ce){const R=Math.min(Ce+ce,T);for(let P=0;P<C;P+=ce){const j=Math.min(P+ce,C);for(let ee=re;ee<he;ee++)for(let se=Ce;se<R;se++){let le=0;for(let me=P;me<j;me++){const ve=_[z*F+ee*V+me*D],ge=A[me*U+se*J+ae*X];le+=ve*ge}ue[Y*te+(ee*T+se)]+=le}}}}}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(S),n.makeTensorInfo(y,ie.dtype,ie.values)}const S6={kernelName:Hf,backendName:"cpu",kernelFunc:HE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I6(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;let h,f,p;const m=[];h=HE({inputs:{a:o,b:r},attrs:{transposeA:l,transposeB:c},backend:n}),i&&(f=yl({inputs:{a:h,b:i},backend:n}),m.push(h),h=f),u&&(p=ef(n,h,u,a,d),m.push(h),h=p);for(const v of m)n.disposeIntermediateTensorInfo(v);return h}const $6={kernelName:Ah,backendName:"cpu",kernelFunc:I6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T6=bt(hu,t=>Math.acos(t)),N6={kernelName:hu,backendName:"cpu",kernelFunc:T6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E6=bt(fu,t=>Math.acosh(t)),_6={kernelName:fu,backendName:"cpu",kernelFunc:E6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A6(t){const{inputs:e,backend:n}=t,s=e;Ne(e,"addN");const o=s.map(a=>n.data.get(a.dataId).values),r=et(s[0].shape,s[0].dtype),i=r.values;for(let a=0;a<s.length;a++){const l=o[a];for(let c=0;c<i.length;c++)i[c]+=l[c]}return n.makeTensorInfo(r.shape,r.dtype,r.values)}const R6={kernelName:_b,backendName:"cpu",kernelFunc:A6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D6(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Ne(o,"all");const a=tt(r,o.shape);let l=a;const c=Lt(l,o.shape.length);let u=o;c!=null&&(u=rs({inputs:{x:o},backend:n,attrs:{perm:c}}),l=Kt(l.length,o.shape.length)),Nn("all",l,u.shape.length);const[d,h]=bn(u.shape,l),f=oe(h),p=Rn(oe(d),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const b=v*f;let y=m[b];for(let x=0;x<f;++x){const w=m[b+x];y=y&&w}p[v]=y}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(i){const v=Jt(d,a),b=Tt({inputs:{x:g},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(g),b}return g}const F6={kernelName:Ab,backendName:"cpu",kernelFunc:D6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O6(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Ne(o,"any");const a=tt(r,o.shape);let l=a;const c=Lt(l,o.shape.length);let u=o;c!=null&&(u=rs({inputs:{x:o},backend:n,attrs:{perm:c}}),l=Kt(l.length,o.shape.length)),Nn("any",l,u.shape.length);const[d,h]=bn(u.shape,l),f=oe(h),p=Rn(oe(d),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const b=v*f;let y=m[b];for(let x=0;x<f;++x){const w=m[b+x];y=y||w}p[v]=y}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(i){const v=Jt(d,a),b=Tt({inputs:{x:g},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(g),b}return g}const P6={kernelName:Rb,backendName:"cpu",kernelFunc:O6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;Ne(o,"argMax");let i=tt(r,o.shape);const a=Lt(i,o.shape.length);let l=o;const c=[];a!=null&&(l=rs({inputs:{x:o},backend:n,attrs:{perm:a}}),c.push(l),i=Kt(i.length,l.shape.length)),i=[i[0]],Nn("argMax",i,l.shape.length);const[u,d]=bn(l.shape,i),h=oe(u),f=Rn(h,"int32"),p=oe(d),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const v=g*p;let b=m[v],y=0;for(let x=0;x<p;++x){const w=m[v+x];w>b&&(b=w,y=x)}f[g]=y}return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(u,"int32",f)}const L6={kernelName:zf,backendName:"cpu",kernelFunc:M6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B6(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;Ne(o,"argMin");let i=tt(r,o.shape);const a=Lt(i,o.shape.length);let l=o;const c=[];a!=null&&(l=rs({inputs:{x:o},backend:n,attrs:{perm:a}}),c.push(l),i=Kt(i.length,l.shape.length)),i=[i[0]],Nn("argMin",i,l.shape.length);const[u,d]=bn(l.shape,i),h=oe(u),f=Rn(h,"int32"),p=oe(d),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const v=g*p;let b=m[v],y=0;for(let x=0;x<p;++x){const w=m[v+x];w<b&&(b=w,y=x)}f[g]=y}return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(u,"int32",f)}const V6={kernelName:Wf,backendName:"cpu",kernelFunc:B6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z6=bt(pu,t=>Math.asin(t)),W6={kernelName:pu,backendName:"cpu",kernelFunc:z6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U6=bt(mu,t=>Math.asinh(t)),G6={kernelName:mu,backendName:"cpu",kernelFunc:U6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H6=bt(gu,t=>Math.atan(t)),j6={kernelName:gu,backendName:"cpu",kernelFunc:H6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K6=Xt((t,e)=>Math.atan2(t,e)),q6=cn(bu,K6),X6={kernelName:bu,backendName:"cpu",kernelFunc:q6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y6=bt(vu,t=>Math.atanh(t)),Z6={kernelName:vu,backendName:"cpu",kernelFunc:Y6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zx(t,e,n,s,o,r){const i=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,h=o.padInfo.top,f=o.padInfo.left,p=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=et(o.outShape,n),g=m.values,v=o.outShape[1]*o.outShape[2]*o.outShape[3],b=o.outShape[2]*o.outShape[3],y=o.outShape[3];for(let x=0;x<o.batchSize;++x){const w=x*v,k=x*s[0];for(let S=0;S<o.inChannels;++S)for(let C=0;C<o.outHeight;++C){const $=C*i-h,T=Math.max(0,$),E=Math.min(o.inHeight,u+$),_=w+C*b;for(let A=0;A<o.outWidth;++A){const O=A*a-f,B=Math.max(0,O),F=Math.min(o.inWidth,d+O);let V=p,D=0,U=0;for(let X=T;X<E;X+=l){const te=k+X*s[1];for(let ie=B;ie<F;ie+=c){const ue=te+ie*s[2],ce=t[ue+S];r==="max"&&ce>V?V=ce:r==="avg"&&(D+=ce,U++)}if(isNaN(V))break}const J=_+A*y+S;g[J]=r==="avg"?D/U:V}}}return m}function jE(t,e,n,s,o=!1,r=!1){const i=et(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,m=et(e,n,t);for(let g=0;g<s.batchSize;++g)for(let v=0;v<s.inChannels;++v)for(let b=0;b<s.outHeight;++b){const y=b*a-f;let x=y;for(;x<0;)x+=c;const w=Math.min(s.inHeight,d+y);for(let k=0;k<s.outWidth;++k){const S=k*l-p;let C=S;for(;C<0;)C+=u;const $=Math.min(s.inWidth,h+S);let T=Number.NEGATIVE_INFINITY,E=-1;for(let _=x;_<w;_+=c){const A=_-y;for(let O=C;O<$;O+=u){const B=O-S,F=m.get(g,_,O,v);F>T&&(T=F,o?E=r?((g*s.inHeight+_)*s.inWidth+O)*s.inChannels+v:(_*s.inWidth+O)*s.inChannels+v:E=A*h+B)}}i.set(E,g,b,k,v)}}return i}function KE(t,e,n,s,o,r){const i=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,h=o.effectiveFilterDepth,f=o.effectiveFilterHeight,p=o.effectiveFilterWidth,m=o.padInfo.front,g=o.padInfo.top,v=o.padInfo.left,b=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=et(o.outShape,n),x=y.values,w=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],k=o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[3]*o.outShape[4],C=o.outShape[4];for(let $=0;$<o.batchSize;++$){const T=$*w,E=$*s[0];for(let _=0;_<o.inChannels;++_)for(let A=0;A<o.outDepth;++A){const O=A*i-m;let B=O;for(;B<0;)B+=c;const F=Math.min(o.inDepth,h+O),V=T+A*k;for(let D=0;D<o.outHeight;++D){const U=D*a-g;let J=U;for(;J<0;)J+=u;const X=Math.min(o.inHeight,f+U),te=V+D*S;for(let ie=0;ie<o.outWidth;++ie){const ue=ie*l-v;let ce=ue;for(;ce<0;)ce+=d;const Y=Math.min(o.inWidth,p+ue),z=te+ie*C;let ae=b,re=0,he=0;for(let R=B;R<F;R+=c){const P=E+R*s[1];for(let j=J;j<X;j+=u){const ee=P+j*s[2];for(let se=ce;se<Y;se+=d){const le=ee+se*s[3],me=t[le+_];if(r==="max"&&me>ae?ae=me:r==="avg"&&(re+=me,he++),isNaN(ae))break}if(isNaN(ae))break}if(isNaN(ae))break}const Ce=z+_;x[Ce]=r==="avg"?re/Math.max(he,1):ae}}}}return y}function Q6(t,e){const n=et(e.outShape,"int32"),s=e.strideDepth,o=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let v=0;v<e.outDepth;++v){const b=v*s-h;let y=b;for(;y<0;)y+=i;const x=Math.min(e.inDepth,c+b);for(let w=0;w<e.outHeight;++w){const k=w*o-f;let S=k;for(;S<0;)S+=a;const C=Math.min(e.inHeight,u+k);for(let $=0;$<e.outWidth;++$){const T=$*r-p;let E=T;for(;E<0;)E+=l;const _=Math.min(e.inWidth,d+T);let A=Number.NEGATIVE_INFINITY,O=-1;for(let B=y;B<x;B+=i){const F=B-b;for(let V=S;V<C;V+=a){const D=V-k;for(let U=E;U<_;U+=l){const J=U-T,X=t.get(m,B,V,U,g);X>=A&&(A=X,O=F*u*d+D*u+J)}}}n.set(O,m,v,w,$,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Ne(o,"avgPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,c=1;N(Dn(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=ro(o.shape,r,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&mt(u.inShape,u.outShape))d=or({inputs:{x:o},backend:n});else{const h=n.data.get(o.dataId).values,f=Ae(o.shape),p=Zx(h,o.shape,o.dtype,f,u,"avg");d=n.makeTensorInfo(u.outShape,o.dtype,p.values)}return d}const ej={kernelName:Uf,backendName:"cpu",kernelFunc:J6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=s;Ne(o,"avgPool3d");const u=Dr(o.shape,r,i,1,a,l,c),d=n.data.get(o.dataId).values,h=KE(d,o.shape,o.dtype,Ae(o.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const nj={kernelName:Gf,backendName:"cpu",kernelFunc:tj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sj(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=s;Ne([o,r],"avgPool3DGrad");const u=Dr(r.shape,i,a,1,l,c),d=u.strideDepth,h=u.strideHeight,f=u.strideWidth,p=u.filterDepth,m=u.filterHeight,g=u.filterWidth,v=u.dilationDepth,b=u.dilationHeight,y=u.dilationWidth,x=u.effectiveFilterDepth,w=u.effectiveFilterHeight,k=u.effectiveFilterWidth,S=x-1-u.padInfo.front,C=k-1-u.padInfo.left,$=w-1-u.padInfo.top,T=et(r.shape,"float32"),E=1/(p*m*g),_=n.bufferSync(o);for(let A=0;A<u.batchSize;++A)for(let O=0;O<u.inChannels;++O)for(let B=0;B<u.inDepth;++B)for(let F=0;F<u.inHeight;++F)for(let V=0;V<u.inWidth;++V){const D=B-S,U=F-$,J=V-C;let X=0;for(let te=0;te<x;te+=v){const ie=(D+te)/d;if(!(ie<0||ie>=u.outDepth||Math.floor(ie)!==ie))for(let ue=0;ue<w;ue+=b){const ce=(U+ue)/h;if(!(ce<0||ce>=u.outHeight||Math.floor(ce)!==ce))for(let Y=0;Y<k;Y+=y){const z=(J+Y)/f;if(z<0||z>=u.outWidth||Math.floor(z)!==z)continue;const ae=_.get(A,ie,ce,z,O);X+=ae}}}T.set(X*E,A,B,F,V,O)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const oj={kernelName:Fb,backendName:"cpu",kernelFunc:sj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rj(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r;Ne([o,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=ro(i.shape,a,l,1,c),d=u.strideHeight,h=u.strideWidth,f=u.filterHeight,p=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,v=u.effectiveFilterHeight,b=u.effectiveFilterWidth,y=b-1-u.padInfo.left,x=v-1-u.padInfo.top,w=et(i.shape,"float32"),k=1/(f*p),S=n.data.get(o.dataId).values,C=et(o.shape,"float32",S);for(let $=0;$<u.batchSize;++$)for(let T=0;T<u.inChannels;++T)for(let E=0;E<u.inHeight;++E)for(let _=0;_<u.inWidth;++_){const A=E-x,O=_-y;let B=0;for(let F=0;F<v;F+=m){const V=(A+F)/d;if(!(V<0||V>=u.outHeight||Math.floor(V)!==V))for(let D=0;D<b;D+=g){const U=(O+D)/h;if(U<0||U>=u.outWidth||Math.floor(U)!==U)continue;const J=C.get($,V,U,T);B+=J}}w.set(B*k,$,E,_,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const ij={kernelName:Db,backendName:"cpu",kernelFunc:rj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,scale:r,offset:i,mean:a,variance:l}=e;N(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),N(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),N(r==null||a.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ne([o,a,l,r,i],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const u=n.data.get(o.dataId).values,d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,f=r?n.data.get(r.dataId).values:new Float32Array([1]),p=i?n.data.get(i.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=p.length,v=f.length,b=h.length,y=d.length;let x=0,w=0,k=0,S=0;for(let C=0;C<u.length;++C)m[C]=p[x++]+(u[C]-d[w++])*f[k++]/Math.sqrt(h[S++]+c),x>=g&&(x=0),w>=y&&(w=0),k>=v&&(k=0),S>=b&&(S=0);return n.makeTensorInfo(o.shape,o.dtype,m)}const lj={kernelName:sp,backendName:"cpu",kernelFunc:aj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,crops:i}=s;Ne([o],"batchToSpaceND");const a=r.reduce((v,b)=>v*b),l=hd(o.shape,r,a),c=fd(l.length,r.length),u=pd(o.shape,r,a),d=ax(i,r.length),h=lx(u,i,r.length),f=Tt({inputs:{x:o},backend:n,attrs:{shape:l}}),p=rs({inputs:{x:f},backend:n,attrs:{perm:c}}),m=Tt({inputs:{x:p},backend:n,attrs:{shape:u}}),g=ma({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const uj={kernelName:jf,backendName:"cpu",kernelFunc:cj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i}=s,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,c=jx(a,l,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,c)}const hj={kernelName:Ob,backendName:"cpu",kernelFunc:dj};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fj(t){const{inputs:e,backend:n}=t,{s0:s,s1:o}=e,r=n.data.get(s.dataId).values,i=n.data.get(o.dataId).values,a=qe(Array.from(r),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const pj={kernelName:hI,backendName:"cpu",kernelFunc:fj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mj=bt(wu,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),gj={kernelName:wu,backendName:"cpu",kernelFunc:mj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vj=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(oe(e.shape)),o=n.data.get(e.dataId),r=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];s[c]=Math.hypot(u,d)}return n.makeOutput(s,e.shape,"float32")},bj={kernelName:Kf,backendName:"cpu",kernelFunc:vj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xl(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.data.get(s.dataId).complexTensorInfos.imag,r=n.data.get(o.dataId).values;return n.makeTensorInfo(o.shape,o.dtype,r)}const yj={kernelName:Jb,backendName:"cpu",kernelFunc:xl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wl(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s,r=tt(o,e[0].shape)[0],i=e.map(m=>m.shape);ox(i,r);let a=Xo(e.map(m=>m.shape),r);if(oe(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>oe(m.shape)>0);if(l.length===1)return or({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(x=>pa({inputs:{input:x},backend:n})),g=l.map(x=>xl({inputs:{input:x},backend:n})),v=wl({inputs:m,backend:n,attrs:{axis:r}}),b=wl({inputs:g,backend:n,attrs:{axis:r}}),y=ds({inputs:{real:v,imag:b},backend:n});return m.forEach(x=>n.disposeIntermediateTensorInfo(x)),g.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),y}const c=l.map(m=>{const v=[-1,oe(m.shape.slice(r))];return Tt({inputs:{x:m},backend:n,attrs:{shape:v}})}),u=c.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=Xo(c.map(m=>m.shape),1);const d=c[0].shape[0]===1,h=QN(u,a,e[0].dtype,d),f=Xo(l.map(m=>m.shape),r),p=n.makeTensorInfo(f,e[0].dtype,h);return c.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const xj={kernelName:qf,backendName:"cpu",kernelFunc:wl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qE(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s;Ne([o,r],"conv2d");const d=Fr(l),h=Tn(o.shape,r.shape,i,c,a,u,!1,d),f=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,v=h.padInfo.left,b=h.padInfo.top,y=h.dataFormat==="channelsLast",x=new In(h.outShape,o.dtype),w=Ae(o.shape),k=Ae(r.shape),S=w[0],C=y?w[1]:w[2],$=y?w[2]:1,T=y?1:w[1],E=x.strides[0],_=y?x.strides[1]:x.strides[2],A=y?x.strides[2]:1,O=y?1:x.strides[1],B=n.data.get(o.dataId).values,F=n.data.get(r.dataId).values,V=x.values;for(let D=0;D<h.batchSize;++D){const U=D*S,J=D*E;for(let X=0;X<h.outHeight;++X){const te=J+X*_,ie=X*h.strideHeight-b;for(let ue=0;ue<f;++ue){const ce=ie+ue*m;if(ce<0||ce>=h.inHeight)continue;const Y=ue*k[0],z=U+ce*C;for(let ae=0;ae<h.outWidth;++ae){const re=te+ae*A,he=ae*h.strideWidth-v;for(let Ce=0;Ce<p;++Ce){const R=he+Ce*g;if(R<0||R>=h.inWidth)continue;const P=Y+Ce*k[1],j=z+R*$;let ee=P;for(let se=0;se<h.inChannels;++se){const le=B[j+se*T];for(let me=0;me<h.outChannels;++me)V[re+me*O]+=le*F[ee+me];ee+=h.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,V)}const wj={kernelName:Xf,backendName:"cpu",kernelFunc:qE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s;Ne([o,r],"conv2dBackpropFilter");const d=Fr(l),h=Tn(o.shape,u,i,1,a,c,!1,d),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=h,v=h.dataFormat==="channelsLast",b=new In(h.filterShape,"float32"),y=h.padInfo.left,x=h.padInfo.top,w=n.data.get(o.dataId).values,k=n.data.get(r.dataId).values,S=new In(o.shape,o.dtype,w),C=new In(r.shape,r.dtype,k);for(let $=0;$<m;++$){const T=Math.max(0,Math.ceil((x-$)/f)),E=Math.min(h.outHeight,(h.inHeight+x-$)/f);for(let _=0;_<g;++_){const A=Math.max(0,Math.ceil((y-_)/p)),O=Math.min(h.outWidth,(h.inWidth+y-_)/p);for(let B=0;B<h.inChannels;++B)for(let F=0;F<h.outChannels;++F){let V=0;for(let D=0;D<h.batchSize;++D)for(let U=T;U<E;++U){const J=$+U*f-x;for(let X=A;X<O;++X){const te=_+X*p-y;v?V+=S.get(D,J,te,B)*C.get(D,U,X,F):V+=S.get(D,B,J,te)*C.get(D,F,U,X)}}b.set(V,$,_,B,F)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const kj={kernelName:Lb,backendName:"cpu",kernelFunc:Cj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s;Ne([o,r],"conv2dBackpropInput");const d=Ae(r.shape),h=Ae(o.shape);let f=Fr(c);const p=Tn(i,r.shape,a,1,l,u,!1,f),m=new In(p.inShape,"float32"),g=m.values,v=n.data.get(o.dataId).values,b=n.data.get(r.dataId).values,[y,x,w]=d,{batchSize:k,filterHeight:S,filterWidth:C,inChannels:$,inHeight:T,inWidth:E,outChannels:_,outHeight:A,outWidth:O,strideHeight:B,strideWidth:F}=p;f=p.dataFormat;const V=S-1-p.padInfo.top,D=C-1-p.padInfo.left,U=f==="channelsLast",J=m.strides[0],X=U?m.strides[1]:m.strides[2],te=U?m.strides[2]:1,ie=U?1:m.strides[1],ue=h[0],ce=U?h[1]:h[2],Y=U?h[2]:1,z=U?1:h[1];for(let ae=0;ae<k;++ae)for(let re=0;re<$;++re)for(let he=0;he<T;++he){const Ce=he-V,R=Math.max(0,Math.ceil(Ce/B)),P=Math.min(A,(S+Ce)/B);for(let j=0;j<E;++j){const ee=j-D,se=Math.max(0,Math.ceil(ee/F)),le=Math.min(O,(C+ee)/F);let me=0;for(let ge=R;ge<P;++ge){const fe=ge*B-Ce;for(let $e=se;$e<le;++$e){const Ie=$e*F-ee,Te=ue*ae+ce*ge+Y*$e,Oe=y*(S-1-fe)+x*(C-1-Ie)+w*re;for(let je=0;je<_;++je){const it=v[Te+z*je],rt=b[Oe+je];me+=it*rt}}}const ve=J*ae+X*he+te*j+ie*re;g[ve]=me}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const Ij={kernelName:Yf,backendName:"cpu",kernelFunc:Sj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $j(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l}=s;Ne([o,r],"conv3d");const c=bi(o.shape,r.shape,i,l,a),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=c,v=g.front,b=g.left,y=g.top,x=new In(c.outShape,o.dtype),w=n.data.get(o.dataId).values,k=n.data.get(r.dataId).values,S=x.values,C=Ae(o.shape),$=Ae(r.shape);for(let T=0;T<c.batchSize;++T){const E=T*C[0],_=T*x.strides[0];for(let A=0;A<c.outDepth;++A){const O=_+A*x.strides[1],B=A*c.strideDepth-v;for(let F=0;F<u;++F){const V=B+F*f;if(V<0||V>=c.inDepth)continue;const D=F*$[0],U=E+V*C[1];for(let J=0;J<c.outHeight;++J){const X=O+J*x.strides[2],te=J*c.strideHeight-y;for(let ie=0;ie<d;++ie){const ue=te+ie*p;if(ue<0||ue>=c.inHeight)continue;const ce=D+ie*$[1],Y=U+ue*C[2];for(let z=0;z<c.outWidth;++z){const ae=X+z*c.outChannels,re=z*c.strideWidth-b;for(let he=0;he<h;++he){const Ce=re+he*m;if(Ce<0||Ce>=c.inWidth)continue;const R=ce+he*$[2],P=Y+Ce*c.inChannels;let j=R;for(let ee=0;ee<c.inChannels;++ee){const se=w[P+ee];for(let le=0;le<c.outChannels;++le)S[ae+le]+=se*k[j+le];j+=c.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const Tj={kernelName:Zf,backendName:"cpu",kernelFunc:$j};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,filterShape:l}=s;Ne([o,r],"conv3dBackpropFilterV2");const c=Ae(o.shape),u=Ae(r.shape),d=bi(o.shape,l,i,1,a),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,v=d.filterWidth,b=new In(d.filterShape,"float32"),y=b.values,[x,w,k,S]=b.strides,C=n.data.get(r.dataId).values,[$,T,E,_]=u,A=n.data.get(o.dataId).values,[O,B,F,V]=c,D=d.padInfo.front,U=d.padInfo.left,J=d.padInfo.top;for(let X=0;X<m;++X){const te=Math.max(0,Math.ceil((D-X)/h)),ie=Math.min(d.outDepth,(d.inDepth+D-X)/h),ue=X*x;for(let ce=0;ce<g;++ce){const Y=Math.max(0,Math.ceil((J-ce)/f)),z=Math.min(d.outHeight,(d.inHeight+J-ce)/f),ae=ce*w+ue;for(let re=0;re<v;++re){const he=Math.max(0,Math.ceil((U-re)/p)),Ce=Math.min(d.outWidth,(d.inWidth+U-re)/p),R=re*k+ae;for(let P=0;P<d.inChannels;++P){const j=P*S+R;for(let ee=0;ee<d.outChannels;++ee){let se=0;for(let le=0;le<d.batchSize;++le){const me=le*O,ve=le*$;for(let ge=te;ge<ie;++ge){const $e=(X+ge*h-D)*B+me,Ie=ge*T+ve;for(let Te=Y;Te<z;++Te){const je=(ce+Te*f-J)*F+$e,it=Te*E+Ie;for(let rt=he;rt<Ce;++rt){const Kn=(re+rt*p-U)*V+je,Do=rt*_+it;se+=A[Kn+P]*C[Do+ee]}}}}y[j+ee]=se}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const Ej={kernelName:Bb,backendName:"cpu",kernelFunc:Nj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _j(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{pad:i,strides:a,inputShape:l}=s;Ne([o],"conv3dBackpropInputV2");const c=Ae(o.shape),u=Ae(r.shape),d=bi(l,r.shape,a,1,i),h=new In(d.inShape,"float32"),f=h.values,[p,m,g,v]=h.strides,b=n.data.get(o.dataId).values,[y,x,w,k]=c,S=n.data.get(r.dataId).values,[C,$,T,E]=u,{batchSize:_,filterDepth:A,filterHeight:O,filterWidth:B,inChannels:F,inDepth:V,inHeight:D,inWidth:U,outChannels:J,outDepth:X,outHeight:te,outWidth:ie,strideDepth:ue,strideHeight:ce,strideWidth:Y}=d,z=A-1-d.padInfo.front,ae=O-1-d.padInfo.top,re=B-1-d.padInfo.left;for(let he=0;he<_;++he)for(let Ce=0;Ce<F;++Ce)for(let R=0;R<V;++R){const P=R-z,j=Math.max(0,Math.ceil(P/ue)),ee=Math.min(X,(A+P)/ue);for(let se=0;se<D;++se){const le=se-ae,me=Math.max(0,Math.ceil(le/ce)),ve=Math.min(te,(O+le)/ce);for(let ge=0;ge<U;++ge){const fe=ge-re,$e=Math.max(0,Math.ceil(fe/Y)),Ie=Math.min(ie,(B+fe)/Y);let Te=0;for(let Oe=j;Oe<ee;++Oe){const je=Oe*ue-P;for(let it=me;it<ve;++it){const rt=it*ce-le;for(let Nt=$e;Nt<Ie;++Nt){const Kn=Nt*Y-fe,Do=y*he+x*Oe+w*it+k*Nt,zd=C*(A-1-je)+$*(O-1-rt)+T*(B-1-Kn)+E*Ce;for(let Fo=0;Fo<J;++Fo){const Wd=b[Do+Fo],qn=S[zd+Fo];Te+=Wd*qn}}}}f[p*he+m*R+g*se+v*ge+Ce]=Te}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const Aj={kernelName:Vb,backendName:"cpu",kernelFunc:_j};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rj=bt(Cu,t=>Math.cos(t)),Dj={kernelName:Cu,backendName:"cpu",kernelFunc:Rj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fj=bt(ku,t=>Math.cosh(t)),Oj={kernelName:ku,backendName:"cpu",kernelFunc:Fj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pj(t){const{inputs:e,backend:n,attrs:s}=t,{image:o,boxes:r,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[u,d,h,f]=o.shape,p=r.shape[0],[m,g]=a,v=et([p,m,g,f],"float32"),b=n.data.get(r.dataId).values,y=n.data.get(i.dataId).values,x=n.data.get(o.dataId).values,w=Ae(o.shape),k=Ae(v.shape);for(let S=0;S<p;S++){const C=S*4,$=b[C],T=b[C+1],E=b[C+2],_=b[C+3],A=y[S];if(A>=u)continue;const O=m>1?(E-$)*(d-1)/(m-1):0,B=g>1?(_-T)*(h-1)/(g-1):0;for(let F=0;F<m;F++){const V=m>1?$*(d-1)+F*O:.5*($+E)*(d-1);if(V<0||V>d-1){for(let D=0;D<g;D++)for(let U=0;U<f;U++){const J=U+D*k[2]+F*k[1]+S*k[0];v.values[J]=c}continue}if(l==="bilinear"){const D=Math.floor(V),U=Math.ceil(V),J=V-D;for(let X=0;X<g;X++){const te=g>1?T*(h-1)+X*B:.5*(T+_)*(h-1);if(te<0||te>h-1){for(let Y=0;Y<f;Y++){const z=Y+X*k[2]+F*k[1]+S*k[0];v.values[z]=c}continue}const ie=Math.floor(te),ue=Math.ceil(te),ce=te-ie;for(let Y=0;Y<f;Y++){let z=Y+ie*w[2]+D*w[1]+A*w[0];const ae=x[z];z=Y+ue*w[2]+D*w[1]+A*w[0];const re=x[z];z=Y+ie*w[2]+U*w[1]+A*w[0];const he=x[z];z=Y+ue*w[2]+U*w[1]+A*w[0];const Ce=x[z],R=ae+(re-ae)*ce,P=he+(Ce-he)*ce;z=Y+X*k[2]+F*k[1]+S*k[0],v.values[z]=R+(P-R)*J}}}else for(let D=0;D<g;++D){const U=g>1?T*(h-1)+D*B:.5*(T+_)*(h-1);if(U<0||U>h-1){for(let te=0;te<f;te++){const ie=te+D*k[2]+F*k[1]+S*k[0];v.values[ie]=c}continue}const J=Math.round(U),X=Math.round(V);for(let te=0;te<f;te++){const ie=te+J*w[2]+X*w[1]+A*w[0],ue=te+D*k[2]+F*k[1]+S*k[0];v.values[ue]=x[ie]}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const Mj={kernelName:Wb,backendName:"cpu",kernelFunc:Pj};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;Ne(o,"cumprod");const l=Lt([r],o.shape.length);let c=o;l!=null&&(c=rs({inputs:{x:o},backend:n,attrs:{perm:l}}));const u=Kt(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=vs(c.dtype,"int32"),h=Tb(oe(c.shape),d),f=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,b)=>v+p-b-1:(v,b)=>v+b;for(let v=0;v<f.length;v+=p)for(let b=0;b<p;b++){const y=m(v,b);if(b===0)h[y]=i?1:f[y];else{const x=m(v,b-1);h[y]=i?f[x]*h[x]:f[y]*h[x]}}const g=n.makeTensorInfo(c.shape,d,h);if(l!=null){const v=yi(l),b=rs({inputs:{x:g},backend:n,attrs:{perm:v}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),b}return g}const Bj={kernelName:zb,backendName:"cpu",kernelFunc:Lj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;Ne(o,"cumsum");const l=Lt([r],o.shape.length);let c=o;l!=null&&(c=rs({inputs:{x:o},backend:n,attrs:{perm:l}}));const u=Kt(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=vs(c.dtype,"int32"),h=Rn(oe(c.shape),d),f=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(v,b)=>v+p-b-1:(v,b)=>v+b;for(let v=0;v<f.length;v+=p)for(let b=0;b<p;b++){const y=m(v,b);if(b===0)h[y]=i?0:f[y];else{const x=m(v,b-1);h[y]=i?f[x]+h[x]:f[y]+h[x]}}const g=n.makeTensorInfo(c.shape,d,h);if(l!=null){const v=yi(l),b=rs({inputs:{x:g},backend:n,attrs:{perm:v}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),b}return g}const zj={kernelName:Qf,backendName:"cpu",kernelFunc:Vj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i,binaryOutput:a}=s;if(o.shape.length===1){const l=n.data.get(o.dataId).values,c=n.data.get(r.dataId).values,u=jx(l,c,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,u)}else if(o.shape.length===2){const l=n.bufferSync(o),c=n.bufferSync(r),u=XN(l,c,i,a);return n.makeTensorInfo(u.shape,r.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const Uj={kernelName:Ub,backendName:"cpu",kernelFunc:Wj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockSize:r,dataFormat:i}=s;N(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*r,h=c*r,f=u/(r*r),p=n.data.get(o.dataId).values,m=new Float32Array(a*d*h*f);let g=0;for(let v=0;v<a;++v)for(let b=0;b<d;++b){const y=Math.floor(b/r),x=b%r;for(let w=0;w<h;++w){const k=Math.floor(w/r),S=w%r,C=(x*r+S)*f;for(let $=0;$<f;++$){const E=$+C+u*(k+c*(y+l*v));m[g++]=p[E]}}}return n.makeTensorInfo([a,d,h,f],o.dtype,m)}const Hj={kernelName:Gb,backendName:"cpu",kernelFunc:Gj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XE(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=s;Ne([o,r],"depthwiseConv2DNative");const u=Ae(o.shape),d=Ae(r.shape);let h=l;h==null&&(h=[1,1]),N(Dn(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const f=Tn(o.shape,r.shape,i,h,a,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:v,padInfo:b}=f,y=b.left,x=b.top,w=f.outChannels/f.inChannels,k=new In(f.outShape,o.dtype),S=n.data.get(o.dataId).values,C=n.data.get(r.dataId).values,$=k.values;for(let T=0;T<f.batchSize;++T){const E=T*u[0],_=T*k.strides[0];for(let A=0;A<f.outHeight;++A){const O=_+A*k.strides[1],B=A*f.strideHeight-x;for(let F=0;F<p;++F){const V=B+F*g;if(V<0||V>=f.inHeight)continue;const D=F*d[0],U=E+V*u[1];for(let J=0;J<f.outWidth;++J){const X=O+J*k.strides[2],te=J*f.strideWidth-y;for(let ie=0;ie<m;++ie){const ue=te+ie*v;if(ue<0||ue>=f.inWidth)continue;const ce=D+ie*d[1],Y=U+ue*f.inChannels;let z=X,ae=ce;for(let re=0;re<f.inChannels;++re){const he=S[Y+re];for(let Ce=0;Ce<w;++Ce)$[z+Ce]+=he*C[ae+Ce];z+=w,ae+=w}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const jj={kernelName:Jf,backendName:"cpu",kernelFunc:XE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kj(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s;Ne([o,r],"depthwiseConv2dNativeBackpropFilter");const d=Tn(o.shape,u,i,a,l,c,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:m}=d,g=new In(d.filterShape,"float32"),v=d.padInfo.left,b=d.padInfo.top,y=d.outChannels/d.inChannels,x=n.data.get(o.dataId).values,w=new In(o.shape,o.dtype,x),k=n.data.get(r.dataId).values,S=new In(r.shape,r.dtype,k);for(let C=0;C<p;++C){const $=Math.max(0,Math.ceil((b-C)/h)),T=Math.min(d.outHeight,(d.inHeight+b-C)/h);for(let E=0;E<m;++E){const _=Math.max(0,Math.ceil((v-E)/f)),A=Math.min(d.outWidth,(d.inWidth+v-E)/f);for(let O=0;O<d.outChannels;++O){const B=Math.trunc(O/y),F=O%y;let V=0;for(let D=0;D<d.batchSize;++D)for(let U=$;U<T;++U){const J=C+U*h-b;for(let X=_;X<A;++X){const te=E+X*f-v;V+=w.get(D,J,te,B)*S.get(D,U,X,O)}}g.set(V,C,E,B,F)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const qj={kernelName:Hb,backendName:"cpu",kernelFunc:Kj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xj(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s;Ne([o,r],"depthwiseConv2DNativeBackpropInput");const d=Ae(o.shape),h=Ae(r.shape),f=Tn(u,r.shape,i,a,l,c,!0),p=new In(f.inShape,"float32"),m=p.values,[g,v,b]=p.strides,y=n.data.get(o.dataId).values,[x,w,k]=d,S=n.data.get(r.dataId).values,[C,$,T]=h,{batchSize:E,filterHeight:_,filterWidth:A,inChannels:O,inHeight:B,inWidth:F,outChannels:V,outHeight:D,outWidth:U,strideHeight:J,strideWidth:X}=f,te=_-1-f.padInfo.top,ie=A-1-f.padInfo.left,ue=V/O;for(let ce=0;ce<E;++ce)for(let Y=0;Y<O;++Y)for(let z=0;z<B;++z){const ae=z-te,re=Math.max(0,Math.ceil(ae/J)),he=Math.min(D,(_+ae)/J);for(let Ce=0;Ce<F;++Ce){const R=Ce-ie,P=Math.max(0,Math.ceil(R/X)),j=Math.min(U,(A+R)/X);let ee=0;for(let se=re;se<he;++se){const le=se*J-ae;for(let me=P;me<j;++me){const ve=me*X-R,ge=x*ce+w*se+k*me,fe=C*(_-1-le)+$*(A-1-ve)+T*Y;for(let $e=0;$e<ue;++$e){const Ie=Y*ue+$e,Te=y[ge+Ie],Oe=S[fe+$e];ee+=Te*Oe}}}m[g*ce+v*z+b*Ce+Y]=ee}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const Yj={kernelName:jb,backendName:"cpu",kernelFunc:Xj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zj(t){const{inputs:e,backend:n}=t,{x:s}=e,o=oe(s.shape),r=n.data.get(s.dataId).values,i=et([o,o],s.dtype),a=i.values;for(let c=0;c<r.length;c++)a[c*o+c]=r[c];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,i.dtype,i.values)}const Qj={kernelName:fI,backendName:"cpu",kernelFunc:Zj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj={kernelName:ep,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:o}=t,{strides:r,pad:i,dilations:a}=n,l=e,c=l.data.get(s.dataId).values,u=s.shape.length,d=l.data.get(o.dataId).values,h=o.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:v,outWidth:b,padInfo:y,strideHeight:x,strideWidth:w,filterHeight:k,filterWidth:S,dilationHeight:C,dilationWidth:$,outShape:T}=ad(s.shape,o.shape,r,i,"NHWC",a),E=oe(T),_=T.length,A=Ut(s.dtype,E);for(let B=0;B<f;++B)for(let F=0;F<v;++F){const V=F*x-y.top;for(let D=0;D<b;++D){const U=D*w-y.left;for(let J=0;J<g;++J){let X=Number.MIN_SAFE_INTEGER;for(let ie=0;ie<k;++ie){const ue=V+ie*C;if(ue>=0&&ue<p)for(let ce=0;ce<S;++ce){const Y=U+ce*$;if(Y>=0&&Y<m){const z=Ko([B,ue,Y,J],u,Ae(s.shape)),ae=Ko([ie,ce,J],h,Ae(o.shape)),re=c[z]+d[ae];re>X&&(X=re)}}}const te=Ko([B,F,D,J],_,Ae(T));A[te]=X}}}return{dataId:l.write(wa(A,s.dtype),T,s.dtype),shape:T,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK={kernelName:Wg,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:o,dy:r}=t,{strides:i,pad:a,dilations:l}=n,c=e,u=yo(s.shape,c.data.get(s.dataId).values),d=yo(o.shape,c.data.get(o.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:b,strideHeight:y,strideWidth:x,filterHeight:w,filterWidth:k,dilationHeight:S,dilationWidth:C,outShape:$}=ad(s.shape,o.shape,i,a,"NHWC",l);N(r.rank===$.length,()=>`Error in ${Wg}, dy must have the same rank as output ${$.length}, but got ${r.rank}`);const T=yo($,c.data.get(r.dataId).values),E=cI(o.shape,o.dtype);for(let A=0;A<h;++A)for(let O=0;O<g;++O){const B=O*y-b.top;for(let F=0;F<v;++F){const V=F*x-b.left;for(let D=0;D<m;++D){let U=Number.MIN_SAFE_INTEGER,J=0,X=0;for(let te=0;te<w;++te){const ie=B+te*S;if(ie>=0&&ie<f)for(let ue=0;ue<k;++ue){const ce=V+ue*C;if(ce>=0&&ce<p){const Y=u[A][ie][ce][D]+d[te][ue][D];Y>U&&(U=Y,J=te,X=ue)}}}E[J][X][D]+=T[A][O][F][D]}}}return{dataId:c.write(wa(E,s.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK={kernelName:zg,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:o,dy:r}=t,{strides:i,pad:a,dilations:l}=n,c=e,u=yo(s.shape,c.data.get(s.dataId).values),d=yo(o.shape,c.data.get(o.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:v,padInfo:b,strideHeight:y,strideWidth:x,filterHeight:w,filterWidth:k,dilationHeight:S,dilationWidth:C,outShape:$}=ad(s.shape,o.shape,i,a,"NHWC",l);N(r.rank===$.length,()=>`Error in ${zg}, dy must have the same rank as output ${$.length}, but got ${r.rank}`);const T=yo($,c.data.get(r.dataId).values),E=cI(s.shape,s.dtype);for(let A=0;A<h;++A)for(let O=0;O<g;++O){const B=O*y-b.top;for(let F=0;F<v;++F){const V=F*x-b.left;for(let D=0;D<m;++D){let U=Number.MIN_SAFE_INTEGER,J=B<0?0:B,X=V<0?0:V;for(let te=0;te<w;++te){const ie=B+te*S;if(ie>=0&&ie<f)for(let ue=0;ue<k;++ue){const ce=V+ue*C;if(ce>=0&&ce<p){const Y=u[A][ie][ce][D]+d[te][ue][D];Y>U&&(U=Y,J=ie,X=ce)}}}E[A][J][X][D]+=T[A][O][F][D]}}}return{dataId:c.write(wa(E,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(t){const{inputs:e,backend:n,attrs:s}=t,{image:o}=e,{canvas:r,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=r.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[h,f]=o.shape.slice(0,2),p=o.shape.length===2?1:o.shape[2],m=n.data.get(o.dataId).values,g=o.dtype==="float32"?255:1,v=new Uint8ClampedArray(f*h*4);for(let y=0;y<h*f;++y){const x=[0,0,0,255*c];for(let k=0;k<p;k++){const S=m[y*p+k];if(o.dtype==="float32"){if(S<0||S>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${S}.`)}else if(o.dtype==="int32"&&(S<0||S>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${S}.`);p===1?(x[0]=S*g,x[1]=S*g,x[2]=S*g):x[k]=S*g}const w=y*4;v[w+0]=Math.round(x[0]),v[w+1]=Math.round(x[1]),v[w+2]=Math.round(x[2]),v[w+3]=Math.round(x[3])}r.width=f,r.height=h;const b=new ImageData(v,f,h);return d.putImageData(b,0,0),o}const sK={kernelName:wP,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kd(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Ne(o,"sum");let a;o.dtype==="bool"?a=hi({inputs:{x:o},backend:n,attrs:{dtype:"int32"}}):a=or({inputs:{x:o},backend:n});const l=a.shape.length,c=tt(r,a.shape),u=Lt(c,l);let d=c,h=a;u!=null&&(h=rs({inputs:{x:a},backend:n,attrs:{perm:u}}),d=Kt(d.length,l)),Nn("sum",d,h.shape.length);const[f,p]=bn(h.shape,d),m=vs(h.dtype,"int32");let g=Qh(n,f,m);const v=oe(p),b=n.data.get(g.dataId).values,y=n.data.get(h.dataId).values;for(let x=0;x<b.length;++x){const w=x*v;let k=0;for(let S=0;S<v;++S)k+=y[w+S];b[x]=k}if(i){const x=Jt(g.shape,c),w=g;g=Tt({inputs:{x:g},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(h),g}const oK={kernelName:Dp,backendName:"cpu",kernelFunc:kd};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(t){const{inputs:e,backend:n,attrs:s}=t,{equation:o}=s,r=e,{allDims:i,summedDims:a,idDims:l}=gx(o,r.length);bx(i.length,l,r);const{path:c,steps:u}=yx(a,l),d=u.length;let h=null,f=i.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:v,expandDims:b}=vx(f,l[g]);let y;xx(v)?y=r[g]:(y=rs({inputs:{x:r[g]},backend:n,attrs:{perm:v}}),p.push(y));const x=y.shape.slice();for(let w=0;w<b.length;++w)x.splice(b[w],0,1);mt(y.shape,x)||(y=Tt({inputs:{x:y},backend:n,attrs:{shape:x}}),p.push(y)),h===null?h=y:(h=um({inputs:{a:y,b:h},backend:n}),p.push(h))}m<d-1&&(c[m]>=0&&(h=kd({inputs:{x:h},backend:n,attrs:{axis:c[m]-(i.length-f),keepDims:!1}}),p.push(h)),f--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const iK={kernelName:Kb,backendName:"cpu",kernelFunc:rK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(t){const{inputs:e,backend:n}=t,{dy:s,y:o}=e;Ne([s,o],"eluGrad");const r=new Float32Array(oe(o.shape)),i=n.data.get(o.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const c=i[l];c>=0?r[l]=a[l]:r[l]=a[l]*(c+1)}return n.makeTensorInfo(o.shape,"float32",r)}const lK={kernelName:qb,backendName:"cpu",kernelFunc:aK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK=cx,uK=ux,dK=dx,hK=hx,fK=fx,pK=px,mK=bt($u,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+cK*n);return e*(1-((((pK*s+fK)*s+hK)*s+dK)*s+uK)*s*Math.exp(-n*n))}),gK={kernelName:$u,backendName:"cpu",kernelFunc:mK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tf(t){const{inputs:e,backend:n,attrs:s}=t,{input:o}=e,{dim:r}=s,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(N(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),Tt({inputs:{x:o},backend:n,attrs:{shape:a}})}const vK={kernelName:np,backendName:"cpu",kernelFunc:tf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bK=Xt((t,e)=>t/e),Qx=cn(Su,bK),gv={kernelName:Su,backendName:"cpu",kernelFunc:Qx};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(t,e,n){const s=t.shape,o=s[0],r=s[1],i=n.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,c=[o,r],u=oe(c),d=An("float32",u),h=An("float32",u);for(let g=0;g<o;g++){const v=ma({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,r]}}),b=ma({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,r]}}),y=ds({inputs:{real:v,imag:b},backend:n}),{real:x,imag:w}=yK(y,e,n),k=Ir(x,w);for(let S=0;S<r;S++){const C=mx(k,S);d[g*r+S]=C.real,h[g*r+S]=C.imag}n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(y)}const f=n.makeTensorInfo(c,"float32",d),p=n.makeTensorInfo(c,"float32",h),m=ds({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function yK(t,e,n){const s=oe(t.shape),o=n.data.get(t.dataId),r=n.data.get(o.complexTensorInfos.real.dataId).values,i=n.data.get(o.complexTensorInfos.imag.dataId).values;if(xK(s)){const a=vv(r,i,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),u=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",vi(s,"float32")),h=or({inputs:{x:d},backend:n}),f=gv.kernelFunc({inputs:{a:c,b:d},backend:n}),p=gv.kernelFunc({inputs:{a:u,b:h},backend:n}),m=n.data.get(f.dataId).values,g=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=Ir(r,i),l=wK(a,s,e);return d2(l)}}function xK(t){return(t&t-1)===0}function vv(t,e,n,s,o){if(n===1)return{real:t,imag:e};const r=Ir(t,e),i=n/2,a=h2(r),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),h=o.makeTensorInfo(u,"float32",c),f=ds({inputs:{real:d,imag:h},backend:o}),p=f2(r),m=p.real,g=p.imag,v=[m.length],b=o.makeTensorInfo(v,"float32",m),y=o.makeTensorInfo(v,"float32",g),x=ds({inputs:{real:b,imag:y},backend:o}),w=vv(l,c,i,s,o),k=w.real,S=w.imag,C=[k.length],$=o.makeTensorInfo(C,"float32",k),T=o.makeTensorInfo(C,"float32",S),E=ds({inputs:{real:$,imag:T},backend:o}),_=vv(m,g,i,s,o),A=_.real,O=_.imag,B=[A.length],F=o.makeTensorInfo(B,"float32",A),V=o.makeTensorInfo(B,"float32",O),D=ds({inputs:{real:F,imag:V},backend:o}),U=m2(n,s),J=[U.real.length],X=o.makeTensorInfo(J,"float32",U.real),te=o.makeTensorInfo(J,"float32",U.imag),ie=ds({inputs:{real:X,imag:te},backend:o}),ue=um({inputs:{a:ie,b:D},backend:o}),ce=yl({inputs:{a:E,b:ue},backend:o}),Y=Yx({inputs:{a:E,b:ue},backend:o}),z=pa({inputs:{input:ce},backend:o}),ae=pa({inputs:{input:Y},backend:o}),re=xl({inputs:{input:ce},backend:o}),he=xl({inputs:{input:Y},backend:o}),Ce=wl({inputs:[z,ae],backend:o,attrs:{axis:0}}),R=wl({inputs:[re,he],backend:o,attrs:{axis:0}}),P=o.data.get(Ce.dataId).values,j=o.data.get(R.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo($),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(E),o.disposeIntermediateTensorInfo(F),o.disposeIntermediateTensorInfo(V),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(te),o.disposeIntermediateTensorInfo(ie),o.disposeIntermediateTensorInfo(ue),o.disposeIntermediateTensorInfo(ce),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(re),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(he),o.disposeIntermediateTensorInfo(Ce),o.disposeIntermediateTensorInfo(R),{real:P,imag:j}}function wK(t,e,n){const s=new Float32Array(e*2);for(let o=0;o<e;o++){let r=0,i=0;for(let a=0;a<e;a++){const l=g2(o*a,e,n),c=mx(t,a);r+=c.real*l.real-c.imag*l.imag,i+=c.real*l.imag+c.imag*l.real}n&&(r/=e,i/=e),p2(s,r,i,o)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CK(t){const{inputs:e,backend:n}=t,{input:s}=e,o=oe(s.shape),r=s.shape[s.shape.length-1],i=o/r,a=Tt({inputs:{x:s},backend:n,attrs:{shape:[i,r]}}),l=YE(a,!1,n),c=Tt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const kK={kernelName:Xb,backendName:"cpu",kernelFunc:CK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jx(t){const{backend:e,attrs:n}=t,{shape:s,value:o,dtype:r}=n,i=r||Ol(o),a=Ut(i,oe(s));return IK(a,o,i),e.makeTensorInfo(s,i,a)}const SK={kernelName:Yb,backendName:"cpu",kernelFunc:Jx};function IK(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $K={kernelName:Zb,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,o=n,r=An(s.dtype,oe(s.shape)),[i,a,l,c]=s.shape,u=o.data.get(s.dataId).values;for(let h=0;h<i;h++){const f=h*l*a*c;for(let p=0;p<a;p++){const m=p*(l*c);for(let g=0;g<l;g++){const v=g*c;for(let b=0;b<c;b++){const y=Math.round(l-g-1),x=f+m+v+b;let w=u[x];if(y>=0&&y<l){const k=y*c,S=f+m+k+b;w=u[S]}r[x]=w}}}}return{dataId:o.write(r,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=qE({inputs:{x:o,filter:r},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(i){const g=m;if(u==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const v=Tt({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});m=yl({inputs:{a:m,b:v},backend:n}),n.disposeIntermediateTensorInfo(v)}else m=yl({inputs:{a:m,b:i},backend:n});n.disposeIntermediateTensorInfo(g)}if(f){const g=m;if(u==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const v=Tt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=ef(n,m,f,v,p),n.disposeIntermediateTensorInfo(v)}else m=ef(n,m,f,a,p);n.disposeIntermediateTensorInfo(g)}return m}const NK={kernelName:Rh,backendName:"cpu",kernelFunc:TK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EK(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=XE({inputs:{x:o,filter:r},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(i){const g=m;m=yl({inputs:{a:m,b:i},backend:n}),n.disposeIntermediateTensorInfo(g)}if(f){const g=m;m=ef(n,m,f,a,p),n.disposeIntermediateTensorInfo(g)}return m}const _K={kernelName:RI,backendName:"cpu",kernelFunc:EK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AK(t){const{inputs:e,backend:n}=t,{params:s,indices:o}=e,r=oe(s.shape),i=o.shape,a=i[i.length-1],[l,c,u,d]=Qy(s,o);if(c===0)return n.makeTensorInfo(l,s.dtype,[]);const h=n.data.get(o.dataId).values,f=n.bufferSync(s),p=iE(h,f,s.dtype,c,a,u,d,s.shape,r);return n.makeTensorInfo(l,s.dtype,p.values)}const RK={kernelName:pI,backendName:"cpu",kernelFunc:AK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,indices:r}=e,{axis:i,batchDims:a}=s;Ne([o,r],"gatherV2");const l=tt(i,o.shape)[0],c=n.data.get(r.dataId).values,u=o.shape[l];for(let x=0;x<c.length;++x){const w=c[x];N(w<=u-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const h=oe(r.shape),f=Cx(o,r,l,d),p=Tt({inputs:{x:o},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=Tt({inputs:{x:r},backend:n,attrs:{shape:[f.batchSize,h/f.batchSize]}}),g=[f.batchSize,f.outerSize,h/f.batchSize,f.sliceSize],v=n.bufferSync(m),b=n.bufferSync(p),y=aE(b,v,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(f.outputShape,y.dtype,y.values)}const FK={kernelName:op,backendName:"cpu",kernelFunc:DK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OK(t){const{inputs:e,backend:n}=t,{input:s}=e,o=oe(s.shape),r=s.shape[s.shape.length-1],i=o/r,a=Tt({inputs:{x:s},backend:n,attrs:{shape:[i,r]}}),l=YE(a,!0,n),c=Tt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const PK={kernelName:Qb,backendName:"cpu",kernelFunc:OK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MK=bt(Du,t=>Number.isFinite(t)?1:0,"bool"),LK={kernelName:Du,backendName:"cpu",kernelFunc:MK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BK=bt(Fu,t=>Math.abs(t)===1/0?1:0,"bool"),VK={kernelName:Fu,backendName:"cpu",kernelFunc:BK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zK=bt(Ou,t=>Number.isNaN(t)?1:0,"bool"),WK={kernelName:Ou,backendName:"cpu",kernelFunc:zK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UK(t){const{backend:e,attrs:n}=t,{start:s,stop:o,num:r}=n,i=hE(s,o,r);return e.makeTensorInfo([i.length],"float32",i)}const GK={kernelName:mI,backendName:"cpu",kernelFunc:UK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HK=bt(Mu,t=>Math.log1p(t)),jK={kernelName:Mu,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KK=Xt((t,e)=>t&&e),qK=cn(cp,KK,null,"bool"),XK={kernelName:cp,backendName:"cpu",kernelFunc:qK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK=bt(up,t=>t?0:1,"bool"),ZK={kernelName:up,backendName:"cpu",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QK=Xt((t,e)=>t||e),JK=cn(dp,QK,null,"bool"),eq={kernelName:dp,backendName:"cpu",kernelFunc:JK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{depthRadius:r,bias:i,alpha:a,beta:l}=s;Ne(o,"LRN");const c=o.shape[3],u=c-1,d=n.data.get(o.dataId).values,h=oe(o.shape),f=new Float32Array(h);function p(m){const g=m%c;let v=m-g+Math.max(0,g-r);const b=m-g+Math.min(g+r,u);let y=0;for(;v<=b;v++){const x=d[v];y+=x*x}return y}for(let m=0;m<h;m++){const g=p(m),v=d[m]*Math.pow(i+a*g,-l);f[m]=v}return n.makeTensorInfo(o.shape,o.dtype,f)}const nq={kernelName:hp,backendName:"cpu",kernelFunc:tq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,y:r,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s;Ne(i,"LRNGrad");const d=oe(i.shape),h=i.shape[3],f=n.data.get(i.dataId).values,p=n.data.get(o.dataId).values,m=n.data.get(r.dataId).values,g=new Float32Array(d),v=d;for(let b=0;b<v;b++){const y=b%h,x=b-y+Math.max(0,y-a),w=b-y+Math.min(h,y+a+1);let k=0;for(let S=x;S<w;S++)k+=Math.pow(p[S],2);k=c*k+l;for(let S=x;S<w;S++){let C=-2*c*u*p[S]*m[b]/k;b===S&&(C+=Math.pow(k,-u)),C*=f[b],g[S]+=C}}return n.makeTensorInfo(i.shape,o.dtype,g)}const oq={kernelName:ey,backendName:"cpu",kernelFunc:sq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZE(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reductionIndices:r,keepDims:i}=s,a=n;let l=o.shape;const c=l.length,u=tt(r,l);let d=u;const h=Lt(d,c);let f=a.data.get(o.dataId).values;if(h!=null){const x=new Array(c);for(let w=0;w<x.length;w++)x[w]=l[h[w]];f=qx(f,l,o.dtype,h,x),d=Kt(d.length,c),l=x}Ne(o,"max"),Nn("max",d,c);const[p,m]=bn(l,d),g=oe(m),v=pE(f,g,p,o.dtype),b=a.write(v,p,o.dtype);let y=p;return i&&(y=Jt(p,u)),{dataId:b,shape:y,dtype:o.dtype}}const rq={kernelName:fp,backendName:"cpu",kernelFunc:ZE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Ne(o,"maxPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,c=1;N(Dn(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=ro(o.shape,r,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&mt(u.inShape,u.outShape))d=or({inputs:{x:o},backend:n});else{const h=n.data.get(o.dataId).values,f=Ae(o.shape),p=Zx(h,o.shape,o.dtype,f,u,"max");d=n.makeTensorInfo(u.outShape,o.dtype,p.values)}return d}const aq={kernelName:pp,backendName:"cpu",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=s;Ne(o,"maxPool3d");const u=Dr(o.shape,r,i,1,a,l,c),d=n.data.get(o.dataId).values,h=KE(d,o.shape,o.dtype,Ae(o.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const cq={kernelName:mp,backendName:"cpu",kernelFunc:lq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=s;Ne([o,r],"maxPool3DGrad");const u=Dr(r.shape,i,a,1,l,c),d=n.bufferSync(r),h=Q6(d,u),f=u.strideDepth,p=u.strideHeight,m=u.strideWidth,g=u.dilationDepth,v=u.dilationHeight,b=u.dilationWidth,y=u.effectiveFilterDepth,x=u.effectiveFilterHeight,w=u.effectiveFilterWidth,k=y-1-u.padInfo.front,S=w-1-u.padInfo.left,C=x-1-u.padInfo.top,$=et(r.shape,"float32"),T=n.bufferSync(o);for(let E=0;E<u.batchSize;++E)for(let _=0;_<u.inChannels;++_)for(let A=0;A<u.inDepth;++A)for(let O=0;O<u.inHeight;++O)for(let B=0;B<u.inWidth;++B){const F=A-k,V=O-C,D=B-S;let U=0;for(let J=0;J<y;J+=g){const X=(F+J)/f;if(!(X<0||X>=u.outDepth||Math.floor(X)!==X))for(let te=0;te<x;te+=v){const ie=(V+te)/p;if(!(ie<0||ie>=u.outHeight||Math.floor(ie)!==ie))for(let ue=0;ue<w;ue+=b){const ce=(D+ue)/m;if(ce<0||ce>=u.outWidth||Math.floor(ce)!==ce)continue;const Y=y*x*w-1-h.get(E,X,ie,ce,_),z=J*x*w+te*w+ue,ae=Y===z?1:0;if(ae===0)continue;const re=T.get(E,X,ie,ce,_);U+=re*ae}}}$.set(U,E,A,O,B,_)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const dq={kernelName:ny,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hq(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r,output:i}=e,a=r;Ne([r,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=ro(a.shape,l,c,1,u,d),f=n.data.get(a.dataId).values,p=et(h.outShape,a.dtype,jE(f,a.shape,a.dtype,h).values),m=h.strideHeight,g=h.strideWidth,v=h.dilationHeight,b=h.dilationWidth,y=h.effectiveFilterHeight,x=h.effectiveFilterWidth,w=x-1-h.padInfo.left,k=y-1-h.padInfo.top,S=et(a.shape,"float32"),C=n.data.get(o.dataId).values,$=et(o.shape,"float32",C);for(let T=0;T<h.batchSize;++T)for(let E=0;E<h.inChannels;++E)for(let _=0;_<h.inHeight;++_)for(let A=0;A<h.inWidth;++A){const O=_-k,B=A-w;let F=0;for(let V=0;V<y;V+=v){const D=(O+V)/m;if(!(D<0||D>=h.outHeight||Math.floor(D)!==D))for(let U=0;U<x;U+=b){const J=(B+U)/g;if(J<0||J>=h.outWidth||Math.floor(J)!==J)continue;const X=y*x-1-p.get(T,D,J,E),te=V*x+U,ie=X===te?1:0;if(ie===0)continue;const ue=$.get(T,D,J,E);F+=ue*ie}}S.set(F,T,_,A,E)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const fq={kernelName:ty,backendName:"cpu",kernelFunc:hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(t,e,n,s,o){const r=Ae(e),i=Zx(t,e,n,r,o,"max"),a=jE(t,e,n,o,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mq={kernelName:gI,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:o,strides:r,pad:i,includeBatchInIndex:a}=e,l=n;Ne(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,u=ro(s.shape,o,r,[1,1],i),[d,h]=pq(c,s.shape,s.dtype,a,u),f=l.write(d,u.outShape,s.dtype),p=l.write(h,u.outShape,s.dtype);return[{dataId:f,shape:u.outShape,dtype:s.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=tt(r,o.shape),c=bn(o.shape,a)[1],u=oe(c),d=[],h=n.makeTensorInfo([],"float32",new Float32Array([u]));d.push(h);const f=hi({inputs:{x:o},backend:n,attrs:{dtype:"float32"}});d.push(f);const p=Qx({inputs:{a:f,b:h},backend:n});d.push(p);const m=kd({inputs:{x:p},backend:n,attrs:{axis:r,keepDims:i}});return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const vq={kernelName:gp,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;Ne(o,"min");const a=tt(r,o.shape);let l=a;const c=Lt(l,o.shape.length);let u=o;c!=null&&(u=rs({inputs:{x:o},backend:n,attrs:{perm:c}}),l=Kt(l.length,o.shape.length)),Nn("min",l,u.shape.length);const[d,h]=bn(u.shape,l),f=oe(h),p=Rn(oe(d),u.dtype),m=n.data.get(u.dataId).values;for(let v=0;v<p.length;++v){const b=v*f;let y=m[b];for(let x=0;x<f;++x){const w=m[b+x];(Number.isNaN(w)||w<y)&&(y=w)}p[v]=y}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(i){const v=Jt(d,a),b=Tt({inputs:{x:g},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(g),b}return g}const yq={kernelName:vp,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{paddings:r,mode:i}=s;Ne(o,"mirrorPad");const a=r.map((y,x)=>y[0]+o.shape[x]+y[1]),l=r.map(y=>y[0]),c=r.map((y,x)=>y[0]+o.shape[x]),u=i==="reflect"?0:1,d=n.data.get(o.dataId).values,h=o.shape.length,f=Ae(o.shape),p=oe(a),m=a.length,g=Ae(a),v=An(o.dtype,p);for(let y=0;y<p;y++){let x=Pl(y,m,g);for(let k=0;k<m;k++)x[k]<l[k]?x[k]=l[k]*2-x[k]-u:x[k]>=c[k]&&(x[k]=(c[k]-1)*2-x[k]+u);x=x.map((k,S)=>k-l[S]);const w=Ko(x,h,f);v[y]=d[w]}return{dataId:n.write(v,a,o.dtype),shape:a,dtype:o.dtype}}const wq={kernelName:bp,backendName:"cpu",kernelFunc:xq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cq=Xt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),kq=cn(Vu,Cq),Sq={kernelName:Vu,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{dim:r}=s,i=o.shape.length;let a=r;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=tt([a],o.shape),c=ZE({inputs:{x:o},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Jt(c.shape,l),d=Tt({inputs:{x:c},backend:n,attrs:{shape:u}}),h=Yx({inputs:{a:o,b:d},backend:n}),f=nE({inputs:{x:h},backend:n}),p=kd({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=Tt({inputs:{x:p},backend:n,attrs:{shape:u}}),g=Qx({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const Iq={kernelName:Pp,backendName:"cpu",kernelFunc:QE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $q(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{numSamples:r,seed:i,normalized:a}=s;Ne(o,"multinomial");const l=a?o:QE({inputs:{logits:o},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=n.data.get(l.dataId).values,h=[c,r],f=Rn(oe(h),"int32");for(let p=0;p<c;++p){const m=p*u,g=new Float32Array(u-1);g[0]=d[m];for(let y=1;y<g.length;++y)g[y]=g[y-1]+d[m+y];const v=My.alea(i.toString()),b=p*r;for(let y=0;y<r;++y){const x=v();f[b+y]=g.length;for(let w=0;w<g.length;w++)if(x<g[w]){f[b+y]=w;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",f)}const Tq={kernelName:vI,backendName:"cpu",kernelFunc:$q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nq=jy;function Eq(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;Ne(o,"NonMaxSuppression");const c=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values,{selectedIndices:d}=Nq(c,u,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const _q={kernelName:sy,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aq=Ky;function Rq(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;Ne(o,"NonMaxSuppressionPadded");const u=n.data.get(o.dataId).values,d=n.data.get(r.dataId).values,{selectedIndices:h,validOutputs:f}=Aq(u,d,i,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const Dq={kernelName:oy,backendName:"cpu",kernelFunc:Rq};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fq=qy;function Oq(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;Ne(o,"NonMaxSuppressionWithScore");const u=n.data.get(o.dataId).values,d=n.data.get(r.dataId).values,h=i,f=a,p=l,m=c,{selectedIndices:g,selectedScores:v}=Fq(u,d,h,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const Pq={kernelName:ry,backendName:"cpu",kernelFunc:Oq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mq(t){const{inputs:e,backend:n,attrs:s}=t,{indices:o}=e,{dtype:r,depth:i,onValue:a,offValue:l}=s;Ne(o,"oneHot");const c=oe(o.shape),u=new Float32Array(c*i);u.fill(l);const d=n.data.get(o.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<i&&(u[h*i+d[h]]=a);return n.makeTensorInfo([...o.shape,i],r,u)}const Lq={kernelName:Cp,backendName:"cpu",kernelFunc:Mq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nf(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const o=pa({inputs:{input:s},backend:n}),r=nf({inputs:{x:o},backend:n}),i=xl({inputs:{input:s},backend:n}),a=nf({inputs:{x:i},backend:n}),l=ds({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Jx({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Bq={kernelName:Bp,backendName:"cpu",kernelFunc:nf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JE(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const o=pa({inputs:{input:s},backend:n}),r=JE({inputs:{x:o},backend:n}),i=xl({inputs:{input:s},backend:n}),a=nf({inputs:{x:i},backend:n}),l=ds({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Jx({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Vq={kernelName:wp,backendName:"cpu",kernelFunc:JE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s;if(e.length===1)return tf({inputs:{input:e[0]},backend:n,attrs:{dim:o}});const r=e[0].shape,i=e[0].dtype;e.forEach(u=>{$b(r,u.shape,"All tensors passed to stack must have matching shapes"),N(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=tf({inputs:{input:u},backend:n,attrs:{dim:o}});return a.push(d),d}),c=wl({inputs:l,backend:n,attrs:{axis:o}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const zq={kernelName:kp,backendName:"cpu",kernelFunc:e_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{paddings:r,constantValue:i}=s;Ne(o,"pad");const a=r.map((b,y)=>b[0]+o.shape[y]+b[1]),l=r.map(b=>b[0]),c=n.data.get(o.dataId).values,u=oe(o.shape),d=o.shape.length,h=Ae(o.shape),f=oe(a),p=a.length,m=Ae(a),g=An(o.dtype,f);i!==0&&g.fill(i);for(let b=0;b<u;b++){const x=Pl(b,d,h).map((k,S)=>k+l[S]),w=Ko(x,p,m);g[w]=c[b]}return{dataId:n.write(g,a,o.dtype),shape:a,dtype:o.dtype}}const t_={kernelName:Sp,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uq=Xt((t,e)=>Math.pow(t,e)),Gq=cn(Wu,Uq),Hq={kernelName:Wu,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jq(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:o,paramsDenseValues:r,indices:i}=e,a=o.map(g=>n.data.get(g.dataId).values),l=o.map(g=>g.shape),c=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,[d,h,f]=xE(a,l,c,r.shape,r.dtype,u,i.shape),p=d.map(g=>n.makeTensorInfo([g.length],"int32",g)),m=n.makeTensorInfo(f,r.dtype,h);return p.concat([m])}const Kq={kernelName:bI,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qq(t){const{inputs:e,backend:n}=t,{starts:s,limits:o,deltas:r}=e,i=n.data.get(s.dataId).values,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,[c,u]=wE(i,s.shape,s.dtype,a,o.shape,l,r.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const Xq={kernelName:yI,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(t){const{inputs:e,backend:n,attrs:s}=t,{shape:o,values:r,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.data.get(o.dataId).values,u=n.data.get(r.dataId).values,d=n.data.get(i.dataId).values,h=a.map(g=>n.data.get(g.dataId).values),f=a.map(g=>g.shape),[p,m]=CE(c,o.shape,u,r.shape,r.dtype,d,i.shape,h,f,l);return n.makeTensorInfo(p,r.dtype,m)}const Zq={kernelName:xI,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qq(t){const{backend:e,attrs:n}=t,{start:s,stop:o,dtype:r,step:i}=n,a=kE(s,o,i,r);return e.makeTensorInfo([a.length],r,a)}const Jq={kernelName:iy,backendName:"cpu",kernelFunc:Qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e5=bt(Uu,t=>1/t),t5={kernelName:Uu,backendName:"cpu",kernelFunc:e5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s;Ne(o,"resizeBilinear");const l=Ae(o.shape),[c,u]=a,[d,h,f,p]=o.shape,m=n.data.get(o.dataId).values,g=new Float32Array(oe([d,c,u,p])),v=[r&&c>1?h-1:h,r&&u>1?f-1:f],b=[r&&c>1?c-1:c,r&&u>1?u-1:u];let y=0;const x=v[0]/b[0],w=v[1]/b[1];for(let k=0;k<d;k++)for(let S=0;S<c;S++){let C;i?C=x*(S+.5)-.5:C=x*S;const $=Math.max(0,Math.floor(C)),T=C-$,E=Math.min(h-1,Math.ceil(C)),_=k*l[0]+$*l[1],A=k*l[0]+E*l[1];for(let O=0;O<u;O++){let B;i?B=w*(O+.5)-.5:B=w*O;const F=Math.max(0,Math.floor(B)),V=B-F,D=Math.min(f-1,Math.ceil(B)),U=_+F*l[2],J=A+F*l[2],X=_+D*l[2],te=A+D*l[2];for(let ie=0;ie<p;ie++){const ue=m[U+ie],ce=m[J+ie],Y=m[X+ie],z=m[te+ie],ae=ue+(Y-ue)*V,re=ce+(z-ce)*V,he=ae+(re-ae)*T;g[y++]=he}}}return n.makeTensorInfo([d,c,u,p],"float32",g)}const s5={kernelName:Ep,backendName:"cpu",kernelFunc:n5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o5(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s;Ne([r,o],"resizeBilinearGrad");const a=Ae(o.shape),[l,c,u,d]=o.shape,[,h,f]=r.shape,p=new Float32Array(l*c*u*d),m=[i&&h>1?c-1:c,i&&f>1?u-1:u],g=[i&&h>1?h-1:h,i&&f>1?f-1:f],v=m[0]/g[0],b=m[1]/g[1],y=n.data.get(r.dataId).values;let x=0;for(let w=0;w<l;w++){const k=w*a[0];for(let S=0;S<h;S++){const C=S*v,$=Math.floor(C),T=Math.min(Math.ceil(C),c-1),E=k+$*a[1],_=k+T*a[1],A=C-$,O=1-A;for(let B=0;B<f;B++){const F=B*b,V=Math.floor(F),D=Math.min(Math.ceil(F),u-1),U=F-V,J=1-U,X=E+V*a[2],te=E+D*a[2],ie=_+V*a[2],ue=_+D*a[2],ce=O*J,Y=O*U,z=A*J,ae=A*U;for(let re=0;re<d;re++){const he=y[x++];p[X+re]+=he*ce,p[te+re]+=he*Y,p[ie+re]+=he*z,p[ue+re]+=he*ae}}}}return n.makeTensorInfo([l,u,c,d],"float32",p)}const r5={kernelName:cy,backendName:"cpu",kernelFunc:o5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i5(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s;Ne(o,"resizeNearestNeighbor");const l=Ae(o.shape),[c,u]=a,[d,h,f,p]=o.shape,m=n.data.get(o.dataId).values,g=new Float32Array(d*c*u*p),v=[r&&c>1?h-1:h,r&&u>1?f-1:f],b=[r&&c>1?c-1:c,r&&u>1?u-1:u],y=v[0]/b[0],x=v[1]/b[1];let w=0;for(let k=0;k<d;k++){const S=k*l[0];for(let C=0;C<c;C++){const $=i?y*(C+.5):y*C;let T=Math.min(h-1,r?Math.round($):Math.floor($));i&&(T=Math.max(0,T));const E=S+T*l[1];for(let _=0;_<u;_++){const A=i?x*(_+.5):x*_;let O=Math.min(f-1,r?Math.round(A):Math.floor(A));i&&(O=Math.max(0,O));const B=E+O*l[2];for(let F=0;F<p;F++){const V=m[B+F];g[w++]=V}}}}return n.makeTensorInfo([d,c,u,p],o.dtype,g)}const a5={kernelName:Np,backendName:"cpu",kernelFunc:i5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l5(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s;Ne([r,o],"resizeNearestNeighborGrad");const a=Ae(o.shape),l=Ae(r.shape),[c,u,d,h]=o.shape,[,f,p]=r.shape,m=new Float32Array(c*u*d*h),g=n.data.get(r.dataId).values,v=[i&&f>1?u-1:u,i&&p>1?d-1:d],b=[i&&f>1?f-1:f,i&&p>1?p-1:p],y=v[0]/b[0],x=v[1]/b[1],w=1/y,k=1/x,S=Math.ceil(w)*2+2,C=Math.ceil(k)*2+2;for(let $=0;$<c;$++){const T=$*a[0];for(let E=0;E<u;E++){const _=T+E*a[1],A=Math.floor(E*w),O=Math.floor(A-S/2);for(let B=0;B<d;B++){const F=_+B*a[2],V=Math.floor(B*k),D=Math.floor(V-C/2);for(let U=0;U<h;U++){let J=0;for(let X=0;X<S;X++){const te=X+O;if(te<0||te>=f)continue;const ie=T+te*l[1],ue=te*y,ce=Math.min(u-1,i?Math.round(ue):Math.floor(ue));if(E===ce)for(let Y=0;Y<C;Y++){const z=Y+D;if(z<0||z>=p)continue;const ae=ie+z*l[2],re=z*x,he=Math.min(d-1,i?Math.round(re):Math.floor(re));B===he&&(J+=g[ae+U])}}m[F+U]=J}}}}return n.makeTensorInfo(o.shape,o.dtype,m)}const c5={kernelName:ly,backendName:"cpu",kernelFunc:l5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u5(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dims:r}=s;Ne(o,"reverse");const i=o.shape.length,a=tt(r,o.shape);if(i===0)return or({inputs:{x:o},backend:n});const l=new In(o.shape,o.dtype),c=n.bufferSync(o);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),h=d.slice();a.forEach(f=>h[f]=o.shape[f]-1-h[f]),l.set(c.get(...h),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const d5={kernelName:_p,backendName:"cpu",kernelFunc:u5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5={kernelName:gy,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:o,fillValue:r,center:i}=e,a=n,l=An(s.dtype,oe(s.shape)),[c,u,d,h]=s.shape,[f,p]=ix(i,u,d),m=255,g=Math.sin(o),v=Math.cos(o),b=a.data.get(s.dataId).values;for(let x=0;x<c;x++){const w=x*d*u*h;for(let k=0;k<u;k++){const S=k*(d*h);for(let C=0;C<d;C++){const $=C*h;for(let T=0;T<h;T++){const E=[c,k,C,T],_=E[2],A=E[1];let O=(_-f)*v-(A-p)*g,B=(_-f)*g+(A-p)*v;O=Math.round(O+f),B=Math.round(B+p);let F=r;if(typeof r!="number"&&(T===3?F=m:F=r[T]),O>=0&&O<d&&B>=0&&B<u){const D=B*(d*h),U=O*h,J=w+D+U+T;F=b[J]}const V=w+S+$+T;l[V]=F}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f5=bt(ju,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),p5={kernelName:ju,backendName:"cpu",kernelFunc:f5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m5(t){const{inputs:e,backend:n,attrs:s}=t,{indices:o,updates:r}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Ia(r,o,i),h=!0,f=n.bufferSync(o),p=n.bufferSync(r),m=qi(f,p,i,d,c,l,a,u,0,h);return n.makeTensorInfo(i,m.dtype,m.values)}const g5={kernelName:wI,backendName:"cpu",kernelFunc:m5};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(t,e){let n=0,s=t.length,o=0;for(;n<s;)o=Math.floor((n+s)/2),t[o]<e?n=o+1:s=o;return s}function b5(t,e){let n=0,s=t.length,o=0;for(;n<s;)o=Math.floor((n+s)/2),t[o]<=e?n=o+1:s=o;return s}function y5(t,e,n,s,o,r){const i=Ut("int32",n*o);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),c=a*o;for(let u=0;u<o;++u)i[c+u]=r==="left"?v5(l,e[u+c]):b5(l,e[u+c])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x5(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:o,values:r}=e,{side:i}=s,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,c=y5(a,l,o.shape[0],o.shape[1],r.shape[1],i);return n.makeTensorInfo(r.shape,"int32",c)}const w5={kernelName:kI,backendName:"cpu",kernelFunc:x5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C5(t){const{inputs:e,backend:n}=t,{condition:s,t:o,e:r}=e;Ne([s,o,r],"select");const i=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,c=n.data.get(r.dataId).values,u=vs(o.dtype,r.dtype),d=Rn(oe(o.shape),u);let h=0;const f=i===0||i>1||o.shape.length===1?1:oe(o.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?d[h++]=l[p]:d[h++]=c[p];return n.makeTensorInfo(o.shape,u,d)}const k5={kernelName:Ap,backendName:"cpu",kernelFunc:C5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S5=Zp,I5=Qp,$5=bt(qu,t=>t>=0?I5*t:S5*(Math.exp(t)-1)),T5={kernelName:qu,backendName:"cpu",kernelFunc:$5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5=bt(Zu,t=>t<0?-1:t>0?1:0),E5={kernelName:Zu,backendName:"cpu",kernelFunc:N5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _5=bt(Xu,t=>Math.sin(t)),A5={kernelName:Xu,backendName:"cpu",kernelFunc:_5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R5=bt(Yu,t=>Math.sinh(t)),D5={kernelName:Yu,backendName:"cpu",kernelFunc:R5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F5=11920928955078125e-23,qw=Math.log(F5)+2,O5=bt(Ju,t=>{const e=t>-qw,n=t<qw,s=Math.exp(t);let o;return n?o=s:e?o=t:o=Math.log(1+s),o}),P5={kernelName:Ju,backendName:"cpu",kernelFunc:O5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M5(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,paddings:i}=s;Ne([o],"spaceToBatchND");const a=oe(r),l=[[0,0]];l.push(...i);for(let k=1+r.length;k<o.shape.length;++k)l.push([0,0]);const c=t_.kernelFunc({inputs:{x:o},backend:n,attrs:{paddings:l,constantValue:0}}),u=hd(c.shape,r,a,!1),d=fd(u.length,r.length,!1),h=pd(c.shape,r,a,!1),m=Tt({inputs:{x:c},backend:n,attrs:{shape:u}}),b=rs({inputs:{x:m},backend:n,attrs:{perm:d}}),w=Tt({inputs:{x:b},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(b),w}const L5={kernelName:Fp,backendName:"cpu",kernelFunc:M5};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B5(t){const{inputs:e,backend:n}=t,{indices:s,values:o,denseShape:r,defaultValue:i}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(o.dataId).values,c=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values[0],[d,h,f,p,m]=TE(a,s.shape,s.dtype,l,o.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],o.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const V5={kernelName:SI,backendName:"cpu",kernelFunc:B5};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z5(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:o,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const i=Array.from(n.data.get(o.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(r.dataId).values),[c,u,d]=NE(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],r.dtype,new Int32Array(d))]}const W5={kernelName:II,backendName:"cpu",kernelFunc:z5};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U5(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${r.shape}`);if(o.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,[c,u]=Xx(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const G5={kernelName:$I,backendName:"cpu",kernelFunc:U5};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H5(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${r.shape}`);if(o.shape[0]!==r.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(o.dataId).values,l=n.data.get(r.dataId).values,[c,u]=Xx(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const j5={kernelName:TI,backendName:"cpu",kernelFunc:H5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K5(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:o,sparseValues:r,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=Ia(r,o,a),f=!1,p=n.bufferSync(o);let m;switch(r.dtype){case"bool":{const g=n.bufferSync(r),v=Boolean(n.data.get(i.dataId).values[0]);m=qi(p,g,a,h,u,c,l,d,v,f);break}case"float32":{const g=n.bufferSync(r),v=n.data.get(i.dataId).values[0];m=qi(p,g,a,h,u,c,l,d,v,f);break}case"int32":{const g=n.bufferSync(r),v=n.data.get(i.dataId).values[0];m=qi(p,g,a,h,u,c,l,d,v,f);break}case"string":{const g=n.bufferSync(r),v=ai(n.data.get(i.dataId).values[0]);m=qi(p,g,a,h,u,c,l,d,v,f);break}default:throw new Error(`Unsupported type ${r.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const q5={kernelName:NI,backendName:"cpu",kernelFunc:K5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X5(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{numOrSizeSplits:r,axis:i}=s,a=tt(i,o.shape)[0],l=wx(o,r,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{const h=[...u];h[a]=d;const f=ma({inputs:{x:o},backend:n,attrs:{begin:c,size:h}});return c[a]+=d,f})}const Y5={kernelName:Op,backendName:"cpu",kernelFunc:X5};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z5={kernelName:uy,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Ne(n,"square");const o=s.data.get(n.dataId).values,r=new Float32Array(o.length);for(let a=0;a<o.length;++a){const l=o[a];r[a]=l*l}return{dataId:s.write(r,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q5=bt(id,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),J5={kernelName:id,backendName:"cpu",kernelFunc:Q5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s;Ne(o,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:b,end:y,strides:x}=sx(o.shape,r,i,a,l,c,u,d,h);let w;if(m)w=Tt({inputs:{x:o},backend:n,attrs:{shape:p}});else if(g||v){N(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const k=ex(b,y,x),S=ma({inputs:{x:o},backend:n,attrs:{begin:b,size:k}});w=Tt({inputs:{x:S},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(S)}else{const k=n.bufferSync(o),S=AE(f,k,x,b);w=n.makeTensorInfo(p,S.dtype,S.values)}return w}const t8={kernelName:hy,backendName:"cpu",kernelFunc:e8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(t){const{inputs:e,backend:n,attrs:s}=t,{separator:o,nGramWidths:r,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.data.get(u.dataId).values,f=n.data.get(d.dataId).values,[p,m]=RE(h,f,o,r,i,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const s8={kernelName:EI,backendName:"cpu",kernelFunc:n8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:o}=s,{input:r,delimiter:i}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values[0],[c,u,d]=DE(a,l,o),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const r8={kernelName:_I,backendName:"cpu",kernelFunc:o8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:o}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=n.data.get(r.dataId).values,a=FE(i,o);return n.makeTensorInfo(r.shape,"int32",a)}const a8={kernelName:AI,backendName:"cpu",kernelFunc:i8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8=bt(sd,t=>Math.tan(t)),c8={kernelName:sd,backendName:"cpu",kernelFunc:l8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8=bt(od,t=>Math.tanh(t)),d8={kernelName:od,backendName:"cpu",kernelFunc:u8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h8(t){const{inputs:e,backend:n}=t,{tensor:s,indices:o,updates:r}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=Ia(r,o,s.shape),d=!1,h=n.bufferSync(o),f=n.bufferSync(r),p=n.bufferSync(s),m=qi(h,f,s.shape,u,l,a,i,c,p,d);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const f8={kernelName:CI,backendName:"cpu",kernelFunc:h8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reps:r}=s;Ne(o,"tile");const i=PE(n.bufferSync(o),r);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const m8={kernelName:rd,backendName:"cpu",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g8(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{k:r,sorted:i}=s;Ne(o,"topk");const a=n.data.get(o.dataId).values,[l,c]=LE(a,o.shape,o.dtype,r,i);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const v8={kernelName:fy,backendName:"cpu",kernelFunc:g8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(t){const{inputs:e,attrs:n,backend:s}=t,{image:o,transforms:r}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=n,[u,d,h,f]=o.shape,[p,m]=c!=null?c:[d,h],g=[u,p,m,f],v=Ae(o.shape),b=v[0],y=v[1],x=v[2],w=Ae(g),k=w[0],S=w[1],C=w[2],$=An(o.dtype,oe(g));$.fill(l);const T=s.data.get(o.dataId).values,E=s.data.get(r.dataId).values;for(let A=0;A<u;++A){const O=r.shape[0]===1?E:E.subarray(A*8,A*8+8);for(let B=0;B<p;++B)for(let F=0;F<m;++F)for(let V=0;V<f;++V){let D;const U=O[6]*F+O[7]*B+1;if(U===0)continue;const J=(O[0]*F+O[1]*B+O[2])/U,X=(O[3]*F+O[4]*B+O[5])/U,te=Xw(J,h,a),ie=Xw(X,d,a);switch(i){case"nearest":D=S8(T,d,h,b,y,x,A,ie,te,V,l);break;case"bilinear":D=I8(T,d,h,b,y,x,A,ie,te,V,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const ue=A*k+B*S+F*C+V;$[ue]=D}return s.makeTensorInfo(g,o.dtype,$)}return{dataId:s.write($,g,o.dtype),shape:o.shape,dtype:o.dtype}}const y8={kernelName:py,backendName:"cpu",kernelFunc:b8};function Xw(t,e,n){switch(n){case"reflect":return x8(t,e);case"wrap":return w8(t,e);case"nearest":return k8(t,e);case"constant":default:return C8(t)}}function x8(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return na(0,n,e-1)}function w8(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return na(0,n,e-1)}function C8(t,e){return t}function k8(t,e){return na(0,t,e-1)}function xc(t,e,n,s,o,r,i,a,l,c,u){const d=i*s+a*o+l*r+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:u}function S8(t,e,n,s,o,r,i,a,l,c,u){const d=Math.round(a),h=Math.round(l);return xc(t,e,n,s,o,r,i,d,h,c,u)}function I8(t,e,n,s,o,r,i,a,l,c,u){const d=Math.floor(a),h=Math.floor(l),f=d+1,p=h+1,m=(p-l)*xc(t,e,n,s,o,r,i,d,h,c,u)+(l-h)*xc(t,e,n,s,o,r,i,d,p,c,u),g=(p-l)*xc(t,e,n,s,o,r,i,f,h,c,u)+(l-h)*xc(t,e,n,s,o,r,i,f,p,c,u);return(f-a)*m+(a-d)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(t){const{inputs:e,attrs:n,backend:s}=t,{axis:o}=n,{x:r}=e;Ne(r,"unique");const i=s.data.get(r.dataId).values,{outputValues:a,outputShape:l,indices:c}=BE(i,o,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const T8={kernelName:my,backendName:"cpu",kernelFunc:$8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(t){const{inputs:e,backend:n,attrs:s}=t,{value:o}=e;let{axis:r}=s;r<0&&(r+=o.shape.length);const i=o.shape.length,a=o.shape[r],l=new Array(i-1);let c=0;for(let f=0;f<i;f++)f!==r&&(l[c++]=o.shape[f]);const u=new Array(i).fill(0),d=o.shape.slice();d[r]=1;const h=new Array(a);for(let f=0;f<h.length;f++){u[r]=f;const p=ma({inputs:{x:o},backend:n,attrs:{begin:u,size:d}});h[f]=Tt({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return h}const E8={kernelName:Mp,backendName:"cpu",kernelFunc:N8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,segmentIds:r}=e,{numSegments:i}=s;Ne(o,"unsortedSegmentSum");const a=o.shape.length,l=r.shape.length,c=[],u=[],d=a-l;let h=r;for(let p=0;p<d;++p){const m=tf({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=m,u.push(m)}for(let p=0;p<i;++p){const m=vi(p,"int32"),g=n.makeTensorInfo([],"int32",m),v=eE({inputs:{a:g,b:h},backend:n}),b=hi({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=um({inputs:{a:b,b:o},backend:n}),x=kd({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});c.push(x),u.push(g),u.push(v),u.push(b),u.push(y),u.push(x)}const f=e_({inputs:c,backend:n,attrs:{axis:0}});return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const A8={kernelName:Lp,backendName:"cpu",kernelFunc:_8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R8=[$6,iH,N6,_6,hH,R6,F6,P6,L6,V6,W6,G6,j6,X6,Z6,ej,nj,oj,ij,S6,lj,uj,hj,pH,pj,uH,gH,gj,aH,bj,xj,wj,kj,Ij,Tj,Ej,Aj,Dj,Oj,Mj,Bj,zj,Uj,Hj,jj,qj,Yj,Qj,Jj,eK,tK,sK,iK,v6,lK,vH,gK,bH,vK,xH,kK,SK,$K,CH,SH,NK,_K,RK,FK,$H,NH,lH,PK,yj,LK,VK,WK,b6,_H,RH,GK,FH,jK,XK,ZK,eq,nq,oq,rq,PH,aq,cq,dq,fq,mq,vq,yq,LH,wq,Sq,Tq,VH,WH,_q,Dq,Pq,GH,Lq,Vq,zq,t_,Hq,x6,KH,Kq,Xq,Zq,Jq,cH,gv,t5,w6,C6,k6,s5,r5,a5,c5,d5,h5,p5,t6,g5,w5,k5,T5,s6,E5,A5,D5,o6,Iq,P5,L5,V5,W5,G5,j5,q5,Y5,a6,Z5,c6,d6,J5,t8,s8,r8,a8,m6,oK,c8,d8,f8,m8,v8,y8,HH,T8,E8,A8,Bq];for(const t of R8)DI(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gi={},th={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function D8(t,e){Gi[t]=e}function So(t,e){if(!(t in Gi)||e!=null){const s=O8(t,e);if(s!==null)Gi[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=Gi[t];return n==null||n.isContextLost()?(delete Gi[t],So(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Gi[t])}function F8(t){if(!Q().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function O8(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e==null?F8(t):e;return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Gi[t]},!1),Q().getBool("SOFTWARE_WEBGL_ENABLED")&&(th.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",th)||n.getContext("experimental-webgl",th):n.getContext("webgl2",th)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Xc;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Xc||(Xc={}));var _s;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(_s||(_s={}));var Sn;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Sn||(Sn={}));function Sd(t,e){return[e,t]}function P8(t,e){return t*e}function nh(t){const e=oe(t),n=Math.ceil(e/4);return Mg(n)}function Ul(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function M8(t,e){const[n,s]=Ul(t,e);return n*s*4}function e0(t,e){const n=t;let s,o,r,i,a,l,c,u,d,h;return Q().getNumber("WEBGL_VERSION")===2?(s=n.R32F,o=n.R16F,r=n.RGBA16F,i=n.RGBA32F,a=n.RED,c=4,u=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(s=t.RGBA,o=t.RGBA,r=t.RGBA,i=n.RGBA,a=t.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,h=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:r,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(t,e){const n=e();return Q().getBool("DEBUG")&&L8(t),n}function L8(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+W8(t,e))}const B8=596e-10,V8=65504;function z8(t){return!!(Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||B8<Math.abs(t)&&Math.abs(t)<V8)}function W8(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function sh(t,e){return Or(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function U8(t,e){const n=Or(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ke(t,()=>t.shaderSource(n,e)),ke(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function G8(t,e){const n=Or(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ke(t,()=>t.shaderSource(n,e)),ke(t,()=>t.compileShader(n)),Q().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw n_(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const H8=/ERROR: [0-9]+:([0-9]+):/g;function n_(t,e){const n=H8.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],o=t.split(`
`),r=o.length.toString().length+2,i=o.map((d,h)=>sl((h+1).toString(),r)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,s-1),c=i.slice(s-1,s),u=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${sl(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function j8(t){return Or(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function K8(t,e){if(ke(t,()=>t.linkProgram(e)),!Q().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Ym(t,e){if(ke(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function q8(t,e){const n=Or(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),ke(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function X8(t,e){const n=Or(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),ke(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Y8(t){return Or(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Z8(t,e){const n=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,o=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+o+".")}}function Q8(t){return Or(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Yw(t,e,n,s,o,r,i){const a=t.getAttribLocation(e,n);return a===-1?!1:(ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),ke(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,r,i)),ke(t,()=>t.enableVertexAttribArray(a)),!0)}function J8(t,e,n){oX(t,n),ke(t,()=>t.activeTexture(t.TEXTURE0+n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function eX(t,e,n){return Or(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function tX(t,e,n){return t.getUniformLocation(e,n)}function nX(t,e,n,s){ke(t,()=>J8(t,e,s)),ke(t,()=>t.uniform1i(n,s))}function Zm(t,e,n){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function Zw(t,e){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function oh(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+sX(t,e))}function sX(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Or(t,e,n){const s=ke(t,()=>e());if(s==null)throw new Error(n);return s}function oX(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const o=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Cl(t,e=2){return oe(t.slice(0,t.length-e))}function kl(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function rh(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Cl(t),...kl(t)]),e}function rX(t,e=!1){let n=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=Q().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&Q().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?Ib(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=gi(t).newShape);let o=oe(t),r=null;t.length<=1&&o<=n?r=[1,o]:t.length===2&&t[0]<=n&&t[1]<=n?r=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?r=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?r=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?r=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(r=[t[0],t[1]*t[2]*t[3]]);const i=r!=null&&Math.max(...r)>s&&Math.min(...r)<=(e?2:1)&&Math.min(...r)>0;if(r==null||i)if(e){const a=Cl(t);let l=2,c=2;t.length&&([l,c]=kl(t)),o=a*(l/2)*(c/2),r=Mg(o).map(u=>u*2)}else r=Mg(o);return r}function ih(t){return t%2===0}function sf(t,e){if(t=t.slice(-2),e=e.slice(-2),mt(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||ih(n)&&ih(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&ih(t[0])&&ih(e[0])}let Qm,Jm;function iX(t){if(Qm==null){const e=So(t);Qm=e.getParameter(e.MAX_TEXTURE_SIZE)}return Qm}function aX(t){if(Jm==null){const e=So(t);Jm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jm)}function lX(t){if(t===0)return 0;let e;const n=So(t);return Ys(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Ys(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ys(t,e){return t.getExtension(e)!=null}function Qw(t){try{if(So(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function cX(t){if(t===0)return!1;const e=So(t);if(t===1){if(!Ys(e,"OES_texture_float"))return!1}else if(!Ys(e,"EXT_color_buffer_float"))return!1;return bv(e)}function uX(t){if(t===0)return!1;const e=So(t);if(t===1){if(!Ys(e,"OES_texture_float")||!Ys(e,"WEBGL_color_buffer_float"))return!1}else{if(Ys(e,"EXT_color_buffer_float"))return bv(e);const s="EXT_color_buffer_half_float";if(Ys(e,s)){const o=e.getExtension(s);return dX(e,o)}return!1}return bv(e)}function bv(t){const e=e0(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const s=1,o=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,s,o,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function dX(t,e){const n=e0(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const o=1,r=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,o,r,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(i),a}function hX(t){return t!==2?!1:So(t).fenceSync!=null}function Id(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&N(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ee=Q();Ee.registerFlag("HAS_WEBGL",()=>Ee.getNumber("WEBGL_VERSION")>0);Ee.registerFlag("WEBGL_VERSION",()=>Qw(2)?2:Qw(1)?1:0);Ee.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ee.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ee.get("WEBGL_VERSION")===2);Ee.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ee.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ee.registerFlag("WEBGL_PACK",()=>Ee.getBool("HAS_WEBGL"));Ee.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_CLIP",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_REDUCE",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_CONV_IM2COL",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ee.getBool("WEBGL_PACK"));Ee.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>iX(Ee.getNumber("WEBGL_VERSION")));Ee.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>aX(Ee.getNumber("WEBGL_VERSION")));Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Ee.getNumber("WEBGL_VERSION");return t===0?0:lX(t)});Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ee.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!qI());Ee.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>cX(Ee.getNumber("WEBGL_VERSION")));Ee.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ee.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ee.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ee.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>uX(Ee.getNumber("WEBGL_VERSION")));Ee.registerFlag("WEBGL_FENCE_API_ENABLED",()=>hX(Ee.getNumber("WEBGL_VERSION")));Ee.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ee.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ee.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Ee.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>qI()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Ee.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ee.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ee.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ee.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ee.registerFlag("WEBGL_EXP_CONV",()=>!1);Ee.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ee.getBool("IS_TEST"));Ee.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ee.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ee.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ee.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(){let t,e,n,s,o,r,i,a,l,c;return Q().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",o="texture",r="outputColor",i="out vec4 outputColor;",a=Q().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",o="texture2D",r="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:o,output:r,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Na(t,e,n="index"){const s=Ae(e);return s.map((o,r)=>{const i=`int ${t[r]} = ${n} / ${o}`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * ${o}`:`index -= ${t[r]} * ${o}`;return`${i}; ${a};`}).join("")}function dm(t,e,n="index"){const s=Ae(e);return s.map((o,r)=>{const i=`int ${t[r]} = ${n} / outShapeStrides[${r}]`,a=r===s.length-1?`int ${t[r+1]} = ${n} - ${t[r]} * outShapeStrides[${r}]`:`index -= ${t[r]} * outShapeStrides[${r}]`;return`${i}; ${a};`}).join("")}function fX(t,e){const n=t.length,s=t.map(r=>`${e}[${r}]`),o=new Array(n-1);o[n-2]=s[n-1];for(let r=n-3;r>=0;--r)o[r]=`(${o[r+1]} * ${s[r+1]})`;return o}function pX(t,e,n="index"){const s=t.map((r,i)=>i),o=fX(s,e);return o.map((r,i)=>{const a=`int ${t[i]} = ${n} / ${o[i]}`,l=i===o.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${o[i]}`:`index -= ${t[i]} * ${o[i]}`;return`${a}; ${l};`}).join("")}function t0(t){const e=Ae(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function n0(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const s_=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:o_}=t4;function mX(t,e,n){const s=[];if(t.forEach(f=>{const p=oe(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),n.enableShapeUniforms){const{uniformShape:m}=s0(n.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const o=s.join(`
`),r=t.map(f=>gX(f,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=e.texShape,a=Hn(),l=yX(a);let c,u,d=CX(a);return e.isPacked?(c=vX(e.logicalShape,i,n.enableShapeUniforms),u=wX(a)):(c=bX(e.logicalShape,i,n.enableShapeUniforms),u=xX(a)),n.packedInputs&&(d+=$X),[d,l,u,o,c,r,n.userCode].join(`
`)}function Gl(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return LX(t,e);case 1:return VX(t,e);case 2:return WX(t,e);case 3:return GX(t,e);case 4:return jX(t,e);case 5:return KX(t);case 6:return qX(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function r_(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return MX(t);case 1:return BX(t,e);case 2:return zX(t,e);case 3:return UX(t,e);default:return HX(t,e)}}function gX(t,e,n=!1,s){let o="";n?o+=r_(t,s):o+=Gl(t,s);const r=t.shapeInfo.logicalShape,i=e.logicalShape;return r.length<=i.length&&(n?o+=XX(t,e):o+=YX(t,e)),o}function vX(t,e,n){switch(t.length){case 0:return i_();case 1:return TX(t,e,n);case 2:return OX(t,e,n);case 3:return EX(t,e,n);default:return AX(t,e,n)}}function bX(t,e,n){switch(t.length){case 0:return i_();case 1:return NX(t,e,n);case 2:return PX(t,e,n);case 3:return _X(t,e,n);case 4:return RX(t,e,n);case 5:return DX(t,e);case 6:return FX(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function yX(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function xX(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function wX(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function CX(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${kX}
    ${SX}
    ${IX}
  `}const kX=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,SX=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IX=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$X=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function i_(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function TX(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function NX(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function EX(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[2]/2),r=o*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function _X(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${dm(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Na(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function AX(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[t.length-1]/2),r=o*Math.ceil(t[t.length-2]/2);let i=r,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)i*=t[t.length-c-1],a=`
      int b${c} = index / ${i};
      index -= b${c} * ${i};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${r};
      index -= b * ${r};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${t.length}(${l});
    }
  `}function RX(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${dm(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Na(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function DX(t,e){const n=Na(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function FX(t,e){const n=Na(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function OX(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(mt(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const o=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function PX(t,e,n){return mt(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Ea(t){return`offset${t}`}function MX(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Hn();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function LX(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[o,r]=t.shapeInfo.texShape;if(o===1&&r===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const i=Ea(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function BX(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,r=Hn();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${r.texture2D}(${n}, uv);
    }
  `;const i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${r.texture2D}(${n}, uv);
    }
  `}function VX(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Hl(t)}
      }
    `;const o=t.shapeInfo.texShape,r=o[0],i=o[1];if(i===1&&r===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=Ea(n);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${r}.0);
        return sampleTexture(${n}, uv);
      }
    `:r===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${r}, ${i}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function zX(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,i=r[0],a=r[1],l=Hn();if(r!=null&&mt(n,r))return e?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function WX(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape;if(r!=null&&mt(n,r)){if(e)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const h=r[0],f=r[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=gi(n),l=i;if(l.length<n.length){const h=jl(t,l),f=["row","col"];return`
      ${Gl(h,e)}
      float ${o}(int row, int col) {
        return ${o}(${Kl(f,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Hl(t)}
      }
    `;const c=r[0],u=r[1],d=Ea(s);return u===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function UX(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(n[0]===1){const h=n.slice(1),f=[1,2],p=jl(t,h),m=["b","row","col"];return`
        ${r_(p,e)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Kl(m,f)});
        }
      `}const a=Hn();if(e)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],c=i[1],u=Math.ceil(n[2]/2),d=u*Math.ceil(n[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function GX(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[1]*n[2],i=n[2],{newShape:a,keptDims:l}=gi(n),c=a;if(c.length<n.length){const m=jl(t,c),g=["row","col","depth"];return`
        ${Gl(m,e)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Kl(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${r}, ${i}, 1)));
        ${Hl(t)}
      }
    `;const u=t.shapeInfo.texShape,d=u[0],h=u[1],f=t.shapeInfo.flatOffset;if(h===r&&f==null)return e?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(h===i&&f==null)return e?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=Ea(s);return e?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r} + col * ${i} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${s}, uv);
      }
  `}function HX(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),o=Hn();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${n}, uv);
    }
  `;const r=t.shapeInfo.logicalShape,i=r.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(r[i-1]/2);let h=d*Math.ceil(r[i-2]/2),f="int b, int row, int col",p=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<i-1;m++)f=`int b${m}, `+f,h*=r[i-m-1],p=`b${m} * ${h} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${o.texture2D}(${n}, uv);
    }
  `}function jX(t,e){const n=t.shapeInfo.logicalShape,s=t.name,o="get"+s.charAt(0).toUpperCase()+s.slice(1),r=n[3],i=n[2]*r,a=n[1]*i,{newShape:l,keptDims:c}=gi(n);if(l.length<n.length){const b=jl(t,l),y=["row","col","depth","depth2"];return`
      ${Gl(b,e)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Kl(y,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${r}, 1)));
        ${Hl(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,g=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&u==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===r&&u==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;const v=Ea(s);return e?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${v});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${r} + depth2;
      vec2 uv = uvFromFlat(${h}, ${f}, index + ${v});
      return sampleTexture(${s}, uv);
    }
  `}function KX(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[4],r=e[3]*o,i=e[2]*r,a=e[1]*i,{newShape:l,keptDims:c}=gi(e);if(l.length<e.length){const m=jl(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Gl(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Kl(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${r}, ${o})) +
          depth3;
        ${Hl(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1];if(f===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${r}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=Ea(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${r} +
          depth2 * ${o} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function qX(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:o,keptDims:r}=gi(e);if(o.length<e.length){const g=jl(t,o),v=["row","col","depth","depth2","depth3","depth4"];return`
      ${Gl(g)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Kl(v,r)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Hl(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];if(p===u&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===i&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=Ea(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Hl(t){const e=t.name,n=oe(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function XX(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),o="get"+s+"AtOutCoords",r=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=o_(t.shapeInfo.logicalShape,e.logicalShape),l=xt(i),c=i-r;let u;const d=["x","y","z","w","u","v"];r===0?u="":i<2&&a.length>=1?u="coords = 0;":u=a.map(b=>`coords.${d[b+c]} = 0;`).join(`
`);let h="";i<2&&r>0?h="coords":h=t.shapeInfo.logicalShape.map((b,y)=>`coords.${d[y+c]}`).join(", ");let f="return outputValue;";const m=oe(t.shapeInfo.logicalShape)===1,v=oe(e.logicalShape)===1;if(r===1&&!m&&!v)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!v)i===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=r-2,y=r-1;a.indexOf(b)>-1&&a.indexOf(y)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(y)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${h});
      ${f}
    }
  `}function YX(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),o="get"+s+"AtOutCoords",r=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&mt(i,r))return`
      float ${o}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=xt(l),u=o_(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const f=["x","y","z","w","u","v"];a===0?h="":l<2&&u.length>=1?h="coords = 0;":h=u.map(m=>`coords.${f[m+d]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${h}
      return get${s}(${p});
    }
  `}function xt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function s0(t,e,n){const{newShape:s,keptDims:o}=gi(e),r=e.length,i=t&&r===3&&e[0]===1,a=i?e.slice(1):s,l=!t&&r>1&&!mt(e,n)&&s.length<r||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:o}}function jl(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function Kl(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(t,e,n,s){const o=n.map((u,d)=>{const h={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(h.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),r=o.map(u=>u.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=mX(o,i,e),l=G8(t.gl,a),c=t.createProgram(l);return Q().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:r,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:r,outShapeInfo:i},a_(t,e,c)))}function a_(t,e,n){const s=[],o=[];let r,i,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),Q().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const h={name:d,uniform:t.getUniformLocation(n,d,u),offset:t.getUniformLocation(n,`offset${d}`,u)};e.enableShapeUniforms&&(h.shape=t.getUniformLocation(n,`${d}Shape`,u),h.texShape=t.getUniformLocation(n,`${d}TexShape`,u)),s.push(h)}if(e.enableShapeUniforms&&(r=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),i=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)o.push(t.getUniformLocation(n,d.name,u));return{variablesLocations:s,customUniformLocations:o,infLoc:l,nanLoc:c,outShapeLocation:r,outShapeStridesLocation:a,outTexShapeLocation:i}}function Jw(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const o=n.logicalShape,r=e[s],i=r.shape;if(!mt(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(n.isUniform&&r.isUniform)return;const a=n.texShape,l=r.isUniform?null:r.texData.texShape;if(!mt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function QX(t,e,n,s,o){e.program.enableShapeUniforms||(Jw(e.inShapeInfos,n),Jw([e.outShapeInfo],[s]));const r=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(r.texture,i[0],i[1]):t.setOutputMatrixTexture(r.texture,i[0],i[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),Q().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:u,offset:d,shape:h,texShape:f}=e.variablesLocations[l];if(h){const{uniformShape:p}=s0(e.program.packedInputs,c.shape,c.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(h,new Int32Array(p));break;case 2:t.gl.uniform2iv(h,new Int32Array(p));break;case 3:t.gl.uniform3iv(h,new Int32Array(p));break;case 4:t.gl.uniform4iv(h,new Int32Array(p));break}}if(f&&t.gl.uniform2i(f,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(oe(c.shape)<2)t.gl.uniform1f(u,c.uniformValues[0]);else{let p=c.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=Ae(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&o)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=o[l];if(c.type==="float")t.gl.uniform1fv(u,d);else if(c.type==="vec2")t.gl.uniform2fv(u,d);else if(c.type==="vec3")t.gl.uniform3fv(u,d);else if(c.type==="vec4")t.gl.uniform4fv(u,d);else if(c.type==="int")t.gl.uniform1iv(u,d);else if(c.type==="ivec2")t.gl.uniform2iv(u,d);else if(c.type==="ivec3")t.gl.uniform3iv(u,d);else if(c.type==="ivec4")t.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function JX(t,e,n){let s="";e.concat(n).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=s0(t.packedInputs,i.shape,l);let h="",f="",p="";if(u.length===1&&t.packedInputs){const w=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${w[0]>1}_${w[1]>1}`}else if(u.length===2&&!t.packedInputs)f=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const w=Ae(u);p=`${w[0]===l[1]}_${w[w.length-1]===l[1]}`}const m=i.shape.length,g=u.length===2&&mt(i.shape,l),v=oe(i.shape)===1,b=ml(i.shape,n.shape),y=!t.packedInputs&&m===n.shape.length&&mt(l,n.texData.texShape),x=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${y}_${c?d:""}_${u.length}_${v}_${b}_${g}_${h}_${f}_${p}_${x}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const o=t.userCode;let r=t.constructor.name;return r+="_"+s+"_"+o+`${Q().getNumber("WEBGL_VERSION")}`,r}function Fn(t){return Q().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e7{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Xc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Hn();this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?dm(["r","c","d"],e):Na(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t7{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Xc.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Hn();this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?dm(["r","c","d"],e):Na(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n7{constructor(e){this.variableNames=["A"],this.outTexUsage=_s.DOWNLOAD;const n=Hn();this.outputShape=e,this.userCode=`
      ${s_}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s7{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=_s.DOWNLOAD;const n=Hn();this.outputShape=e,this.userCode=`
      ${s_}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o7={R:0,G:1,B:2,A:3};class eC{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=Hn();this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length);let r="result";n&&(r="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${o7[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?n0():t0(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${r}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r7{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Hn();this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length);let o="",r="result";n&&(r="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?n0():t0(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${s.output} = ${r};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(t){const e=Hn(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return U8(t,n)}function a7(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return q8(t,e)}function l7(t){const e=new Uint16Array([0,1,2,2,1,3]);return X8(t,e)}function $d(t,e,n,s,o,r){Z8(e,n);const i=Y8(t),a=t.TEXTURE_2D;return ke(t,()=>t.bindTexture(a,i)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Q().getNumber("WEBGL_VERSION")===1?ke(t,()=>t.texImage2D(a,0,s,e,n,0,o,r,null)):ke(t,()=>t.texStorage2D(a,1,s,e,n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[n,e]}}function l_(t){return t.internalFormatFloat}function c7(t,e,n,s){const[o,r]=Sd(e,n);return $d(t,o,r,l_(s),s.textureFormatFloat,t.FLOAT)}function c_(t){return t.internalFormatHalfFloat}function u7(t,e,n,s){const[o,r]=Sd(e,n);return $d(t,o,r,c_(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function u_(t){return t.downloadTextureFormat}function d7(t,e,n,s){const[o,r]=Sd(e,n);return $d(t,o,r,u_(s),t.RGBA,t.UNSIGNED_BYTE)}function d_(t){return t.internalFormatPackedFloat}function h7(t,e,n,s){const[o,r]=Ul(e,n);return $d(t,o,r,d_(s),t.RGBA,t.FLOAT)}function h_(t){return t.internalFormatPackedHalfFloat}function f7(t,e,n,s){const[o,r]=Ul(e,n);return $d(t,o,r,h_(s),t.RGBA,s.textureTypeHalfFloat)}function p7(t,e,n){return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Yw(t,e,"clipSpacePos",n,3,20,0)&&Yw(t,e,"uv",n,2,20,12)}function m7(t,e,n,s,o,r){ke(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;o instanceof Uint8Array?(i=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(n*s*4),a=t.FLOAT,l=r.internalFormatPackedFloat),i.set(o),Q().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,i)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,i)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function g7(t,e,n){ke(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?Q().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):Q().getNumber("WEBGL_VERSION")===2?ke(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function v7(t,e,n,s){const o=t.createBuffer();ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));const a=4*4*e*n;return ke(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ke(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function b7(t,e,n){const s=t,o=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,o),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),o}function y7(t,e,n,s){const[o,r]=Sd(e,n),i=4,a=new Uint8Array(P8(e*n,i));return ke(t,()=>t.readPixels(0,0,o,r,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function x7(t,e,n,s,o,r,i,a){const l=t,c=new Float32Array(M8(r,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function w7(t,e,n){const s=new Float32Array(e*n*4);return ke(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eg{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=Q().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,D8(n,e)):this.gl=So(n),e=this.gl,Q().getNumber("WEBGL_VERSION")===2){const r=e;this.createVertexArray=()=>ke(r,()=>r.createVertexArray()),this.bindVertexArray=i=>ke(r,()=>r.bindVertexArray(i)),this.deleteVertexArray=i=>ke(r,()=>r.deleteVertexArray(i)),this.getVertexArray=()=>ke(r,()=>r.getParameter(r.VERTEX_ARRAY_BINDING))}else if(e!=null){const r=e.getExtension("OES_vertex_array_object");if(r==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ke(e,()=>r.createVertexArrayOES()),this.bindVertexArray=i=>ke(e,()=>r.bindVertexArrayOES(i)),this.deleteVertexArray=i=>ke(e,()=>r.deleteVertexArrayOES(i)),this.getVertexArray=()=>ke(e,()=>e.getParameter(r.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Q().getNumber("WEBGL_VERSION")===1){const r="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=sh(this.gl,r),Ys(this.gl,i))this.textureHalfFloatExtension=sh(this.gl,i);else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Ys(this.gl,o))this.colorBufferHalfFloatExtension=sh(this.gl,o);else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Ys(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Ys(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=a7(this.gl),this.indexBuffer=l7(this.gl),this.framebuffer=Q8(this.gl),this.textureConfig=e0(this.gl,this.textureHalfFloatExtension)}get debug(){return Q().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ke(e,()=>e.finish()),ke(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ke(e,()=>e.deleteFramebuffer(this.framebuffer)),ke(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ke(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ke(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),c7(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),u7(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),d7(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),g7(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,o){this.throwIfDisposed(),m7(this.gl,e,n,s,o,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),f7(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),h7(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Zw(this.gl,this.framebuffer),this.outputTexture=null),ke(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>y7(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,o,r,i){return x7(this.gl,e,n,s,o,r,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return b7(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const o=v7(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(Q().getBool("WEBGL_FENCE_API_ENABLED")){const o=e,r=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=o.clientWaitSync(r,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},n=r}else Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>w7(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=i7(n));const s=j8(n);ke(n,()=>n.attachShader(s,this.vertexShader)),ke(n,()=>n.attachShader(s,e)),K8(n,s);const o=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Ym(n,o),o}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;ke(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),p7(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ke(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Ym(this.gl,this.program),ke(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?eX(this.gl,e,n):tX(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),ke(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),nX(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[o,r]=Ul(n,s);this.setOutputMatrixTextureDriver(e,o,r)}setOutputMatrixWriteRegion(e,n,s,o){this.setOutputMatrixWriteRegionDriver(s,e,o,n)}setOutputPackedMatrixWriteRegion(e,n,s,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Ym(this.gl,this.program),oh(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ke(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ke(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=sh(this.gl,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,o=this.getQueryTimerExtensionWebGL2(),r=s.createQuery();return s.beginQuery(o.TIME_ELAPSED_EXT,r),r}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await M1(()=>this.disposed||this.isQueryAvailable(e,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,o=this.getQueryTimerExtensionWebGL2(),r=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),r&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),o=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=C7(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in Q().platform&&(s=Q().platform.setTimeoutCustom.bind(Q().platform)),M1(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Zm(this.gl,e,this.framebuffer),this.debug&&oh(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Zm(this.gl,this.outputTexture,this.framebuffer),this.debug&&oh(this.gl)):Zw(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const o=this.gl;Zm(o,e,this.framebuffer),this.debug&&oh(o),this.outputTexture=e,ke(o,()=>o.viewport(0,0,n,s)),ke(o,()=>o.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,o){this.throwIfDisposed(),ke(this.gl,()=>this.gl.scissor(e,n,s,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function C7(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:k7,bincountImpl:f_,bincountReduceImpl:S7,bitwiseAndImpl:I7,castImpl:$7,ceilImpl:T7,concatImpl:N7,equalImpl:E7,expImpl:_7,expm1Impl:A7,floorImpl:R7,gatherNdImpl:D7,gatherV2Impl:F7,greaterImpl:O7,greaterEqualImpl:P7,lessImpl:M7,lessEqualImpl:L7,linSpaceImpl:B7,logImpl:V7,maxImpl:z7,maximumImpl:W7,minimumImpl:U7,multiplyImpl:G7,negImpl:H7,notEqualImpl:j7,prodImpl:K7,raggedGatherImpl:q7,raggedRangeImpl:X7,raggedTensorToTensorImpl:Y7,rangeImpl:Z7,rsqrtImpl:Q7,scatterImpl:J7,sigmoidImpl:eY,simpleAbsImpl:p_,sliceImpl:tY,sparseFillEmptyRowsImpl:nY,sparseReshapeImpl:sY,sparseSegmentReductionImpl:m_,sqrtImpl:oY,staticRegexReplaceImpl:rY,stridedSliceImpl:iY,stringNGramsImpl:aY,stringSplitImpl:lY,stringToHashBucketFastImpl:cY,subImpl:uY,tileImpl:dY,topKImpl:hY,transposeImpl:o0,uniqueImpl:fY}=g6;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function zn(t,e){return e===1?[t]:g_(t,e)}function pY(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mY{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Fn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=zn("rc",this.rank),s=xt(this.rank),o=this.getOutOfBoundsCondition(n),r=this.getSetup(n),i=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${r}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){let r=`${s===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)r=`${e[e.length-1-i]},`+r;n.push(r)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${o};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v_{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length);let s="";for(let o=0;o<4;o++){let r="thisRC = rc;";o%2===1&&(r+="thisRC.z += 1;"),o>1&&(r+="thisRC.y += 1;"),s+=`
        ${r}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${gY(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?n0():t0(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function gY(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?pX(["r","c","d"],"inputShape"):Na(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vY{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const o=nC(n,s),r=sC(e,o,s);r in this.freeTextures||(this.freeTextures[r]=[]),r in this.usedTextures||(this.usedTextures[r]=[]);const i=tC(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[r].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[r].pop();return this.usedTextures[r].push(l),l}let a;return o===Sn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Sn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Sn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Sn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Sn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[r].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,n,s,o){if(this.freeTextures==null)return;const r=nC(s,o),i=sC(n,r,o);i in this.freeTextures||(this.freeTextures[i]=[]);const a=tC(n,r,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=Q().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[i],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function bY(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function tC(t,e,n,s,o){const r=yY(e,s);let i;if(o){const[l,c]=Ul(t[0],t[1]);i=l*c}else{const[l,c]=Sd(t[0],t[1]);i=l*c}const a=bY(n,r);return i*a}function yY(t,e){switch(t){case Sn.PACKED_2X2_FLOAT32:return d_(e);case Sn.PACKED_2X2_FLOAT16:return h_(e);case Sn.UNPACKED_FLOAT32:return l_(e);case Sn.UNPACKED_FLOAT16:return c_(e);case Sn.PACKED_4X1_UNSIGNED_BYTE:return u_(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function xY(t){return Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Sn.PACKED_2X2_FLOAT32:Sn.UNPACKED_FLOAT32:t?Sn.PACKED_2X2_FLOAT16:Sn.UNPACKED_FLOAT16}function nC(t,e){if(t===_s.UPLOAD)return Sn.PACKED_2X2_FLOAT32;if(t===_s.RENDER||t==null)return xY(e);if(t===_s.DOWNLOAD||t===_s.PIXELS)return Sn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function sC(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ho{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const ao="if (isnan(x)) return x;",wY="return x;",oC="return abs(x);",CY="return (x >= 0.0) ? x : (exp(x) - 1.0);",kY=ao+`
  return (x < 0.0) ? 0.0 : x;
`,SY=ao+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,jr="return x;",IY="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Y="return x;",TY=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,NY=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,EY=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_Y="return 1.0 / (1.0 + exp(-1.0 * x));";class Zr{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AY{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length);const n=e.length,s=zn("rc",n),o=xt(n),r=pY(n,s),i=s.slice(-2),a=n<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${r});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RY=z$,DY=1e-7,FY=1e-4,ah={};function OY(t){return t in ah||(ah[t]={}),ah[t]}const PY=Q().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),MY=600;function LY(){return Q().global.screen==null?1024:Q().global.screen.height*Q().global.screen.width*window.devicePixelRatio*MY/1024/1024}class hm extends Sb{nextDataId(){return hm.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof eg)n=e;else{const s=So(Q().getNumber("WEBGL_VERSION"),e);n=new eg(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=So(Q().getNumber("WEBGL_VERSION"));n=new eg(s),this.binaryCache=OY(Q().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new vY(this.gpgpu),this.numMBBeforeWarning=LY(),this.texData=new oI(this,Mo())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,o,r,i){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[o,r]},l.texShape=[o,r];const c=rh(n),u=new eC(c,!1,i),d=this.runWebGLProgram(u,[a],s,[[o,r]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((Q().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Q().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const o={id:this.nextDataId()};return this.texData.set(o,{shape:n,dtype:s,values:e,usage:_s.UPLOAD,refCount:1}),o}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,o,r){if(Q().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:o,values:n,usage:_s.UPLOAD,refCount:r})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:o,complexTensorInfos:r,slice:i,shape:a,isPacked:l}=n;if(i!=null){let h;l?h=new Zr(a,jr):h=new Ho(a,jr);const f=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:o}],o),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return s;const c=this.activeTimers!=null;let u;c&&(u=Yn());let d;if(o==="complex64"){const h=this.readSync(r.real.dataId),f=this.readSync(r.imag.dataId);d=Ir(h,f)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Yn()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:s,shape:o,slice:r,dtype:i,complexTensorInfos:a,isPacked:l}=n;if(r!=null){let p;l?p=new Zr(o,jr):p=new Ho(o,jr);const m=this.runWebGLProgram(p,[{dataId:e,shape:o,dtype:i}],i),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(e);if(Q().getBool("DEBUG")&&!Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(i!=="complex64"&&Q().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const p=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(p.texture.texture,...nh(o))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];d=Ir(m,g)}else if(c==null)d=this.getValuesFromTexture(e);else{const p=oe(o);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const p=this.gpgpu.gl;ke(p,()=>p.deleteBuffer(c))}const h=this.convertAndCacheOnCPU(e,d),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Mo().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,n={}){const s=this.texData.get(e),{values:o,shape:r,slice:i,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let f;l?f=new Zr(r,jr):f=new Ho(r,jr);const p=this.runWebGLProgram(f,[{dataId:e,shape:r,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(c==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),d=Mo().makeTensorFromTensorInfo(u),h=this.texData.get(u.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(o=>ai(o));return et(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return et(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!z8(s))throw Q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:o}=this.texData.get(e),r=oe(n);if(Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),f=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...nh(n)).subarray(0,r);return this.disposeIntermediateTensorInfo(h),p}const i=Q().getBool("WEBGL_PACK")&&o===!0,a=i?rh(n):n,l=i?new s7(a):new n7(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,r);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let o=!1;this.programTimersStack==null?(this.programTimersStack=s,o=!0):this.activeTimers.push(s),this.activeTimers=s,e();const r=sa(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=sa(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,o&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(r);a.kernelMs=lP(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:i[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Yn(),endMs:null}}endTimer(e){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Yn(),e)}async getQueryTime(e){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:o,usage:r,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(o,s),this.textureManager.releaseTexture(n,o,r,i)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=PY){return Q().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&oe(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){Ts("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return RY(e.shape,n)}packedUnaryOp(e,n,s){const o=new Zr(e.shape,n),r=this.compileAndRun(o,[e],s);return Mo().makeTensorFromTensorInfo(r)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const o=p_(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,o)}if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,oC,e.dtype);const n=new Ho(e.shape,oC),s=this.compileAndRun(n,[e]);return Mo().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let o;if(n==="string"&&s!=null&&s.length>0&&du(s[0])){const r=s.map(i=>ni(i));o=this.write(r,e,n)}else o=this.write(s,e,n);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:n}}makeOutput(e,n,s){return Mo().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new AY(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new mY(e.shape),s=!0;return this.runWebGLProgram(n,[e],e.dtype,null,s)}packedReshape(e,n){const s=[Cl(e.shape),...kl(e.shape)],o={dtype:e.dtype,shape:s,dataId:e.dataId},r=[Cl(n),...kl(n)],i=new v_(r,s),a=!0,l=[s],c=this.runWebGLProgram(i,[o],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:o,shape:r,dtype:i}=s;if(n!=null){const h=oe(r),f=n[0]*n[1]*4;N(h<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=rh(r);let l;o?l=new t7(a):l=new e7(a);const c=!0,u=[n!=null?n:nh(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,u,c,n);return{dtype:i,shape:r,dataId:d.dataId}}runWebGLProgram(e,n,s,o,r=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Xc.DENSE){const v=i!=null?i:nh(e.outputShape);l.texShape=v.map(b=>b*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),oe(a.shape)===0)return l.values=An(a.dtype,0),a;const c=[],u=n.map(v=>{if(v.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(v.dataId);if(b.texture==null){if(!e.packedInputs&&oe(v.shape)<=Q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:v.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=v.shape)}if(this.uploadToGPU(v.dataId),!!b.isPacked!=!!e.packedInputs)v=b.isPacked?this.unpackTensor(v):this.packTensor(v),c.push(v),b=this.texData.get(v.dataId);else if(b.isPacked&&!sf(b.shape,v.shape)){const y=v,x=v.shape;v.shape=b.shape,v=this.packedReshape(v,x),c.push(v),b=this.texData.get(v.dataId),y.shape=x}return{shape:v.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=JX(e,u,d),f=this.getAndSaveBinary(h,()=>ZX(this.gpgpu,e,u,d)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),Q().get("ENGINE_COMPILE_ONLY")||QX(this.gpgpu,f,u,d,o),c.forEach(v=>this.disposeIntermediateTensorInfo(v)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=Q().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const v=Yn();v-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=v)}if(!Q().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&r===!1){const v=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),v}return a}compileAndRun(e,n,s,o,r=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,o,r)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Z(()=>{if(!Q().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=Q().getBool("DEBUG");Q().set("DEBUG",!1);const n=this.abs(pt(1e-8)).dataSync()[0];if(Q().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?DY:FY}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:o,values:r,texture:i,usage:a,isPacked:l}=n;if(i!=null)return;const c=this.activeTimers!=null;let u;c&&(u=Yn());let d=n.texShape;if(d==null&&(d=rX(s,l),n.texShape=d),r!=null){const h=rh(s);let f,p=d[1],m=d[0];const g=r instanceof Uint8Array||r instanceof Uint8ClampedArray;(l||!g)&&([p,m]=Ul(d[0],d[1])),l?f=new r7(h,g):f=new eC(h,g);const v=g?[m,p]:d,b=this.makeTensorInfo(v,o),y=this.texData.get(b.dataId);g?y.usage=_s.PIXELS:y.usage=_s.UPLOAD,y.texShape=v,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,m,r);const x=[[m,p]],w=!0,k=this.runWebGLProgram(f,[b],o,x,w),S=this.texData.get(k.dataId);n.texShape=S.texShape,n.isPacked=S.isPacked,n.usage=S.usage,Q().get("ENGINE_COMPILE_ONLY")?this.disposeData(k.dataId):(n.texture=S.texture,n.values=null,this.texData.delete(k.dataId)),this.disposeIntermediateTensorInfo(b),c&&(this.uploadWaitMs+=Yn()-u)}else{const h=this.acquireTexture(d,a,o,l);n.texture=h}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:o}=s;return n!=null&&(s.values=BY(n,o)),s.values}acquireTexture(e,n,s,o){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const r=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${r} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,o)}computeBytes(e,n){return e[0]*e[1]*_h(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(o=>{try{this.checkCompletion_(n),o(!0)}catch(r){throw r}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await i2(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(n_(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:o,nanLoc:r,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=a_(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=o,e.nanLoc=r,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:o,height:r,width:i,channels:a}=e,l=Mo().backend;if(!l.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(o,n,s,r,i,a);return Mo().makeTensorFromDataId(c,n,s,l)}}hm.nextDataId=0;function BY(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */XI()&&r$("webgl",()=>new hm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r0=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ga{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=qe(n,s),this.enableShapeUniforms=Fn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _a=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class ql{constructor(e,n,s,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=qe(n,s);const r=this.outputShape.length;this.enableShapeUniforms=Fn(r);let i="";if(o)if(r===0||oe(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${xt(r)} coords = getOutputCoords();
        `,r===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=zn("coords",r);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= outShape[${r} - 2];
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= outShape[${r} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[r-2]} + 1) >= ${this.outputShape[r-2]};
            bool nextColOutOfBounds =
              (${l[r-1]} + 1) >= ${this.outputShape[r-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ys(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const VY={kernelName:Ru,backendName:"webgl",kernelFunc:ys};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ii(t){const{inputs:e,backend:n}=t,{real:s,imag:o}=e,r=n.makeTensorInfo(s.shape,"complex64"),i=n.texData.get(r.dataId),a=ys({inputs:{x:s},backend:n}),l=ys({inputs:{x:o},backend:n});return i.complexTensorInfos={real:a,imag:l},r}const zY={kernelName:Mb,backendName:"webgl",kernelFunc:Ii};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b_="return (a < 0.) ? b * a : a;",y_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function WY(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{alpha:r}=s,i=n.makeTensorInfo([],"float32",vi(r,"float32")),a=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ql(y_,o.shape,i.shape):new ga(b_,o.shape,i.shape),l=n.runWebGLProgram(a,[o,i],"float32");return n.disposeIntermediateTensorInfo(i),l}const UY={kernelName:ip,backendName:"webgl",kernelFunc:WY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x_="return (a < 0.) ? b * a : a;",w_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function GY(t){const{inputs:e,backend:n}=t,{x:s,alpha:o}=e,r=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ql(w_,s.shape,o.shape):new ga(x_,s.shape,o.shape);return n.runWebGLProgram(r,[s,o],"float32")}const HY={kernelName:Ip,backendName:"webgl",kernelFunc:GY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xl="if (isnan(x)) return x;";function ct({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:o,backend:r})=>{const{x:i}=o,a=r,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&n!=null){const d=a.texData.get(i.dataId),h=n(d.values,l);return a.makeTensorInfo(i.shape,l,h)}const c=Q().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new Zr(i.shape,e):u=new Ho(i.shape,t),a.runWebGLProgram(u,[i],l)}}function En({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:o,dtype:r}){return({inputs:i,backend:a})=>{const{a:l,b:c}=i,u=a;if(s&&l.dtype==="complex64"){const p=u.texData.get(l.dataId),m=u.texData.get(c.dataId),[g,v]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(y=>{const[x,w]=y,k={dataId:x.dataId,dtype:x.dtype,shape:l.shape},S={dataId:w.dataId,dtype:w.dtype,shape:c.shape},C=new ga(t,l.shape,c.shape);return u.runWebGLProgram(C,[k,S],vs(x.dtype,w.dtype))}),b=Ii({inputs:{real:g,imag:v},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(v),b}const d=r||vs(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&o!=null){const p=u.texData.get(l.dataId).values,m=u.texData.get(c.dataId).values,g=l.dtype==="string"?$r(p):p,v=l.dtype==="string"?$r(m):m,[b,y]=o(l.shape,c.shape,g,v,d),x=u.makeTensorInfo(y,d),w=u.texData.get(x.dataId);return w.values=b,x}const h=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return h?f=new ql(e,l.shape,c.shape,n):f=new ga(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function Yc(t,e=!1){if(t==="linear")return e?$Y:wY;if(t==="relu")return e?NY:kY;if(t==="elu")return e?TY:CY;if(t==="relu6")return e?EY:SY;if(t==="prelu")return e?w_:x_;if(t==="leakyrelu")return e?y_:b_;if(t==="sigmoid")return e?_Y:IY;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class C_{constructor(e,n,s,o=!1,r=!1,i=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Fn(this.outputShape.length);const u=o?e[1]:e[2],d=Math.ceil(u/2),h=o?"i * 2, rc.y":"rc.y, i * 2",f=r?"rc.z, i * 2":"i * 2, rc.z",p=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",v="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,v="result = activation(result);");const b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let y="rc.x",x="rc.x";e[0]<n[0]?y=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${y};
        int batchB = ${x};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${v}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class iC{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=qe(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aC="return a * b;";function i0(t){const{inputs:e,backend:n}=t,{a:s,b:o}=e,r=vs(s.dtype,o.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(o.dataId),c=new iC(rC.REAL,s.shape,o.shape),u=new iC(rC.IMAG,s.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],h=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(u,d,"float32"),p=Ii({inputs:{real:h,imag:f},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}if(n.shouldExecuteOnCPU([s,o])){const a=n.texData.get(s.dataId),l=n.texData.get(o.dataId),[c,u]=G7(s.shape,o.shape,a.values,l.values,r),d=n.makeTensorInfo(u,r),h=n.texData.get(d.dataId);return h.values=c,d}let i;return Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new ql(aC,s.shape,o.shape):i=new ga(aC,s.shape,o.shape),n.runWebGLProgram(i,[s,o],r)}const jY={kernelName:zu,backendName:"webgl",kernelFunc:i0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KY(t,e,n){const s=[Cl(t.shape),...kl(t.shape)],o={dtype:t.dtype,shape:s,dataId:t.dataId},r=[Cl(e),...kl(e)],i=new v_(r,s),a=!0,l=[s],c=n.runWebGLProgram(i,[o],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{shape:r}=s,i=n,a=oe(o.shape),l=iI(r,a),c=oe(l);N(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=i.texData.get(o.dataId);return u.isPacked&&!sf(o.shape,l)&&!(u.texture!==null&&sf(u.shape,l))?KY(o,l,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}const qY={kernelName:Tp,backendName:"webgl",kernelFunc:xe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lC{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:o,inSize:r,outSize:i}=e;this.outputShape=[o,i];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${hl(d)?d.toPrecision(2):d}, ones);`}let u="";r%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XY{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:o,inSize:r,outSize:i}=e;this.outputShape=[o,i];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(s/4)*4,d=s%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";r%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YY(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=Yp(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function Aa(t,e,n,s){const o=YY(t.shape);let r=t;for(let i=0;i<o.length;i++){const{inSize:a,windowSize:l,outSize:c}=o[i];let u,d;n==="mean"?u=i===0?new lC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new lC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new XY({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=r,r=s.runWebGLProgram(u,[r],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZY{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[n[i]];this.outputShape=s,this.rank=s.length;const o=xt(this.rank),r=QY(n);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${r}));
    }
    `}}function QY(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let o=0;o<t.length;o++)s[t[o]]=n[o];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JY{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let u=0;u<s.length;u++)s[u]=e[n[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const o=xt(this.rank),r=g_("rc",this.rank),i=new Array(this.rank);for(let u=0;u<n.length;u++)i[n[u]]=r[u];const a=`vec2(${i.slice(-2).join()})`,l=`++${r[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${r[this.rank-1]};
      if(++${r[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fm(t,e,n){const s=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JY(t.shape,e):new ZY(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eZ(t,e,n,s){const o=e,r=t.shape.length,i=tt(o,t.shape);let a=i;const l=Lt(a,r),c=l!=null;let u=t;c&&(u=fm(t,l,s),a=Kt(a.length,r)),Nn("sum",a,r);const[d,h]=bn(u.shape,a);let f=d;n&&(f=Jt(d,i));const p=oe(h),g=oe(t.shape)/p,v=xe({inputs:{x:u},attrs:{shape:[g,p]},backend:s}),b=by(t.dtype),y=Aa(v,b,"sum",s),x=xe({inputs:{x:y},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(v),s.disposeIntermediateTensorInfo(y),c&&s.disposeIntermediateTensorInfo(u),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pm(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s;return eZ(o,r,i,n)}const tZ={kernelName:Dp,backendName:"webgl",kernelFunc:pm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gn(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{perm:r}=s,i=n,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[r[u]];let c;if(i.shouldExecuteOnCPU([o])){const d=i.texData.get(o.dataId).values,h=o0(d,o.shape,o.dtype,r,l);c=i.makeTensorInfo(l,o.dtype);const f=i.texData.get(c.dataId);f.values=h}else c=fm(o,r,i);return c}const nZ={kernelName:ol,backendName:"webgl",kernelFunc:Gn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k_=1e3;function of({a:t,b:e,transposeA:n,transposeB:s,backend:o,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],h=s?e.shape[u-1]:e.shape[u-2],f=n?t.shape[c-1]:t.shape[c-2],p=s?e.shape[u-2]:e.shape[u-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),v=oe(m),b=oe(g),x=qe(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);N(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const w=n?[v,d,f]:[v,f,d],k=s?[b,p,h]:[b,h,p],S=xe({inputs:{x:t},backend:o,attrs:{shape:w}}),C=xe({inputs:{x:e},backend:o,attrs:{shape:k}}),$=[S,C],T=Math.max(v,b),E=n?S.shape[1]:S.shape[2],_=r!=null,A=i!=null,O=l==="leakyrelu",B=l!=null?Yc(l,!0):null,F=_||A||O||B!=null;let V;if((f===1||p===1)&&E>k_&&F===!1){let U=S,J=C;n&&(U=Gn({inputs:{x:S},backend:o,attrs:{perm:[0,2,1]}}),$.push(U)),s&&(J=Gn({inputs:{x:C},backend:o,attrs:{perm:[0,2,1]}}),$.push(J));const X=p!==1,te=p===1;let ie=U;X&&(ie=xe({inputs:{x:U},backend:o,attrs:{shape:[T,E,1]}}),$.push(ie));const ue=p===1?2:1;let ce=J;te&&(ce=xe({inputs:{x:J},backend:o,attrs:{shape:[T,1,E]}}),$.push(ce));const Y=i0({inputs:{a:ie,b:ce},backend:o});V=pm({inputs:{x:Y},backend:o,attrs:{axis:ue,keepDims:!0}}),$.push(Y)}else{const U=vs(t.dtype,e.dtype),J=new C_(w,k,[T,f,p],n,s,_,B,A,O),X=[S,C];if(r!=null&&X.push(r),A&&X.push(i),O){const te=o.makeTensorInfo([],"float32",vi(a,"float32"));X.push(te),$.push(te)}V=o.runWebGLProgram(J,X,U)}const D=xe({inputs:{x:V},backend:o,attrs:{shape:x}});$.push(V);for(const U of $)o.disposeIntermediateTensorInfo(U);return D}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sZ(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;return of({a:o,b:r,transposeA:l,transposeB:c,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const oZ={kernelName:Ah,backendName:"webgl",kernelFunc:sZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cC="return abs(x);";function rZ(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const r=n.texData.get(s.dataId),i=p_(r.values);return n.makeTensorInfo(s.shape,s.dtype,i)}let o;return Q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Zr(s.shape,cC):o=new Ho(s.shape,cC),n.runWebGLProgram(o,[s],s.dtype)}const iZ={kernelName:Vf,backendName:"webgl",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aZ=ao+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,lZ=ct({opSnippet:aZ}),cZ={kernelName:hu,backendName:"webgl",kernelFunc:lZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uZ=ao+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,dZ=ct({opSnippet:uZ}),hZ={kernelName:fu,backendName:"webgl",kernelFunc:dZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC="return a + b;",fZ=En({opSnippet:uC,packedOpSnippet:uC,supportsComplex:!0,cpuKernelImpl:k7}),pZ={kernelName:Ml,backendName:"webgl",kernelFunc:fZ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mZ{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((r,i)=>`T${i}`);const s=[];this.variableNames.forEach(r=>{s.push(`float v${r} = get${r}AtOutCoords();`)});const o=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gZ{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((r,i)=>`T${i}`);const s=[];this.variableNames.forEach(r=>{s.push(`vec4 v${r} = get${r}AtOutCoords();`)});const o=this.variableNames.map(r=>`v${r}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yh(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return ys({inputs:{x:s[0]},backend:n});if(s.length>Q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=yh({inputs:s.slice(0,l),backend:n}),u=yh({inputs:s.slice(l),backend:n});return yh({inputs:[c,u],backend:n})}const o=s.map(l=>l.dtype).reduce((l,c)=>vs(l,c)),r=s.map(l=>l.shape),a=Q().getBool("WEBGL_PACK")?new gZ(s[0].shape,r):new mZ(s[0].shape,r);return n.runWebGLProgram(a,s,o)}const vZ={kernelName:_b,backendName:"webgl",kernelFunc:yh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=tt(r,o.shape);let c=l;const u=Lt(c,a);let d=o;u!=null&&(d=Gn({inputs:{x:o},backend:n,attrs:{perm:u}}),c=Kt(c.length,a)),Nn("all",c,a);const[h,f]=bn(d.shape,c),p=oe(f),m=xe({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=Aa(m,m.dtype,"all",n);let v;if(i){const b=Jt(h,l);v=xe({inputs:{x:g},backend:n,attrs:{shape:b}})}else v=xe({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),v}const yZ={kernelName:Ab,backendName:"webgl",kernelFunc:bZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=tt(r,o.shape);let c=l;const u=Lt(c,a);let d=o;u!=null&&(d=Gn({inputs:{x:o},backend:n,attrs:{perm:u}}),c=Kt(c.length,a)),Nn("any",c,a);const[h,f]=bn(d.shape,c),p=oe(f),m=xe({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=Aa(m,m.dtype,"any",n);let v;if(i){const b=Jt(h,l);v=xe({inputs:{x:g},backend:n,attrs:{shape:b}})}else v=xe({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),v}const wZ={kernelName:Rb,backendName:"webgl",kernelFunc:xZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CZ{constructor(e,n,s){this.variableNames=["A"];const{windowSize:o,batchSize:r,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[r,i];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kZ{constructor(e,n,s,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,N(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const r=e[e.length-1],i=Math.ceil(r/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=xt(l),u=zn("coords",l);let d,h;if(i===1){h=l+1;const C=xt(h);d=`
        ${C} sourceLocR = ${C}(${u.join()}, 0);
        ++${u[l-1]};
        ${C} sourceLocG = ${C}(${u.join()}, 0);
        ++${u[l-2]};
        ${C} sourceLocA = ${C}(${u.join()}, 0);
        --${u[l-1]};
        ${C} sourceLocB = ${C}(${u.join()}, 0);
        --${u[l-2]};`}else h=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,h),p="."+f[h-1],m=f.map(C=>"int "+C),g=zn("sourceLocR",h-1).concat("inIdx.r"),v=zn("sourceLocG",h-1).concat("inIdx.g"),b=zn("sourceLocB",h-1).concat("inIdx.b"),y=zn("sourceLocA",h-1).concat("inIdx.a"),x=s==="max"?"greaterThan":"lessThan",w=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${y.join()})));`,k=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${v.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${y.join()}) : 0.)`,S=o?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${S}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${k};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${k};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S_(t,e,n,s=null){let o=e.shape[0],r=e.shape[1];s!=null&&(o=s.shape[0],r=s.shape[1]);const i=Yp(r),a={windowSize:i,inSize:r,batchSize:o,outSize:Math.ceil(r/i)},l=new CZ(a,n,s==null),c=[e];s!=null&&c.push(s);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=S_(t,e,n,u);return t.disposeIntermediateTensorInfo(u),d}function I_(t,e,n,s=null){const o=s!=null?s.shape:e.shape,r=o[o.length-1],i=Yp(r),a=new kZ(o,i,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=I_(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function $_(t,e,n,s){const o=[n];if(Nn("arg"+s.charAt(0).toUpperCase()+s.slice(1),o,e.shape.length),!Q().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const r=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=t.unpackTensor(e),r.push(l));const[c,u]=bn(l.shape,o),d=oe(u),h=xe({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});r.push(h);const f=S_(t,h,s);r.push(f);const p=xe({inputs:{x:f},backend:t,attrs:{shape:c}});return r.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return I_(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;let i=tt(r,o.shape);const a=Lt(i,o.shape.length);let l=o;const c=[];a!=null&&(l=Gn({inputs:{x:o},backend:n,attrs:{perm:a}}),c.push(l),i=Kt(i.length,l.shape.length)),Nn("argMax",[i[0]],l.shape.length);const u=$_(n,l,i[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const IZ={kernelName:zf,backendName:"webgl",kernelFunc:SZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Z(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r}=s;let i=tt(r,o.shape);const a=Lt(i,o.shape.length);let l=o;const c=[];a!=null&&(l=Gn({inputs:{x:o},backend:n,attrs:{perm:a}}),c.push(l),i=Kt(i.length,l.shape.length)),Nn("argMin",[i[0]],l.shape.length);const u=$_(n,l,i[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const TZ={kernelName:Wf,backendName:"webgl",kernelFunc:$Z};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NZ=ao+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,EZ=ct({opSnippet:NZ}),_Z={kernelName:pu,backendName:"webgl",kernelFunc:EZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AZ=ao+"return log(x + sqrt(x * x + 1.0));",RZ=ct({opSnippet:AZ}),DZ={kernelName:mu,backendName:"webgl",kernelFunc:RZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FZ=ao+`
  return atan(x);
`,OZ=ct({opSnippet:FZ}),PZ={kernelName:gu,backendName:"webgl",kernelFunc:OZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MZ=r0+`
  return atan(a, b);
`,LZ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+_a+`
  return result;
`,BZ=En({opSnippet:MZ,packedOpSnippet:LZ}),VZ={kernelName:bu,backendName:"webgl",kernelFunc:BZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zZ=ao+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,WZ=ct({opSnippet:zZ}),UZ={kernelName:vu,backendName:"webgl",kernelFunc:WZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zc{constructor(e,n,s,o=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,v=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let b="0.0";if(m||(b="-1.0 / 1e-20"),s){const C=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${C} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?r?g:v:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const y="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const w=Math.floor(i/4)*4,k=i%4,S=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${y}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${S}
          }

          int xC = xCCorner + ${w};
          if (${k===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${k===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${k===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${S}
          }
        }
        setOutput(${x});
      }
    `}}class a0{constructor(e,n,s,o=!1,r=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,v=e.padInfo.top,b=e.padInfo.left;this.outputShape=e.outShape;const y=n==="avg";let x="0.0";if(y||(x="-1.0 / 1e-20"),s){const T=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${v}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${T} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?r?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let k=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(k="avgValue / max(count, 1.0)");const S=Math.floor(i/4)*4,C=i%4,$=`
      if (${y}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${v}, ${b});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${S}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${S};
            if (${C===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${C===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${C===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${k});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Id(o,"avgPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,c=1;N(Dn(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=ro(o.shape,r,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&mt(u.inShape,u.outShape))return ys({inputs:{x:o},backend:n});const d=new Zc(u,"avg",!1);return n.runWebGLProgram(d,[o],"float32")}const HZ={kernelName:Uf,backendName:"webgl",kernelFunc:GZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=s,u=[1,1,1],d=Dr(o.shape,r,i,u,a,l,c),h=new a0(d,"avg",!1);return n.runWebGLProgram(h,[o],"float32")}const KZ={kernelName:Gf,backendName:"webgl",kernelFunc:jZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,o=e.strideHeight,r=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class XZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,o=e.filterWidth,r=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=h-1-e.padInfo.top,g=f-1-e.padInfo.left,v=1/(n*s*o);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YZ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=Dr(i.shape,a,l,d,c,u),f=new XZ(h);return n.runWebGLProgram(f,[o],i.dtype)}const ZZ={kernelName:Fb,backendName:"webgl",kernelFunc:YZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r;Id([o,r],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=ro(i.shape,a,l,1,c),d=new qZ(u);return n.runWebGLProgram(d,[o],i.dtype)}const JZ={kernelName:Db,backendName:"webgl",kernelFunc:QZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e9(t){const{inputs:e,backend:n,attrs:s}=t,{a:o,b:r}=e,{transposeA:i,transposeB:a}=s;return of({a:o,b:r,transposeA:i,transposeB:a,backend:n})}const t9={kernelName:Hf,backendName:"webgl",kernelFunc:e9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n9{constructor(e,n,s,o,r,i){this.outputShape=[],this.variableNames=["x","mean","variance"],qe(e,n),qe(e,s);let a="0.0";o!=null&&(qe(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";r!=null&&(qe(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s9{constructor(e,n,s,o,r,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],qe(e,n),qe(e,s);let a="vec4(0.0)";o!=null&&(qe(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";r!=null&&(qe(e,r),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o9=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:o,variance:r,offset:i,scale:a}=t;N(o.shape.length===r.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),N(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),N(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,o,r];let u=null;i!=null&&(u=i.shape,c.push(i));let d=null;a!=null&&(d=a.shape,c.push(a));const h=Q().getBool("WEBGL_PACK_NORMALIZATION")?new s9(s.shape,o.shape,r.shape,u,d,l):new n9(s.shape,o.shape,r.shape,u,d,l);return e.runWebGLProgram(h,c,c[0].dtype)},r9={kernelName:sp,backendName:"webgl",kernelFunc:o9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i9{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=xt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=a9(this.rank);let o;const r=e.map((i,a)=>`sourceLoc.${yv[a]} = start[${a}] + coords.${yv[a]};`);o=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${r.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${s}));
      }
    `}}const yv=["x","y","z","w","u","v"];function a9(t){if(t===1)return"sourceLoc";if(t<=6)return yv.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l9{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=xt(this.rank),s=zn("coords",this.rank),o=zn("sourceLoc",this.rank),r=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${r})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${o[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c9(t,e,n,s){const o=s.texData.get(t.dataId),r=s.makeTensorInfo(n,t.dtype),i=s.texData.get(r.dataId);Object.assign(i,o),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=nx(e,Ae(t.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),r}function Yl(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,size:i}=s,[a,l]=Xp(o,r,i);if(Jy(o,a,l),oe(l)===0)return n.makeTensorInfo(l,o.dtype,[]);if(n.shouldExecuteOnCPU([o])||o.dtype==="string"){const d=n.texData.get(o.dataId),h=tY(d.values,a,l,o.shape,o.dtype);return n.makeTensorInfo(l,o.dtype,h)}const{isPacked:c}=n.texData.get(o.dataId),u=tx(o.shape,a,l);if(c||!u){const d=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l9(l):new i9(l),h=[a];return n.runWebGLProgram(d,[o],o.dtype,h)}return n.uploadToGPU(o.dataId),c9(o,a,l,n)}const u9={kernelName:Rp,backendName:"webgl",kernelFunc:Yl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d9=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,crops:i}=s;N(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((b,y)=>b*y),l=hd(o.shape,r,a),c=fd(l.length,r.length),u=pd(o.shape,r,a),d=ax(i,r.length),h=lx(u,i,r.length),f=[],p=xe({inputs:{x:o},backend:n,attrs:{shape:l}}),m=Gn({inputs:{x:p},backend:n,attrs:{perm:c}}),g=xe({inputs:{x:m},backend:n,attrs:{shape:u}}),v=Yl({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return f.push(p),f.push(m),f.push(g),f.forEach(b=>n.disposeIntermediateTensorInfo(b)),v},h9={kernelName:jf,backendName:"webgl",kernelFunc:d9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f9(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i}=s,a=n.readSync(o.dataId),l=n.readSync(r.dataId),c=f_(a,l,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,c)}const p9={kernelName:Ob,backendName:"webgl",kernelFunc:f9};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m9=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,g9=`
  return float(int(a.r) & int(b.r));
`;function v9(t){const{inputs:e,backend:n}=t,{a:s,b:o}=e,r=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=Q().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,o])||i===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(o.dataId).values,[u,d]=I7(s.shape,o.shape,l,c,s.dtype),h=n.makeTensorInfo(d,s.dtype),f=n.texData.get(h.dataId);return f.values=u,h}let a;return r?a=new ql(m9,s.shape,o.shape,!1):a=new ga(g9,s.shape,o.shape),n.runWebGLProgram(a,[s,o],s.dtype)}const b9={kernelName:Pb,backendName:"webgl",kernelFunc:v9};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y9(t){const{inputs:e,backend:n}=t,{s0:s,s1:o}=e,r=n.readSync(s.dataId),i=n.readSync(o.dataId),a=qe(Array.from(r),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const x9={kernelName:hI,backendName:"webgl",kernelFunc:y9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9="return float(a != b);",T_=En({opSnippet:w9,cpuKernelImpl:j7,dtype:"bool"}),C9={kernelName:xp,backendName:"webgl",kernelFunc:T_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Td(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.texData.get(s.dataId);return ys({inputs:{x:o.complexTensorInfos.real},backend:n})}const k9={kernelName:ay,backendName:"webgl",kernelFunc:Td};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S9="return float(int(x));";function I9(t,e){const n=new Ho(t.shape,S9),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xv(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dtype:r}=s;if(r==="complex64"){if(o.dtype==="complex64")return ys({inputs:{x:o},backend:n});const i=hn(o.shape),a=xv({inputs:{x:o},backend:n,attrs:{dtype:"float32"}}),l=Ii({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){const i=Td({inputs:{input:o},backend:n}),a=xv({inputs:{x:i},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(i),a}if(!aI(o.dtype,r)){const i=ys({inputs:{x:o},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:r}}if(n.shouldExecuteOnCPU([o])){const i=n.texData.get(o.dataId).values,[a,l,c]=$7(i,o.shape,o.dtype,r);return n.makeTensorInfo(a,l,c)}if(r==="int32")return I9(o,n);if(r==="bool"){const i=n.makeTensorInfo([],"bool",An("bool",1)),l=T_({inputs:{a:o,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${r}`)}const $9={kernelName:yu,backendName:"webgl",kernelFunc:xv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dC="return ceil(x);",T9=ct({opSnippet:dC,packedOpSnippet:dC,cpuKernelImpl:T7}),N9={kernelName:xu,backendName:"webgl",kernelFunc:T9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E9{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _9{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A9(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{clipValueMin:r,clipValueMax:i}=s;let a;Q().getBool("WEBGL_PACK_CLIP")?a=new _9(o.shape):a=new E9(o.shape);const l=[[r],[i]];return n.runWebGLProgram(a,[o],o.dtype,l)}const R9={kernelName:wu,backendName:"webgl",kernelFunc:A9};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D9{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hC(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function F9(t){const{inputs:e,backend:n}=t,{x:s}=e,o=n.texData.get(s.dataId),r=new D9(s.shape),i=[hC(s,o.complexTensorInfos.real),hC(s,o.complexTensorInfos.imag)];return n.runWebGLProgram(r,i,i[0].dtype)}const O9={kernelName:Kf,backendName:"webgl",kernelFunc:F9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P9{constructor(e){this.outputShape=[],this.outputShape=Xo(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let i=1;i<n.length;i++)n[i]=n[i-1]+e[i][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<n.length;i++){const a=n[i-1];s.push(`else if (yC < ${n[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const o=n.length,r=n[n.length-1];s.push(`else setOutput(getT${o}(yR, yC-${r}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M9{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Xo(e,n);const s=this.outputShape,o=s.length,r=xt(o),i=zn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const c=a[n],u=a.slice(-2),d=a.join();let h=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];h+=`
        if (${c} < ${l[m]}  && ${c} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${lh(a,c,g)}),
            vec2(${lh(u,c,g)}));
        }`}const f=l.length,p=l[l.length-1];h+=`
        return getChannel(
          getT${f}(${lh(a,c,p)}),
          vec2(${lh(u,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${h}
      }

      void main() {
        ${r} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${s[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${s[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${s[o-2]} &&
            ${i[o-1]} < ${s[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function lh(t,e,n){const s=t.indexOf(e);return t.map((r,i)=>i===s?`${r} - ${n}`:r).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mm(t){const{inputs:e,backend:n}=t,{input:s}=e,o=n.texData.get(s.dataId);return ys({inputs:{x:o.complexTensorInfos.imag},backend:n})}const L9={kernelName:Jb,backendName:"webgl",kernelFunc:mm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wc(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(b=>Td({inputs:{input:b},backend:n})),p=t.map(b=>mm({inputs:{input:b},backend:n})),m=wc(f,e,n),g=wc(p,e,n),v=Ii({inputs:{real:m,imag:g},backend:n});return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),v}let o=n.shouldExecuteOnCPU(t);if(s==="string"&&(o=!0),o){const f=t.map(x=>{const k=[-1,oe(x.shape.slice(e))];return xe({inputs:{x},backend:n,attrs:{shape:k}})}),p=f.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),m=Xo(f.map(x=>x.shape),1),g=f[0].shape[0]===1,v=N7(p,m,s,g),b=Xo(t.map(x=>x.shape),e),y=n.makeTensorInfo(b,s,v);return f.forEach(x=>n.disposeIntermediateTensorInfo(x)),y}const r=t.filter(f=>oe(f.shape)>0),i=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1;if(r.length===1){const f=i?new Ho(t[0].shape,jr):new Zr(t[0].shape,jr);return n.runWebGLProgram(f,t,s)}const a=Q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>a){const f=[];for(let m=0;m<r.length;m+=a){const g=r.slice(m,m+a);f.push(wc(g,e,n))}const p=wc(f,e,n);for(const m of f)n.disposeIntermediateTensorInfo(m);return p}if(i){const f=new M9(r.map(p=>p.shape),e);return n.runWebGLProgram(f,r,s)}const{tensors2D:l,outShape:c}=B9(r,e,n),u=new P9(l.map(f=>f.shape)),d=n.runWebGLProgram(u,l,s);l.forEach(f=>n.disposeIntermediateTensorInfo(f));const h=xe({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),h}function B9(t,e,n){const s=Xo(t.map(r=>r.shape),e);return{tensors2D:t.map(r=>xe({inputs:{x:r},attrs:{shape:[-1,oe(r.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N_(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s,r=tt(o,e[0].shape)[0],i=e.map(c=>c.shape);ox(i,r);const a=Xo(e.map(c=>c.shape),r);if(oe(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>oe(c.shape)>0);return l.length===1?ys({inputs:{x:l[0]},backend:n}):wc(l,r,n)}const V9={kernelName:qf,backendName:"webgl",kernelFunc:N_};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E_{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",v=g?1:2,b=g?2:3,y=g?3:1;let x="",w="";s&&(o?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`
          float activation(float x) {
            ${s}
          }
        `,w="result = activation(result);");const k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${y}];

        ivec2 xRCCorner =
            ivec2(coords[${v}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${k}
        ${w}
        setOutput(result);
      }
    `}}class z9{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,o=e.padInfo.left,r=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${r}, ${i}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class __{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Fn(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)h+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)h+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(d+1)/2;g++){const v=g*2;if(h+=`
           xC = xCCorner + ${v*l};
           `,a===1){if(v<u&&(i%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }
               `,l===1&&v>0?h+=`
                 xC${v} = vec4(xTexelC${v-2}.zw, xTexelC${v}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${v} = vec4(previous.zw, xTexelC${v}.xy);
                   } else {
                     xC${v} = vec4(0.0, 0.0, xTexelC${v}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xC${v} = xTexelC${v};
                 `,v+1<u)){const b=i%2===0?Ib(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                     xTexelC${v+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${v+1}.zw = vec2(0.0);
                     }
                     xTexelC${v+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${v+1} = vec4(previous.zw, xTexelC${v+1}.xy);
                     } else {
                      xC${v+1} = vec4(0.0, 0.0, xTexelC${v+1}.xy);
                     }
                     `:h+=`
                     xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.xy);
                     `):b===1?h+=`
                     xC${v+1} = xTexelC${v};
                     `:h+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                       xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${v+1}.zw = vec2(0.0);
                       }
                       xTexelC${v+1}Ready = 1;
                     }

                     xC${v+1} = xTexelC${v+1};
                     `}}else v<u&&(i%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.0);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
               `,v+1<u&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${v+1} = vec4(xTexelC${v+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${v}Ready == 0) {
                   xTexelC${v} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${v}.zw = vec2(0.0);
                   }
                   xTexelC${v}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${v+1}Ready == 0) {
                   xTexelC${v+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${v+1}.zw = vec2(0.);
                   }
                   xTexelC${v+1}Ready = 1;
                 }

                 xC${v} = vec4(
                   xTexelC${v}.xy, xTexelC${v+1}.xy);
               `,v+1<u&&(h+=`
                   xC${v+1} = vec4(xTexelC${v}.zw, xTexelC${v+1}.zw);
                 `)));v<u&&(h+=`
             wTexel = getW(r, ${v}, d1, d2);
             dotProd += xC${v}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${v}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,v+1<u&&(h+=`
               wTexel = getW(r, ${v+1}, d1, d2);
               dotProd += xC${v+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${v+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let f="",p="";s&&(o?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:r?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W9{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Fn(this.outputShape.length);const{dataFormat:s}=n,o=Hn(),r=s==="channelsLast",i=r?1:2,a=r?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${r}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${o.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rf(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function A_({x:t,filter:e,convInfo:n,backend:s,bias:o=null,preluActivationWeights:r=null,leakyreluAlpha:i=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),u=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,f=n.dataFormat==="channelsLast",p=!1,m=!1;let g;const v=[];if(r!=null){const x=rf(r.shape,f);x!=null&&(r=xe({inputs:{x:r},backend:s,attrs:{shape:x}}),v.push(r))}if(o!=null){const x=rf(o.shape,f);x!=null&&(o=xe({inputs:{x:o},backend:s,attrs:{shape:x}}),v.push(o))}if(!((d===1||h===1)&&u>k_)&&c.isPacked&&f&&c.texture!=null&&l[2]%2!==0&&mt(c.shape.slice(-3),l.slice(-3))){const x=l[0]*l[1]*(l[2]+1),w={dataId:t.dataId,shape:[1,x,n.inChannels],dtype:t.dtype},k=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,N(sf(c.shape,w.shape),()=>`packed reshape ${c.shape} to ${w.shape} isn't free`);const S=xe({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});v.push(S);const C=of({a:w,b:S,backend:s,transposeA:p,transposeB:m,bias:o,activation:a,preluActivationWeights:r,leakyreluAlpha:i}),$=s.texData.get(C.dataId);N($.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=k,$.shape=n.outShape,g=ys({inputs:{x:C},backend:s}),g.shape=n.outShape,v.push(C)}else{const x=n.outHeight*n.outWidth,w=xe({inputs:{x:t},backend:s,attrs:{shape:f?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),k=xe({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),S=of({a:f?w:k,b:f?k:w,transposeA:!f,transposeB:m,backend:s,bias:o,activation:a,preluActivationWeights:r,leakyreluAlpha:i});g=xe({inputs:{x:S},backend:s,attrs:{shape:n.outShape}}),v.push(w),v.push(k),v.push(S)}for(const x of v)s.disposeIntermediateTensorInfo(x);return g}function R_({x:t,filter:e,convInfo:n,backend:s,bias:o=null,preluActivationWeights:r=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:h,dataFormat:f}=n,p=f==="channelsLast",m=l*c*u,g=h*d,v=[n.batchSize,m,g],b=!0,y=!1,x=[];if(r!=null){const D=rf(r.shape,p);D!=null&&(r=xe({inputs:{x:r},backend:s,attrs:{shape:D}}),x.push(r))}if(o!=null){const D=rf(o.shape,p);D!=null&&(o=xe({inputs:{x:o},backend:s,attrs:{shape:D}}),x.push(o))}const w=xe({inputs:{x:e},backend:s,attrs:{shape:[1,m,oe(e.shape)/m]}});x.push(w);const k=new W9(v,n),S=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],C=s.runWebGLProgram(k,[t],"float32",S),$=xe({inputs:{x:C},backend:s,attrs:{shape:v}});x.push(C),x.push($);const T=o!=null,E=r!=null,_=a==="leakyrelu",A=a?Yc(a,!0):null,O=new C_(p?$.shape:w.shape,p?w.shape:$.shape,p?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],b,y,T,A,E,_),B=p?[$,w]:[w,$];if(o&&B.push(o),E&&B.push(r),_){const D=s.makeTensorInfo([],"float32",vi(i,"float32"));B.push(D),x.push(D)}const F=s.runWebGLProgram(O,B,"float32"),V=xe({inputs:{x:F},backend:s,attrs:{shape:n.outShape}});x.push(F);for(const D of x)s.disposeIntermediateTensorInfo(D);return V}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U9(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s,d=Fr(l),h=Tn(o.shape,r.shape,i,c,a,u,!1,d);let f;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))f=A_({x:o,filter:r,convInfo:h,backend:n});else if(h.strideWidth<=2&&d==="channelsLast"&&Q().getBool("WEBGL_EXP_CONV")){const m=new __(h),g=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];f=n.runWebGLProgram(m,[o,r],"float32",g)}else if(Q().getBool("WEBGL_CONV_IM2COL"))f=R_({x:o,filter:r,convInfo:h,backend:n});else{const m=new E_(h);f=n.runWebGLProgram(m,[o,r],"float32")}const p=xe({inputs:{x:f},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(f),p}const G9={kernelName:Xf,backendName:"webgl",kernelFunc:U9};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H9{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,o=e.padInfo.top,r=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class j9{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,o=e.strideHeight,r=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=i?1:2,u=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class K9{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,o=e.strideWidth,r=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${r};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class q9{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,o=e.filterWidth,r=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,u=o-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${r}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X9(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s,d=Fr(l),h=Tn(o.shape,u,i,1,a,c,!1,d),f=new H9(h);return n.runWebGLProgram(f,[o,r],"float32")}const Y9={kernelName:Lb,backendName:"webgl",kernelFunc:X9};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Z9{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Fn(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,o=n-1-e.padInfo.top,r=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${r});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q9(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s,d=Fr(c),h=Tn(i,r.shape,a,1,l,u,!1,d);if(Q().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const f=[[h.strideHeight,h.strideWidth]],p=new Z9(h);return n.runWebGLProgram(p,[o,r],"float32",f)}else{const f=new j9(h);return n.runWebGLProgram(f,[o,r],"float32")}}const J9={kernelName:Yf,backendName:"webgl",kernelFunc:Q9};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l}=s,c=bi(o.shape,r.shape,i,l,a),u=new z9(c);return n.runWebGLProgram(u,[o,r],"float32")}const tQ={kernelName:Zf,backendName:"webgl",kernelFunc:eQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,pad:a,filterShape:l}=s,c=bi(o.shape,l,i,1,a),u=new K9(c);return n.runWebGLProgram(u,[o,r],"float32")}const sQ={kernelName:Bb,backendName:"webgl",kernelFunc:nQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oQ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{pad:i,strides:a,inputShape:l}=s,c=bi(l,r.shape,a,1,i),u=new q9(c);return n.runWebGLProgram(u,[o,r],"float32")}const rQ={kernelName:Vb,backendName:"webgl",kernelFunc:oQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iQ=Xl+`
  return cos(x);
`,aQ=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${_a}
  return result;
`,lQ=ct({opSnippet:iQ,packedOpSnippet:aQ}),cQ={kernelName:Cu,backendName:"webgl",kernelFunc:lQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,dQ=ct({opSnippet:uQ}),hQ={kernelName:ku,backendName:"webgl",kernelFunc:dQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fQ{constructor(e,n,s,o,r){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,c]=e,[u]=n,[d,h]=s;this.outputShape=[u,d,h,c];const f=o==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[g,v,b]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[y,x,w]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${y});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${v};
        float width_scale = ${x};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${r}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${r}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pQ=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:o,boxes:r,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=s,u=new fQ(o.shape,r.shape,a,l,c);return n.runWebGLProgram(u,[o,r,i],"float32")},mQ={kernelName:Wb,backendName:"webgl",kernelFunc:pQ};var Qc;(function(t){t.Prod="*",t.Sum="+"})(Qc||(Qc={}));class fC{constructor(e,n,s,o){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const r=this.outputShape.length,i=this.op===Qc.Prod?"1.0":"0.0",a=s?i:`getX(${pC(r,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";s?(c=o?`end != ${l-1}`:"end != 0",u=o?"end + 1":"end - 1"):(c=o?`end + pow2 < ${l}`:"end >= pow2",u=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${xt(r)} coords = getOutputCoords();
        int end = ${mC(r,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${mC(r,"coords",this.op)} = idx;
          val ${this.op}= getX(${pC(r,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function pC(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function mC(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_(t,e,n,s,o,r){const i=e.shape.length,a=Lt([s],i);let l=e;a!=null&&(l=Gn({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=Kt(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const u=l.shape[c];let d=ys({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(u))-1;h++){const f=new fC(t,l.shape,!1,r),p=[[h]],m=d;d=n.runWebGLProgram(f,[d],d.dtype,p),n.disposeIntermediateTensorInfo(m)}if(o){const h=new fC(t,l.shape,o,r),f=d;d=n.runWebGLProgram(h,[d],d.dtype),n.disposeIntermediateTensorInfo(f)}if(a!=null){const h=yi(a),f=Gn({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),f}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;return D_(Qc.Prod,o,n,r,i,a)}const vQ={kernelName:zb,backendName:"webgl",kernelFunc:gQ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,exclusive:i,reverse:a}=s;return D_(Qc.Sum,o,n,r,i,a)}const yQ={kernelName:Qf,backendName:"webgl",kernelFunc:bQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,weights:r}=e,{size:i,binaryOutput:a}=s;if(o.shape.length===1){const l=n.readSync(o.dataId),c=n.readSync(r.dataId),u=f_(l,c,r.dtype,r.shape,i);return n.makeTensorInfo([i],r.dtype,u)}else if(o.shape.length===2){const l=n.bufferSync(o),c=n.bufferSync(r),u=S7(l,c,i,a);return n.makeTensorInfo(u.shape,r.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}const wQ={kernelName:Ub,backendName:"webgl",kernelFunc:xQ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CQ{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockSize:r,dataFormat:i}=s,a=o.shape[0],l=i==="NHWC"?o.shape[1]:o.shape[2],c=i==="NHWC"?o.shape[2]:o.shape[3],u=i==="NHWC"?o.shape[3]:o.shape[1],d=l*r,h=c*r,f=u/(r*r),p=i==="NHWC"?[a,d,h,f]:[a,f,d,h],m=new CQ(p,r,i);return n.runWebGLProgram(m,[o],o.dtype)}const SQ={kernelName:Gb,backendName:"webgl",kernelFunc:kQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F_{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Fn(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";s&&(o?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O_{constructor(e,n=!1,s=null,o=!1,r=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Fn(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=d;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)f+=`
          vec4 xTexelC${v*2};
          int xTexelC${v*2}Ready;
          vec4 xTexelC${v*2+1};
          int xTexelC${v*2+1}Ready;
          vec4 xC${v};`;f+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let v=0;v<d;v++)f+=`
          xTexelC${v*2} = vec4(0.0);
          xTexelC${v*2}Ready = 0;
          xTexelC${v*2+1} = vec4(0.0);
          xTexelC${v*2+1}Ready = 0;
          xC${v} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let v=0;v<(h+1)/2;v++){const b=v*2;if(f+=`
          xC = xCCorner + ${b*c};
          `,l===1){if(b<d&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,c===1&&b>0?f+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<d)){const y=a%2===0?Ib(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${y};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,c>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:f+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):y===1?f+=`
                    xC${b+1} = xTexelC${b};
                    `:f+=`
                    xCOffset = xC + ${y};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<d&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<d&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<d&&(f+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<d&&(f+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<d&&(f+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";s&&(o?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:r?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),r&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=s;let u=l;u==null&&(u=[1,1]),N(Dn(i,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Tn(o.shape,r.shape,i,u,a,c,!0);let h;Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new O_(d):h=new F_(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[o,r],"float32",f)}const $Q={kernelName:Jf,backendName:"webgl",kernelFunc:IQ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TQ{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,o=e.padInfo.top,r=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${r};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class NQ{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,o=e.strideHeight,r=e.strideWidth,i=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,dy:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s,d=Tn(o.shape,u,i,a,l,c,!0),h=new TQ(d);return n.runWebGLProgram(h,[o,r],"float32")}const _Q={kernelName:Hb,backendName:"webgl",kernelFunc:EQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,filter:r}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s,d=Tn(u,r.shape,i,a,l,c,!0),h=new NQ(d);return n.runWebGLProgram(h,[o,r],"float32")}const RQ={kernelName:jb,backendName:"webgl",kernelFunc:AQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DQ{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(t){const{inputs:e,backend:n}=t,{x:s}=e,o=[...s.shape,...s.shape],r=oe(s.shape),i=xe({inputs:{x:s},backend:n,attrs:{shape:[r]}}),a=new DQ(r),l=n.runWebGLProgram(a,[i],i.dtype),c=xe({inputs:{x:l},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),c}const OQ={kernelName:fI,backendName:"webgl",kernelFunc:FQ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PQ{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:o,strideHeight:r,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:h}=o;this.userCode=`
      const ivec2 strides = ivec2(${r}, ${i});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MQ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r}=e,{strides:i,pad:a,dilations:l}=s,c=ad(o.shape,r.shape,i,a,"NHWC",l);let u;const d=new PQ(c);u=n.runWebGLProgram(d,[o,r],"float32");const h=xe({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),h}const LQ={kernelName:ep,backendName:"webgl",kernelFunc:MQ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BQ(t){const{inputs:e,backend:n,attrs:s}=t,{equation:o}=s,r=e,{allDims:i,summedDims:a,idDims:l}=gx(o,r.length);bx(i.length,l,r);const{path:c,steps:u}=yx(a,l),d=u.length;let h=null,f=i.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:v,expandDims:b}=vx(f,l[g]);let y;xx(v)?y=r[g]:(y=Gn({inputs:{x:r[g]},backend:n,attrs:{perm:v}}),p.push(y));const x=y.shape.slice();for(let w=0;w<b.length;++w)x.splice(b[w],0,1);mt(y.shape,x)||(y=xe({inputs:{x:y},backend:n,attrs:{shape:x}}),p.push(y)),h===null?h=y:(h=i0({inputs:{a:y,b:h},backend:n}),p.push(h))}m<d-1&&(c[m]>=0&&(h=pm({inputs:{x:h},backend:n,attrs:{axis:c[m]-(i.length-f),keepDims:!1}}),p.push(h)),f--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const VQ={kernelName:Kb,backendName:"webgl",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zQ="return (x >= 0.0) ? x : (exp(x) - 1.0);",WQ=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,UQ=ct({opSnippet:zQ,packedOpSnippet:WQ}),GQ={kernelName:Iu,backendName:"webgl",kernelFunc:UQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HQ="return (b >= 0.0) ? a : a * (b + 1.0);",jQ=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,KQ=t=>{const{inputs:e,backend:n}=t,{dy:s,y:o}=e,r=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ql(jQ,s.shape,o.shape):new ga(HQ,s.shape,o.shape);return n.runWebGLProgram(r,[s,o],s.dtype)},qQ={kernelName:qb,backendName:"webgl",kernelFunc:KQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XQ=`
  return vec4(equal(a, b));
`,YQ="return float(a == b);",ZQ=En({opSnippet:YQ,packedOpSnippet:XQ,dtype:"bool",cpuKernelImpl:E7}),QQ={kernelName:tp,backendName:"webgl",kernelFunc:ZQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JQ=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${cx};
  float a1 = ${ux};
  float a2 = ${dx};
  float a3 = ${hx};
  float a4 = ${fx};
  float a5 = ${px};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,eJ=ct({opSnippet:JQ}),tJ={kernelName:$u,backendName:"webgl",kernelFunc:eJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nJ=Xl+`
  return exp(x);
`,sJ=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,P_=ct({opSnippet:nJ,packedOpSnippet:sJ,cpuKernelImpl:_7,dtype:"float32"}),oJ={kernelName:Tu,backendName:"webgl",kernelFunc:P_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wv(t){const{inputs:e,attrs:n,backend:s}=t,{dim:o}=n,{input:r}=e,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(N(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),xe({inputs:{x:r},backend:s,attrs:{shape:a}})}const rJ={kernelName:np,backendName:"webgl",kernelFunc:wv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gC="return exp(x) - 1.0;",iJ=ct({opSnippet:gC,packedOpSnippet:gC,cpuKernelImpl:A7}),aJ={kernelName:Nu,backendName:"webgl",kernelFunc:iJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vC{constructor(e,n,s){this.variableNames=["real","imag"];const o=n[1];this.outputShape=n;const r=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${o}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${r};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_(t,e,n){const s=n.texData.get(t.dataId),o=oe(t.shape),r=t.shape[t.shape.length-1],i=o/r,a=xe({inputs:{x:t},backend:n,attrs:{shape:[i,r]}}),l=a.shape,c=new vC("real",l,e),u=new vC("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],h=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(u,d,"float32"),p=Ii({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);const m=xe({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(t){const{inputs:e,backend:n}=t,{input:s}=e;return M_(s,!1,n)}const cJ={kernelName:Xb,backendName:"webgl",kernelFunc:lJ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uJ{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(t){const{backend:e,attrs:n}=t,{shape:s,value:o}=n;let{dtype:r}=n;if(r=r||Ol(o),r==="string"){const i=Ut(r,oe(s));return i.fill(o),e.makeTensorInfo(s,r,i)}else{const i=new uJ(s,o),a=[[o]];return e.runWebGLProgram(i,[],r,a)}}const dJ={kernelName:Yb,backendName:"webgl",kernelFunc:Nd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hJ{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fJ={kernelName:Zb,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,o=new hJ(n.shape);return s.runWebGLProgram(o,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bC="return floor(x);",pJ=ct({opSnippet:bC,packedOpSnippet:bC,cpuKernelImpl:R7}),mJ={kernelName:Eu,backendName:"webgl",kernelFunc:pJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gJ=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,vJ=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,bJ=En({opSnippet:gJ,packedOpSnippet:vJ,dtype:"int32"}),yJ={kernelName:_u,backendName:"webgl",kernelFunc:bJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xJ{constructor(e){this.variableNames=["A"];const n=Hn(),[s,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wJ{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Hn(),[s,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CJ={kernelName:kP,backendName:"webgl",kernelFunc:kJ};let Wa,tg=Q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function kJ(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:o}=e;const{numChannels:r}=s,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,r];if(a||i){const m=Q().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Wa==null||m!==tg)&&(tg=m,Wa=document.createElement("canvas").getContext("2d",{willReadFrequently:tg})),Wa.canvas.width=l,Wa.canvas.height=c,Wa.drawImage(o,0,0,l,c),o=Wa.canvas}const h=n.makeTensorInfo(u,"int32");n.texData.get(h.dataId).usage=_s.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),o);const f=Q().getBool("WEBGL_PACK")?new wJ(d):new xJ(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,m=Fr(u),g=Tn(o.shape,r.shape,l,d,c,h,!1,m);let v;const b=[],y=i!=null,x=a!=null,w=f==="leakyrelu",k=()=>{const C=[o,r],$=(T,E)=>{if(E==="NCHW"&&T.shape.length===1&&T.shape[0]!==1){const _=xe({inputs:{x:T},backend:n,attrs:{shape:[T.shape[0],1,1]}});return b.push(_),_}return T};if(y&&C.push($(i,u)),x&&C.push($(a,u)),w){const T=n.makeTensorInfo([],"float32",vi(p,"float32"));C.push(T),b.push(T)}return C};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))v=A_({x:o,filter:r,convInfo:g,backend:n,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&Q().getBool("WEBGL_EXP_CONV")){const C=f?Yc(f,!0):null,$=new __(g,y,C,x,w),T=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],E=k();v=n.runWebGLProgram($,E,"float32",T)}else if(Q().getBool("WEBGL_CONV_IM2COL"))v=R_({x:o,filter:r,convInfo:g,backend:n,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const C=f?Yc(f,!1):null,$=new E_(g,y,C,x,w),T=k();v=n.runWebGLProgram($,T,"float32")}const S=xe({inputs:{x:v},backend:n,attrs:{shape:g.outShape}});return b.push(v),b.forEach(C=>n.disposeIntermediateTensorInfo(C)),S}const IJ={kernelName:Rh,backendName:"webgl",kernelFunc:SJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $J(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,filter:r,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=s,p=[];let m=u;m==null&&(m=[1,1]),N(Dn(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=Tn(o.shape,r.shape,l,m,c,d,!0),v=Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=h?Yc(h,v):null,y=[o,r],x=i!=null,w=a!=null,k=h==="leakyrelu";if(x&&y.push(i),w&&y.push(a),k){const T=n.makeTensorInfo([],"float32",vi(f,"float32"));y.push(T),p.push(T)}let S;v?S=new O_(g,x,b,w,k):S=new F_(g,x,b,w,k);const C=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],$=n.runWebGLProgram(S,y,"float32",C);return p.forEach(T=>n.disposeIntermediateTensorInfo(T)),$}const TJ={kernelName:RI,backendName:"webgl",kernelFunc:$J};class NJ{constructor(e,n,s,o){this.sliceDim=e,this.strides=n,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=s;const r=xt(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${r} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EJ(t){const{inputs:e,backend:n}=t,{params:s,indices:o}=e,r=o.shape,i=r[r.length-1],a=oe(s.shape),[l,c,u,d]=Qy(s,o),h=xe({inputs:{x:o},backend:n,attrs:{shape:[c,i]}}),f=xe({inputs:{x:s},backend:n,attrs:{shape:[oe(s.shape)/u,u]}});if(n.shouldExecuteOnCPU([s,o])||s.dtype==="string"){const v=n.readSync(o.dataId),b=n.bufferSync(s),y=D7(v,b,s.dtype,c,i,u,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,y.values)}const p=new NJ(i,d,[c,u],s.shape),m=n.runWebGLProgram(p,[f,h],f.dtype),g=xe({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const _J={kernelName:pI,backendName:"webgl",kernelFunc:EJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AJ{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=xt(this.rank),o=RJ(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}}function RJ(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let o=0;o<t.length;o++)o===2?s.push("index"):s.push(`${n[o]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,indices:r}=e,{axis:i,batchDims:a}=s,l=tt(i,o.shape)[0];if(Q().get("DEBUG")){const b=n.readSync(r.dataId),y=o.shape[l];for(let x=0;x<b.length;++x){const w=b[x];N(w<=y-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${y-1}]`)}}const c=Cx(o,r,l,a),u=oe(r.shape),d=[],h=xe({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=xe({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(h),d.push(f);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([o,r])||o.dtype==="string"){const b=n.bufferSync(f),y=n.bufferSync(h),x=F7(y,b,p);return d.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(c.outputShape,x.dtype,x.values)}const m=new AJ(h.shape,p),g=n.runWebGLProgram(m,[h,f],h.dtype);d.push(g);const v=xe({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),v}const DJ={kernelName:op,backendName:"webgl",kernelFunc:L_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ="return float(a > b);",OJ=`
  return vec4(greaterThan(a, b));
`,PJ=En({opSnippet:FJ,packedOpSnippet:OJ,cpuKernelImpl:O7,dtype:"bool"}),MJ={kernelName:rp,backendName:"webgl",kernelFunc:PJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LJ="return float(a >= b);",BJ=`
  return vec4(greaterThanEqual(a, b));
`,VJ=En({opSnippet:LJ,packedOpSnippet:BJ,dtype:"bool",cpuKernelImpl:P7}),zJ={kernelName:Au,backendName:"webgl",kernelFunc:VJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(t){const{inputs:e,backend:n}=t,{input:s}=e;return M_(s,!0,n)}const UJ={kernelName:Qb,backendName:"webgl",kernelFunc:WJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GJ="return float(!isnan(x) && !isinf(x));",HJ=ct({opSnippet:GJ,dtype:"bool"}),jJ={kernelName:Du,backendName:"webgl",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ="return float(isinf(x));",qJ=ct({opSnippet:KJ,dtype:"bool"}),XJ={kernelName:Fu,backendName:"webgl",kernelFunc:qJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YJ="return float(isnan(x));",ZJ=ct({opSnippet:YJ,dtype:"bool"}),QJ={kernelName:Ou,backendName:"webgl",kernelFunc:ZJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JJ="return float(a < b);",eee=`
  return vec4(lessThan(a, b));
`,tee=En({opSnippet:JJ,packedOpSnippet:eee,cpuKernelImpl:M7,dtype:"bool"}),nee={kernelName:ap,backendName:"webgl",kernelFunc:tee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const see="return float(a <= b);",oee=`
  return vec4(lessThanEqual(a, b));
`,ree=En({opSnippet:see,packedOpSnippet:oee,cpuKernelImpl:L7,dtype:"bool"}),iee={kernelName:lp,backendName:"webgl",kernelFunc:ree};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aee(t){const{backend:e,attrs:n}=t,{start:s,stop:o,num:r}=n,i=B7(s,o,r);return e.makeTensorInfo([i.length],"float32",i)}const lee={kernelName:mI,backendName:"webgl",kernelFunc:aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cee=Xl+`
  return x < 0.0 ? 0./0. : log(x);
`,uee=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,dee=ct({opSnippet:cee,packedOpSnippet:uee,cpuKernelImpl:V7}),hee={kernelName:Pu,backendName:"webgl",kernelFunc:dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fee=Xl+`
  return log(1.0 + x);
`,pee=ct({opSnippet:fee}),mee={kernelName:Mu,backendName:"webgl",kernelFunc:pee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gee="return float(a >= 1.0 && b >= 1.0);",vee=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,bee=En({opSnippet:gee,packedOpSnippet:vee,dtype:"bool"}),yee={kernelName:cp,backendName:"webgl",kernelFunc:bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xee="return float(!(x >= 1.0));",wee=ct({opSnippet:xee}),Cee={kernelName:up,backendName:"webgl",kernelFunc:wee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kee="return float(a >= 1.0 || b >= 1.0);",See=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Iee=En({opSnippet:kee,packedOpSnippet:See,dtype:"bool"}),$ee={kernelName:dp,backendName:"webgl",kernelFunc:Iee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tee{constructor(e,n,s,o,r){this.variableNames=["x"],this.outputShape=[];const i=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${o}) * sum`;r===.5?l=`inversesqrt(${c})`:r===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nee{constructor(e,n,s,o,r){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${o}) * sum`;r===.5?l=`inversesqrt(${c})`:r===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${r}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eee=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{depthRadius:r,bias:i,alpha:a,beta:l}=s,c=Q().getBool("WEBGL_PACK_NORMALIZATION")?new Nee(o.shape,r,i,a,l):new Tee(o.shape,r,i,a,l);return n.runWebGLProgram(c,[o],o.dtype)},_ee={kernelName:hp,backendName:"webgl",kernelFunc:Eee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aee{constructor(e,n,s,o,r){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=o,this.beta=r,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${r})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${r});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ree=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o,y:r,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s,d=new Aee(o.shape,a,l,c,u);return n.runWebGLProgram(d,[o,r,i],o.dtype)},Dee={kernelName:ey,backendName:"webgl",kernelFunc:Ree};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fee(t,e,n,s){const o=oe(e),i=oe(t.shape)/o,a=xe({inputs:{x:t},attrs:{shape:[i,o]},backend:s}),l=Aa(a,t.dtype,"max",s),c=xe({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reductionIndices:r,keepDims:i}=s,a=o.shape.length,l=tt(r,o.shape);let c=l;const u=Lt(c,a),d=u!=null,h=n.shouldExecuteOnCPU([o]);let f=o;if(d){if(h){const y=n.texData.get(f.dataId).values,x=new Array(a);for(let S=0;S<x.length;S++)x[S]=o.shape[u[S]];const w=o0(y,o.shape,o.dtype,u,x);f=n.makeTensorInfo(x,o.dtype);const k=n.texData.get(f.dataId);k.values=w}else f=fm(o,u,n);c=Kt(c.length,a)}Nn("max",c,a);const[p,m]=bn(f.shape,c);let g=p;i&&(g=Jt(p,l));let v;if(h){const y=n.texData.get(f.dataId).values,x=z7(y,oe(m),g,o.dtype);v=n.makeTensorInfo(g,o.dtype);const w=n.texData.get(v.dataId);w.values=x}else v=Fee(f,m,g,n);return d&&n.disposeIntermediateTensorInfo(f),v}const Oee={kernelName:fp,backendName:"webgl",kernelFunc:B_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pee=r0+`
  return max(a, b);
`,Mee=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+_a+`
  return result;
`,Lee=En({opSnippet:Pee,packedOpSnippet:Mee,cpuKernelImpl:W7}),Bee={kernelName:Lu,backendName:"webgl",kernelFunc:Lee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vee(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;Id(o,"maxPool");const{filterSize:r,strides:i,pad:a,dimRoundingMode:l}=s,c=1;N(Dn(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=ro(o.shape,r,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&mt(u.inShape,u.outShape))return ys({inputs:{x:o},backend:n});const d=new Zc(u,"max",!1);return n.runWebGLProgram(d,[o],o.dtype)}const zee={kernelName:pp,backendName:"webgl",kernelFunc:Vee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{filterSize:r,strides:i,pad:a,dataFormat:l,dimRoundingMode:c}=s,u=[1,1,1],d=Dr(o.shape,r,i,u,a,c,l),h=new a0(d,"max",!1);return n.runWebGLProgram(h,[o],o.dtype)}const Uee={kernelName:mp,backendName:"webgl",kernelFunc:Wee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gee{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,o=e.dilationHeight,r=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=r-1-e.padInfo.top,l=i-1-e.padInfo.left,c=r*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Hee{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,o=e.strideWidth,r=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,f=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${r}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jee(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r}=e,i=r,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=Dr(i.shape,a,l,d,c,u),f=new a0(h,"max",!0),p=n.runWebGLProgram(f,[i],i.dtype),m=new Hee(h),g=n.runWebGLProgram(m,[o,p],i.dtype);return n.disposeIntermediateTensorInfo(p),g}const Kee={kernelName:ny,backendName:"webgl",kernelFunc:jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qee(t){const{inputs:e,backend:n,attrs:s}=t,{dy:o,input:r,output:i}=e,a=r;Id([r,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=ro(a.shape,l,c,1,u,d),f=!0,p=new Zc(h,"max",f),m=n.runWebGLProgram(p,[a],a.dtype),g=new Gee(h),v=n.runWebGLProgram(g,[o,m],a.dtype);return n.disposeIntermediateTensorInfo(m),v}const Xee={kernelName:ty,backendName:"webgl",kernelFunc:qee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yee(t,e,n,s){let o=new Zc(n,"max",!1);const r=s.runWebGLProgram(o,[t],"float32");o=new Zc(n,"max",!0,!0,e);const i=s.runWebGLProgram(o,[t],"float32");return[r,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zee={kernelName:gI,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:o,strides:r,pad:i,includeBatchInIndex:a}=e,l=n;N(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];N(Dn(r,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`);const u=ro(s.shape,o,r,c,i),[d,h]=Yee(s,a,u,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qee(t,e,n,s){const o=oe(e),i=oe(t.shape)/o,a=xe({inputs:{x:t},attrs:{shape:[i,o]},backend:s}),l=Aa(a,"float32","mean",s),c=xe({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jee={kernelName:gp,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:o,axis:r}=e,i=n,a=s.shape.length,l=tt(r,s.shape);let c=l;const u=Lt(c,a),d=u!=null,h=i.shouldExecuteOnCPU([s]),f=[];let p=s;if(d){if(h){const x=i.texData.get(p.dataId).values,w=new Array(a);for(let C=0;C<w.length;C++)w[C]=s.shape[u[C]];const k=o0(x,s.shape,s.dtype,u,w);p=i.makeTensorInfo(w,s.dtype);const S=i.texData.get(p.dataId);S.values=k}else p=fm(s,u,i);f.push(p),c=Kt(c.length,a)}Nn("sum",c,a);const[m,g]=bn(p.shape,c);let v=m;o&&(v=Jt(m,l));const b=Qee(p,g,v,i);for(const y of f)i.disposeIntermediateTensorInfo(y);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=tt(r,o.shape);let c=l;const u=Lt(c,a);let d=o;u!=null&&(d=Gn({inputs:{x:o},backend:n,attrs:{perm:u}}),c=Kt(c.length,o.shape.length)),Nn("min",c,a);const[h,f]=bn(d.shape,c),p=oe(f),m=xe({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=Aa(m,m.dtype,"min",n);let v;if(i){const b=Jt(h,l);v=xe({inputs:{x:g},backend:n,attrs:{shape:b}})}else v=xe({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),v}const tte={kernelName:vp,backendName:"webgl",kernelFunc:ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nte=r0+`
  return min(a, b);
`,ste=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+_a+`
  return result;
`,ote=En({opSnippet:nte,packedOpSnippet:ste,cpuKernelImpl:U7}),rte={kernelName:Bu,backendName:"webgl",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ite{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((u,d)=>u[0]+e[d]+u[1]);const o=e.length,r=xt(o),i=n.map(u=>u[0]).join(","),a=n.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=s==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${i});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${r} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ate{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const o=e.length,r=xt(o),i=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=zn("rc",o),c=zn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,h=s==="reflect"?0:1;let f="";if(o===1){const p=`
        ${r} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;f=`
        ${r} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const p=`
        ${r} source = rc;
        ${r} lt = ${r}(lessThan(source, start));
        ${r} gte = ${r}(greaterThanEqual(source, end));
        ${r} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;f=`
        ${r} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${r} start = ${r}(${i});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lte=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:o,mode:r}=n,i=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ate(s.shape,o,r):new ite(s.shape,o,r);return e.runWebGLProgram(i,[s],s.dtype)},cte={kernelName:bp,backendName:"webgl",kernelFunc:lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute=`if (b == 0.0) return NAN;
  return mod(a, b);`,dte=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+_a+`
  return result;
`,hte=En({opSnippet:ute,packedOpSnippet:dte}),fte={kernelName:Vu,backendName:"webgl",kernelFunc:hte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pte{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte=`
if (a == b) {
  return 1.0;
};
return a / b;`,gte=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,V_=En({opSnippet:mte,packedOpSnippet:gte,checkOutOfBounds:!0}),vte={kernelName:Su,backendName:"webgl",kernelFunc:V_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yC="return a - b;",z_=En({opSnippet:yC,packedOpSnippet:yC,supportsComplex:!0,cpuKernelImpl:uY}),bte={kernelName:nd,backendName:"webgl",kernelFunc:z_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{dim:r}=s,i=tt([r],o.shape),a=B_({inputs:{x:o},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),l=Jt(a.shape,i),c=xe({inputs:{x:a},backend:n,attrs:{shape:l}}),u=z_({inputs:{a:o,b:c},backend:n}),d=P_({inputs:{x:u},backend:n}),h=pm({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:!1}}),f=xe({inputs:{x:h},backend:n,attrs:{shape:l}}),p=V_({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}const yte={kernelName:Pp,backendName:"webgl",kernelFunc:W_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(t){const{inputs:e,backend:n,attrs:s}=t,{logits:o}=e,{numSamples:r,seed:i,normalized:a}=s,l=a?o:W_({inputs:{logits:o},backend:n,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new pte(c,u,r),h=[[i]],f=n.runWebGLProgram(d,[l],"int32",h);return a||n.disposeIntermediateTensorInfo(l),f}const wte={kernelName:vI,backendName:"webgl",kernelFunc:xte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte=ao+`
  return -x;
`,kte=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Ste(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const r=n.texData.get(s.dataId),[i,a]=H7(r.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}let o;return Q().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Zr(s.shape,kte):o=new Ho(s.shape,Cte),n.runWebGLProgram(o,[s],s.dtype)}const Ite={kernelName:yp,backendName:"webgl",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $te=jy;function Tte(t){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(o.dataId),u=n.readSync(r.dataId),{selectedIndices:d}=$te(c,u,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Nte={kernelName:sy,backendName:"webgl",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ete=Ky;function _te(t){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,u=n.readSync(o.dataId),d=n.readSync(r.dataId),{selectedIndices:h,validOutputs:f}=Ete(u,d,i,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const Ate={kernelName:oy,backendName:"webgl",kernelFunc:_te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=qy;function Dte(t){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:o,scores:r}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,u=n.readSync(o.dataId),d=n.readSync(r.dataId),h=i,f=a,p=l,m=c,{selectedIndices:g,selectedScores:v}=Rte(u,d,h,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([v.length],"float32",new Float32Array(v))]}const Fte={kernelName:ry,backendName:"webgl",kernelFunc:Dte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ote{constructor(e,n,s,o){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pte=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:o}=e,{dtype:r,depth:i,onValue:a,offValue:l}=s,c=oe(o.shape),u=new Ote(c,i,a,l),d=xe({inputs:{x:o},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(u,[d],r);n.disposeIntermediateTensorInfo(d);const f=[...o.shape,i],p=xe({inputs:{x:h},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(h),p},Mte={kernelName:Cp,backendName:"webgl",kernelFunc:Pte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function af(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const o=Td({inputs:{input:s},backend:n}),r=af({inputs:{x:o},backend:n}),i=mm({inputs:{input:s},backend:n}),a=af({inputs:{x:i},backend:n}),l=Ii({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Nd({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const Lte={kernelName:Bp,backendName:"webgl",kernelFunc:af};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const o=Td({inputs:{input:s},backend:n}),r=U_({inputs:{x:o},backend:n}),i=mm({inputs:{input:s},backend:n}),a=af({inputs:{x:i},backend:n}),l=Ii({inputs:{real:r,imag:a},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Nd({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const Bte={kernelName:wp,backendName:"webgl",kernelFunc:U_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vte(t){const{inputs:e,backend:n,attrs:s}=t,{axis:o}=s;if(e.length===1)return wv({inputs:{input:e[0]},backend:n,attrs:{dim:o}});const r=e[0].shape,i=e[0].dtype;e.forEach(u=>{$b(r,u.shape,"All tensors passed to stack must have matching shapes"),N(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=wv({inputs:{input:u},backend:n,attrs:{dim:o}});return a.push(d),d}),c=N_({inputs:l,backend:n,attrs:{axis:o}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const zte={kernelName:kp,backendName:"webgl",kernelFunc:Vte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wte{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const o=e.length,r=xt(o),i=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${r} start = ${r}(${i});
      ${r} end = ${r}(${a});

      void main() {
        ${r} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${r} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ute{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+e[g]+m[1]);const o=e.length,r=xt(o),i=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+e[g]).join(","),l=zn("rc",o),c=zn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${r} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=o===1?2:4;m<g;m++)p+=`
        ${h[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${r} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${d});
        }
      `;p+=o===1?"} ":"}}",this.userCode=`
      const ${r} start = ${r}(${i});
      const ${r} end = ${r}(${a});

      void main() {
        ${r} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G_=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{paddings:r,constantValue:i}=s;if(oe(o.shape)===0){const c=r.map((u,d)=>u[0]+o.shape[d]+u[1]);return Nd({backend:n,attrs:{shape:c,value:i,dtype:o.dtype}})}const a=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ute(o.shape,r,i):new Wte(o.shape,r,i),l=[[i]];return n.runWebGLProgram(a,[o],o.dtype,l)},Gte={kernelName:Sp,backendName:"webgl",kernelFunc:G_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hte=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,jte=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+_a+`
  return result;
`,Kte=En({opSnippet:Hte,packedOpSnippet:jte}),qte={kernelName:Wu,backendName:"webgl",kernelFunc:Kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xte(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{axis:r,keepDims:i}=s,a=o.shape.length,l=[],c=tt(r,o.shape);let u=c;const d=Lt(u,a);let h=o;d!=null&&(h=Gn({inputs:{x:o},backend:n,attrs:{perm:d}}),u=Kt(u.length,a),l.push(h)),Nn("prod",u,a);let f;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:m,outShape:g,outDtype:v}=K7(h.shape,h.dtype,p,u);f=n.makeTensorInfo(g,v,m)}else{const[p,m]=bn(h.shape,u),g=oe(m),v=xe({inputs:{x:h},backend:n,attrs:{shape:[-1,g]}}),b=by(o.dtype),y=Aa(v,b,"prod",n);f=xe({inputs:{x:y},backend:n,attrs:{shape:p}}),l.push(v),l.push(y)}if(i){l.push(f);const p=Jt(f.shape,c);f=xe({inputs:{x:f},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const Yte={kernelName:$p,backendName:"webgl",kernelFunc:Xte};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zte(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:o,paramsDenseValues:r,indices:i}=e,{outputRaggedRank:a}=s,l=o.map(v=>n.readSync(v.dataId)),c=o.map(v=>v.shape),u=n.readSync(r.dataId),d=n.readSync(i.dataId),[h,f,p]=q7(l,c,u,r.shape,r.dtype,d,i.shape,a),m=h.map(v=>n.makeTensorInfo([v.length],"int32",v)),g=n.makeTensorInfo(p,r.dtype,f);return m.concat([g])}const Qte={kernelName:bI,backendName:"webgl",kernelFunc:Zte};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jte(t){const{inputs:e,backend:n}=t,{starts:s,limits:o,deltas:r}=e,i=n.readSync(s.dataId),a=n.readSync(o.dataId),l=n.readSync(r.dataId),[c,u]=X7(i,s.shape,s.dtype,a,o.shape,l,r.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const ene={kernelName:yI,backendName:"webgl",kernelFunc:Jte};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tne(t){const{inputs:e,backend:n,attrs:s}=t,{shape:o,values:r,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(o.dataId),u=n.readSync(r.dataId),d=n.readSync(i.dataId),h=a.map(g=>n.readSync(g.dataId)),f=a.map(g=>g.shape),[p,m]=Y7(c,o.shape,u,r.shape,r.dtype,d,i.shape,h,f,l);return n.makeTensorInfo(p,r.dtype,m)}const nne={kernelName:xI,backendName:"webgl",kernelFunc:tne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_=t=>{const{backend:e,attrs:n}=t,{start:s,stop:o,step:r,dtype:i}=n,a=Z7(s,o,r,i);return e.makeTensorInfo([a.length],i,a)},sne={kernelName:iy,backendName:"webgl",kernelFunc:H_};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const one="return 1.0 / x;",rne=ct({opSnippet:one}),ine={kernelName:Uu,backendName:"webgl",kernelFunc:rne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane=ao+`
  return (x < 0.0) ? 0.0 : x;
`,lne=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cne=ct({opSnippet:ane,packedOpSnippet:lne}),une={kernelName:Gu,backendName:"webgl",kernelFunc:cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dne=ao+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,hne=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fne=ct({opSnippet:dne,packedOpSnippet:hne}),pne={kernelName:Hu,backendName:"webgl",kernelFunc:fne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mne{constructor(e,n,s,o,r){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[o&&n>1?a-1:a,o&&s>1?l-1:l],d=[o&&n>1?n-1:n,o&&s>1?s-1:s];let h;r?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gne{constructor(e,n,s,o,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[o&&n>1?a-1:a,o&&s>1?l-1:l],d=[o&&n>1?n-1:n,o&&s>1?s-1:s];let h;r?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vne(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s,[l,c]=a,u=Q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new gne(o.shape,l,c,r,i):new mne(o.shape,l,c,r,i);return n.runWebGLProgram(u,[o],"float32")}const bne={kernelName:Ep,backendName:"webgl",kernelFunc:vne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yne{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,o,r]=n,[,i,a]=e,l=[s&&i>1?o-1:o,s&&a>1?r-1:r],c=[s&&i>1?i-1:i,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,f=1/d,p=Math.ceil(h)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${r-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s,a=new yne(r.shape,o.shape,i);return n.runWebGLProgram(a,[r],r.dtype)}const wne={kernelName:cy,backendName:"webgl",kernelFunc:xne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cne{constructor(e,n,s,o,r){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[o&&n>1?a-1:a,o&&s>1?l-1:l],d=[o&&n>1?n-1:n,o&&s>1?s-1:s],h=o?"0.5":"0.0";let f;r?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kne{constructor(e,n,s,o,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[o&&n>1?a-1:a,o&&s>1?l-1:l],d=[o&&n>1?n-1:n,o&&s>1?s-1:s],h=o?"0.5":"0.0";let f;r?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sne(t){const{inputs:e,backend:n,attrs:s}=t,{images:o}=e,{alignCorners:r,halfPixelCenters:i,size:a}=s,[l,c]=a,u=Q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new kne(o.shape,l,c,r,i):new Cne(o.shape,l,c,r,i);return n.runWebGLProgram(u,[o],o.dtype)}const Ine={kernelName:Np,backendName:"webgl",kernelFunc:Sne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $ne{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,o,r]=n,[,i,a]=e,l=[s&&i>1?o-1:o,s&&a>1?r-1:r],c=[s&&i>1?i-1:i,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,f=1/d,p=Math.ceil(h)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tne(t){const{inputs:e,backend:n,attrs:s}=t,{images:o,dy:r}=e,{alignCorners:i}=s,a=new $ne(r.shape,o.shape,i);return n.runWebGLProgram(a,[r],r.dtype)}const Nne={kernelName:ly,backendName:"webgl",kernelFunc:Tne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ene{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const o=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,r=e.map((a,l)=>o(l)).join(","),i=xt(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${r}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ne{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const o=zn("rc",s),r=`${o[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${o[s-2]} + 1 < ${this.outputShape[s-2]}`,a=xt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${r}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${r}){
            result.g = ${c(o.slice())};
          }
          if(${i}) {
            result.b = ${u(o.slice())};
            if(${r}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return h(p)}function c(p){return p[s-1]="("+p[s-1]+" + 1)",h(p)}function u(p){return p[s-2]="("+p[s-2]+" + 1)",h(p)}function d(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",h(p)}function h(p){const m=e.map((b,y)=>f(y,p)),g=m.join(","),v=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${v}))`}function f(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ane(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{dims:r}=s,i=o.shape.length,a=tt(r,o.shape);if(i===0)return ys({inputs:{x:o},backend:n});const l=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _ne(o.shape,a):new Ene(o.shape,a);return n.runWebGLProgram(l,[o],o.dtype)}const Rne={kernelName:_p,backendName:"webgl",kernelFunc:Ane};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dne{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],o=e[2];this.outputShape=e;let r="";typeof n=="number"?r=`float outputValue = ${n.toFixed(2)};`:r=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${r}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fne={kernelName:gy,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:o,fillValue:r,center:i}=e,a=n,l=new Dne(s.shape,r),[c,u]=ix(i,s.shape[1],s.shape[2]),d=[[c,u,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const One=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Pne=ct({opSnippet:One}),Mne={kernelName:ju,backendName:"webgl",kernelFunc:Pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lne="return inversesqrt(x);",Bne=ct({opSnippet:Lne,cpuKernelImpl:Q7}),Vne={kernelName:Ku,backendName:"webgl",kernelFunc:Bne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class l0{constructor(e,n,s,o,r,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const c=xt(r.length),u=xt(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";o===1?f="i":o===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${r});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${v};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zne{constructor(e,n,s,o,r,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const c=xt(r.length),u=xt(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";o===1?f="i":o===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,v=n>1?"strides[j]":"strides",b=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${r});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${v};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wne(t){const{inputs:e,backend:n,attrs:s}=t,{indices:o,updates:r}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Ia(r,o,i),h=[d/c,c];if(d===0)return n.makeTensorInfo(i,o.dtype);const f=xe({inputs:{x:o},backend:n,attrs:{shape:[l,a]}}),p=xe({inputs:{x:r},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;Q().getBool("WEBGL_PACK")?g=new zne(l,a,f.shape.length,p.shape.length,u,h):g=new l0(l,a,f.shape.length,p.shape.length,u,h);const v=n.runWebGLProgram(g,[p,f,m],p.dtype),b=xe({inputs:{x:v},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),b}const Une={kernelName:wI,backendName:"webgl",kernelFunc:Wne};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gne{constructor(e,n,s,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const r="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=Q().getNumber("WEBGL_VERSION")===2?r:i,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hne(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:o,values:r}=e,{side:i}=s,a=new Gne(o.shape[0],o.shape[1],r.shape[1],i),l=[[o.shape[1]]];return n.runWebGLProgram(a,[o,r],"int32",l)}const jne={kernelName:kI,backendName:"webgl",kernelFunc:Hne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kne{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let o,r;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)r="resRC",o="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);o=l.join(),r=c.join()}const i=xt(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${r}));
        } else {
          setOutput(getB(${r}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qne(t){const{inputs:e,backend:n}=t,{condition:s,t:o,e:r}=e,i=new Kne(s.shape.length,o.shape,o.shape.length);return n.runWebGLProgram(i,[s,o,r],vs(o.dtype,r.dtype))}const Xne={kernelName:Ap,backendName:"webgl",kernelFunc:qne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yne=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Zp};
  float scale = ${Qp};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Zne=ct({opSnippet:Yne}),Qne={kernelName:qu,backendName:"webgl",kernelFunc:Zne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jne=Xl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,ese=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tse=ct({opSnippet:Jne,packedOpSnippet:ese,cpuKernelImpl:eY}),nse={kernelName:Qu,backendName:"webgl",kernelFunc:tse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sse=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,ose=ct({opSnippet:sse}),rse={kernelName:Zu,backendName:"webgl",kernelFunc:ose};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise=Xl+`
  return sin(x);
`,ase=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${_a}
  return result;
`,lse=ct({opSnippet:ise,packedOpSnippet:ase}),cse={kernelName:Xu,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const use=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,dse=ct({opSnippet:use}),hse={kernelName:Yu,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,pse=ct({opSnippet:fse}),mse={kernelName:Ju,backendName:"webgl",kernelFunc:pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{blockShape:r,paddings:i}=s;N(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=r.reduce((v,b)=>v*b),l=[[0,0]];l.push(...i);for(let v=1+r.length;v<o.shape.length;++v)l.push([0,0]);const c=[],u=G_({inputs:{x:o},backend:n,attrs:{paddings:l,constantValue:0}}),d=hd(u.shape,r,a,!1),h=fd(d.length,r.length,!1),f=pd(u.shape,r,a,!1),p=xe({inputs:{x:u},backend:n,attrs:{shape:d}}),m=Gn({inputs:{x:p},backend:n,attrs:{perm:h}}),g=xe({inputs:{x:m},backend:n,attrs:{shape:f}});return c.push(u),c.push(p),c.push(m),c.forEach(v=>n.disposeIntermediateTensorInfo(v)),g},vse={kernelName:Fp,backendName:"webgl",kernelFunc:gse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(t){const{inputs:e,backend:n}=t,{indices:s,values:o,denseShape:r,defaultValue:i}=e;if(r.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${r.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.readSync(s.dataId),l=n.readSync(o.dataId),c=n.readSync(r.dataId),u=n.readSync(i.dataId)[0],[d,h,f,p,m]=nY(a,s.shape,s.dtype,l,o.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],o.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const yse={kernelName:SI,backendName:"webgl",kernelFunc:bse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:o,newShape:r}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(r.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${r.shape}`);const i=Array.from(n.readSync(o.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(r.dataId)),[c,u,d]=sY(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],r.dtype,new Int32Array(d))]}const wse={kernelName:II,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cse(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${r.shape}`);const i=n.readSync(s.dataId),a=n.readSync(o.dataId),l=n.readSync(r.dataId),[c,u]=m_(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const kse={kernelName:$I,backendName:"webgl",kernelFunc:Cse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(t){const{inputs:e,backend:n}=t,{data:s,indices:o,segmentIds:r}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(r.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${r.shape}`);const i=n.readSync(s.dataId),a=n.readSync(o.dataId),l=n.readSync(r.dataId),[c,u]=m_(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const Ise={kernelName:TI,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:o,sparseValues:r,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=Ia(r,o,a),f=!1;if(r.dtype==="string"){const v=n.bufferSync(o),b=n.bufferSync(r),y=ai(n.readSync(i.dataId)[0]),x=J7(v,b,a,h,u,c,l,d,y,f);return n.makeTensorInfo(a,x.dtype,x.values)}const p=new l0(c,l,o.shape.length,r.shape.length,d,[h,1],f),m=n.runWebGLProgram(p,[r,o,i],r.dtype),g=xe({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),g}const Tse={kernelName:NI,backendName:"webgl",kernelFunc:$se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{numOrSizeSplits:r,axis:i}=s,a=tt(i,o.shape)[0],l=wx(o,r,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(h=>{const f=[...d];f[a]=h;const p=Yl({inputs:{x:o},backend:n,attrs:{begin:u,size:f}});return u[a]+=h,p})}const Ese={kernelName:Op,backendName:"webgl",kernelFunc:Nse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xC="return sqrt(x);",_se=ct({opSnippet:xC,packedOpSnippet:xC,cpuKernelImpl:oY}),Ase={kernelName:ed,backendName:"webgl",kernelFunc:_se};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rse="return x * x;",Dse=ct({opSnippet:Rse}),Fse={kernelName:uy,backendName:"webgl",kernelFunc:Dse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wC="return (a - b) * (a - b);",Ose=En({opSnippet:wC,packedOpSnippet:wC}),Pse={kernelName:td,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");const r=n.readSync(o.dataId),i=$r(r),a=rY(i,"string",s);return n.makeTensorInfo(o.shape,"string",a)}const Lse={kernelName:dy,backendName:"webgl",kernelFunc:Mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse({inputs:t,attrs:e,backend:n}){const{x:s}=t,o=ao+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,r=new Ho(s.shape,o);return n.runWebGLProgram(r,[s],s.dtype)}const Vse={kernelName:id,backendName:"webgl",kernelFunc:Bse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zse{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const o=s.length,r=xt(s.length),i=xt(s.length);let a="";if(o===1)a="coords * strides + begin";else{let l=0;a=s.map((c,u)=>(l++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${r} begin = ${r}(${e});
      ${r} strides = ${r}(${n});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wse(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{begin:r,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:v,begin:b,end:y,strides:x}=sx(o.shape,r,i,a,l,c,u,d,h);let w;if(m)w=xe({inputs:{x:o},backend:n,attrs:{shape:p}});else if(g||v){N(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);const S=ex(b,y,x),C=Yl({inputs:{x:o},backend:n,attrs:{begin:b,size:S}});w=xe({inputs:{x:C},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(C)}else if(n.shouldExecuteOnCPU([o])){const C=n.readSync(o.dataId),$=et(o.shape,o.dtype,C),T=iY(f,$,x,b);w=n.makeTensorInfo(p,o.dtype,T.values)}else{const C=new zse(b,x,f);w=n.runWebGLProgram(C,[o],o.dtype)}const k=xe({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),k}const Use={kernelName:hy,backendName:"webgl",kernelFunc:Wse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t){const{inputs:e,backend:n,attrs:s}=t,{separator:o,nGramWidths:r,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.readSync(u.dataId),f=n.readSync(d.dataId),[p,m]=aY(h,f,o,r,i,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const Hse={kernelName:EI,backendName:"webgl",kernelFunc:Gse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:o}=s,{input:r,delimiter:i}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(r.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${r.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(r.dataId),l=n.readSync(i.dataId)[0],[c,u,d]=lY(a,l,o),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const Kse={kernelName:_I,backendName:"webgl",kernelFunc:jse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:o}=s,{input:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(r.dataId),a=cY(i,o);return n.makeTensorInfo(r.shape,"int32",a)}const Xse={kernelName:AI,backendName:"webgl",kernelFunc:qse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yse="return tan(x);",Zse=ct({opSnippet:Yse}),Qse={kernelName:sd,backendName:"webgl",kernelFunc:Zse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,eoe=ct({opSnippet:Jse}),toe={kernelName:od,backendName:"webgl",kernelFunc:eoe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:o,indices:r,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Ia(i,r,o.shape),h=[d/c,c];if(d===0)return n.makeTensorInfo(o.shape,r.dtype);const f=xe({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),p=xe({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),m=xe({inputs:{x:o},backend:n,attrs:{shape:h}}),g=new l0(l,a,f.shape.length,p.shape.length,u,h,!1,!0),v=n.runWebGLProgram(g,[p,f,m],m.dtype),b=xe({inputs:{x:v},backend:n,attrs:{shape:o.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),b}const soe={kernelName:CI,backendName:"webgl",kernelFunc:noe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ooe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*n[i];this.outputShape=s,this.rank=s.length;const o=xt(this.rank),r=roe(e);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${r}));
      }
    `}}function roe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let o=0;o<t.length;o++)s.push(`imod(${n[o]}, ${t[o]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j_(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{reps:r}=s;if(o.dtype==="string"||o.shape.length>5){const l=n.readSync(o.dataId),c=o.dtype==="string"?l.map(h=>ai(h)):l,u=et(o.shape,o.dtype,c),d=dY(u,r);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new ooe(o.shape,r);return n.runWebGLProgram(i,[o],o.dtype)}const ioe={kernelName:rd,backendName:"webgl",kernelFunc:j_};class aoe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class loe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oi(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function CC(t){let e=1;for(;e<t;)e*=2;return e}function coe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o}=e,{k:r,sorted:i}=s,a=Q().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=Q().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=o.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([o])||u<a||r>l){const T=n.readSync(o.dataId),[E,_]=hY(T,c,o.dtype,r,i);return[n.makeTensorInfo(E.shape,E.dtype,E.values),n.makeTensorInfo(_.shape,_.dtype,_.values)]}if(r===0)return c[c.length-1]=0,[n.makeTensorInfo(c,o.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[o,Nd({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(o.dataId),h=d!==null&&d.isPacked,f=h?n.unpackTensor(o):o,m=oe(c)/u,g=xe({inputs:{x:f},attrs:{shape:[m,u]},backend:n});h&&Oi(n,f);const v=CC(r),b=CC(u);let y=null;const x=()=>y===null?[g,g]:[g,y],w=(T,E,_)=>{const A=x(),O=new aoe(_),F=[[u],[y===null?1:0],[Number.NEGATIVE_INFINITY],[T],[E]],V=y;y=n.runWebGLProgram(O,A,"int32",F),Oi(n,V)};for(let T=1;T<v;T*=2){const E=T*2;for(let _=T;_>=1;_/=2)w(E,_,[m,b])}for(let T=b;T>v;T/=2){const E=x(),_=new loe([m,T/2]),O=[[u],[y===null?1:0],[v]],B=y;y=n.runWebGLProgram(_,E,"int32",O),Oi(n,B);const F=v/2,V=F*2;for(let D=F;D>=1;D/=2)w(V,D,y.shape)}let k=y;y=Yl({inputs:{x:y},backend:n,attrs:{begin:0,size:[m,r]}}),Oi(n,k);let S=L_({inputs:{x:g,indices:y},backend:n,attrs:{axis:1,batchDims:1}});Oi(n,g);const C=c.slice(0,-1);C.push(r),k=y,y=xe({inputs:{x:y},attrs:{shape:C},backend:n}),Oi(n,k);const $=S;return S=xe({inputs:{x:S},attrs:{shape:C},backend:n}),Oi(n,$),[S,y]}const uoe={kernelName:fy,backendName:"webgl",kernelFunc:coe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class doe{constructor(e,n,s,o,r,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${r});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${r});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t){const{inputs:e,backend:n,attrs:s}=t,{image:o,transforms:r}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=s,[u,d,h,f]=o.shape,[p,m]=c!=null?c:[d,h],g=[u,p,m,f],v=new doe(d,h,i,a,l,g);return n.runWebGLProgram(v,[o,r],"float32")}const foe={kernelName:py,backendName:"webgl",kernelFunc:hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:o}=n,{x:r}=e;Id(r,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(r.dataId),{outputValues:a,outputShape:l,indices:c}=fY(i,o,r.shape,r.dtype);return[s.makeTensorInfo(l,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const moe={kernelName:my,backendName:"webgl",kernelFunc:poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t){const{inputs:e,backend:n,attrs:s}=t,{value:o}=e;let{axis:r}=s;r<0&&(r+=o.shape.length);const i=o,a=i.shape.length,l=o.shape[r],c=new Array(a-1);let u=0;for(let m=0;m<a;m++)m!==r&&(c[u++]=i.shape[m]);const d=[],h=new Array(a).fill(0),f=i.shape.slice();f[r]=1;const p=new Array(l);for(let m=0;m<p.length;m++){h[r]=m;const g=Yl({inputs:{x:i},backend:n,attrs:{begin:h,size:f}}),v=xe({inputs:{x:g},backend:n,attrs:{shape:c}});p[m]=v,d.push(g)}return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const voe={kernelName:Mp,backendName:"webgl",kernelFunc:goe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class boe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,o=e.batchSize,r=e.inSize,i=e.numSegments,a=i*Math.ceil(r/s);this.outputShape=[o,a];const l="0.0",c="sumValue",u=Math.floor(s/4)*4,d=s%4,h=`
        sumValue += dot(values, segFilter);
    `;let f="";r%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return initializationValue;
        }
      `);let p="";r%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${r}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:o,segmentIds:r}=e,{numSegments:i}=s,a=o.shape.length,l=[];let c=0;const u=Lt([c],a);let d=o;u!=null&&(d=Gn({inputs:{x:o},backend:n,attrs:{perm:u}}),l.push(d),c=Kt(1,a)[0]);const h=E2(d.shape,c,i),f=oe([d.shape[c]]),p=xe({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});l.push(p);const m=by(o.dtype),g=(x,w,k,S,C)=>{const $=x.shape[0],T=x.shape[1],E=N2(T,C),_={windowSize:E,inSize:T,batchSize:$,numSegments:C},A=new boe(_,w),O=n.compileAndRun(A,[x,k],S);if(l.push(O),O.shape[1]===C)return O;const B=H_({backend:n,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),F=j_({inputs:{x:B},backend:n,attrs:{reps:[T/E]}});return l.push(B),l.push(F),g(O,w,F,S,C)},v=g(p,"unsortedSegmentSum",r,m,i),b=xe({inputs:{x:v},backend:n,attrs:{shape:h}});let y=b;if(u!=null){l.push(b);const x=yi(u);y=Gn({inputs:{x:y},backend:n,attrs:{perm:x}})}return l.forEach(x=>n.disposeIntermediateTensorInfo(x)),y}const xoe={kernelName:Lp,backendName:"webgl",kernelFunc:yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=[oZ,iZ,cZ,hZ,pZ,vZ,yZ,wZ,IZ,TZ,_Z,DZ,PZ,VZ,UZ,HZ,KZ,ZZ,JZ,t9,r9,h9,p9,b9,x9,$9,N9,R9,zY,O9,V9,G9,Y9,J9,tQ,sQ,rQ,cQ,hQ,mQ,vQ,yQ,wQ,SQ,$Q,_Q,RQ,OQ,LQ,VQ,GQ,qQ,QQ,tJ,oJ,rJ,aJ,cJ,dJ,fJ,mJ,yJ,CJ,IJ,TJ,_J,DJ,MJ,zJ,VY,UJ,L9,jJ,XJ,QJ,UY,nee,iee,lee,hee,mee,yee,Cee,$ee,_ee,Dee,Oee,Bee,zee,Uee,Kee,Xee,Zee,Jee,tte,rte,cte,fte,wte,jY,Ite,Nte,Ate,Fte,C9,Mte,Bte,zte,Gte,qte,HY,Yte,Qte,ene,nne,sne,k9,vte,ine,une,pne,qY,bne,wne,Ine,Nne,Rne,Fne,Mne,Vne,Une,jne,Xne,Qne,nse,rse,cse,hse,u9,yte,mse,vse,yse,wse,kse,Ise,Tse,Ese,Ase,Fse,Pse,Lse,Vse,Use,Hse,Kse,Xse,bte,tZ,Qse,toe,soe,ioe,uoe,foe,nZ,moe,voe,xoe,Lte];for(const t of woe)DI(t);/** @license See the LICENSE file. *//**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Coe=["complete-model","3m-unique-rust-model","15m-unique-model","puzzletrain-512neurons-4layers","15mtrain-512neurons-4layers","15mtrain-512neurons-4layers-2","15mtrain-724neurons-4layers","15mrevtrain-724neurons-4layers","20mmatestrain-512neurons-4layers","20mmatestrain-512neurons-4layers-2","15mtrain-512neurons-4layers-1024batch","12Mopenings","14Mmiddlegame","15Mendgame","schule-pc","50M_first","50M-1124neurons-2048batch","50M-2048neurons","50M-4096neurons","50M-8192neurons"],koe=["20mevaltrain-512neurons-4layers","20mevaltrain-1024neurons-4layers","20mevaltrain-512neurons-5layers","20mevaltrain-1024neurons-5layers","20mevaltrain-1024neurons-4layers-mae"],Soe=["first-autoencode","256-64-autoencoder","256-128-autoencoder","128-shallow-autoencoder","256-shallow-autoencoder"];async function Ioe(t,e){return await MG(`models/${t}/model.json`,e)}let ng={};async function c0(t,e={}){if(ng[t]!=null)return ng[t];const n=await Ioe(t,e);let s=o=>n.predict(rl(o,[1,833])).dataSync();return ng[t]={name:t,predict:s},{name:t,predict:s}}async function K_(t,e={}){return await c0(t,e)}async function $oe(t){return await c0(t)}async function Toe(t){return await c0(t)}const q_=["anarcandy","cardinal","chess7","companion","dubrovny","fantasy","fresca","gioco","horsey","icpieces","leipzig","libra","maestro","shapes","spatial","staunty","tatiana"],zs={ByNcSa:"CC-BY-NC-SA 4.0",BySa:"CC-BY-SA 4.0",Mit:"MIT"},Noe=["P","N","B","R","Q","K"],Eoe=["w","b"],_oe={horsey:{by:"cham and michael1241",license:zs.ByNcSa},shapes:{by:"flugsio",license:zs.BySa},maestro:{by:"sadsnake1",license:zs.ByNcSa},fresca:{by:"sadsnake1",license:zs.ByNcSa},cardinal:{by:"sadsnake1",license:zs.ByNcSa},icpieces:{by:"sadsnake1",license:zs.ByNcSa},gioco:{by:"sadsnake1",license:zs.ByNcSa},tatiana:{by:"sadsnake1",license:zs.ByNcSa},staunty:{by:"sadsnake1",license:zs.ByNcSa},dubrovny:{by:"sadsnake1",license:zs.ByNcSa},libra:{by:"sadsnake1",license:zs.ByNcSa},anarcandy:{by:"caderek",license:zs.ByNcSa},chess7:{by:"Style-7"},companion:{by:"David L. Brown"},fantasy:{by:"Maurizio Monge"},spatial:{by:"Maurizio Monge"},leipzig:{by:"Armando Hernandez Marroquin"}};function va(t,e=un("theme")){return`assets/img/chesspieces/${e}/${t}.svg`}const Aoe={mounted(){this.interval=setInterval(()=>{this.animate&&this.ticks++},100)},unmounted(){clearInterval(this.interval)},props:{oldTheme:String},data:()=>({ticks:0,interval:0,animate:!1}),computed:{themes(){return q_.filter(t=>t!=="companion")}},methods:{loadPiece(t,e){return va(t,e)},select(t){this.$emit("select",t)},piece(t){if(!this.animate)return"wN";const e=500,n=Math.floor((this.ticks-t+e)%e/(e/12)),s=Noe[Math.floor(n/2)];return Eoe[n%2]+s}}},ks=(t,e)=>{const n=t.__vccOpts||t;for(const[s,o]of e)n[s]=o;return n};function ye(t,e){return n=>Object.keys(t).reduce((s,o)=>{const i=typeof t[o]=="object"&&t[o]!=null&&!Array.isArray(t[o])?t[o]:{type:t[o]};return n&&o in n?s[o]={...i,default:n[o]}:s[o]=i,e&&!s[o].source&&(s[o].source=e),s},{})}const st=ye({class:[String,Array],style:{type:[String,Array,Object],default:null}},"component"),zt=typeof window<"u",u0=zt&&"IntersectionObserver"in window,Roe=zt&&("ontouchstart"in window||window.navigator.maxTouchPoints>0);function X_(t,e,n){const s=e.length-1;if(s<0)return t===void 0?n:t;for(let o=0;o<s;o++){if(t==null)return n;t=t[e[o]]}return t==null||t[e[s]]===void 0?n:t[e[s]]}function Ed(t,e){if(t===e)return!0;if(t instanceof Date&&e instanceof Date&&t.getTime()!==e.getTime()||t!==Object(t)||e!==Object(e))return!1;const n=Object.keys(t);return n.length!==Object.keys(e).length?!1:n.every(s=>Ed(t[s],e[s]))}function Cv(t,e,n){return t==null||!e||typeof e!="string"?n:t[e]!==void 0?t[e]:(e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,""),X_(t,e.split("."),n))}function vr(t,e,n){if(e===!0)return t===void 0?n:t;if(e==null||typeof e=="boolean")return n;if(t!==Object(t)){if(typeof e!="function")return n;const o=e(t,n);return typeof o>"u"?n:o}if(typeof e=="string")return Cv(t,e,n);if(Array.isArray(e))return X_(t,e,n);if(typeof e!="function")return n;const s=e(t,n);return typeof s>"u"?n:s}function gm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:t},(n,s)=>e+s)}function Fe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(!(t==null||t===""))return isNaN(+t)?String(t):isFinite(+t)?`${Number(t)}${e}`:void 0}function kv(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Sv(t){return t&&"$el"in t?t.$el:t}const kC=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16}),Doe=Object.freeze({enter:"Enter",tab:"Tab",delete:"Delete",esc:"Escape",space:"Space",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",end:"End",home:"Home",del:"Delete",backspace:"Backspace",insert:"Insert",pageup:"PageUp",pagedown:"PageDown",shift:"Shift"});function sg(t,e){return e.every(n=>t.hasOwnProperty(n))}function Sl(t,e,n){const s=Object.create(null),o=Object.create(null);for(const r in t)e.some(i=>i instanceof RegExp?i.test(r):i===r)&&!(n!=null&&n.some(i=>i===r))?s[r]=t[r]:o[r]=t[r];return[s,o]}function _d(t,e){const n={...t};return e.forEach(s=>delete n[s]),n}const Y_=/^on[^a-z]/,d0=t=>Y_.test(t),Foe=["onAfterscriptexecute","onAnimationcancel","onAnimationend","onAnimationiteration","onAnimationstart","onAuxclick","onBeforeinput","onBeforescriptexecute","onChange","onClick","onCompositionend","onCompositionstart","onCompositionupdate","onContextmenu","onCopy","onCut","onDblclick","onFocusin","onFocusout","onFullscreenchange","onFullscreenerror","onGesturechange","onGestureend","onGesturestart","onGotpointercapture","onInput","onKeydown","onKeypress","onKeyup","onLostpointercapture","onMousedown","onMousemove","onMouseout","onMouseover","onMouseup","onMousewheel","onPaste","onPointercancel","onPointerdown","onPointerenter","onPointerleave","onPointermove","onPointerout","onPointerover","onPointerup","onReset","onSelect","onSubmit","onTouchcancel","onTouchend","onTouchmove","onTouchstart","onTransitioncancel","onTransitionend","onTransitionrun","onTransitionstart","onWheel"];function vm(t){const[e,n]=Sl(t,[Y_]),s=_d(e,Foe),[o,r]=Sl(n,["class","style","id",/^data-/]);return Object.assign(o,e),Object.assign(r,s),[o,r]}function ri(t){return t==null?[]:Array.isArray(t)?t:[t]}function Tr(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(e,Math.min(n,t))}function SC(t){const e=t.toString().trim();return e.includes(".")?e.length-e.indexOf(".")-1:0}function IC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return t+n.repeat(Math.max(0,e-t.length))}function $C(t,e){return(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0").repeat(Math.max(0,e-t.length))+t}function Ooe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=[];let s=0;for(;s<t.length;)n.push(t.substr(s,e)),s+=e;return n}function Zs(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s={};for(const o in t)s[o]=t[o];for(const o in e){const r=t[o],i=e[o];if(kv(r)&&kv(i)){s[o]=Zs(r,i,n);continue}if(Array.isArray(r)&&Array.isArray(i)&&n){s[o]=n(r,i);continue}s[o]=i}return s}function Z_(t){return t.map(e=>e.type===ot?Z_(e.children):e).flat()}function ea(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(ea.cache.has(t))return ea.cache.get(t);const e=t.replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase();return ea.cache.set(t,e),e}ea.cache=new Map;function Nc(t,e){if(!e||typeof e!="object")return[];if(Array.isArray(e))return e.map(n=>Nc(t,n)).flat(1);if(Array.isArray(e.children))return e.children.map(n=>Nc(t,n)).flat(1);if(e.component){if(Object.getOwnPropertySymbols(e.component.provides).includes(t))return[e.component];if(e.component.subTree)return Nc(t,e.component.subTree).flat(1)}return[]}function h0(t){const e=Jn({}),n=M(t);return To(()=>{for(const s in n.value)e[s]=n.value[s]},{flush:"sync"}),ab(e)}function lf(t,e){return t.includes(e)}function Q_(t){return t[2].toLowerCase()+t.slice(3)}const Jo=()=>[Function,Array];function TC(t,e){return e="on"+Er(e),!!(t[e]||t[`${e}Once`]||t[`${e}Capture`]||t[`${e}OnceCapture`]||t[`${e}CaptureOnce`])}function J_(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];if(Array.isArray(t))for(const o of t)o(...n);else typeof t=="function"&&t(...n)}function cf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const n=["button","[href]",'input:not([type="hidden"])',"select","textarea","[tabindex]"].map(s=>`${s}${e?':not([tabindex="-1"])':""}:not([disabled])`).join(", ");return[...t.querySelectorAll(n)]}function eA(t,e,n){var i;let s,o=t.indexOf(document.activeElement);const r=e==="next"?1:-1;do o+=r,s=t[o];while((!s||s.offsetParent==null||!((i=n==null?void 0:n(s))==null||i))&&o<t.length&&o>=0);return s}function uf(t,e){var s,o,r,i;const n=cf(t);if(!e)(t===document.activeElement||!t.contains(document.activeElement))&&((s=n[0])==null||s.focus());else if(e==="first")(o=n[0])==null||o.focus();else if(e==="last")(r=n.at(-1))==null||r.focus();else if(typeof e=="number")(i=n[e])==null||i.focus();else{const a=eA(n,e);a?a.focus():uf(t,e==="next"?"first":"last")}}function df(t,e){if(!(zt&&typeof CSS<"u"&&typeof CSS.supports<"u"&&CSS.supports(`selector(${e})`)))return null;try{return!!t&&t.matches(e)}catch{return null}}const tA=["top","bottom"],Poe=["start","end","left","right"];function Iv(t,e){let[n,s]=t.split(" ");return s||(s=lf(tA,n)?"start":lf(Poe,n)?"top":"center"),{side:NC(n,e),align:NC(s,e)}}function NC(t,e){return t==="start"?e?"right":"left":t==="end"?e?"left":"right":t}function og(t){return{side:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[t.side],align:t.align}}function rg(t){return{side:t.side,align:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[t.align]}}function EC(t){return{side:t.align,align:t.side}}function _C(t){return lf(tA,t.side)?"y":"x"}class cl{constructor(e){let{x:n,y:s,width:o,height:r}=e;this.x=n,this.y=s,this.width=o,this.height=r}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}}function AC(t,e){return{x:{before:Math.max(0,e.left-t.left),after:Math.max(0,t.right-e.right)},y:{before:Math.max(0,e.top-t.top),after:Math.max(0,t.bottom-e.bottom)}}}function f0(t){const e=t.getBoundingClientRect(),n=getComputedStyle(t),s=n.transform;if(s){let o,r,i,a,l;if(s.startsWith("matrix3d("))o=s.slice(9,-1).split(/, /),r=+o[0],i=+o[5],a=+o[12],l=+o[13];else if(s.startsWith("matrix("))o=s.slice(7,-1).split(/, /),r=+o[0],i=+o[3],a=+o[4],l=+o[5];else return new cl(e);const c=n.transformOrigin,u=e.x-a-(1-r)*parseFloat(c),d=e.y-l-(1-i)*parseFloat(c.slice(c.indexOf(" ")+1)),h=r?e.width/r:t.offsetWidth+1,f=i?e.height/i:t.offsetHeight+1;return new cl({x:u,y:d,width:h,height:f})}else return new cl(e)}function Qa(t,e,n){if(typeof t.animate>"u")return{finished:Promise.resolve()};let s;try{s=t.animate(e,n)}catch{return{finished:Promise.resolve()}}return typeof s.finished>"u"&&(s.finished=new Promise(o=>{s.onfinish=()=>{o(s)}})),s}const xh=new WeakMap;function Moe(t,e){Object.keys(e).forEach(n=>{if(d0(n)){const s=Q_(n),o=xh.get(t);if(e[n]==null)o==null||o.forEach(r=>{const[i,a]=r;i===s&&(t.removeEventListener(s,a),o.delete(r))});else if(!o||![...o].some(r=>r[0]===s&&r[1]===e[n])){t.addEventListener(s,e[n]);const r=o||new Set;r.add([s,e[n]]),xh.has(t)||xh.set(t,r)}}else e[n]==null?t.removeAttribute(n):t.setAttribute(n,e[n])})}function Loe(t,e){Object.keys(e).forEach(n=>{if(d0(n)){const s=Q_(n),o=xh.get(t);o==null||o.forEach(r=>{const[i,a]=r;i===s&&(t.removeEventListener(s,a),o.delete(r))})}else t.removeAttribute(n)})}const Ua=2.4,RC=.2126729,DC=.7151522,FC=.072175,Boe=.55,Voe=.58,zoe=.57,Woe=.62,ch=.03,OC=1.45,Uoe=5e-4,Goe=1.25,Hoe=1.25,PC=.078,MC=12.82051282051282,uh=.06,LC=.001;function BC(t,e){const n=(t.r/255)**Ua,s=(t.g/255)**Ua,o=(t.b/255)**Ua,r=(e.r/255)**Ua,i=(e.g/255)**Ua,a=(e.b/255)**Ua;let l=n*RC+s*DC+o*FC,c=r*RC+i*DC+a*FC;if(l<=ch&&(l+=(ch-l)**OC),c<=ch&&(c+=(ch-c)**OC),Math.abs(c-l)<Uoe)return 0;let u;if(c>l){const d=(c**Boe-l**Voe)*Goe;u=d<LC?0:d<PC?d-d*MC*uh:d-uh}else{const d=(c**Woe-l**zoe)*Hoe;u=d>-LC?0:d>-PC?d-d*MC*uh:d+uh}return u*100}function joe(t,e){e=Array.isArray(e)?e.slice(0,-1).map(n=>`'${n}'`).join(", ")+` or '${e.at(-1)}'`:`'${e}'`}const hf=.20689655172413793,Koe=t=>t>hf**3?Math.cbrt(t):t/(3*hf**2)+4/29,qoe=t=>t>hf?t**3:3*hf**2*(t-4/29);function nA(t){const e=Koe,n=e(t[1]);return[116*n-16,500*(e(t[0]/.95047)-n),200*(n-e(t[2]/1.08883))]}function sA(t){const e=qoe,n=(t[0]+16)/116;return[e(n+t[1]/500)*.95047,e(n),e(n-t[2]/200)*1.08883]}const Xoe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],Yoe=t=>t<=.0031308?t*12.92:1.055*t**(1/2.4)-.055,Zoe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],Qoe=t=>t<=.04045?t/12.92:((t+.055)/1.055)**2.4;function oA(t){const e=Array(3),n=Yoe,s=Xoe;for(let o=0;o<3;++o)e[o]=Math.round(Tr(n(s[o][0]*t[0]+s[o][1]*t[1]+s[o][2]*t[2]))*255);return{r:e[0],g:e[1],b:e[2]}}function p0(t){let{r:e,g:n,b:s}=t;const o=[0,0,0],r=Qoe,i=Zoe;e=r(e/255),n=r(n/255),s=r(s/255);for(let a=0;a<3;++a)o[a]=i[a][0]*e+i[a][1]*n+i[a][2]*s;return o}function VC(t){return!!t&&/^(#|var\(--|(rgb|hsl)a?\()/.test(t)}const zC=/^(?<fn>(?:rgb|hsl)a?)\((?<values>.+)\)/,Joe={rgb:(t,e,n,s)=>({r:t,g:e,b:n,a:s}),rgba:(t,e,n,s)=>({r:t,g:e,b:n,a:s}),hsl:(t,e,n,s)=>WC({h:t,s:e,l:n,a:s}),hsla:(t,e,n,s)=>WC({h:t,s:e,l:n,a:s}),hsv:(t,e,n,s)=>Jc({h:t,s:e,v:n,a:s}),hsva:(t,e,n,s)=>Jc({h:t,s:e,v:n,a:s})};function jo(t){if(typeof t=="number")return{r:(t&16711680)>>16,g:(t&65280)>>8,b:t&255};if(typeof t=="string"&&zC.test(t)){const{groups:e}=t.match(zC),{fn:n,values:s}=e,o=s.split(/,\s*/).map(r=>r.endsWith("%")&&["hsl","hsla","hsv","hsva"].includes(n)?parseFloat(r)/100:parseFloat(r));return Joe[n](...o)}else if(typeof t=="string"){let e=t.startsWith("#")?t.slice(1):t;return[3,4].includes(e.length)?e=e.split("").map(n=>n+n).join(""):[6,8].includes(e.length),tre(e)}else if(typeof t=="object"){if(sg(t,["r","g","b"]))return t;if(sg(t,["h","s","l"]))return Jc(rA(t));if(sg(t,["h","s","v"]))return Jc(t)}throw new TypeError(`Invalid color: ${t==null?t:String(t)||t.constructor.name}
Expected #hex, #hexa, rgb(), rgba(), hsl(), hsla(), object or number`)}function Jc(t){const{h:e,s:n,v:s,a:o}=t,r=a=>{const l=(a+e/60)%6;return s-s*n*Math.max(Math.min(l,4-l,1),0)},i=[r(5),r(3),r(1)].map(a=>Math.round(a*255));return{r:i[0],g:i[1],b:i[2],a:o}}function WC(t){return Jc(rA(t))}function rA(t){const{h:e,s:n,l:s,a:o}=t,r=s+n*Math.min(s,1-s),i=r===0?0:2-2*s/r;return{h:e,s:i,v:r,a:o}}function dh(t){const e=Math.round(t).toString(16);return("00".substr(0,2-e.length)+e).toUpperCase()}function ere(t){let{r:e,g:n,b:s,a:o}=t;return`#${[dh(e),dh(n),dh(s),o!==void 0?dh(Math.round(o*255)):""].join("")}`}function tre(t){t=nre(t);let[e,n,s,o]=Ooe(t,2).map(r=>parseInt(r,16));return o=o===void 0?o:o/255,{r:e,g:n,b:s,a:o}}function nre(t){return t.startsWith("#")&&(t=t.slice(1)),t=t.replace(/([^0-9a-f])/gi,"F"),(t.length===3||t.length===4)&&(t=t.split("").map(e=>e+e).join("")),t.length!==6&&(t=IC(IC(t,6),8,"F")),t}function sre(t,e){const n=nA(p0(t));return n[0]=n[0]+e*10,oA(sA(n))}function ore(t,e){const n=nA(p0(t));return n[0]=n[0]-e*10,oA(sA(n))}function rre(t){const e=jo(t);return p0(e)[1]}function iA(t){const e=Math.abs(BC(jo(0),jo(t)));return Math.abs(BC(jo(16777215),jo(t)))>Math.min(e,50)?"#fff":"#000"}function Zl(t){var e,n;if(t._setup=(e=t._setup)!=null?e:t.setup,!t.name)return t;if(t._setup){t.props=ye((n=t.props)!=null?n:{},t.name)();const s=Object.keys(t.props);t.filterProps=function(r){return Sl(r,s,["class","style"])},t.props._as=String,t.setup=function(r,i){var d;const a=g0();if(!a.value)return t._setup(r,i);const{props:l,provideSubDefaults:c}=fre(r,(d=r._as)!=null?d:t.name,a),u=t._setup(l,i);return c(),u}}return t}function Re(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return e=>(t?Zl:hb)(e)}function Ql(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",n=arguments.length>2?arguments[2]:void 0;return Re()({name:n!=null?n:Er(eo(t.replace(/__/g,"-"))),props:{tag:{type:String,default:e},...st()},setup(s,o){let{slots:r}=o;return()=>{var i;return lr(s.tag,{class:[t,s.class],style:s.style},(i=r.default)==null?void 0:i.call(r))}}})}function aA(t){if(typeof t.getRootNode!="function"){for(;t.parentNode;)t=t.parentNode;return t!==document?null:document}const e=t.getRootNode();return e!==document&&e.getRootNode({composed:!0})!==document?null:e}const ff="cubic-bezier(0.4, 0, 0.2, 1)",ire="cubic-bezier(0.0, 0, 0.2, 1)",are="cubic-bezier(0.4, 0, 1, 1)";function On(t,e){const n=xb();if(!n)throw new Error(`[Vuetify] ${t} ${e||"must be called from inside a setup function"}`);return n}function Pr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const e=On(t).type;return ea((e==null?void 0:e.aliasName)||(e==null?void 0:e.name))}let lA=0,wh=new WeakMap;function Ps(){const t=On("getUid");if(wh.has(t))return wh.get(t);{const e=lA++;return wh.set(t,e),e}}Ps.reset=()=>{lA=0,wh=new WeakMap};function cA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(;t;){if(e?lre(t):m0(t))return t;t=t.parentElement}return document.scrollingElement}function pf(t,e){const n=[];if(e&&t&&!e.contains(t))return n;for(;t&&(m0(t)&&n.push(t),t!==e);)t=t.parentElement;return n}function m0(t){if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const e=window.getComputedStyle(t);return e.overflowY==="scroll"||e.overflowY==="auto"&&t.scrollHeight>t.clientHeight}function lre(t){if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;const e=window.getComputedStyle(t);return["scroll","auto"].includes(e.overflowY)}function cre(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:On("injectSelf");const{provides:n}=e;if(n&&t in n)return n[t]}function ure(t){for(;t;){if(window.getComputedStyle(t).position==="fixed")return!0;t=t.offsetParent}return!1}function Ge(t){const e=On("useRender");e.render=t}const Il=Symbol.for("vuetify:defaults");function dre(t){return _e(t)}function g0(){const t=vt(Il);if(!t)throw new Error("[Vuetify] Could not find defaults instance");return t}function Ra(t,e){const n=g0(),s=_e(t),o=M(()=>{if(hs(e==null?void 0:e.disabled))return n.value;const i=hs(e==null?void 0:e.scoped),a=hs(e==null?void 0:e.reset),l=hs(e==null?void 0:e.root);if(s.value==null&&!(i||a||l))return n.value;let c=Zs(s.value,{prev:n.value});if(i)return c;if(a||l){const u=Number(a||1/0);for(let d=0;d<=u&&!(!c||!("prev"in c));d++)c=c.prev;return c&&typeof l=="string"&&l in c&&(c=Zs(Zs(c,{prev:c}),c[l])),c}return c.prev?Zs(c.prev,c):c});return vn(Il,o),o}function hre(t,e){var n,s;return typeof((n=t.props)==null?void 0:n[e])<"u"||typeof((s=t.props)==null?void 0:s[ea(e)])<"u"}function fre(){var l;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g0();const s=On("useDefaults");if(e=(l=e!=null?e:s.type.name)!=null?l:s.type.__name,!e)throw new Error("[Vuetify] Could not determine component name");const o=M(()=>{var c,u;return(u=n.value)==null?void 0:u[(c=t._as)!=null?c:e]}),r=new Proxy(t,{get(c,u){var h,f,p,m,g,v;const d=Reflect.get(c,u);return u==="class"||u==="style"?[(h=o.value)==null?void 0:h[u],d].filter(b=>b!=null):typeof u=="string"&&!hre(s.vnode,u)&&(v=(g=(f=o.value)==null?void 0:f[u])!=null?g:(m=(p=n.value)==null?void 0:p.global)==null?void 0:m[u])!=null?v:d}}),i=He();To(()=>{if(o.value){const c=Object.entries(o.value).filter(u=>{let[d]=u;return d.startsWith(d[0].toUpperCase())});i.value=c.length?Object.fromEntries(c):void 0}else i.value=void 0});function a(){const c=cre(Il,s);vn(Il,M(()=>{var u;return i.value?Zs((u=c==null?void 0:c.value)!=null?u:{},i.value):c==null?void 0:c.value}))}return{props:r,provideSubDefaults:a}}const v0=Re()({name:"VCardActions",props:st(),setup(t,e){let{slots:n}=e;return Ra({VBtn:{variant:"text"}}),Ge(()=>{var s;return I("div",{class:["v-card-actions",t.class],style:t.style},[(s=n.default)==null?void 0:s.call(n)])}),{}}}),pre=Ql("v-card-subtitle"),so=Ql("v-card-title");function b0(t){return h0(()=>{const e=[],n={};if(t.value.background)if(VC(t.value.background)){if(n.backgroundColor=t.value.background,!t.value.text){const s=jo(t.value.background);if(s.a==null||s.a===1){const o=iA(s);n.color=o,n.caretColor=o}}}else e.push(`bg-${t.value.background}`);return t.value.text&&(VC(t.value.text)?(n.color=t.value.text,n.caretColor=t.value.text):e.push(`text-${t.value.text}`)),{colorClasses:e,colorStyles:n}})}function rr(t,e){const n=M(()=>({text:Vt(t)?t.value:e?t[e]:null})),{colorClasses:s,colorStyles:o}=b0(n);return{textColorClasses:s,textColorStyles:o}}function Nr(t,e){const n=M(()=>({background:Vt(t)?t.value:e?t[e]:null})),{colorClasses:s,colorStyles:o}=b0(n);return{backgroundColorClasses:s,backgroundColorStyles:o}}const mre={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sortAsc:"mdi-arrow-up",sortDesc:"mdi-arrow-down",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus",calendar:"mdi-calendar"},gre={component:t=>lr(dA,{...t,class:"mdi"})},$t=[String,Function,Object,Array],$v=Symbol.for("vuetify:icons"),bm=ye({icon:{type:$t},tag:{type:String,required:!0}},"icon"),UC=Re()({name:"VComponentIcon",props:bm(),setup(t,e){let{slots:n}=e;return()=>{const s=t.icon;return I(t.tag,null,{default:()=>{var o;return[t.icon?I(s,null,null):(o=n.default)==null?void 0:o.call(n)]}})}}}),uA=Zl({name:"VSvgIcon",inheritAttrs:!1,props:bm(),setup(t,e){let{attrs:n}=e;return()=>I(t.tag,Ue(n,{style:null}),{default:()=>[I("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[Array.isArray(t.icon)?t.icon.map(s=>Array.isArray(s)?I("path",{d:s[0],"fill-opacity":s[1]},null):I("path",{d:s},null)):I("path",{d:t.icon},null)])]})}});Zl({name:"VLigatureIcon",props:bm(),setup(t){return()=>I(t.tag,null,{default:()=>[t.icon]})}});const dA=Zl({name:"VClassIcon",props:bm(),setup(t){return()=>I(t.tag,{class:t.icon},null)}}),vre={svg:{component:uA},class:{component:dA}};function bre(t){return Zs({defaultSet:"mdi",sets:{...vre,mdi:gre},aliases:{...mre,vuetify:["M8.2241 14.2009L12 21L22 3H14.4459L8.2241 14.2009Z",["M7.26303 12.4733L7.00113 12L2 3H12.5261C12.5261 3 12.5261 3 12.5261 3L7.26303 12.4733Z",.6]],"vuetify-outline":"svg:M7.26 12.47 12.53 3H2L7.26 12.47ZM14.45 3 8.22 14.2 12 21 22 3H14.45ZM18.6 5 12 16.88 10.51 14.2 15.62 5ZM7.26 8.35 5.4 5H9.13L7.26 8.35Z"}},t)}const yre=t=>{const e=vt($v);if(!e)throw new Error("Missing Vuetify Icons provide!");return{iconData:M(()=>{var l;const s=hs(t);if(!s)return{component:UC};let o=s;if(typeof o=="string"&&(o=o.trim(),o.startsWith("$")&&(o=(l=e.aliases)==null?void 0:l[o.slice(1)])),!o)throw new Error(`Could not find aliased icon "${s}"`);if(Array.isArray(o))return{component:uA,icon:o};if(typeof o!="string")return{component:UC,icon:o};const r=Object.keys(e.sets).find(c=>typeof o=="string"&&o.startsWith(`${c}:`)),i=r?o.slice(r.length+1):o;return{component:e.sets[r!=null?r:e.defaultSet].component,icon:i}})}},xre=["x-small","small","default","large","x-large"],Ad=ye({size:{type:[String,Number],default:"default"}},"size");function Rd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();return h0(()=>{let n,s;return lf(xre,t.size)?n=`${e}--size-${t.size}`:t.size&&(s={width:Fe(t.size),height:Fe(t.size)}),{sizeClasses:n,sizeStyles:s}})}const yn=ye({tag:{type:String,default:"div"}},"tag"),mf=Symbol.for("vuetify:theme"),_n=ye({theme:String},"theme"),lc={defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#6200EE","primary-darken-1":"#3700B3",secondary:"#03DAC6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#F5F5F5","theme-on-code":"#000000"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-bright":"#ccbfd6","surface-variant":"#a3a3a3","on-surface-variant":"#424242",primary:"#BB86FC","primary-darken-1":"#3700B3",secondary:"#03DAC5","secondary-darken-1":"#03DAC5",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":1,"medium-emphasis-opacity":.7,"disabled-opacity":.5,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#343434","theme-on-code":"#CCCCCC"}}}};function wre(){var n,s,o;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lc;if(!t)return{...lc,isDisabled:!0};const e={};for(const[r,i]of Object.entries((n=t.themes)!=null?n:{})){const a=i.dark||r==="dark"?(s=lc.themes)==null?void 0:s.dark:(o=lc.themes)==null?void 0:o.light;e[r]=Zs(a,i)}return Zs(lc,{...t,themes:e})}function Cre(t){const e=wre(t),n=_e(e.defaultTheme),s=_e(e.themes),o=M(()=>{const u={};for(const[d,h]of Object.entries(s.value)){const f=u[d]={...h,colors:{...h.colors}};if(e.variations)for(const p of e.variations.colors){const m=f.colors[p];if(!!m)for(const g of["lighten","darken"]){const v=g==="lighten"?sre:ore;for(const b of gm(e.variations[g],1))f.colors[`${p}-${g}-${b}`]=ere(v(jo(m),b))}}for(const p of Object.keys(f.colors)){if(/^on-[a-z]/.test(p)||f.colors[`on-${p}`])continue;const m=`on-${p}`,g=jo(f.colors[p]);f.colors[m]=iA(g)}}return u}),r=M(()=>o.value[n.value]),i=M(()=>{const u=[];r.value.dark&&Pi(u,":root",["color-scheme: dark"]),Pi(u,":root",GC(r.value));for(const[p,m]of Object.entries(o.value))Pi(u,`.v-theme--${p}`,[`color-scheme: ${m.dark?"dark":"normal"}`,...GC(m)]);const d=[],h=[],f=new Set(Object.values(o.value).flatMap(p=>Object.keys(p.colors)));for(const p of f)/^on-[a-z]/.test(p)?Pi(h,`.${p}`,[`color: rgb(var(--v-theme-${p})) !important`]):(Pi(d,`.bg-${p}`,[`--v-theme-overlay-multiplier: var(--v-theme-${p}-overlay-multiplier)`,`background-color: rgb(var(--v-theme-${p})) !important`,`color: rgb(var(--v-theme-on-${p})) !important`]),Pi(h,`.text-${p}`,[`color: rgb(var(--v-theme-${p})) !important`]),Pi(h,`.border-${p}`,[`--v-border-color: var(--v-theme-${p})`]));return u.push(...d,...h),u.map((p,m)=>m===0?p:`    ${p}`).join("")});function a(){return{style:[{children:i.value,id:"vuetify-theme-stylesheet",nonce:e.cspNonce||!1}]}}function l(u){if(e.isDisabled)return;const d=u._context.provides.usehead;if(d)if(d.push){const f=d.push(a);zt&&ze(i,()=>{f.patch(a)})}else zt?(d.addHeadObjs(M(a)),To(()=>d.updateDOM())):d.addHeadObjs(a());else{let p=function(){if(typeof document<"u"&&!f){const m=document.createElement("style");m.type="text/css",m.id="vuetify-theme-stylesheet",e.cspNonce&&m.setAttribute("nonce",e.cspNonce),f=m,document.head.appendChild(f)}f&&(f.innerHTML=i.value)};var h=p;let f=zt?document.getElementById("vuetify-theme-stylesheet"):null;zt?ze(i,p,{immediate:!0}):p()}}const c=M(()=>e.isDisabled?void 0:`v-theme--${n.value}`);return{install:l,isDisabled:e.isDisabled,name:n,themes:s,current:r,computedThemes:o,themeClasses:c,styles:i,global:{name:n,current:r}}}function jn(t){On("provideTheme");const e=vt(mf,null);if(!e)throw new Error("Could not find Vuetify theme injection");const n=M(()=>{var i;return(i=t.theme)!=null?i:e.name.value}),s=M(()=>e.themes.value[n.value]),o=M(()=>e.isDisabled?void 0:`v-theme--${n.value}`),r={...e,name:n,current:s,themeClasses:o};return vn(mf,r),r}function Pi(t,e,n){t.push(`${e} {
`,...n.map(s=>`  ${s};
`),`}
`)}function GC(t){const e=t.dark?2:1,n=t.dark?1:2,s=[];for(const[o,r]of Object.entries(t.colors)){const i=jo(r);s.push(`--v-theme-${o}: ${i.r},${i.g},${i.b}`),o.startsWith("on-")||s.push(`--v-theme-${o}-overlay-multiplier: ${rre(r)>.18?e:n}`)}for(const[o,r]of Object.entries(t.variables)){const i=typeof r=="string"&&r.startsWith("#")?jo(r):void 0,a=i?`${i.r}, ${i.g}, ${i.b}`:void 0;s.push(`--v-${o}: ${a!=null?a:r}`)}return s}const kre=ye({color:String,start:Boolean,end:Boolean,icon:$t,...st(),...Ad(),...yn({tag:"i"}),..._n()},"VIcon"),on=Re()({name:"VIcon",props:kre(),setup(t,e){let{attrs:n,slots:s}=e;const o=_e(),{themeClasses:r}=jn(t),{iconData:i}=yre(M(()=>o.value||t.icon)),{sizeClasses:a}=Rd(t),{textColorClasses:l,textColorStyles:c}=rr(Pe(t,"color"));return Ge(()=>{var d,h;const u=(d=s.default)==null?void 0:d.call(s);return u&&(o.value=(h=Z_(u).filter(f=>f.type===uu&&f.children&&typeof f.children=="string")[0])==null?void 0:h.children),I(i.value.component,{tag:t.tag,icon:i.value.icon,class:["v-icon","notranslate",r.value,a.value,l.value,{"v-icon--clickable":!!n.onClick,"v-icon--start":t.start,"v-icon--end":t.end},t.class],style:[a.value?void 0:{fontSize:Fe(t.size),height:Fe(t.size),width:Fe(t.size)},c.value,t.style],role:n.onClick?"button":void 0,"aria-hidden":!n.onClick},{default:()=>[u]})}),{}}});const Da=ye({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function Fa(t){return{dimensionStyles:M(()=>({height:Fe(t.height),maxHeight:Fe(t.maxHeight),maxWidth:Fe(t.maxWidth),minHeight:Fe(t.minHeight),minWidth:Fe(t.minWidth),width:Fe(t.width)}))}}function Sre(t){return{aspectStyles:M(()=>{const e=Number(t.aspectRatio);return e?{paddingBottom:String(1/e*100)+"%"}:void 0})}}const hA=ye({aspectRatio:[String,Number],contentClass:String,inline:Boolean,...st(),...Da()},"VResponsive"),HC=Re()({name:"VResponsive",props:hA(),setup(t,e){let{slots:n}=e;const{aspectStyles:s}=Sre(t),{dimensionStyles:o}=Fa(t);return Ge(()=>{var r;return I("div",{class:["v-responsive",{"v-responsive--inline":t.inline},t.class],style:[o.value,t.style]},[I("div",{class:"v-responsive__sizer",style:s.value},null),(r=n.additional)==null?void 0:r.call(n),n.default&&I("div",{class:["v-responsive__content",t.contentClass]},[n.default()])])}),{}}}),Dd=ye({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:t=>t!==!0}},"transition"),Qr=(t,e)=>{let{slots:n}=e;const{transition:s,disabled:o,...r}=t,{component:i=Cr,...a}=typeof s=="object"?s:{};return lr(i,Ue(typeof s=="string"?{name:o?"":s}:a,r,{disabled:o}),n)};function Ire(t,e){if(!u0)return;const n=e.modifiers||{},s=e.value,{handler:o,options:r}=typeof s=="object"?s:{handler:s,options:{}},i=new IntersectionObserver(function(){var d;let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1?arguments[1]:void 0;const c=(d=t._observe)==null?void 0:d[e.instance.$.uid];if(!c)return;const u=a.some(h=>h.isIntersecting);o&&(!n.quiet||c.init)&&(!n.once||u||c.init)&&o(u,a,l),u&&n.once?fA(t,e):c.init=!0},r);t._observe=Object(t._observe),t._observe[e.instance.$.uid]={init:!1,observer:i},i.observe(t)}function fA(t,e){var s;const n=(s=t._observe)==null?void 0:s[e.instance.$.uid];!n||(n.observer.unobserve(t),delete t._observe[e.instance.$.uid])}const $re={mounted:Ire,unmounted:fA},y0=$re,Tre=ye({alt:String,cover:Boolean,eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},srcset:String,...hA(),...st(),...Dd()},"VImg"),Fd=Re()({name:"VImg",directives:{intersect:y0},props:Tre(),emits:{loadstart:t=>!0,load:t=>!0,error:t=>!0},setup(t,e){let{emit:n,slots:s}=e;const o=He(""),r=_e(),i=He(t.eager?"loading":"idle"),a=He(),l=He(),c=M(()=>t.src&&typeof t.src=="object"?{src:t.src.src,srcset:t.srcset||t.src.srcset,lazySrc:t.lazySrc||t.src.lazySrc,aspect:Number(t.aspectRatio||t.src.aspect||0)}:{src:t.src,srcset:t.srcset,lazySrc:t.lazySrc,aspect:Number(t.aspectRatio||0)}),u=M(()=>c.value.aspect||a.value/l.value||0);ze(()=>t.src,()=>{d(i.value!=="idle")}),ze(u,(C,$)=>{!C&&$&&r.value&&g(r.value)}),fb(()=>d());function d(C){if(!(t.eager&&C)&&!(u0&&!C&&!t.eager)){if(i.value="loading",c.value.lazySrc){const $=new Image;$.src=c.value.lazySrc,g($,null)}!c.value.src||gn(()=>{var $,T;if(n("loadstart",(($=r.value)==null?void 0:$.currentSrc)||c.value.src),(T=r.value)!=null&&T.complete){if(r.value.naturalWidth||f(),i.value==="error")return;u.value||g(r.value,null),h()}else u.value||g(r.value),p()})}}function h(){var C;p(),i.value="loaded",n("load",((C=r.value)==null?void 0:C.currentSrc)||c.value.src)}function f(){var C;i.value="error",n("error",((C=r.value)==null?void 0:C.currentSrc)||c.value.src)}function p(){const C=r.value;C&&(o.value=C.currentSrc||C.src)}let m=-1;function g(C){let $=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const T=()=>{clearTimeout(m);const{naturalHeight:E,naturalWidth:_}=C;E||_?(a.value=_,l.value=E):!C.complete&&i.value==="loading"&&$!=null?m=window.setTimeout(T,$):(C.currentSrc.endsWith(".svg")||C.currentSrc.startsWith("data:image/svg+xml"))&&(a.value=1,l.value=1)};T()}const v=M(()=>({"v-img__img--cover":t.cover,"v-img__img--contain":!t.cover})),b=()=>{var T;if(!c.value.src||i.value==="idle")return null;const C=I("img",{class:["v-img__img",v.value],src:c.value.src,srcset:c.value.srcset,alt:t.alt,sizes:t.sizes,ref:r,onLoad:h,onError:f},null),$=(T=s.sources)==null?void 0:T.call(s);return I(Qr,{transition:t.transition,appear:!0},{default:()=>[$n($?I("picture",{class:"v-img__picture"},[$,C]):C,[[mi,i.value==="loaded"]])]})},y=()=>I(Qr,{transition:t.transition},{default:()=>[c.value.lazySrc&&i.value!=="loaded"&&I("img",{class:["v-img__img","v-img__img--preload",v.value],src:c.value.lazySrc,alt:t.alt},null)]}),x=()=>s.placeholder?I(Qr,{transition:t.transition,appear:!0},{default:()=>[(i.value==="loading"||i.value==="error"&&!s.error)&&I("div",{class:"v-img__placeholder"},[s.placeholder()])]}):null,w=()=>s.error?I(Qr,{transition:t.transition,appear:!0},{default:()=>[i.value==="error"&&I("div",{class:"v-img__error"},[s.error()])]}):null,k=()=>t.gradient?I("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${t.gradient})`}},null):null,S=He(!1);{const C=ze(u,$=>{$&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{S.value=!0})}),C())})}return Ge(()=>{const[C]=HC.filterProps(t);return $n(I(HC,Ue({class:["v-img",{"v-img--booting":!S.value},t.class],style:[{width:Fe(t.width==="auto"?a.value:t.width)},t.style]},C,{aspectRatio:u.value,"aria-label":t.alt,role:t.alt?"img":void 0}),{additional:()=>I(ot,null,[I(b,null,null),I(y,null,null),I(k,null,null),I(x,null,null),I(w,null,null)]),default:s.default}),[[ar("intersect"),{handler:d,options:t.options},null,{once:!0}]])}),{currentSrc:o,image:r,state:i,naturalWidth:a,naturalHeight:l}}}),Nre=[null,"default","comfortable","compact"],ur=ye({density:{type:String,default:"default",validator:t=>Nre.includes(t)}},"density");function Mr(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();return{densityClasses:M(()=>`${e}--density-${t.density}`)}}const _o=ye({rounded:{type:[Boolean,Number,String],default:void 0}},"rounded");function Ao(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();return{roundedClasses:M(()=>{const s=Vt(t)?t.value:t.rounded,o=[];if(s===!0||s==="")o.push(`${e}--rounded`);else if(typeof s=="string"||s===0)for(const r of String(s).split(" "))o.push(`rounded-${r}`);return o})}}const Ere=["elevated","flat","tonal","outlined","text","plain"];function Od(t,e){return I(ot,null,[t&&I("span",{key:"overlay",class:`${e}__overlay`},null),I("span",{key:"underlay",class:`${e}__underlay`},null)])}const $i=ye({color:String,variant:{type:String,default:"elevated",validator:t=>Ere.includes(t)}},"variant");function Pd(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();const n=M(()=>{const{variant:r}=hs(t);return`${e}--variant-${r}`}),{colorClasses:s,colorStyles:o}=b0(M(()=>{const{variant:r,color:i}=hs(t);return{[["elevated","flat"].includes(r)?"background":"text"]:i}}));return{colorClasses:s,colorStyles:o,variantClasses:n}}const _re=ye({start:Boolean,end:Boolean,icon:$t,image:String,...st(),...ur(),..._o(),...Ad(),...yn(),..._n(),...$i({variant:"flat"})},"VAvatar"),$l=Re()({name:"VAvatar",props:_re(),setup(t,e){let{slots:n}=e;const{themeClasses:s}=jn(t),{colorClasses:o,colorStyles:r,variantClasses:i}=Pd(t),{densityClasses:a}=Mr(t),{roundedClasses:l}=Ao(t),{sizeClasses:c,sizeStyles:u}=Rd(t);return Ge(()=>I(t.tag,{class:["v-avatar",{"v-avatar--start":t.start,"v-avatar--end":t.end},s.value,o.value,a.value,l.value,c.value,i.value,t.class],style:[r.value,u.value,t.style]},{default:()=>{var d;return[t.image?I(Fd,{key:"image",src:t.image,alt:"",cover:!0},null):t.icon?I(on,{key:"icon",icon:t.icon},null):(d=n.default)==null?void 0:d.call(n),Od(!1,"v-avatar")]}})),{}}}),Are=ye({defaults:Object,disabled:Boolean,reset:[Number,String],root:[Boolean,String],scoped:Boolean},"VDefaultsProvider"),pn=Re(!1)({name:"VDefaultsProvider",props:Are(),setup(t,e){let{slots:n}=e;const{defaults:s,disabled:o,reset:r,root:i,scoped:a}=ab(t);return Ra(s,{reset:r,root:i,scoped:a,disabled:o}),()=>{var l;return(l=n.default)==null?void 0:l.call(n)}}}),Rre=ye({appendAvatar:String,appendIcon:$t,prependAvatar:String,prependIcon:$t,subtitle:String,title:String,...st(),...ur()},"VCardItem"),Dre=Re()({name:"VCardItem",props:Rre(),setup(t,e){let{slots:n}=e;return Ge(()=>{var c;const s=!!(t.prependAvatar||t.prependIcon),o=!!(s||n.prepend),r=!!(t.appendAvatar||t.appendIcon),i=!!(r||n.append),a=!!(t.title||n.title),l=!!(t.subtitle||n.subtitle);return I("div",{class:["v-card-item",t.class],style:t.style},[o&&I("div",{key:"prepend",class:"v-card-item__prepend"},[n.prepend?I(pn,{key:"prepend-defaults",disabled:!s,defaults:{VAvatar:{density:t.density,icon:t.prependIcon,image:t.prependAvatar}}},n.prepend):s&&I($l,{key:"prepend-avatar",density:t.density,icon:t.prependIcon,image:t.prependAvatar},null)]),I("div",{class:"v-card-item__content"},[a&&I(so,{key:"title"},{default:()=>{var u,d;return[(d=(u=n.title)==null?void 0:u.call(n))!=null?d:t.title]}}),l&&I(pre,{key:"subtitle"},{default:()=>{var u,d;return[(d=(u=n.subtitle)==null?void 0:u.call(n))!=null?d:t.subtitle]}}),(c=n.default)==null?void 0:c.call(n)]),i&&I("div",{key:"append",class:"v-card-item__append"},[n.append?I(pn,{key:"append-defaults",disabled:!r,defaults:{VAvatar:{density:t.density,icon:t.appendIcon,image:t.appendAvatar}}},n.append):r&&I($l,{key:"append-avatar",density:t.density,icon:t.appendIcon,image:t.appendAvatar},null)])])}),{}}}),Io=Ql("v-card-text"),Oa=ye({border:[Boolean,Number,String]},"border");function Pa(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();return{borderClasses:M(()=>{const s=Vt(t)?t.value:t.border,o=[];if(s===!0||s==="")o.push(`${e}--border`);else if(typeof s=="string"||s===0)for(const r of String(s).split(" "))o.push(`border-${r}`);return o})}}const Ti=ye({elevation:{type:[Number,String],validator(t){const e=parseInt(t);return!isNaN(e)&&e>=0&&e<=24}}},"elevation");function Ni(t){return{elevationClasses:M(()=>{const n=Vt(t)?t.value:t.elevation,s=[];return n==null||s.push(`elevation-${n}`),s})}}function pA(t,e){const n=_e(),s=He(!1);if(u0){const o=new IntersectionObserver(r=>{t==null||t(r,o),s.value=!!r.find(i=>i.isIntersecting)},e);oo(()=>{o.disconnect()}),ze(n,(r,i)=>{i&&(o.unobserve(i),s.value=!1),r&&o.observe(r)},{flush:"post"})}return{intersectionRef:n,isIntersecting:s}}const Fre={badge:"Badge",open:"Open",close:"Close",dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},dateRangeInput:{divider:"to"},datePicker:{ok:"OK",cancel:"Cancel",range:{title:"Select dates",header:"Enter dates"},title:"Select date",header:"Enter date",input:{placeholder:"Enter date"}},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action",otp:"Please enter OTP character {0}"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},timePicker:{am:"AM",pm:"PM"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Go to page {0}",currentPage:"Page {0}, Current page",first:"First page",last:"Last page"}},stepper:{next:"Next",prev:"Previous"},rating:{ariaLabel:{item:"Rating {0} of {1}"}},loading:"Loading...",infiniteScroll:{loadMore:"Load more",empty:"No more"}},Ore={af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!0,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1};function fi(t,e){let n;function s(){n=Jv(),n.run(()=>e.length?e(()=>{n==null||n.stop(),s()}):e())}ze(t,o=>{o&&!n?s():o||(n==null||n.stop(),n=void 0)},{immediate:!0}),ms(()=>{n==null||n.stop()})}function Mt(t,e,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:d=>d,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:d=>d;const r=On("useProxiedModel"),i=_e(t[e]!==void 0?t[e]:n),a=ea(e),c=M(a!==e?()=>{var d,h,f,p;return t[e],!!((((d=r.vnode.props)==null?void 0:d.hasOwnProperty(e))||((h=r.vnode.props)==null?void 0:h.hasOwnProperty(a)))&&(((f=r.vnode.props)==null?void 0:f.hasOwnProperty(`onUpdate:${e}`))||((p=r.vnode.props)==null?void 0:p.hasOwnProperty(`onUpdate:${a}`))))}:()=>{var d,h;return t[e],!!(((d=r.vnode.props)==null?void 0:d.hasOwnProperty(e))&&((h=r.vnode.props)==null?void 0:h.hasOwnProperty(`onUpdate:${e}`)))});fi(()=>!c.value,()=>{ze(()=>t[e],d=>{i.value=d})});const u=M({get(){const d=t[e];return s(c.value?d:i.value)},set(d){const h=o(d),f=Qe(c.value?t[e]:i.value);f===h||s(f)===d||(i.value=h,r==null||r.emit(`update:${e}`,h))}});return Object.defineProperty(u,"externalValue",{get:()=>c.value?t[e]:i.value}),u}const jC="$vuetify.",KC=(t,e)=>t.replace(/\{(\d+)\}/g,(n,s)=>String(e[+s])),mA=(t,e,n)=>function(s){for(var o=arguments.length,r=new Array(o>1?o-1:0),i=1;i<o;i++)r[i-1]=arguments[i];if(!s.startsWith(jC))return KC(s,r);const a=s.replace(jC,""),l=t.value&&n.value[t.value],c=e.value&&n.value[e.value];let u=Cv(l,a,null);return u||(`${s}${t.value}`,u=Cv(c,a,null)),u||(u=s),typeof u!="string"&&(u=s),KC(u,r)};function gA(t,e){return(n,s)=>new Intl.NumberFormat([t.value,e.value],s).format(n)}function ig(t,e,n){var o,r;const s=Mt(t,e,(o=t[e])!=null?o:n.value);return s.value=(r=t[e])!=null?r:n.value,ze(n,i=>{t[e]==null&&(s.value=n.value)}),s}function vA(t){return e=>{const n=ig(e,"locale",t.current),s=ig(e,"fallback",t.fallback),o=ig(e,"messages",t.messages);return{name:"vuetify",current:n,fallback:s,messages:o,t:mA(n,s,o),n:gA(n,s),provide:vA({current:n,fallback:s,messages:o})}}}function Pre(t){var o,r;const e=He((o=t==null?void 0:t.locale)!=null?o:"en"),n=He((r=t==null?void 0:t.fallback)!=null?r:"en"),s=_e({en:Fre,...t==null?void 0:t.messages});return{name:"vuetify",current:e,fallback:n,messages:s,t:mA(e,n,s),n:gA(e,n),provide:vA({current:e,fallback:n,messages:s})}}const gf=Symbol.for("vuetify:locale");function Mre(t){return t.name!=null}function Lre(t){const e=(t==null?void 0:t.adapter)&&Mre(t==null?void 0:t.adapter)?t==null?void 0:t.adapter:Pre(t),n=Bre(e,t);return{...e,...n}}function x0(){const t=vt(gf);if(!t)throw new Error("[Vuetify] Could not find injected locale instance");return t}function Bre(t,e){var o;const n=_e((o=e==null?void 0:e.rtl)!=null?o:Ore),s=M(()=>{var r;return(r=n.value[t.current.value])!=null?r:!1});return{isRtl:s,rtl:n,rtlClasses:M(()=>`v-locale--is-${s.value?"rtl":"ltr"}`)}}function Ro(){const t=vt(gf);if(!t)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:t.isRtl,rtlClasses:t.rtlClasses}}const qC={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},w0=ye({location:String},"location");function C0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2?arguments[2]:void 0;const{isRtl:s}=Ro();return{locationStyles:M(()=>{if(!t.location)return{};const{side:r,align:i}=Iv(t.location.split(" ").length>1?t.location:`${t.location} center`,s.value);function a(c){return n?n(c):0}const l={};return r!=="center"&&(e?l[qC[r]]=`calc(100% - ${a(r)}px)`:l[r]=0),i!=="center"?e?l[qC[i]]=`calc(100% - ${a(i)}px)`:l[i]=0:(r==="center"?l.top=l.left="50%":l[{top:"left",bottom:"left",left:"top",right:"top"}[r]]="50%",l.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[r]),l})}}const Vre=ye({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...st(),...w0({location:"top"}),..._o(),...yn(),..._n()},"VProgressLinear"),bA=Re()({name:"VProgressLinear",props:Vre(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const s=Mt(t,"modelValue"),{isRtl:o,rtlClasses:r}=Ro(),{themeClasses:i}=jn(t),{locationStyles:a}=C0(t),{textColorClasses:l,textColorStyles:c}=rr(t,"color"),{backgroundColorClasses:u,backgroundColorStyles:d}=Nr(M(()=>t.bgColor||t.color)),{backgroundColorClasses:h,backgroundColorStyles:f}=Nr(t,"color"),{roundedClasses:p}=Ao(t),{intersectionRef:m,isIntersecting:g}=pA(),v=M(()=>parseInt(t.max,10)),b=M(()=>parseInt(t.height,10)),y=M(()=>parseFloat(t.bufferValue)/v.value*100),x=M(()=>parseFloat(s.value)/v.value*100),w=M(()=>o.value!==t.reverse),k=M(()=>t.indeterminate?"fade-transition":"slide-x-transition"),S=M(()=>t.bgOpacity==null?t.bgOpacity:parseFloat(t.bgOpacity));function C($){if(!m.value)return;const{left:T,right:E,width:_}=m.value.getBoundingClientRect(),A=w.value?_-$.clientX+(E-_):$.clientX-T;s.value=Math.round(A/_*v.value)}return Ge(()=>I(t.tag,{ref:m,class:["v-progress-linear",{"v-progress-linear--absolute":t.absolute,"v-progress-linear--active":t.active&&g.value,"v-progress-linear--reverse":w.value,"v-progress-linear--rounded":t.rounded,"v-progress-linear--rounded-bar":t.roundedBar,"v-progress-linear--striped":t.striped},p.value,i.value,r.value,t.class],style:[{bottom:t.location==="bottom"?0:void 0,top:t.location==="top"?0:void 0,height:t.active?Fe(b.value):0,"--v-progress-linear-height":Fe(b.value),...a.value},t.style],role:"progressbar","aria-hidden":t.active?"false":"true","aria-valuemin":"0","aria-valuemax":t.max,"aria-valuenow":t.indeterminate?void 0:x.value,onClick:t.clickable&&C},{default:()=>[t.stream&&I("div",{key:"stream",class:["v-progress-linear__stream",l.value],style:{...c.value,[w.value?"left":"right"]:Fe(-b.value),borderTop:`${Fe(b.value/2)} dotted`,opacity:S.value,top:`calc(50% - ${Fe(b.value/4)})`,width:Fe(100-y.value,"%"),"--v-progress-linear-stream-to":Fe(b.value*(w.value?1:-1))}},null),I("div",{class:["v-progress-linear__background",u.value],style:[d.value,{opacity:S.value,width:Fe(t.stream?y.value:100,"%")}]},null),I(Cr,{name:k.value},{default:()=>[t.indeterminate?I("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map($=>I("div",{key:$,class:["v-progress-linear__indeterminate",$,h.value],style:f.value},null))]):I("div",{class:["v-progress-linear__determinate",h.value],style:[f.value,{width:Fe(x.value,"%")}]},null)]}),n.default&&I("div",{class:"v-progress-linear__content"},[n.default({value:x.value,buffer:y.value})])]})),{}}}),k0=ye({loading:[Boolean,String]},"loader");function ym(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();return{loaderClasses:M(()=>({[`${e}--loading`]:t.loading}))}}function S0(t,e){var s;let{slots:n}=e;return I("div",{class:`${t.name}__loader`},[((s=n.default)==null?void 0:s.call(n,{color:t.color,isActive:t.active}))||I(bA,{active:t.active,color:t.color,height:"2",indeterminate:!0},null)])}const zre=["static","relative","fixed","absolute","sticky"],yA=ye({position:{type:String,validator:t=>zre.includes(t)}},"position");function xA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();return{positionClasses:M(()=>t.position?`${e}--${t.position}`:void 0)}}function Wre(){var t,e;return(e=(t=On("useRouter"))==null?void 0:t.proxy)==null?void 0:e.$router}function xm(t,e){const n=UF("RouterLink"),s=M(()=>!!(t.href||t.to)),o=M(()=>(s==null?void 0:s.value)||TC(e,"click")||TC(t,"click"));if(typeof n=="string")return{isLink:s,isClickable:o,href:Pe(t,"href")};const r=t.to?n.useLink(t):void 0;return{isLink:s,isClickable:o,route:r==null?void 0:r.route,navigate:r==null?void 0:r.navigate,isActive:r&&M(()=>{var i,a;return t.exact?(i=r.isExactActive)==null?void 0:i.value:(a=r.isActive)==null?void 0:a.value}),href:M(()=>t.to?r==null?void 0:r.route.value.href:t.href)}}const wm=ye({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router");let ag=!1;function Ure(t,e){let n=!1,s,o;zt&&(gn(()=>{window.addEventListener("popstate",r),s=t==null?void 0:t.beforeEach((i,a,l)=>{ag?n?e(l):l():setTimeout(()=>n?e(l):l()),ag=!0}),o=t==null?void 0:t.afterEach(()=>{ag=!1})}),ms(()=>{window.removeEventListener("popstate",r),s==null||s(),o==null||o()}));function r(i){var a;(a=i.state)!=null&&a.replaced||(n=!0,setTimeout(()=>n=!1))}}const Tv=Symbol("rippleStop"),Gre=80;function XC(t,e){t.style.transform=e,t.style.webkitTransform=e}function Nv(t){return t.constructor.name==="TouchEvent"}function wA(t){return t.constructor.name==="KeyboardEvent"}const Hre=function(t,e){var d;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=0,o=0;if(!wA(t)){const h=e.getBoundingClientRect(),f=Nv(t)?t.touches[t.touches.length-1]:t;s=f.clientX-h.left,o=f.clientY-h.top}let r=0,i=.3;(d=e._ripple)!=null&&d.circle?(i=.15,r=e.clientWidth/2,r=n.center?r:r+Math.sqrt((s-r)**2+(o-r)**2)/4):r=Math.sqrt(e.clientWidth**2+e.clientHeight**2)/2;const a=`${(e.clientWidth-r*2)/2}px`,l=`${(e.clientHeight-r*2)/2}px`,c=n.center?a:`${s-r}px`,u=n.center?l:`${o-r}px`;return{radius:r,scale:i,x:c,y:u,centerX:a,centerY:l}},vf={show(t,e){var f;let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!((f=e==null?void 0:e._ripple)!=null&&f.enabled))return;const s=document.createElement("span"),o=document.createElement("span");s.appendChild(o),s.className="v-ripple__container",n.class&&(s.className+=` ${n.class}`);const{radius:r,scale:i,x:a,y:l,centerX:c,centerY:u}=Hre(t,e,n),d=`${r*2}px`;o.className="v-ripple__animation",o.style.width=d,o.style.height=d,e.appendChild(s);const h=window.getComputedStyle(e);h&&h.position==="static"&&(e.style.position="relative",e.dataset.previousPosition="static"),o.classList.add("v-ripple__animation--enter"),o.classList.add("v-ripple__animation--visible"),XC(o,`translate(${a}, ${l}) scale3d(${i},${i},${i})`),o.dataset.activated=String(performance.now()),setTimeout(()=>{o.classList.remove("v-ripple__animation--enter"),o.classList.add("v-ripple__animation--in"),XC(o,`translate(${c}, ${u}) scale3d(1,1,1)`)},0)},hide(t){var r;if(!((r=t==null?void 0:t._ripple)!=null&&r.enabled))return;const e=t.getElementsByClassName("v-ripple__animation");if(e.length===0)return;const n=e[e.length-1];if(n.dataset.isHiding)return;n.dataset.isHiding="true";const s=performance.now()-Number(n.dataset.activated),o=Math.max(250-s,0);setTimeout(()=>{n.classList.remove("v-ripple__animation--in"),n.classList.add("v-ripple__animation--out"),setTimeout(()=>{var a;t.getElementsByClassName("v-ripple__animation").length===1&&t.dataset.previousPosition&&(t.style.position=t.dataset.previousPosition,delete t.dataset.previousPosition),((a=n.parentNode)==null?void 0:a.parentNode)===t&&t.removeChild(n.parentNode)},300)},o)}};function CA(t){return typeof t>"u"||!!t}function eu(t){const e={},n=t.currentTarget;if(!(!(n!=null&&n._ripple)||n._ripple.touched||t[Tv])){if(t[Tv]=!0,Nv(t))n._ripple.touched=!0,n._ripple.isTouch=!0;else if(n._ripple.isTouch)return;if(e.center=n._ripple.centered||wA(t),n._ripple.class&&(e.class=n._ripple.class),Nv(t)){if(n._ripple.showTimerCommit)return;n._ripple.showTimerCommit=()=>{vf.show(t,n,e)},n._ripple.showTimer=window.setTimeout(()=>{var s;(s=n==null?void 0:n._ripple)!=null&&s.showTimerCommit&&(n._ripple.showTimerCommit(),n._ripple.showTimerCommit=null)},Gre)}else vf.show(t,n,e)}}function YC(t){t[Tv]=!0}function Ns(t){const e=t.currentTarget;if(!!(e!=null&&e._ripple)){if(window.clearTimeout(e._ripple.showTimer),t.type==="touchend"&&e._ripple.showTimerCommit){e._ripple.showTimerCommit(),e._ripple.showTimerCommit=null,e._ripple.showTimer=window.setTimeout(()=>{Ns(t)});return}window.setTimeout(()=>{e._ripple&&(e._ripple.touched=!1)}),vf.hide(e)}}function kA(t){const e=t.currentTarget;!(e!=null&&e._ripple)||(e._ripple.showTimerCommit&&(e._ripple.showTimerCommit=null),window.clearTimeout(e._ripple.showTimer))}let tu=!1;function SA(t){!tu&&(t.keyCode===kC.enter||t.keyCode===kC.space)&&(tu=!0,eu(t))}function IA(t){tu=!1,Ns(t)}function $A(t){tu&&(tu=!1,Ns(t))}function TA(t,e,n){var i;const{value:s,modifiers:o}=e,r=CA(s);if(r||vf.hide(t),t._ripple=(i=t._ripple)!=null?i:{},t._ripple.enabled=r,t._ripple.centered=o.center,t._ripple.circle=o.circle,kv(s)&&s.class&&(t._ripple.class=s.class),r&&!n){if(o.stop){t.addEventListener("touchstart",YC,{passive:!0}),t.addEventListener("mousedown",YC);return}t.addEventListener("touchstart",eu,{passive:!0}),t.addEventListener("touchend",Ns,{passive:!0}),t.addEventListener("touchmove",kA,{passive:!0}),t.addEventListener("touchcancel",Ns),t.addEventListener("mousedown",eu),t.addEventListener("mouseup",Ns),t.addEventListener("mouseleave",Ns),t.addEventListener("keydown",SA),t.addEventListener("keyup",IA),t.addEventListener("blur",$A),t.addEventListener("dragstart",Ns,{passive:!0})}else!r&&n&&NA(t)}function NA(t){t.removeEventListener("mousedown",eu),t.removeEventListener("touchstart",eu),t.removeEventListener("touchend",Ns),t.removeEventListener("touchmove",kA),t.removeEventListener("touchcancel",Ns),t.removeEventListener("mouseup",Ns),t.removeEventListener("mouseleave",Ns),t.removeEventListener("keydown",SA),t.removeEventListener("keyup",IA),t.removeEventListener("dragstart",Ns),t.removeEventListener("blur",$A)}function jre(t,e){TA(t,e,!1)}function Kre(t){delete t._ripple,NA(t)}function qre(t,e){if(e.value===e.oldValue)return;const n=CA(e.oldValue);TA(t,e,n)}const Jl={mounted:jre,unmounted:Kre,updated:qre},Xre=ye({appendAvatar:String,appendIcon:$t,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:$t,ripple:{type:[Boolean,Object],default:!0},subtitle:String,text:String,title:String,...Oa(),...st(),...ur(),...Da(),...Ti(),...k0(),...w0(),...yA(),..._o(),...wm(),...yn(),..._n(),...$i({variant:"elevated"})},"VCard"),Ds=Re()({name:"VCard",directives:{Ripple:Jl},props:Xre(),setup(t,e){let{attrs:n,slots:s}=e;const{themeClasses:o}=jn(t),{borderClasses:r}=Pa(t),{colorClasses:i,colorStyles:a,variantClasses:l}=Pd(t),{densityClasses:c}=Mr(t),{dimensionStyles:u}=Fa(t),{elevationClasses:d}=Ni(t),{loaderClasses:h}=ym(t),{locationStyles:f}=C0(t),{positionClasses:p}=xA(t),{roundedClasses:m}=Ao(t),g=xm(t,n),v=M(()=>t.link!==!1&&g.isLink.value),b=M(()=>!t.disabled&&t.link!==!1&&(t.link||g.isClickable.value));return Ge(()=>{const y=v.value?"a":t.tag,x=!!(s.title||t.title),w=!!(s.subtitle||t.subtitle),k=x||w,S=!!(s.append||t.appendAvatar||t.appendIcon),C=!!(s.prepend||t.prependAvatar||t.prependIcon),$=!!(s.image||t.image),T=k||C||S,E=!!(s.text||t.text);return $n(I(y,{class:["v-card",{"v-card--disabled":t.disabled,"v-card--flat":t.flat,"v-card--hover":t.hover&&!(t.disabled||t.flat),"v-card--link":b.value},o.value,r.value,i.value,c.value,d.value,h.value,p.value,m.value,l.value,t.class],style:[a.value,u.value,f.value,t.style],href:g.href.value,onClick:b.value&&g.navigate,tabindex:t.disabled?-1:void 0},{default:()=>{var _;return[$&&I("div",{key:"image",class:"v-card__image"},[s.image?I(pn,{key:"image-defaults",disabled:!t.image,defaults:{VImg:{cover:!0,src:t.image}}},s.image):I(Fd,{key:"image-img",cover:!0,src:t.image},null)]),I(S0,{name:"v-card",active:!!t.loading,color:typeof t.loading=="boolean"?void 0:t.loading},{default:s.loader}),T&&I(Dre,{key:"item",prependAvatar:t.prependAvatar,prependIcon:t.prependIcon,title:t.title,subtitle:t.subtitle,appendAvatar:t.appendAvatar,appendIcon:t.appendIcon},{default:s.item,prepend:s.prepend,title:s.title,subtitle:s.subtitle,append:s.append}),E&&I(Io,{key:"text"},{default:()=>{var A,O;return[(O=(A=s.text)==null?void 0:A.call(s))!=null?O:t.text]}}),(_=s.default)==null?void 0:_.call(s),s.actions&&I(v0,null,{default:s.actions}),Od(b.value,"v-card")]}}),[[ar("ripple"),b.value&&t.ripple]])}),{}}});const Yre=ye({fluid:{type:Boolean,default:!1},...st(),...yn()},"VContainer"),Zre=Re()({name:"VContainer",props:Yre(),setup(t,e){let{slots:n}=e;const{rtlClasses:s}=Ro();return Ge(()=>I(t.tag,{class:["v-container",{"v-container--fluid":t.fluid},s.value,t.class],style:t.style},n)),{}}}),Cm=["sm","md","lg","xl","xxl"],Ev=Symbol.for("vuetify:display"),ZC={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},Qre=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ZC;return Zs(ZC,t)};function QC(t){return zt&&!t?window.innerWidth:typeof t=="object"&&t.clientWidth||0}function JC(t){return zt&&!t?window.innerHeight:typeof t=="object"&&t.clientHeight||0}function ek(t){const e=zt&&!t?window.navigator.userAgent:"ssr";function n(p){return Boolean(e.match(p))}const s=n(/android/i),o=n(/iphone|ipad|ipod/i),r=n(/cordova/i),i=n(/electron/i),a=n(/chrome/i),l=n(/edge/i),c=n(/firefox/i),u=n(/opera/i),d=n(/win/i),h=n(/mac/i),f=n(/linux/i);return{android:s,ios:o,cordova:r,electron:i,chrome:a,edge:l,firefox:c,opera:u,win:d,mac:h,linux:f,touch:Roe,ssr:e==="ssr"}}function Jre(t,e){const{thresholds:n,mobileBreakpoint:s}=Qre(t),o=He(JC(e)),r=He(ek(e)),i=Jn({}),a=He(QC(e));function l(){o.value=JC(),a.value=QC()}function c(){l(),r.value=ek()}return To(()=>{const u=a.value<n.sm,d=a.value<n.md&&!u,h=a.value<n.lg&&!(d||u),f=a.value<n.xl&&!(h||d||u),p=a.value<n.xxl&&!(f||h||d||u),m=a.value>=n.xxl,g=u?"xs":d?"sm":h?"md":f?"lg":p?"xl":"xxl",v=typeof s=="number"?s:n[s],b=a.value<v;i.xs=u,i.sm=d,i.md=h,i.lg=f,i.xl=p,i.xxl=m,i.smAndUp=!u,i.mdAndUp=!(u||d),i.lgAndUp=!(u||d||h),i.xlAndUp=!(u||d||h||f),i.smAndDown=!(h||f||p||m),i.mdAndDown=!(f||p||m),i.lgAndDown=!(p||m),i.xlAndDown=!m,i.name=g,i.height=o.value,i.width=a.value,i.mobile=b,i.mobileBreakpoint=s,i.platform=r.value,i.thresholds=n}),zt&&window.addEventListener("resize",l,{passive:!0}),{...ab(i),update:c,ssr:!!e}}function EA(){const t=vt(Ev);if(!t)throw new Error("Could not find Vuetify display injection");return t}const _A=(()=>Cm.reduce((t,e)=>(t[e]={type:[Boolean,String,Number],default:!1},t),{}))(),AA=(()=>Cm.reduce((t,e)=>{const n="offset"+Er(e);return t[n]={type:[String,Number],default:null},t},{}))(),RA=(()=>Cm.reduce((t,e)=>{const n="order"+Er(e);return t[n]={type:[String,Number],default:null},t},{}))(),tk={col:Object.keys(_A),offset:Object.keys(AA),order:Object.keys(RA)};function eie(t,e,n){let s=t;if(!(n==null||n===!1)){if(e){const o=e.replace(t,"");s+=`-${o}`}return t==="col"&&(s="v-"+s),t==="col"&&(n===""||n===!0)||(s+=`-${n}`),s.toLowerCase()}}const tie=["auto","start","end","center","baseline","stretch"],nie=ye({cols:{type:[Boolean,String,Number],default:!1},..._A,offset:{type:[String,Number],default:null},...AA,order:{type:[String,Number],default:null},...RA,alignSelf:{type:String,default:null,validator:t=>tie.includes(t)},...st(),...yn()},"VCol"),tn=Re()({name:"VCol",props:nie(),setup(t,e){let{slots:n}=e;const s=M(()=>{const o=[];let r;for(r in tk)tk[r].forEach(a=>{const l=t[a],c=eie(r,a,l);c&&o.push(c)});const i=o.some(a=>a.startsWith("v-col-"));return o.push({"v-col":!i||!t.cols,[`v-col-${t.cols}`]:t.cols,[`offset-${t.offset}`]:t.offset,[`order-${t.order}`]:t.order,[`align-self-${t.alignSelf}`]:t.alignSelf}),o});return()=>{var o;return lr(t.tag,{class:[s.value,t.class],style:t.style},(o=n.default)==null?void 0:o.call(n))}}}),I0=["start","end","center"],DA=["space-between","space-around","space-evenly"];function $0(t,e){return Cm.reduce((n,s)=>{const o=t+Er(s);return n[o]=e(),n},{})}const sie=[...I0,"baseline","stretch"],FA=t=>sie.includes(t),OA=$0("align",()=>({type:String,default:null,validator:FA})),oie=[...I0,...DA],PA=t=>oie.includes(t),MA=$0("justify",()=>({type:String,default:null,validator:PA})),rie=[...I0,...DA,"stretch"],LA=t=>rie.includes(t),BA=$0("alignContent",()=>({type:String,default:null,validator:LA})),nk={align:Object.keys(OA),justify:Object.keys(MA),alignContent:Object.keys(BA)},iie={align:"align",justify:"justify",alignContent:"align-content"};function aie(t,e,n){let s=iie[t];if(n!=null){if(e){const o=e.replace(t,"");s+=`-${o}`}return s+=`-${n}`,s.toLowerCase()}}const lie=ye({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:FA},...OA,justify:{type:String,default:null,validator:PA},...MA,alignContent:{type:String,default:null,validator:LA},...BA,...st(),...yn()},"VRow"),Md=Re()({name:"VRow",props:lie(),setup(t,e){let{slots:n}=e;const s=M(()=>{const o=[];let r;for(r in nk)nk[r].forEach(i=>{const a=t[i],l=aie(r,i,a);l&&o.push(l)});return o.push({"v-row--no-gutters":t.noGutters,"v-row--dense":t.dense,[`align-${t.align}`]:t.align,[`justify-${t.justify}`]:t.justify,[`align-content-${t.alignContent}`]:t.alignContent}),o});return()=>{var o;return lr(t.tag,{class:["v-row",s.value,t.class],style:t.style},(o=n.default)==null?void 0:o.call(n))}}}),nu=Ql("v-spacer","div","VSpacer");const cie=ye({disabled:Boolean,group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:String,origin:String},"transition");function Ms(t,e,n){return Re()({name:t,props:cie({mode:n,origin:e}),setup(s,o){let{slots:r}=o;const i={onBeforeEnter(a){s.origin&&(a.style.transformOrigin=s.origin)},onLeave(a){if(s.leaveAbsolute){const{offsetTop:l,offsetLeft:c,offsetWidth:u,offsetHeight:d}=a;a._transitionInitialStyles={position:a.style.position,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height},a.style.position="absolute",a.style.top=`${l}px`,a.style.left=`${c}px`,a.style.width=`${u}px`,a.style.height=`${d}px`}s.hideOnLeave&&a.style.setProperty("display","none","important")},onAfterLeave(a){if(s.leaveAbsolute&&(a==null?void 0:a._transitionInitialStyles)){const{position:l,top:c,left:u,width:d,height:h}=a._transitionInitialStyles;delete a._transitionInitialStyles,a.style.position=l||"",a.style.top=c||"",a.style.left=u||"",a.style.width=d||"",a.style.height=h||""}}};return()=>{const a=s.group?tI:Cr;return lr(a,{name:s.disabled?"":t,css:!s.disabled,...s.group?void 0:{mode:s.mode},...s.disabled?{}:i},r.default)}}})}function VA(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return Re()({name:t,props:{mode:{type:String,default:n},disabled:Boolean},setup(s,o){let{slots:r}=o;return()=>lr(Cr,{name:s.disabled?"":t,css:!s.disabled,...s.disabled?{}:e},r.default)}})}function zA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",s=eo(`offset-${n}`);return{onBeforeEnter(i){i._parent=i.parentNode,i._initialStyle={transition:i.style.transition,overflow:i.style.overflow,[n]:i.style[n]}},onEnter(i){const a=i._initialStyle;i.style.setProperty("transition","none","important"),i.style.overflow="hidden";const l=`${i[s]}px`;i.style[n]="0",i.offsetHeight,i.style.transition=a.transition,t&&i._parent&&i._parent.classList.add(t),requestAnimationFrame(()=>{i.style[n]=l})},onAfterEnter:r,onEnterCancelled:r,onLeave(i){i._initialStyle={transition:"",overflow:i.style.overflow,[n]:i.style[n]},i.style.overflow="hidden",i.style[n]=`${i[s]}px`,i.offsetHeight,requestAnimationFrame(()=>i.style[n]="0")},onAfterLeave:o,onLeaveCancelled:o};function o(i){t&&i._parent&&i._parent.classList.remove(t),r(i)}function r(i){const a=i._initialStyle[n];i.style.overflow=i._initialStyle.overflow,a!=null&&(i.style[n]=a),delete i._initialStyle}}const uie=ye({target:Object},"v-dialog-transition"),T0=Re()({name:"VDialogTransition",props:uie(),setup(t,e){let{slots:n}=e;const s={onBeforeEnter(o){o.style.pointerEvents="none",o.style.visibility="hidden"},async onEnter(o,r){var h;await new Promise(f=>requestAnimationFrame(f)),await new Promise(f=>requestAnimationFrame(f)),o.style.visibility="";const{x:i,y:a,sx:l,sy:c,speed:u}=ok(t.target,o),d=Qa(o,[{transform:`translate(${i}px, ${a}px) scale(${l}, ${c})`,opacity:0},{}],{duration:225*u,easing:ire});(h=sk(o))==null||h.forEach(f=>{Qa(f,[{opacity:0},{opacity:0,offset:.33},{}],{duration:225*2*u,easing:ff})}),d.finished.then(()=>r())},onAfterEnter(o){o.style.removeProperty("pointer-events")},onBeforeLeave(o){o.style.pointerEvents="none"},async onLeave(o,r){var h;await new Promise(f=>requestAnimationFrame(f));const{x:i,y:a,sx:l,sy:c,speed:u}=ok(t.target,o);Qa(o,[{},{transform:`translate(${i}px, ${a}px) scale(${l}, ${c})`,opacity:0}],{duration:125*u,easing:are}).finished.then(()=>r()),(h=sk(o))==null||h.forEach(f=>{Qa(f,[{},{opacity:0,offset:.2},{opacity:0}],{duration:125*2*u,easing:ff})})},onAfterLeave(o){o.style.removeProperty("pointer-events")}};return()=>t.target?I(Cr,Ue({name:"dialog-transition"},s,{css:!1}),n):I(Cr,{name:"dialog-transition"},n)}});function sk(t){var n;const e=(n=t.querySelector(":scope > .v-card, :scope > .v-sheet, :scope > .v-list"))==null?void 0:n.children;return e&&[...e]}function ok(t,e){const n=t.getBoundingClientRect(),s=f0(e),[o,r]=getComputedStyle(e).transformOrigin.split(" ").map(v=>parseFloat(v)),[i,a]=getComputedStyle(e).getPropertyValue("--v-overlay-anchor-origin").split(" ");let l=n.left+n.width/2;i==="left"||a==="left"?l-=n.width/2:(i==="right"||a==="right")&&(l+=n.width/2);let c=n.top+n.height/2;i==="top"||a==="top"?c-=n.height/2:(i==="bottom"||a==="bottom")&&(c+=n.height/2);const u=n.width/s.width,d=n.height/s.height,h=Math.max(1,u,d),f=u/h||0,p=d/h||0,m=s.width*s.height/(window.innerWidth*window.innerHeight),g=m>.12?Math.min(1.5,(m-.12)*10+1):1;return{x:l-(o+s.left),y:c-(r+s.top),sx:f,sy:p,speed:g}}Ms("fab-transition","center center","out-in");Ms("dialog-bottom-transition");Ms("dialog-top-transition");Ms("fade-transition");const WA=Ms("scale-transition");Ms("scroll-x-transition");Ms("scroll-x-reverse-transition");Ms("scroll-y-transition");Ms("scroll-y-reverse-transition");Ms("slide-x-transition");Ms("slide-x-reverse-transition");const N0=Ms("slide-y-transition");Ms("slide-y-reverse-transition");const UA=VA("expand-transition",zA()),GA=VA("expand-x-transition",zA("",!0));function HA(t){const{t:e}=x0();function n(s){var l;let{name:o}=s;const r={prepend:"prependAction",prependInner:"prependAction",append:"appendAction",appendInner:"appendAction",clear:"clear"}[o],i=t[`onClick:${o}`],a=i&&r?e(`$vuetify.input.${r}`,(l=t.label)!=null?l:""):void 0;return I(on,{icon:t[`${o}Icon`],"aria-label":a,onClick:i},null)}return{InputIcon:n}}const die=ye({active:Boolean,color:String,messages:{type:[Array,String],default:()=>[]},...st(),...Dd({transition:{component:N0,leaveAbsolute:!0,group:!0}})},"VMessages"),hie=Re()({name:"VMessages",props:die(),setup(t,e){let{slots:n}=e;const s=M(()=>ri(t.messages)),{textColorClasses:o,textColorStyles:r}=rr(M(()=>t.color));return Ge(()=>I(Qr,{transition:t.transition,tag:"div",class:["v-messages",o.value,t.class],style:[r.value,t.style],role:"alert","aria-live":"polite"},{default:()=>[t.active&&s.value.map((i,a)=>I("div",{class:"v-messages__message",key:`${a}-${s.value}`},[n.message?n.message({message:i}):i]))]})),{}}}),E0=ye({focused:Boolean,"onUpdate:focused":Jo()},"focus");function Ld(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr();const n=Mt(t,"focused"),s=M(()=>({[`${e}--focused`]:n.value}));function o(){n.value=!0}function r(){n.value=!1}return{focusClasses:s,isFocused:n,focus:o,blur:r}}const fie=Symbol.for("vuetify:form");function jA(){return vt(fie,null)}const pie=ye({disabled:{type:Boolean,default:null},error:Boolean,errorMessages:{type:[Array,String],default:()=>[]},maxErrors:{type:[Number,String],default:1},name:String,label:String,readonly:{type:Boolean,default:null},rules:{type:Array,default:()=>[]},modelValue:null,validateOn:String,validationValue:null,...E0()},"validation");function mie(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pr(),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ps();const s=Mt(t,"modelValue"),o=M(()=>t.validationValue===void 0?s.value:t.validationValue),r=jA(),i=_e([]),a=He(!0),l=M(()=>!!(ri(s.value===""?null:s.value).length||ri(o.value===""?null:o.value).length)),c=M(()=>{var x;return!!((x=t.disabled)!=null?x:r==null?void 0:r.isDisabled.value)}),u=M(()=>{var x;return!!((x=t.readonly)!=null?x:r==null?void 0:r.isReadonly.value)}),d=M(()=>{var x;return(x=t.errorMessages)!=null&&x.length?ri(t.errorMessages).slice(0,Math.max(0,+t.maxErrors)):i.value}),h=M(()=>{var k,S;let x=((k=t.validateOn)!=null?k:r==null?void 0:r.validateOn.value)||"input";x==="lazy"&&(x="input lazy");const w=new Set((S=x==null?void 0:x.split(" "))!=null?S:[]);return{blur:w.has("blur")||w.has("input"),input:w.has("input"),submit:w.has("submit"),lazy:w.has("lazy")}}),f=M(()=>{var x;return t.error||((x=t.errorMessages)==null?void 0:x.length)?!1:t.rules.length?a.value?i.value.length||h.value.lazy?null:!0:!i.value.length:!0}),p=He(!1),m=M(()=>({[`${e}--error`]:f.value===!1,[`${e}--dirty`]:l.value,[`${e}--disabled`]:c.value,[`${e}--readonly`]:u.value})),g=M(()=>{var x;return(x=t.name)!=null?x:hs(n)});fb(()=>{r==null||r.register({id:g.value,validate:y,reset:v,resetValidation:b})}),oo(()=>{r==null||r.unregister(g.value)}),ir(async()=>{h.value.lazy||await y(!0),r==null||r.update(g.value,f.value,d.value)}),fi(()=>h.value.input,()=>{ze(o,()=>{if(o.value!=null)y();else if(t.focused){const x=ze(()=>t.focused,w=>{w||y(),x()})}})}),fi(()=>h.value.blur,()=>{ze(()=>t.focused,x=>{x||y()})}),ze(f,()=>{r==null||r.update(g.value,f.value,d.value)});function v(){s.value=null,gn(b)}function b(){a.value=!0,h.value.lazy?i.value=[]:y(!0)}async function y(){var k;let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const w=[];p.value=!0;for(const S of t.rules){if(w.length>=+((k=t.maxErrors)!=null?k:1))break;const $=await(typeof S=="function"?S:()=>S)(o.value);if($!==!0){if($!==!1&&typeof $!="string"){console.warn(`${$} is not a valid value. Rule functions must return boolean true or a string.`);continue}w.push($||"")}}return i.value=w,p.value=!1,a.value=x,i.value}return{errorMessages:d,isDirty:l,isDisabled:c,isReadonly:u,isPristine:a,isValid:f,isValidating:p,reset:v,resetValidation:b,validate:y,validationClasses:m}}const Bd=ye({id:String,appendIcon:$t,centerAffix:{type:Boolean,default:!0},prependIcon:$t,hideDetails:[Boolean,String],hint:String,persistentHint:Boolean,messages:{type:[Array,String],default:()=>[]},direction:{type:String,default:"horizontal",validator:t=>["horizontal","vertical"].includes(t)},"onClick:prepend":Jo(),"onClick:append":Jo(),...st(),...ur(),...pie()},"VInput"),pi=Re()({name:"VInput",props:{...Bd()},emits:{"update:modelValue":t=>!0},setup(t,e){let{attrs:n,slots:s,emit:o}=e;const{densityClasses:r}=Mr(t),{rtlClasses:i}=Ro(),{InputIcon:a}=HA(t),l=Ps(),c=M(()=>t.id||`input-${l}`),u=M(()=>`${c.value}-messages`),{errorMessages:d,isDirty:h,isDisabled:f,isReadonly:p,isPristine:m,isValid:g,isValidating:v,reset:b,resetValidation:y,validate:x,validationClasses:w}=mie(t,"v-input",c),k=M(()=>({id:c,messagesId:u,isDirty:h,isDisabled:f,isReadonly:p,isPristine:m,isValid:g,isValidating:v,reset:b,resetValidation:y,validate:x})),S=M(()=>{var C;return((C=t.errorMessages)==null?void 0:C.length)||!m.value&&d.value.length?d.value:t.hint&&(t.persistentHint||t.focused)?t.hint:t.messages});return Ge(()=>{var _,A,O,B;const C=!!(s.prepend||t.prependIcon),$=!!(s.append||t.appendIcon),T=S.value.length>0,E=!t.hideDetails||t.hideDetails==="auto"&&(T||!!s.details);return I("div",{class:["v-input",`v-input--${t.direction}`,{"v-input--center-affix":t.centerAffix},r.value,i.value,w.value,t.class],style:t.style},[C&&I("div",{key:"prepend",class:"v-input__prepend"},[(_=s.prepend)==null?void 0:_.call(s,k.value),t.prependIcon&&I(a,{key:"prepend-icon",name:"prepend"},null)]),s.default&&I("div",{class:"v-input__control"},[(A=s.default)==null?void 0:A.call(s,k.value)]),$&&I("div",{key:"append",class:"v-input__append"},[t.appendIcon&&I(a,{key:"append-icon",name:"append"},null),(O=s.append)==null?void 0:O.call(s,k.value)]),E&&I("div",{class:"v-input__details"},[I(hie,{id:u.value,active:T,messages:S.value},{message:s.message}),(B=s.details)==null?void 0:B.call(s,k.value)])])}),{reset:b,resetValidation:y,validate:x}}});function km(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"content";const n=_e(),s=_e();if(zt){const o=new ResizeObserver(r=>{t==null||t(r,o),r.length&&(e==="content"?s.value=r[0].contentRect:s.value=r[0].target.getBoundingClientRect())});oo(()=>{o.disconnect()}),ze(n,(r,i)=>{i&&(o.unobserve(Sv(i)),s.value=void 0),r&&o.observe(Sv(r))},{flush:"post"})}return{resizeRef:n,contentRect:cu(s)}}const gie=ye({bgColor:String,color:String,indeterminate:[Boolean,String],modelValue:{type:[Number,String],default:0},rotate:{type:[Number,String],default:0},width:{type:[Number,String],default:4},...st(),...Ad(),...yn({tag:"div"}),..._n()},"VProgressCircular"),Sm=Re()({name:"VProgressCircular",props:gie(),setup(t,e){let{slots:n}=e;const s=20,o=2*Math.PI*s,r=_e(),{themeClasses:i}=jn(t),{sizeClasses:a,sizeStyles:l}=Rd(t),{textColorClasses:c,textColorStyles:u}=rr(Pe(t,"color")),{textColorClasses:d,textColorStyles:h}=rr(Pe(t,"bgColor")),{intersectionRef:f,isIntersecting:p}=pA(),{resizeRef:m,contentRect:g}=km(),v=M(()=>Math.max(0,Math.min(100,parseFloat(t.modelValue)))),b=M(()=>Number(t.width)),y=M(()=>l.value?Number(t.size):g.value?g.value.width:Math.max(b.value,32)),x=M(()=>s/(1-b.value/y.value)*2),w=M(()=>b.value/y.value*x.value),k=M(()=>Fe((100-v.value)/100*o));return To(()=>{f.value=r.value,m.value=r.value}),Ge(()=>I(t.tag,{ref:r,class:["v-progress-circular",{"v-progress-circular--indeterminate":!!t.indeterminate,"v-progress-circular--visible":p.value,"v-progress-circular--disable-shrink":t.indeterminate==="disable-shrink"},i.value,a.value,c.value,t.class],style:[l.value,u.value,t.style],role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":t.indeterminate?void 0:v.value},{default:()=>[I("svg",{style:{transform:`rotate(calc(-90deg + ${Number(t.rotate)}deg))`},xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${x.value} ${x.value}`},[I("circle",{class:["v-progress-circular__underlay",d.value],style:h.value,fill:"transparent",cx:"50%",cy:"50%",r:s,"stroke-width":w.value,"stroke-dasharray":o,"stroke-dashoffset":0},null),I("circle",{class:"v-progress-circular__overlay",fill:"transparent",cx:"50%",cy:"50%",r:s,"stroke-width":w.value,"stroke-dasharray":o,"stroke-dashoffset":k.value},null)]),n.default&&I("div",{class:"v-progress-circular__content"},[n.default({value:v.value})])]})),{}}});const vie=ye({text:String,clickable:Boolean,...st(),..._n()},"VLabel"),_0=Re()({name:"VLabel",props:vie(),setup(t,e){let{slots:n}=e;return Ge(()=>{var s;return I("label",{class:["v-label",{"v-label--clickable":t.clickable},t.class],style:t.style},[t.text,(s=n.default)==null?void 0:s.call(n)])}),{}}});const KA=Symbol.for("vuetify:selection-control-group"),qA=ye({color:String,disabled:{type:Boolean,default:null},defaultsTarget:String,error:Boolean,id:String,inline:Boolean,falseIcon:$t,trueIcon:$t,ripple:{type:Boolean,default:!0},multiple:{type:Boolean,default:null},name:String,readonly:Boolean,modelValue:null,type:String,valueComparator:{type:Function,default:Ed},...st(),...ur(),..._n()},"SelectionControlGroup"),bie=ye({...qA({defaultsTarget:"VSelectionControl"})},"VSelectionControlGroup");Re()({name:"VSelectionControlGroup",props:bie(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const s=Mt(t,"modelValue"),o=Ps(),r=M(()=>t.id||`v-selection-control-group-${o}`),i=M(()=>t.name||r.value),a=new Set;return vn(KA,{modelValue:s,forceUpdate:()=>{a.forEach(l=>l())},onForceUpdate:l=>{a.add(l),ms(()=>{a.delete(l)})}}),Ra({[t.defaultsTarget]:{color:Pe(t,"color"),disabled:Pe(t,"disabled"),density:Pe(t,"density"),error:Pe(t,"error"),inline:Pe(t,"inline"),modelValue:s,multiple:M(()=>!!t.multiple||t.multiple==null&&Array.isArray(s.value)),name:i,falseIcon:Pe(t,"falseIcon"),trueIcon:Pe(t,"trueIcon"),readonly:Pe(t,"readonly"),ripple:Pe(t,"ripple"),type:Pe(t,"type"),valueComparator:Pe(t,"valueComparator")}}),Ge(()=>{var l;return I("div",{class:["v-selection-control-group",{"v-selection-control-group--inline":t.inline},t.class],style:t.style,role:t.type==="radio"?"radiogroup":void 0},[(l=n.default)==null?void 0:l.call(n)])}),{}}});const A0=ye({label:String,trueValue:null,falseValue:null,value:null,...st(),...qA()},"VSelectionControl");function yie(t){const e=vt(KA,void 0),{densityClasses:n}=Mr(t),s=Mt(t,"modelValue"),o=M(()=>t.trueValue!==void 0?t.trueValue:t.value!==void 0?t.value:!0),r=M(()=>t.falseValue!==void 0?t.falseValue:!1),i=M(()=>!!t.multiple||t.multiple==null&&Array.isArray(s.value)),a=M({get(){const f=e?e.modelValue.value:s.value;return i.value?f.some(p=>t.valueComparator(p,o.value)):t.valueComparator(f,o.value)},set(f){if(t.readonly)return;const p=f?o.value:r.value;let m=p;i.value&&(m=f?[...ri(s.value),p]:ri(s.value).filter(g=>!t.valueComparator(g,o.value))),e?e.modelValue.value=m:s.value=m}}),{textColorClasses:l,textColorStyles:c}=rr(M(()=>a.value&&!t.error&&!t.disabled?t.color:void 0)),{backgroundColorClasses:u,backgroundColorStyles:d}=Nr(M(()=>a.value&&!t.error&&!t.disabled?t.color:void 0)),h=M(()=>a.value?t.trueIcon:t.falseIcon);return{group:e,densityClasses:n,trueValue:o,falseValue:r,model:a,textColorClasses:l,textColorStyles:c,backgroundColorClasses:u,backgroundColorStyles:d,icon:h}}const bf=Re()({name:"VSelectionControl",directives:{Ripple:Jl},inheritAttrs:!1,props:A0(),emits:{"update:modelValue":t=>!0},setup(t,e){let{attrs:n,slots:s}=e;const{group:o,densityClasses:r,icon:i,model:a,textColorClasses:l,textColorStyles:c,backgroundColorClasses:u,backgroundColorStyles:d,trueValue:h}=yie(t),f=Ps(),p=M(()=>t.id||`input-${f}`),m=He(!1),g=He(!1),v=_e();o==null||o.onForceUpdate(()=>{v.value&&(v.value.checked=a.value)});function b(w){m.value=!0,df(w.target,":focus-visible")!==!1&&(g.value=!0)}function y(){m.value=!1,g.value=!1}function x(w){t.readonly&&o&&gn(()=>o.forceUpdate()),a.value=w.target.checked}return Ge(()=>{var $,T,E;const w=s.label?s.label({label:t.label,props:{for:p.value}}):t.label,[k,S]=vm(n),C=I("input",Ue({ref:v,checked:a.value,disabled:!!(t.readonly||t.disabled),id:p.value,onBlur:y,onFocus:b,onInput:x,"aria-disabled":!!(t.readonly||t.disabled),type:t.type,value:h.value,name:t.name,"aria-checked":t.type==="checkbox"?a.value:void 0},S),null);return I("div",Ue({class:["v-selection-control",{"v-selection-control--dirty":a.value,"v-selection-control--disabled":t.disabled,"v-selection-control--error":t.error,"v-selection-control--focused":m.value,"v-selection-control--focus-visible":g.value,"v-selection-control--inline":t.inline},r.value,t.class]},k,{style:t.style}),[I("div",{class:["v-selection-control__wrapper",l.value],style:c.value},[($=s.default)==null?void 0:$.call(s,{backgroundColorClasses:u,backgroundColorStyles:d}),$n(I("div",{class:["v-selection-control__input"]},[(E=(T=s.input)==null?void 0:T.call(s,{model:a,textColorClasses:l,textColorStyles:c,backgroundColorClasses:u,backgroundColorStyles:d,inputNode:C,icon:i.value,props:{onFocus:b,onBlur:y,id:p.value}}))!=null?E:I(ot,null,[i.value&&I(on,{key:"icon",icon:i.value},null),C])]),[[ar("ripple"),t.ripple&&[!t.disabled&&!t.readonly,null,["center","circle"]]]])]),w&&I(_0,{for:p.value,clickable:!0,onClick:_=>_.stopPropagation()},{default:()=>[w]})])}),{isFocused:m,input:v}}}),xie=ye({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...Bd(),...A0()},"VSwitch"),_v=Re()({name:"VSwitch",inheritAttrs:!1,props:xie(),emits:{"update:focused":t=>!0,"update:modelValue":()=>!0,"update:indeterminate":t=>!0},setup(t,e){let{attrs:n,slots:s}=e;const o=Mt(t,"indeterminate"),r=Mt(t,"modelValue"),{loaderClasses:i}=ym(t),{isFocused:a,focus:l,blur:c}=Ld(t),u=_e(),d=M(()=>typeof t.loading=="string"&&t.loading!==""?t.loading:t.color),h=Ps(),f=M(()=>t.id||`switch-${h}`);function p(){o.value&&(o.value=!1)}function m(g){var v,b;g.stopPropagation(),g.preventDefault(),(b=(v=u.value)==null?void 0:v.input)==null||b.click()}return Ge(()=>{const[g,v]=vm(n),[b,y]=pi.filterProps(t),[x,w]=bf.filterProps(t);return I(pi,Ue({class:["v-switch",{"v-switch--inset":t.inset},{"v-switch--indeterminate":o.value},i.value,t.class],style:t.style},g,b,{id:f.value,focused:a.value}),{...s,default:k=>{let{id:S,messagesId:C,isDisabled:$,isReadonly:T,isValid:E}=k;return I(bf,Ue({ref:u},x,{modelValue:r.value,"onUpdate:modelValue":[_=>r.value=_,p],id:S.value,"aria-describedby":C.value,type:"checkbox","aria-checked":o.value?"mixed":void 0,disabled:$.value,readonly:T.value,onFocus:l,onBlur:c},v),{...s,default:_=>{let{backgroundColorClasses:A,backgroundColorStyles:O}=_;return I("div",{class:["v-switch__track",...A.value],style:O.value,onClick:m},null)},input:_=>{let{inputNode:A,icon:O,backgroundColorClasses:B,backgroundColorStyles:F}=_;return I(ot,null,[A,I("div",{class:["v-switch__thumb",{"v-switch__thumb--filled":O||t.loading},t.inset?void 0:B.value],style:t.inset?void 0:F.value},[I(WA,null,{default:()=>[t.loading?I(S0,{name:"v-switch",active:!0,color:E.value===!1?void 0:d.value},{default:V=>s.loader?s.loader(V):I(Sm,{active:V.isActive,color:V.color,indeterminate:!0,size:"16",width:"2"},null)}):O&&I(on,{key:O,icon:O,size:"x-small"},null)]})])])}})}})}),{}}});function lg(t,e){return{x:t.x+e.x,y:t.y+e.y}}function wie(t,e){return{x:t.x-e.x,y:t.y-e.y}}function rk(t,e){if(t.side==="top"||t.side==="bottom"){const{side:n,align:s}=t,o=s==="left"?0:s==="center"?e.width/2:s==="right"?e.width:s,r=n==="top"?0:n==="bottom"?e.height:n;return lg({x:o,y:r},e)}else if(t.side==="left"||t.side==="right"){const{side:n,align:s}=t,o=n==="left"?0:n==="right"?e.width:n,r=s==="top"?0:s==="center"?e.height/2:s==="bottom"?e.height:s;return lg({x:o,y:r},e)}return lg({x:e.width/2,y:e.height/2},e)}const XA={static:Sie,connected:$ie},Cie=ye({locationStrategy:{type:[String,Function],default:"static",validator:t=>typeof t=="function"||t in XA},location:{type:String,default:"bottom"},origin:{type:String,default:"auto"},offset:[Number,String,Array]},"VOverlay-location-strategies");function kie(t,e){const n=_e({}),s=_e();zt&&(fi(()=>!!(e.isActive.value&&t.locationStrategy),r=>{var i,a;ze(()=>t.locationStrategy,r),ms(()=>{s.value=void 0}),typeof t.locationStrategy=="function"?s.value=(i=t.locationStrategy(e,t,n))==null?void 0:i.updateLocation:s.value=(a=XA[t.locationStrategy](e,t,n))==null?void 0:a.updateLocation}),window.addEventListener("resize",o,{passive:!0}),ms(()=>{window.removeEventListener("resize",o),s.value=void 0}));function o(r){var i;(i=s.value)==null||i.call(s,r)}return{contentStyles:n,updateLocation:s}}function Sie(){}function Iie(t,e){e?t.style.removeProperty("left"):t.style.removeProperty("right");const n=f0(t);return e?n.x+=parseFloat(t.style.right||0):n.x-=parseFloat(t.style.left||0),n.y-=parseFloat(t.style.top||0),n}function $ie(t,e,n){ure(t.activatorEl.value)&&Object.assign(n.value,{position:"fixed",top:0,[t.isRtl.value?"right":"left"]:0});const{preferredAnchor:o,preferredOrigin:r}=h0(()=>{const p=Iv(e.location,t.isRtl.value),m=e.origin==="overlap"?p:e.origin==="auto"?og(p):Iv(e.origin,t.isRtl.value);return p.side===m.side&&p.align===rg(m).align?{preferredAnchor:EC(p),preferredOrigin:EC(m)}:{preferredAnchor:p,preferredOrigin:m}}),[i,a,l,c]=["minWidth","minHeight","maxWidth","maxHeight"].map(p=>M(()=>{const m=parseFloat(e[p]);return isNaN(m)?1/0:m})),u=M(()=>{if(Array.isArray(e.offset))return e.offset;if(typeof e.offset=="string"){const p=e.offset.split(" ").map(parseFloat);return p.length<2&&p.push(0),p}return typeof e.offset=="number"?[e.offset,0]:[0,0]});let d=!1;const h=new ResizeObserver(()=>{d&&f()});ze([t.activatorEl,t.contentEl],(p,m)=>{let[g,v]=p,[b,y]=m;b&&h.unobserve(b),g&&h.observe(g),y&&h.unobserve(y),v&&h.observe(v)},{immediate:!0}),ms(()=>{h.disconnect()});function f(){if(d=!1,requestAnimationFrame(()=>{requestAnimationFrame(()=>d=!0)}),!t.activatorEl.value||!t.contentEl.value)return;const p=t.activatorEl.value.getBoundingClientRect(),m=Iie(t.contentEl.value,t.isRtl.value),g=pf(t.contentEl.value),v=12;g.length||(g.push(document.documentElement),t.contentEl.value.style.top&&t.contentEl.value.style.left||(m.x-=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-x")||0),m.y-=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-y")||0)));const b=g.reduce((E,_)=>{const A=_.getBoundingClientRect(),O=new cl({x:_===document.documentElement?0:A.x,y:_===document.documentElement?0:A.y,width:_.clientWidth,height:_.clientHeight});return E?new cl({x:Math.max(E.left,O.left),y:Math.max(E.top,O.top),width:Math.min(E.right,O.right)-Math.max(E.left,O.left),height:Math.min(E.bottom,O.bottom)-Math.max(E.top,O.top)}):O},void 0);b.x+=v,b.y+=v,b.width-=v*2,b.height-=v*2;let y={anchor:o.value,origin:r.value};function x(E){const _=new cl(m),A=rk(E.anchor,p),O=rk(E.origin,_);let{x:B,y:F}=wie(A,O);switch(E.anchor.side){case"top":F-=u.value[0];break;case"bottom":F+=u.value[0];break;case"left":B-=u.value[0];break;case"right":B+=u.value[0];break}switch(E.anchor.align){case"top":F-=u.value[1];break;case"bottom":F+=u.value[1];break;case"left":B-=u.value[1];break;case"right":B+=u.value[1];break}return _.x+=B,_.y+=F,_.width=Math.min(_.width,l.value),_.height=Math.min(_.height,c.value),{overflows:AC(_,b),x:B,y:F}}let w=0,k=0;const S={x:0,y:0},C={x:!1,y:!1};let $=-1;for(;!($++>10);){const{x:E,y:_,overflows:A}=x(y);w+=E,k+=_,m.x+=E,m.y+=_;{const O=_C(y.anchor),B=A.x.before||A.x.after,F=A.y.before||A.y.after;let V=!1;if(["x","y"].forEach(D=>{if(D==="x"&&B&&!C.x||D==="y"&&F&&!C.y){const U={anchor:{...y.anchor},origin:{...y.origin}},J=D==="x"?O==="y"?rg:og:O==="y"?og:rg;U.anchor=J(U.anchor),U.origin=J(U.origin);const{overflows:X}=x(U);(X[D].before<=A[D].before&&X[D].after<=A[D].after||X[D].before+X[D].after<(A[D].before+A[D].after)/2)&&(y=U,V=C[D]=!0)}}),V)continue}A.x.before&&(w+=A.x.before,m.x+=A.x.before),A.x.after&&(w-=A.x.after,m.x-=A.x.after),A.y.before&&(k+=A.y.before,m.y+=A.y.before),A.y.after&&(k-=A.y.after,m.y-=A.y.after);{const O=AC(m,b);S.x=b.width-O.x.before-O.x.after,S.y=b.height-O.y.before-O.y.after,w+=O.x.before,m.x+=O.x.before,k+=O.y.before,m.y+=O.y.before}break}const T=_C(y.anchor);return Object.assign(n.value,{"--v-overlay-anchor-origin":`${y.anchor.side} ${y.anchor.align}`,transformOrigin:`${y.origin.side} ${y.origin.align}`,top:Fe(cg(k)),left:t.isRtl.value?void 0:Fe(cg(w)),right:t.isRtl.value?Fe(cg(-w)):void 0,minWidth:Fe(T==="y"?Math.min(i.value,p.width):i.value),maxWidth:Fe(ik(Tr(S.x,i.value===1/0?0:i.value,l.value))),maxHeight:Fe(ik(Tr(S.y,a.value===1/0?0:a.value,c.value)))}),{available:S,contentBox:m}}return ze(()=>[o.value,r.value,e.offset,e.minWidth,e.minHeight,e.maxWidth,e.maxHeight],()=>f()),gn(()=>{const p=f();if(!p)return;const{available:m,contentBox:g}=p;g.height>m.y&&requestAnimationFrame(()=>{f(),requestAnimationFrame(()=>{f()})})}),{updateLocation:f}}function cg(t){return Math.round(t*devicePixelRatio)/devicePixelRatio}function ik(t){return Math.ceil(t*devicePixelRatio)/devicePixelRatio}let Av=!0;const yf=[];function Tie(t){!Av||yf.length?(yf.push(t),Rv()):(Av=!1,t(),Rv())}let ak=-1;function Rv(){cancelAnimationFrame(ak),ak=requestAnimationFrame(()=>{const t=yf.shift();t&&t(),yf.length?Rv():Av=!0})}const Ch={none:null,close:_ie,block:Aie,reposition:Rie},Nie=ye({scrollStrategy:{type:[String,Function],default:"block",validator:t=>typeof t=="function"||t in Ch}},"VOverlay-scroll-strategies");function Eie(t,e){if(!zt)return;let n;To(async()=>{n==null||n.stop(),e.isActive.value&&t.scrollStrategy&&(n=Jv(),await gn(),n.active&&n.run(()=>{var s;typeof t.scrollStrategy=="function"?t.scrollStrategy(e,t,n):(s=Ch[t.scrollStrategy])==null||s.call(Ch,e,t,n)}))}),ms(()=>{n==null||n.stop()})}function _ie(t){var n;function e(s){t.isActive.value=!1}YA((n=t.activatorEl.value)!=null?n:t.contentEl.value,e)}function Aie(t,e){var i;const n=(i=t.root.value)==null?void 0:i.offsetParent,s=[...new Set([...pf(t.activatorEl.value,e.contained?n:void 0),...pf(t.contentEl.value,e.contained?n:void 0)])].filter(a=>!a.classList.contains("v-overlay-scroll-blocked")),o=window.innerWidth-document.documentElement.offsetWidth,r=(a=>m0(a)&&a)(n||document.documentElement);r&&t.root.value.classList.add("v-overlay--scroll-blocked"),s.forEach((a,l)=>{a.style.setProperty("--v-body-scroll-x",Fe(-a.scrollLeft)),a.style.setProperty("--v-body-scroll-y",Fe(-a.scrollTop)),a!==document.documentElement&&a.style.setProperty("--v-scrollbar-offset",Fe(o)),a.classList.add("v-overlay-scroll-blocked")}),ms(()=>{s.forEach((a,l)=>{const c=parseFloat(a.style.getPropertyValue("--v-body-scroll-x")),u=parseFloat(a.style.getPropertyValue("--v-body-scroll-y"));a.style.removeProperty("--v-body-scroll-x"),a.style.removeProperty("--v-body-scroll-y"),a.style.removeProperty("--v-scrollbar-offset"),a.classList.remove("v-overlay-scroll-blocked"),a.scrollLeft=-c,a.scrollTop=-u}),r&&t.root.value.classList.remove("v-overlay--scroll-blocked")})}function Rie(t,e,n){let s=!1,o=-1,r=-1;function i(a){Tie(()=>{var u,d;const l=performance.now();(d=(u=t.updateLocation).value)==null||d.call(u,a),s=(performance.now()-l)/(1e3/60)>2})}r=(typeof requestIdleCallback>"u"?a=>a():requestIdleCallback)(()=>{n.run(()=>{var a;YA((a=t.activatorEl.value)!=null?a:t.contentEl.value,l=>{s?(cancelAnimationFrame(o),o=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{i(l)})})):i(l)})})}),ms(()=>{typeof cancelIdleCallback<"u"&&cancelIdleCallback(r),cancelAnimationFrame(o)})}function YA(t,e){const n=[document,...pf(t)];n.forEach(s=>{s.addEventListener("scroll",e,{passive:!0})}),ms(()=>{n.forEach(s=>{s.removeEventListener("scroll",e)})})}const Dv=Symbol.for("vuetify:v-menu"),Die=ye({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function Fie(t,e){const n={},s=o=>()=>{if(!zt)return Promise.resolve(!0);const r=o==="openDelay";return n.closeDelay&&window.clearTimeout(n.closeDelay),delete n.closeDelay,n.openDelay&&window.clearTimeout(n.openDelay),delete n.openDelay,new Promise(i=>{var l;const a=parseInt((l=t[o])!=null?l:0,10);n[o]=window.setTimeout(()=>{e==null||e(r),i(r)},a)})};return{runCloseDelay:s("closeDelay"),runOpenDelay:s("openDelay")}}const Oie=ye({activator:[String,Object],activatorProps:{type:Object,default:()=>({})},openOnClick:{type:Boolean,default:void 0},openOnHover:Boolean,openOnFocus:{type:Boolean,default:void 0},closeOnContentClick:Boolean,...Die()},"VOverlay-activator");function Pie(t,e){let{isActive:n,isTop:s}=e;const o=_e();let r=!1,i=!1,a=!0;const l=M(()=>t.openOnFocus||t.openOnFocus==null&&t.openOnHover),c=M(()=>t.openOnClick||t.openOnClick==null&&!t.openOnHover&&!l.value),{runOpenDelay:u,runCloseDelay:d}=Fie(t,y=>{y===(t.openOnHover&&r||l.value&&i)&&!(t.openOnHover&&n.value&&!s.value)&&(n.value!==y&&(a=!0),n.value=y)}),h={onClick:y=>{y.stopPropagation(),o.value=y.currentTarget||y.target,n.value=!n.value},onMouseenter:y=>{var x;(x=y.sourceCapabilities)!=null&&x.firesTouchEvents||(r=!0,o.value=y.currentTarget||y.target,u())},onMouseleave:y=>{r=!1,d()},onFocus:y=>{df(y.target,":focus-visible")!==!1&&(i=!0,y.stopPropagation(),o.value=y.currentTarget||y.target,u())},onBlur:y=>{i=!1,y.stopPropagation(),d()}},f=M(()=>{const y={};return c.value&&(y.onClick=h.onClick),t.openOnHover&&(y.onMouseenter=h.onMouseenter,y.onMouseleave=h.onMouseleave),l.value&&(y.onFocus=h.onFocus,y.onBlur=h.onBlur),y}),p=M(()=>{const y={};if(t.openOnHover&&(y.onMouseenter=()=>{r=!0,u()},y.onMouseleave=()=>{r=!1,d()}),l.value&&(y.onFocusin=()=>{i=!0,u()},y.onFocusout=()=>{i=!1,d()}),t.closeOnContentClick){const x=vt(Dv,null);y.onClick=()=>{n.value=!1,x==null||x.closeParents()}}return y}),m=M(()=>{const y={};return t.openOnHover&&(y.onMouseenter=()=>{a&&(r=!0,a=!1,u())},y.onMouseleave=()=>{r=!1,d()}),y});ze(s,y=>{y&&(t.openOnHover&&!r&&(!l.value||!i)||l.value&&!i&&(!t.openOnHover||!r))&&(n.value=!1)});const g=_e();To(()=>{!g.value||gn(()=>{o.value=Sv(g.value)})});const v=On("useActivator");let b;return ze(()=>!!t.activator,y=>{y&&zt?(b=Jv(),b.run(()=>{Mie(t,v,{activatorEl:o,activatorEvents:f})})):b&&b.stop()},{flush:"post",immediate:!0}),ms(()=>{b==null||b.stop()}),{activatorEl:o,activatorRef:g,activatorEvents:f,contentEvents:p,scrimEvents:m}}function Mie(t,e,n){let{activatorEl:s,activatorEvents:o}=n;ze(()=>t.activator,(l,c)=>{if(c&&l!==c){const u=a(c);u&&i(u)}l&&gn(()=>r())},{immediate:!0}),ze(()=>t.activatorProps,()=>{r()}),ms(()=>{i()});function r(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a(),c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.activatorProps;!l||Moe(l,Ue(o.value,c))}function i(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a(),c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t.activatorProps;!l||Loe(l,Ue(o.value,c))}function a(){var u,d;let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.activator,c;if(l)if(l==="parent"){let h=(d=(u=e==null?void 0:e.proxy)==null?void 0:u.$el)==null?void 0:d.parentNode;for(;h!=null&&h.hasAttribute("data-no-activator");)h=h.parentNode;c=h}else typeof l=="string"?c=document.querySelector(l):"$el"in l?c=l.$el:c=l;return s.value=(c==null?void 0:c.nodeType)===Node.ELEMENT_NODE?c:null,s.value}}function Lie(){if(!zt)return He(!1);const{ssr:t}=EA();if(t){const e=He(!1);return ir(()=>{e.value=!0}),e}else return He(!0)}const Bie=ye({eager:Boolean},"lazy");function Vie(t,e){const n=He(!1),s=M(()=>n.value||t.eager||e.value);ze(e,()=>n.value=!0);function o(){t.eager||(n.value=!1)}return{isBooted:n,hasContent:s,onAfterLeave:o}}function Im(){const e=On("useScopeId").vnode.scopeId;return{scopeId:e?{[e]:""}:void 0}}const lk=Symbol.for("vuetify:stack"),cc=Jn([]);function zie(t,e,n){const s=On("useStack"),o=!n,r=vt(lk,void 0),i=Jn({activeChildren:new Set});vn(lk,i);const a=He(+e.value);fi(t,()=>{var d;const u=(d=cc.at(-1))==null?void 0:d[1];a.value=u?u+10:+e.value,o&&cc.push([s.uid,a.value]),r==null||r.activeChildren.add(s.uid),ms(()=>{if(o){const h=Qe(cc).findIndex(f=>f[0]===s.uid);cc.splice(h,1)}r==null||r.activeChildren.delete(s.uid)})});const l=He(!0);o&&To(()=>{var d;const u=((d=cc.at(-1))==null?void 0:d[0])===s.uid;setTimeout(()=>l.value=u)});const c=M(()=>!i.activeChildren.size);return{globalTop:cu(l),localTop:c,stackStyles:M(()=>({zIndex:a.value}))}}function Wie(t){return{teleportTarget:M(()=>{const n=t.value;if(n===!0||!zt)return;const s=n===!1?document.body:typeof n=="string"?document.querySelector(n):n;if(s==null)return;let o=s.querySelector(":scope > .v-overlay-container");return o||(o=document.createElement("div"),o.className="v-overlay-container",s.appendChild(o)),o})}}function Uie(){return!0}function ZA(t,e,n){if(!t||QA(t,n)===!1)return!1;const s=aA(e);if(typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&s.host===t.target)return!1;const o=(typeof n.value=="object"&&n.value.include||(()=>[]))();return o.push(e),!o.some(r=>r==null?void 0:r.contains(t.target))}function QA(t,e){return(typeof e.value=="object"&&e.value.closeConditional||Uie)(t)}function Gie(t,e,n){const s=typeof n.value=="function"?n.value:n.value.handler;e._clickOutside.lastMousedownWasOutside&&ZA(t,e,n)&&setTimeout(()=>{QA(t,n)&&s&&s(t)},0)}function ck(t,e){const n=aA(t);e(document),typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&e(n)}const Hie={mounted(t,e){const n=o=>Gie(o,t,e),s=o=>{t._clickOutside.lastMousedownWasOutside=ZA(o,t,e)};ck(t,o=>{o.addEventListener("click",n,!0),o.addEventListener("mousedown",s,!0)}),t._clickOutside||(t._clickOutside={lastMousedownWasOutside:!1}),t._clickOutside[e.instance.$.uid]={onClick:n,onMousedown:s}},unmounted(t,e){!t._clickOutside||(ck(t,n=>{var r;if(!n||!((r=t._clickOutside)!=null&&r[e.instance.$.uid]))return;const{onClick:s,onMousedown:o}=t._clickOutside[e.instance.$.uid];n.removeEventListener("click",s,!0),n.removeEventListener("mousedown",o,!0)}),delete t._clickOutside[e.instance.$.uid])}};function jie(t){const{modelValue:e,color:n,...s}=t;return I(Cr,{name:"fade-transition",appear:!0},{default:()=>[t.modelValue&&I("div",Ue({class:["v-overlay__scrim",t.color.backgroundColorClasses.value],style:t.color.backgroundColorStyles.value},s),null)]})}const $m=ye({absolute:Boolean,attach:[Boolean,String,Object],closeOnBack:{type:Boolean,default:!0},contained:Boolean,contentClass:null,contentProps:null,disabled:Boolean,noClickAnimation:Boolean,modelValue:Boolean,persistent:Boolean,scrim:{type:[Boolean,String],default:!0},zIndex:{type:[Number,String],default:2e3},...Oie(),...st(),...Da(),...Bie(),...Cie(),...Nie(),..._n(),...Dd()},"VOverlay"),Tl=Re()({name:"VOverlay",directives:{ClickOutside:Hie},inheritAttrs:!1,props:{_disableGlobalStack:Boolean,...$m()},emits:{"click:outside":t=>!0,"update:modelValue":t=>!0,afterLeave:()=>!0},setup(t,e){let{slots:n,attrs:s,emit:o}=e;const r=Mt(t,"modelValue"),i=M({get:()=>r.value,set:U=>{U&&t.disabled||(r.value=U)}}),{teleportTarget:a}=Wie(M(()=>t.attach||t.contained)),{themeClasses:l}=jn(t),{rtlClasses:c,isRtl:u}=Ro(),{hasContent:d,onAfterLeave:h}=Vie(t,i),f=Nr(M(()=>typeof t.scrim=="string"?t.scrim:null)),{globalTop:p,localTop:m,stackStyles:g}=zie(i,Pe(t,"zIndex"),t._disableGlobalStack),{activatorEl:v,activatorRef:b,activatorEvents:y,contentEvents:x,scrimEvents:w}=Pie(t,{isActive:i,isTop:m}),{dimensionStyles:k}=Fa(t),S=Lie(),{scopeId:C}=Im();ze(()=>t.disabled,U=>{U&&(i.value=!1)});const $=_e(),T=_e(),{contentStyles:E,updateLocation:_}=kie(t,{isRtl:u,contentEl:T,activatorEl:v,isActive:i});Eie(t,{root:$,contentEl:T,activatorEl:v,isActive:i,updateLocation:_});function A(U){o("click:outside",U),t.persistent?D():i.value=!1}function O(){return i.value&&p.value}zt&&ze(i,U=>{U?window.addEventListener("keydown",B):window.removeEventListener("keydown",B)},{immediate:!0});function B(U){var J,X;U.key==="Escape"&&p.value&&(t.persistent?D():(i.value=!1,(J=T.value)!=null&&J.contains(document.activeElement)&&((X=v.value)==null||X.focus())))}const F=Wre();fi(()=>t.closeOnBack,()=>{Ure(F,U=>{p.value&&i.value?(U(!1),t.persistent?D():i.value=!1):U()})});const V=_e();ze(()=>i.value&&(t.absolute||t.contained)&&a.value==null,U=>{if(U){const J=cA($.value);J&&J!==document.scrollingElement&&(V.value=J.scrollTop)}});function D(){t.noClickAnimation||T.value&&Qa(T.value,[{transformOrigin:"center"},{transform:"scale(1.03)"},{transformOrigin:"center"}],{duration:150,easing:ff})}return Ge(()=>{var U;return I(ot,null,[(U=n.activator)==null?void 0:U.call(n,{isActive:i.value,props:Ue({ref:b},y.value,t.activatorProps)}),S.value&&d.value&&I(cO,{disabled:!a.value,to:a.value},{default:()=>[I("div",Ue({class:["v-overlay",{"v-overlay--absolute":t.absolute||t.contained,"v-overlay--active":i.value,"v-overlay--contained":t.contained},l.value,c.value,t.class],style:[g.value,{top:Fe(V.value)},t.style],ref:$},C,s),[I(jie,Ue({color:f,modelValue:i.value&&!!t.scrim},w.value),null),I(Qr,{appear:!0,persisted:!0,transition:t.transition,target:v.value,onAfterLeave:()=>{h(),o("afterLeave")}},{default:()=>{var J;return[$n(I("div",Ue({ref:T,class:["v-overlay__content",t.contentClass],style:[k.value,E.value]},x.value,t.contentProps),[(J=n.default)==null?void 0:J.call(n,{isActive:i})]),[[mi,i.value],[ar("click-outside"),{handler:A,closeConditional:O,include:()=>[v.value]}]])]}})])]})])}),{activatorEl:v,animateClick:D,contentEl:T,globalTop:p,localTop:m,updateLocation:_}}}),ug=Symbol("Forwarded refs");function dg(t,e){let n=t;for(;n;){const s=Reflect.getOwnPropertyDescriptor(n,e);if(s)return s;n=Object.getPrototypeOf(n)}}function ec(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return t[ug]=n,new Proxy(t,{get(o,r){if(Reflect.has(o,r))return Reflect.get(o,r);if(!(typeof r=="symbol"||r.startsWith("$")||r.startsWith("__"))){for(const i of n)if(i.value&&Reflect.has(i.value,r)){const a=Reflect.get(i.value,r);return typeof a=="function"?a.bind(i.value):a}}},has(o,r){if(Reflect.has(o,r))return!0;if(typeof r=="symbol"||r.startsWith("$")||r.startsWith("__"))return!1;for(const i of n)if(i.value&&Reflect.has(i.value,r))return!0;return!1},set(o,r,i){if(Reflect.has(o,r))return Reflect.set(o,r,i);if(typeof r=="symbol"||r.startsWith("$")||r.startsWith("__"))return!1;for(const a of n)if(a.value&&Reflect.has(a.value,r))return Reflect.set(a.value,r,i);return!1},getOwnPropertyDescriptor(o,r){var a,l;const i=Reflect.getOwnPropertyDescriptor(o,r);if(i)return i;if(!(typeof r=="symbol"||r.startsWith("$")||r.startsWith("__"))){for(const c of n){if(!c.value)continue;const u=(l=dg(c.value,r))!=null?l:"_"in c.value?dg((a=c.value._)==null?void 0:a.setupState,r):void 0;if(u)return u}for(const c of n){const u=c.value&&c.value[ug];if(!u)continue;const d=u.slice();for(;d.length;){const h=d.shift(),f=dg(h.value,r);if(f)return f;const p=h.value&&h.value[ug];p&&d.push(...p)}}}}})}const Kie=ye({id:String,text:String,..._d($m({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),Nl=Re()({name:"VTooltip",props:Kie(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const s=Mt(t,"modelValue"),{scopeId:o}=Im(),r=Ps(),i=M(()=>t.id||`v-tooltip-${r}`),a=_e(),l=M(()=>t.location.split(" ").length>1?t.location:t.location+" center"),c=M(()=>t.origin==="auto"||t.origin==="overlap"||t.origin.split(" ").length>1||t.location.split(" ").length>1?t.origin:t.origin+" center"),u=M(()=>t.transition?t.transition:s.value?"scale-transition":"fade-transition"),d=M(()=>Ue({"aria-describedby":i.value},t.activatorProps));return Ge(()=>{const[h]=Tl.filterProps(t);return I(Tl,Ue({ref:a,class:["v-tooltip",t.class],style:t.style,id:i.value},h,{modelValue:s.value,"onUpdate:modelValue":f=>s.value=f,transition:u.value,absolute:!0,location:l.value,origin:c.value,persistent:!0,role:"tooltip",activatorProps:d.value,_disableGlobalStack:!0},o),{activator:n.activator,default:function(){var g,v;for(var f=arguments.length,p=new Array(f),m=0;m<f;m++)p[m]=arguments[m];return(v=(g=n.default)==null?void 0:g.call(n,...p))!=null?v:t.text}})}),ec({},a)}});function qie(t,e,n,s,o,r){return We(),ht(Ds,{"max-width":"400px"},{default:pe(()=>[I(so,null,{default:pe(()=>[gt("W\xE4hle einen Figurenstil aus")]),_:1}),I(Io,null,{default:pe(()=>[I(Md,null,{default:pe(()=>[I(tn,{cols:"12"},{default:pe(()=>[I(_v,{modelValue:t.animate,"onUpdate:modelValue":e[0]||(e[0]=i=>t.animate=i),label:"Figuren animieren"},null,8,["modelValue"])]),_:1}),(We(!0),es(ot,null,Mf(r.themes,(i,a)=>(We(),ht(tn,{cols:"3",key:i},{default:pe(()=>[I(Nl,{text:i,location:"top"},{activator:pe(({props:l})=>[I(Ds,{onClick:c=>r.select(i),class:"ma-0 pa-0",color:n.oldTheme==i?"primary":null},{default:pe(()=>[I(Fd,Ue({src:r.loadPiece(r.piece(a),i)},l),null,16,["src"])]),_:2},1032,["onClick","color"])]),_:2},1032,["text"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}const Xie=ks(Aoe,[["render",qie]]),Yie={components:{ChooseTheme:Xie},emits:["cancel","save"],data:()=>({settings:sI(),themes:q_,pieceThemeMenu:!1,playModelNames:Coe,evaluationModelNames:koe,autoencoderModelNames:Soe}),computed:{license(){return _oe[this.settings.theme]}},methods:{autoPlay(t){this.settings.autoPlay[t]=!this.settings.autoPlay[t],this.settings.autoPlay[t]&&(this.settings.autoPlay[t==="black"?"white":"black"]=!1)},reset(){this.settings=oP()},save(){this.settings.autoPlay.white&&(this.settings.orientation="black"),this.settings.autoPlay.black&&(this.settings.orientation="white"),sP(this.settings),this.$emit("save")},selectTheme(t){this.settings.theme=t,this.pieceThemeMenu=!1},loadPiece(t){return va(t,this.settings.theme)}}};const JA=ye({divided:Boolean,...Oa(),...st(),...ur(),...Ti(),..._o(),...yn(),..._n(),...$i()},"VBtnGroup"),uk=Re()({name:"VBtnGroup",props:JA(),setup(t,e){let{slots:n}=e;const{themeClasses:s}=jn(t),{densityClasses:o}=Mr(t),{borderClasses:r}=Pa(t),{elevationClasses:i}=Ni(t),{roundedClasses:a}=Ao(t);Ra({VBtn:{height:"auto",color:Pe(t,"color"),density:Pe(t,"density"),flat:!0,variant:Pe(t,"variant")}}),Ge(()=>I(t.tag,{class:["v-btn-group",{"v-btn-group--divided":t.divided},s.value,r.value,o.value,i.value,a.value,t.class],style:t.style},n))}}),eR=ye({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),tR=ye({value:null,disabled:Boolean,selectedClass:String},"group-item");function nR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const s=On("useGroupItem");if(!s)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const o=Ps();vn(Symbol.for(`${e.description}:id`),o);const r=vt(e,null);if(!r){if(!n)return r;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${e.description}`)}const i=Pe(t,"value"),a=M(()=>!!(r.disabled.value||t.disabled));r.register({id:o,value:i,disabled:a},s),oo(()=>{r.unregister(o)});const l=M(()=>r.isSelected(o)),c=M(()=>l.value&&[r.selectedClass.value,t.selectedClass]);return ze(l,u=>{s.emit("group:selected",{value:u})}),{id:o,isSelected:l,toggle:()=>r.select(o,!l.value),select:u=>r.select(o,u),selectedClass:c,value:i,disabled:a,group:r}}function sR(t,e){let n=!1;const s=Jn([]),o=Mt(t,"modelValue",[],h=>h==null?[]:oR(s,ri(h)),h=>{const f=Qie(s,h);return t.multiple?f:f[0]}),r=On("useGroup");function i(h,f){const p=h,m=Symbol.for(`${e.description}:id`),v=Nc(m,r==null?void 0:r.vnode).indexOf(f);v>-1?s.splice(v,0,p):s.push(p)}function a(h){if(n)return;l();const f=s.findIndex(p=>p.id===h);s.splice(f,1)}function l(){const h=s.find(f=>!f.disabled);h&&t.mandatory==="force"&&!o.value.length&&(o.value=[h.id])}ir(()=>{l()}),oo(()=>{n=!0});function c(h,f){const p=s.find(m=>m.id===h);if(!(f&&(p==null?void 0:p.disabled)))if(t.multiple){const m=o.value.slice(),g=m.findIndex(b=>b===h),v=~g;if(f=f!=null?f:!v,v&&t.mandatory&&m.length<=1||!v&&t.max!=null&&m.length+1>t.max)return;g<0&&f?m.push(h):g>=0&&!f&&m.splice(g,1),o.value=m}else{const m=o.value.includes(h);if(t.mandatory&&m)return;o.value=(f!=null?f:!m)?[h]:[]}}function u(h){if(t.multiple,o.value.length){const f=o.value[0],p=s.findIndex(v=>v.id===f);let m=(p+h)%s.length,g=s[m];for(;g.disabled&&m!==p;)m=(m+h)%s.length,g=s[m];if(g.disabled)return;o.value=[s[m].id]}else{const f=s.find(p=>!p.disabled);f&&(o.value=[f.id])}}const d={register:i,unregister:a,selected:o,select:c,disabled:Pe(t,"disabled"),prev:()=>u(s.length-1),next:()=>u(1),isSelected:h=>o.value.includes(h),selectedClass:M(()=>t.selectedClass),items:M(()=>s),getItemIndex:h=>Zie(s,h)};return vn(e,d),d}function Zie(t,e){const n=oR(t,[e]);return n.length?t.findIndex(s=>s.id===n[0]):-1}function oR(t,e){const n=[];return e.forEach(s=>{const o=t.find(i=>Ed(s,i.value)),r=t[s];(o==null?void 0:o.value)!=null?n.push(o.id):r!=null&&n.push(r.id)}),n}function Qie(t,e){const n=[];return e.forEach(s=>{const o=t.findIndex(r=>r.id===s);if(~o){const r=t[o];n.push(r.value!=null?r.value:o)}}),n}const rR=Symbol.for("vuetify:v-btn-toggle"),Jie=ye({...JA(),...eR()},"VBtnToggle");Re()({name:"VBtnToggle",props:Jie(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const{isSelected:s,next:o,prev:r,select:i,selected:a}=sR(t,rR);return Ge(()=>{const[l]=uk.filterProps(t);return I(uk,Ue({class:["v-btn-toggle",t.class]},l,{style:t.style}),{default:()=>{var c;return[(c=n.default)==null?void 0:c.call(n,{isSelected:s,next:o,prev:r,select:i,selected:a})]}})}),{next:o,prev:r,select:i}}});function eae(t,e){ze(()=>{var n;return(n=t.isActive)==null?void 0:n.value},n=>{t.isLink.value&&n&&e&&gn(()=>{e(!0)})},{immediate:!0})}const tae=ye({active:{type:Boolean,default:void 0},symbol:{type:null,default:rR},flat:Boolean,icon:[Boolean,String,Function,Object],prependIcon:$t,appendIcon:$t,block:Boolean,stacked:Boolean,ripple:{type:[Boolean,Object],default:!0},text:String,...Oa(),...st(),...ur(),...Da(),...Ti(),...tR(),...k0(),...w0(),...yA(),..._o(),...wm(),...Ad(),...yn({tag:"button"}),..._n(),...$i({variant:"elevated"})},"VBtn"),us=Re()({name:"VBtn",directives:{Ripple:Jl},props:tae(),emits:{"group:selected":t=>!0},setup(t,e){let{attrs:n,slots:s}=e;const{themeClasses:o}=jn(t),{borderClasses:r}=Pa(t),{colorClasses:i,colorStyles:a,variantClasses:l}=Pd(t),{densityClasses:c}=Mr(t),{dimensionStyles:u}=Fa(t),{elevationClasses:d}=Ni(t),{loaderClasses:h}=ym(t),{locationStyles:f}=C0(t),{positionClasses:p}=xA(t),{roundedClasses:m}=Ao(t),{sizeClasses:g,sizeStyles:v}=Rd(t),b=nR(t,t.symbol,!1),y=xm(t,n),x=M(()=>{var $;return t.active!==void 0?t.active:y.isLink.value?($=y.isActive)==null?void 0:$.value:b==null?void 0:b.isSelected.value}),w=M(()=>(b==null?void 0:b.disabled.value)||t.disabled),k=M(()=>t.variant==="elevated"&&!(t.disabled||t.flat||t.border)),S=M(()=>{if(t.value!==void 0)return Object(t.value)===t.value?JSON.stringify(t.value,null,0):t.value});function C($){var T;w.value||y.isLink.value&&($.metaKey||$.ctrlKey||$.shiftKey||$.button!==0||n.target==="_blank")||((T=y.navigate)==null||T.call(y,$),b==null||b.toggle())}return eae(y,b==null?void 0:b.select),Ge(()=>{var O,B;const $=y.isLink.value?"a":t.tag,T=!!(t.prependIcon||s.prepend),E=!!(t.appendIcon||s.append),_=!!(t.icon&&t.icon!==!0),A=(b==null?void 0:b.isSelected.value)&&(!y.isLink.value||((O=y.isActive)==null?void 0:O.value))||!b||((B=y.isActive)==null?void 0:B.value);return $n(I($,{type:$==="a"?void 0:"button",class:["v-btn",b==null?void 0:b.selectedClass.value,{"v-btn--active":x.value,"v-btn--block":t.block,"v-btn--disabled":w.value,"v-btn--elevated":k.value,"v-btn--flat":t.flat,"v-btn--icon":!!t.icon,"v-btn--loading":t.loading,"v-btn--stacked":t.stacked},o.value,r.value,A?i.value:void 0,c.value,d.value,h.value,p.value,m.value,g.value,l.value,t.class],style:[A?a.value:void 0,u.value,f.value,v.value,t.style],disabled:w.value||void 0,href:y.href.value,onClick:C,value:S.value},{default:()=>{var F,V;return[Od(!0,"v-btn"),!t.icon&&T&&I("span",{key:"prepend",class:"v-btn__prepend"},[s.prepend?I(pn,{key:"prepend-defaults",disabled:!t.prependIcon,defaults:{VIcon:{icon:t.prependIcon}}},s.prepend):I(on,{key:"prepend-icon",icon:t.prependIcon},null)]),I("span",{class:"v-btn__content","data-no-activator":""},[!s.default&&_?I(on,{key:"content-icon",icon:t.icon},null):I(pn,{key:"content-defaults",disabled:!_,defaults:{VIcon:{icon:t.icon}}},{default:()=>{var D,U;return[(U=(D=s.default)==null?void 0:D.call(s))!=null?U:t.text]}})]),!t.icon&&E&&I("span",{key:"append",class:"v-btn__append"},[s.append?I(pn,{key:"append-defaults",disabled:!t.appendIcon,defaults:{VIcon:{icon:t.appendIcon}}},s.append):I(on,{key:"append-icon",icon:t.appendIcon},null)]),!!t.loading&&I("span",{key:"loader",class:"v-btn__loader"},[(V=(F=s.loader)==null?void 0:F.call(s))!=null?V:I(Sm,{color:typeof t.loading=="boolean"?void 0:t.loading,indeterminate:!0,size:"23",width:"2"},null)])]}}),[[ar("ripple"),!w.value&&t.ripple,null]])}),{}}});const nae=ye({id:String,..._d($m({closeDelay:250,closeOnContentClick:!0,locationStrategy:"connected",openDelay:300,scrim:!1,scrollStrategy:"reposition",transition:{component:T0}}),["absolute"])},"VMenu"),R0=Re()({name:"VMenu",props:nae(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const s=Mt(t,"modelValue"),{scopeId:o}=Im(),r=Ps(),i=M(()=>t.id||`v-menu-${r}`),a=_e(),l=vt(Dv,null),c=He(0);vn(Dv,{register(){++c.value},unregister(){--c.value},closeParents(){setTimeout(()=>{c.value||(s.value=!1,l==null||l.closeParents())},40)}});async function u(m){var b,y,x;const g=m.relatedTarget,v=m.target;await gn(),s.value&&g!==v&&((b=a.value)==null?void 0:b.contentEl)&&((y=a.value)==null?void 0:y.globalTop)&&![document,a.value.contentEl].includes(v)&&!a.value.contentEl.contains(v)&&((x=cf(a.value.contentEl)[0])==null||x.focus())}ze(s,m=>{m?(l==null||l.register(),document.addEventListener("focusin",u,{once:!0})):(l==null||l.unregister(),document.removeEventListener("focusin",u))});function d(){l==null||l.closeParents()}function h(m){var g,v,b;t.disabled||m.key==="Tab"&&(eA(cf((g=a.value)==null?void 0:g.contentEl,!1),m.shiftKey?"prev":"next",x=>x.tabIndex>=0)||(s.value=!1,(b=(v=a.value)==null?void 0:v.activatorEl)==null||b.focus()))}function f(m){var v;if(t.disabled)return;const g=(v=a.value)==null?void 0:v.contentEl;g&&s.value?m.key==="ArrowDown"?(m.preventDefault(),uf(g,"next")):m.key==="ArrowUp"&&(m.preventDefault(),uf(g,"prev")):["ArrowDown","ArrowUp"].includes(m.key)&&(s.value=!0,m.preventDefault(),setTimeout(()=>setTimeout(()=>f(m))))}const p=M(()=>Ue({"aria-haspopup":"menu","aria-expanded":String(s.value),"aria-owns":i.value,onKeydown:f},t.activatorProps));return Ge(()=>{const[m]=Tl.filterProps(t);return I(Tl,Ue({ref:a,class:["v-menu",t.class],style:t.style},m,{modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,absolute:!0,activatorProps:p.value,"onClick:outside":d,onKeydown:h},o),{activator:n.activator,default:function(){for(var g=arguments.length,v=new Array(g),b=0;b<g;b++)v[b]=arguments[b];return I(pn,{root:"VMenu"},{default:()=>{var y;return[(y=n.default)==null?void 0:y.call(n,...v)]}})}})}),ec({id:i,\u03A8openChildren:c},a)}});const sae=ye({indeterminate:Boolean,indeterminateIcon:{type:$t,default:"$checkboxIndeterminate"},...A0({falseIcon:"$checkboxOff",trueIcon:"$checkboxOn"})},"VCheckboxBtn"),oae=Re()({name:"VCheckboxBtn",props:sae(),emits:{"update:modelValue":t=>!0,"update:indeterminate":t=>!0},setup(t,e){let{slots:n}=e;const s=Mt(t,"indeterminate"),o=Mt(t,"modelValue");function r(l){s.value&&(s.value=!1)}const i=M(()=>s.value?t.indeterminateIcon:t.falseIcon),a=M(()=>s.value?t.indeterminateIcon:t.trueIcon);return Ge(()=>{const l=_d(bf.filterProps(t)[0],["modelValue"]);return I(bf,Ue(l,{modelValue:o.value,"onUpdate:modelValue":[c=>o.value=c,r],class:["v-checkbox-btn",t.class],style:t.style,type:"checkbox",falseIcon:i.value,trueIcon:a.value,"aria-checked":s.value?"mixed":void 0}),n)}),{}}});const iR=Symbol.for("vuetify:v-chip-group"),rae=ye({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:Ed},...st(),...eR({selectedClass:"v-chip--selected"}),...yn(),..._n(),...$i({variant:"tonal"})},"VChipGroup");Re()({name:"VChipGroup",props:rae(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const{themeClasses:s}=jn(t),{isSelected:o,select:r,next:i,prev:a,selected:l}=sR(t,iR);return Ra({VChip:{color:Pe(t,"color"),disabled:Pe(t,"disabled"),filter:Pe(t,"filter"),variant:Pe(t,"variant")}}),Ge(()=>I(t.tag,{class:["v-chip-group",{"v-chip-group--column":t.column},s.value,t.class],style:t.style},{default:()=>{var c;return[(c=n.default)==null?void 0:c.call(n,{isSelected:o,select:r,next:i,prev:a,selected:l.value})]}})),{}}});const iae=ye({activeClass:String,appendAvatar:String,appendIcon:$t,closable:Boolean,closeIcon:{type:$t,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:String,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:$t,ripple:{type:[Boolean,Object],default:!0},text:String,modelValue:{type:Boolean,default:!0},onClick:Jo(),onClickOnce:Jo(),...Oa(),...st(),...ur(),...Ti(),...tR(),..._o(),...wm(),...Ad(),...yn({tag:"span"}),..._n(),...$i({variant:"tonal"})},"VChip"),aR=Re()({name:"VChip",directives:{Ripple:Jl},props:iae(),emits:{"click:close":t=>!0,"update:modelValue":t=>!0,"group:selected":t=>!0,click:t=>!0},setup(t,e){let{attrs:n,emit:s,slots:o}=e;const{t:r}=x0(),{borderClasses:i}=Pa(t),{colorClasses:a,colorStyles:l,variantClasses:c}=Pd(t),{densityClasses:u}=Mr(t),{elevationClasses:d}=Ni(t),{roundedClasses:h}=Ao(t),{sizeClasses:f}=Rd(t),{themeClasses:p}=jn(t),m=Mt(t,"modelValue"),g=nR(t,iR,!1),v=xm(t,n),b=M(()=>t.link!==!1&&v.isLink.value),y=M(()=>!t.disabled&&t.link!==!1&&(!!g||t.link||v.isClickable.value)),x=M(()=>({"aria-label":r(t.closeLabel),onClick(S){S.stopPropagation(),m.value=!1,s("click:close",S)}}));function w(S){var C;s("click",S),y.value&&((C=v.navigate)==null||C.call(v,S),g==null||g.toggle())}function k(S){(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),w(S))}return()=>{const S=v.isLink.value?"a":t.tag,C=!!(t.appendIcon||t.appendAvatar),$=!!(C||o.append),T=!!(o.close||t.closable),E=!!(o.filter||t.filter)&&g,_=!!(t.prependIcon||t.prependAvatar),A=!!(_||o.prepend),O=!g||g.isSelected.value;return m.value&&$n(I(S,{class:["v-chip",{"v-chip--disabled":t.disabled,"v-chip--label":t.label,"v-chip--link":y.value,"v-chip--filter":E,"v-chip--pill":t.pill},p.value,i.value,O?a.value:void 0,u.value,d.value,h.value,f.value,c.value,g==null?void 0:g.selectedClass.value,t.class],style:[O?l.value:void 0,t.style],disabled:t.disabled||void 0,draggable:t.draggable,href:v.href.value,tabindex:y.value?0:void 0,onClick:w,onKeydown:y.value&&!b.value&&k},{default:()=>{var B,F;return[Od(y.value,"v-chip"),E&&I(GA,{key:"filter"},{default:()=>[$n(I("div",{class:"v-chip__filter"},[o.filter?I(pn,{key:"filter-defaults",disabled:!t.filterIcon,defaults:{VIcon:{icon:t.filterIcon}}},o.filter):I(on,{key:"filter-icon",icon:t.filterIcon},null)]),[[mi,g.isSelected.value]])]}),A&&I("div",{key:"prepend",class:"v-chip__prepend"},[o.prepend?I(pn,{key:"prepend-defaults",disabled:!_,defaults:{VAvatar:{image:t.prependAvatar,start:!0},VIcon:{icon:t.prependIcon,start:!0}}},o.prepend):I(ot,null,[t.prependIcon&&I(on,{key:"prepend-icon",icon:t.prependIcon,start:!0},null),t.prependAvatar&&I($l,{key:"prepend-avatar",image:t.prependAvatar,start:!0},null)])]),I("div",{class:"v-chip__content"},[(F=(B=o.default)==null?void 0:B.call(o,{isSelected:g==null?void 0:g.isSelected.value,selectedClass:g==null?void 0:g.selectedClass.value,select:g==null?void 0:g.select,toggle:g==null?void 0:g.toggle,value:g==null?void 0:g.value.value,disabled:t.disabled}))!=null?F:t.text]),$&&I("div",{key:"append",class:"v-chip__append"},[o.append?I(pn,{key:"append-defaults",disabled:!C,defaults:{VAvatar:{end:!0,image:t.appendAvatar},VIcon:{end:!0,icon:t.appendIcon}}},o.append):I(ot,null,[t.appendIcon&&I(on,{key:"append-icon",end:!0,icon:t.appendIcon},null),t.appendAvatar&&I($l,{key:"append-avatar",end:!0,image:t.appendAvatar},null)])]),T&&I("div",Ue({key:"close",class:"v-chip__close"},x.value),[o.close?I(pn,{key:"close-defaults",defaults:{VIcon:{icon:t.closeIcon,size:"x-small"}}},o.close):I(on,{key:"close-icon",icon:t.closeIcon,size:"x-small"},null)])]}}),[[ar("ripple"),y.value&&t.ripple,null]])}}});const Fv=Symbol.for("vuetify:list");function lR(){const t=vt(Fv,{hasPrepend:He(!1),updateHasPrepend:()=>null}),e={hasPrepend:He(!1),updateHasPrepend:n=>{n&&(e.hasPrepend.value=n)}};return vn(Fv,e),t}function cR(){return vt(Fv,null)}const aae={open:t=>{let{id:e,value:n,opened:s,parents:o}=t;if(n){const r=new Set;r.add(e);let i=o.get(e);for(;i!=null;)r.add(i),i=o.get(i);return r}else return s.delete(e),s},select:()=>null},uR={open:t=>{let{id:e,value:n,opened:s,parents:o}=t;if(n){let r=o.get(e);for(s.add(e);r!=null&&r!==e;)s.add(r),r=o.get(r);return s}else s.delete(e);return s},select:()=>null},lae={open:uR.open,select:t=>{let{id:e,value:n,opened:s,parents:o}=t;if(!n)return s;const r=[];let i=o.get(e);for(;i!=null;)r.push(i),i=o.get(i);return new Set(r)}},D0=t=>{const e={select:n=>{let{id:s,value:o,selected:r}=n;if(s=Qe(s),t&&!o){const i=Array.from(r.entries()).reduce((a,l)=>{let[c,u]=l;return u==="on"?[...a,c]:a},[]);if(i.length===1&&i[0]===s)return r}return r.set(s,o?"on":"off"),r},in:(n,s,o)=>{let r=new Map;for(const i of n||[])r=e.select({id:i,value:!0,selected:new Map(r),children:s,parents:o});return r},out:n=>{const s=[];for(const[o,r]of n.entries())r==="on"&&s.push(o);return s}};return e},dR=t=>{const e=D0(t);return{select:s=>{let{selected:o,id:r,...i}=s;r=Qe(r);const a=o.has(r)?new Map([[r,o.get(r)]]):new Map;return e.select({...i,id:r,selected:a})},in:(s,o,r)=>{let i=new Map;return s!=null&&s.length&&(i=e.in(s.slice(0,1),o,r)),i},out:(s,o,r)=>e.out(s,o,r)}},cae=t=>{const e=D0(t);return{select:s=>{let{id:o,selected:r,children:i,...a}=s;return o=Qe(o),i.has(o)?r:e.select({id:o,selected:r,children:i,...a})},in:e.in,out:e.out}},uae=t=>{const e=dR(t);return{select:s=>{let{id:o,selected:r,children:i,...a}=s;return o=Qe(o),i.has(o)?r:e.select({id:o,selected:r,children:i,...a})},in:e.in,out:e.out}},dae=t=>{const e={select:n=>{let{id:s,value:o,selected:r,children:i,parents:a}=n;s=Qe(s);const l=new Map(r),c=[s];for(;c.length;){const d=c.shift();r.set(d,o?"on":"off"),i.has(d)&&c.push(...i.get(d))}let u=a.get(s);for(;u;){const d=i.get(u),h=d.every(p=>r.get(p)==="on"),f=d.every(p=>!r.has(p)||r.get(p)==="off");r.set(u,h?"on":f?"off":"indeterminate"),u=a.get(u)}return t&&!o&&Array.from(r.entries()).reduce((h,f)=>{let[p,m]=f;return m==="on"?[...h,p]:h},[]).length===0?l:r},in:(n,s,o)=>{let r=new Map;for(const i of n||[])r=e.select({id:i,value:!0,selected:new Map(r),children:s,parents:o});return r},out:(n,s)=>{const o=[];for(const[r,i]of n.entries())i==="on"&&!s.has(r)&&o.push(r);return o}};return e},su=Symbol.for("vuetify:nested"),hR={id:He(),root:{register:()=>null,unregister:()=>null,parents:_e(new Map),children:_e(new Map),open:()=>null,openOnSelect:()=>null,select:()=>null,opened:_e(new Set),selected:_e(new Map),selectedValues:_e([])}},hae=ye({selectStrategy:[String,Function],openStrategy:[String,Object],opened:Array,selected:Array,mandatory:Boolean},"nested"),fae=t=>{let e=!1;const n=_e(new Map),s=_e(new Map),o=Mt(t,"opened",t.opened,d=>new Set(d),d=>[...d.values()]),r=M(()=>{if(typeof t.selectStrategy=="object")return t.selectStrategy;switch(t.selectStrategy){case"single-leaf":return uae(t.mandatory);case"leaf":return cae(t.mandatory);case"independent":return D0(t.mandatory);case"single-independent":return dR(t.mandatory);case"classic":default:return dae(t.mandatory)}}),i=M(()=>{if(typeof t.openStrategy=="object")return t.openStrategy;switch(t.openStrategy){case"list":return lae;case"single":return aae;case"multiple":default:return uR}}),a=Mt(t,"selected",t.selected,d=>r.value.in(d,n.value,s.value),d=>r.value.out(d,n.value,s.value));oo(()=>{e=!0});function l(d){const h=[];let f=d;for(;f!=null;)h.unshift(f),f=s.value.get(f);return h}const c=On("nested"),u={id:He(),root:{opened:o,selected:a,selectedValues:M(()=>{const d=[];for(const[h,f]of a.value.entries())f==="on"&&d.push(h);return d}),register:(d,h,f)=>{h&&d!==h&&s.value.set(d,h),f&&n.value.set(d,[]),h!=null&&n.value.set(h,[...n.value.get(h)||[],d])},unregister:d=>{var f;if(e)return;n.value.delete(d);const h=s.value.get(d);if(h){const p=(f=n.value.get(h))!=null?f:[];n.value.set(h,p.filter(m=>m!==d))}s.value.delete(d),o.value.delete(d)},open:(d,h,f)=>{c.emit("click:open",{id:d,value:h,path:l(d),event:f});const p=i.value.open({id:d,value:h,opened:new Set(o.value),children:n.value,parents:s.value,event:f});p&&(o.value=p)},openOnSelect:(d,h,f)=>{const p=i.value.select({id:d,value:h,selected:new Map(a.value),opened:new Set(o.value),children:n.value,parents:s.value,event:f});p&&(o.value=p)},select:(d,h,f)=>{c.emit("click:select",{id:d,value:h,path:l(d),event:f});const p=r.value.select({id:d,value:h,selected:new Map(a.value),children:n.value,parents:s.value,event:f});p&&(a.value=p),u.root.openOnSelect(d,h,f)},children:n,parents:s}};return vn(su,u),u.root},fR=(t,e)=>{const n=vt(su,hR),s=Symbol(Ps()),o=M(()=>t.value!==void 0?t.value:s),r={...n,id:o,open:(i,a)=>n.root.open(o.value,i,a),openOnSelect:(i,a)=>n.root.openOnSelect(o.value,i,a),isOpen:M(()=>n.root.opened.value.has(o.value)),parent:M(()=>n.root.parents.value.get(o.value)),select:(i,a)=>n.root.select(o.value,i,a),isSelected:M(()=>n.root.selected.value.get(Qe(o.value))==="on"),isIndeterminate:M(()=>n.root.selected.value.get(o.value)==="indeterminate"),isLeaf:M(()=>!n.root.children.value.get(o.value)),isGroupActivator:n.isGroupActivator};return!n.isGroupActivator&&n.root.register(o.value,n.id.value,e),oo(()=>{!n.isGroupActivator&&n.root.unregister(o.value)}),e&&vn(su,r),r},pae=()=>{const t=vt(su,hR);vn(su,{...t,isGroupActivator:!0})};function F0(){const t=He(!1);return ir(()=>{window.requestAnimationFrame(()=>{t.value=!0})}),{ssrBootStyles:M(()=>t.value?void 0:{transition:"none !important"}),isBooted:cu(t)}}const mae=Zl({name:"VListGroupActivator",setup(t,e){let{slots:n}=e;return pae(),()=>{var s;return(s=n.default)==null?void 0:s.call(n)}}}),gae=ye({activeColor:String,baseColor:String,color:String,collapseIcon:{type:$t,default:"$collapse"},expandIcon:{type:$t,default:"$expand"},prependIcon:$t,appendIcon:$t,fluid:Boolean,subgroup:Boolean,title:String,value:null,...st(),...yn()},"VListGroup"),dk=Re()({name:"VListGroup",props:gae(),setup(t,e){let{slots:n}=e;const{isOpen:s,open:o,id:r}=fR(Pe(t,"value"),!0),i=M(()=>`v-list-group--id-${String(r.value)}`),a=cR(),{isBooted:l}=F0();function c(f){o(!s.value,f)}const u=M(()=>({onClick:c,class:"v-list-group__header",id:i.value})),d=M(()=>s.value?t.collapseIcon:t.expandIcon),h=M(()=>({VListItem:{active:s.value,activeColor:t.activeColor,baseColor:t.baseColor,color:t.color,prependIcon:t.prependIcon||t.subgroup&&d.value,appendIcon:t.appendIcon||!t.subgroup&&d.value,title:t.title,value:t.value}}));return Ge(()=>I(t.tag,{class:["v-list-group",{"v-list-group--prepend":a==null?void 0:a.hasPrepend.value,"v-list-group--fluid":t.fluid,"v-list-group--subgroup":t.subgroup,"v-list-group--open":s.value},t.class],style:t.style},{default:()=>[n.activator&&I(pn,{defaults:h.value},{default:()=>[I(mae,null,{default:()=>[n.activator({props:u.value,isOpen:s.value})]})]}),I(Qr,{transition:{component:UA},disabled:!l.value},{default:()=>{var f;return[$n(I("div",{class:"v-list-group__items",role:"group","aria-labelledby":i.value},[(f=n.default)==null?void 0:f.call(n)]),[[mi,s.value]])]}})]})),{}}});const vae=Ql("v-list-item-subtitle"),bae=Ql("v-list-item-title"),yae=ye({active:{type:Boolean,default:void 0},activeClass:String,activeColor:String,appendAvatar:String,appendIcon:$t,baseColor:String,disabled:Boolean,lines:String,link:{type:Boolean,default:void 0},nav:Boolean,prependAvatar:String,prependIcon:$t,ripple:{type:[Boolean,Object],default:!0},subtitle:[String,Number,Boolean],title:[String,Number,Boolean],value:null,onClick:Jo(),onClickOnce:Jo(),...Oa(),...st(),...ur(),...Da(),...Ti(),..._o(),...wm(),...yn(),..._n(),...$i({variant:"text"})},"VListItem"),xf=Re()({name:"VListItem",directives:{Ripple:Jl},props:yae(),emits:{click:t=>!0},setup(t,e){let{attrs:n,slots:s,emit:o}=e;const r=xm(t,n),i=M(()=>t.value===void 0?r.href.value:t.value),{select:a,isSelected:l,isIndeterminate:c,isGroupActivator:u,root:d,parent:h,openOnSelect:f}=fR(i,!1),p=cR(),m=M(()=>{var D;return t.active!==!1&&(t.active||((D=r.isActive)==null?void 0:D.value)||l.value)}),g=M(()=>t.link!==!1&&r.isLink.value),v=M(()=>!t.disabled&&t.link!==!1&&(t.link||r.isClickable.value||t.value!=null&&!!p)),b=M(()=>t.rounded||t.nav),y=M(()=>{var D;return(D=t.color)!=null?D:t.activeColor}),x=M(()=>{var D;return{color:m.value&&(D=y.value)!=null?D:t.baseColor,variant:t.variant}});ze(()=>{var D;return(D=r.isActive)==null?void 0:D.value},D=>{D&&h.value!=null&&d.open(h.value,!0),D&&f(D)},{immediate:!0});const{themeClasses:w}=jn(t),{borderClasses:k}=Pa(t),{colorClasses:S,colorStyles:C,variantClasses:$}=Pd(x),{densityClasses:T}=Mr(t),{dimensionStyles:E}=Fa(t),{elevationClasses:_}=Ni(t),{roundedClasses:A}=Ao(b),O=M(()=>t.lines?`v-list-item--${t.lines}-line`:void 0),B=M(()=>({isActive:m.value,select:a,isSelected:l.value,isIndeterminate:c.value}));function F(D){var U;o("click",D),!(u||!v.value)&&((U=r.navigate)==null||U.call(r,D),t.value!=null&&a(!l.value,D))}function V(D){(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),F(D))}return Ge(()=>{const D=g.value?"a":t.tag,U=s.title||t.title,J=s.subtitle||t.subtitle,X=!!(t.appendAvatar||t.appendIcon),te=!!(X||s.append),ie=!!(t.prependAvatar||t.prependIcon),ue=!!(ie||s.prepend);return p==null||p.updateHasPrepend(ue),t.activeColor&&joe("active-color",["color","base-color"]),$n(I(D,{class:["v-list-item",{"v-list-item--active":m.value,"v-list-item--disabled":t.disabled,"v-list-item--link":v.value,"v-list-item--nav":t.nav,"v-list-item--prepend":!ue&&(p==null?void 0:p.hasPrepend.value),[`${t.activeClass}`]:t.activeClass&&m.value},w.value,k.value,S.value,T.value,_.value,O.value,A.value,$.value,t.class],style:[C.value,E.value,t.style],href:r.href.value,tabindex:v.value?p?-2:0:void 0,onClick:F,onKeydown:v.value&&!g.value&&V},{default:()=>{var ce;return[Od(v.value||m.value,"v-list-item"),ue&&I("div",{key:"prepend",class:"v-list-item__prepend"},[s.prepend?I(pn,{key:"prepend-defaults",disabled:!ie,defaults:{VAvatar:{density:t.density,image:t.prependAvatar},VIcon:{density:t.density,icon:t.prependIcon},VListItemAction:{start:!0}}},{default:()=>{var Y;return[(Y=s.prepend)==null?void 0:Y.call(s,B.value)]}}):I(ot,null,[t.prependAvatar&&I($l,{key:"prepend-avatar",density:t.density,image:t.prependAvatar},null),t.prependIcon&&I(on,{key:"prepend-icon",density:t.density,icon:t.prependIcon},null)]),I("div",{class:"v-list-item__spacer"},null)]),I("div",{class:"v-list-item__content","data-no-activator":""},[U&&I(bae,{key:"title"},{default:()=>{var Y,z;return[(z=(Y=s.title)==null?void 0:Y.call(s,{title:t.title}))!=null?z:t.title]}}),J&&I(vae,{key:"subtitle"},{default:()=>{var Y,z;return[(z=(Y=s.subtitle)==null?void 0:Y.call(s,{subtitle:t.subtitle}))!=null?z:t.subtitle]}}),(ce=s.default)==null?void 0:ce.call(s,B.value)]),te&&I("div",{key:"append",class:"v-list-item__append"},[s.append?I(pn,{key:"append-defaults",disabled:!X,defaults:{VAvatar:{density:t.density,image:t.appendAvatar},VIcon:{density:t.density,icon:t.appendIcon},VListItemAction:{end:!0}}},{default:()=>{var Y;return[(Y=s.append)==null?void 0:Y.call(s,B.value)]}}):I(ot,null,[t.appendIcon&&I(on,{key:"append-icon",density:t.density,icon:t.appendIcon},null),t.appendAvatar&&I($l,{key:"append-avatar",density:t.density,image:t.appendAvatar},null)]),I("div",{class:"v-list-item__spacer"},null)])]}}),[[ar("ripple"),v.value&&t.ripple]])}),{}}}),xae=ye({color:String,inset:Boolean,sticky:Boolean,title:String,...st(),...yn()},"VListSubheader"),wae=Re()({name:"VListSubheader",props:xae(),setup(t,e){let{slots:n}=e;const{textColorClasses:s,textColorStyles:o}=rr(Pe(t,"color"));return Ge(()=>{const r=!!(n.default||t.title);return I(t.tag,{class:["v-list-subheader",{"v-list-subheader--inset":t.inset,"v-list-subheader--sticky":t.sticky},s.value,t.class],style:[{textColorStyles:o},t.style]},{default:()=>{var i,a;return[r&&I("div",{class:"v-list-subheader__text"},[(a=(i=n.default)==null?void 0:i.call(n))!=null?a:t.title])]}})}),{}}});const Cae=ye({color:String,inset:Boolean,length:[Number,String],thickness:[Number,String],vertical:Boolean,...st(),..._n()},"VDivider"),kae=Re()({name:"VDivider",props:Cae(),setup(t,e){let{attrs:n}=e;const{themeClasses:s}=jn(t),{textColorClasses:o,textColorStyles:r}=rr(Pe(t,"color")),i=M(()=>{const a={};return t.length&&(a[t.vertical?"maxHeight":"maxWidth"]=Fe(t.length)),t.thickness&&(a[t.vertical?"borderRightWidth":"borderTopWidth"]=Fe(t.thickness)),a});return Ge(()=>I("hr",{class:[{"v-divider":!0,"v-divider--inset":t.inset,"v-divider--vertical":t.vertical},s.value,o.value,t.class],style:[i.value,r.value,t.style],"aria-orientation":!n.role||n.role==="separator"?t.vertical?"vertical":"horizontal":void 0,role:`${n.role||"separator"}`},null)),{}}}),Sae=ye({items:Array,returnObject:Boolean},"VListChildren"),pR=Re()({name:"VListChildren",props:Sae(),setup(t,e){let{slots:n}=e;return lR(),()=>{var s,o,r;return(r=(s=n.default)==null?void 0:s.call(n))!=null?r:(o=t.items)==null?void 0:o.map(i=>{var p,m,g,v;let{children:a,props:l,type:c,raw:u}=i;if(c==="divider")return(m=(p=n.divider)==null?void 0:p.call(n,{props:l}))!=null?m:I(kae,l,null);if(c==="subheader")return(v=(g=n.subheader)==null?void 0:g.call(n,{props:l}))!=null?v:I(wae,l,null);const d={subtitle:n.subtitle?b=>{var y;return(y=n.subtitle)==null?void 0:y.call(n,{...b,item:u})}:void 0,prepend:n.prepend?b=>{var y;return(y=n.prepend)==null?void 0:y.call(n,{...b,item:u})}:void 0,append:n.append?b=>{var y;return(y=n.append)==null?void 0:y.call(n,{...b,item:u})}:void 0,title:n.title?b=>{var y;return(y=n.title)==null?void 0:y.call(n,{...b,item:u})}:void 0},[h,f]=dk.filterProps(l);return a?I(dk,Ue({value:l==null?void 0:l.value},h),{activator:b=>{let{props:y}=b;const x={...l,...y,value:t.returnObject?u:l.value};return n.header?n.header({props:x}):I(xf,x,d)},default:()=>I(pR,{items:a},n)}):n.item?n.item({props:l}):I(xf,Ue(l,{value:t.returnObject?u:l.value}),d)})}}}),mR=ye({items:{type:Array,default:()=>[]},itemTitle:{type:[String,Array,Function],default:"title"},itemValue:{type:[String,Array,Function],default:"value"},itemChildren:{type:[Boolean,String,Array,Function],default:"children"},itemProps:{type:[Boolean,String,Array,Function],default:"props"},returnObject:Boolean,valueComparator:{type:Function,default:Ed}},"list-items");function Ov(t,e){var a;const n=vr(e,t.itemTitle,e),s=vr(e,t.itemValue,n),o=vr(e,t.itemChildren),r=t.itemProps===!0?typeof e=="object"&&e!=null&&!Array.isArray(e)?"children"in e?Sl(e,["children"])[1]:e:void 0:vr(e,t.itemProps),i={title:n,value:s,...r};return{title:String((a=i.title)!=null?a:""),value:i.value,props:i,children:Array.isArray(o)?gR(t,o):void 0,raw:e}}function gR(t,e){const n=[];for(const s of e)n.push(Ov(t,s));return n}function Iae(t){const e=M(()=>gR(t,t.items)),n=M(()=>e.value.some(r=>r.value===null));function s(r){return n.value||(r=r.filter(i=>i!==null)),r.map(i=>t.returnObject&&typeof i=="string"?Ov(t,i):e.value.find(a=>t.valueComparator(i,a.value))||Ov(t,i))}function o(r){return t.returnObject?r.map(i=>{let{raw:a}=i;return a}):r.map(i=>{let{value:a}=i;return a})}return{items:e,transformIn:s,transformOut:o}}function $ae(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"}function Tae(t,e){const n=vr(e,t.itemType,"item"),s=$ae(e)?e:vr(e,t.itemTitle),o=vr(e,t.itemValue,void 0),r=vr(e,t.itemChildren),i=t.itemProps===!0?Sl(e,["children"])[1]:vr(e,t.itemProps),a={title:s,value:o,...i};return{type:n,title:a.title,value:a.value,props:a,children:n==="item"&&r?vR(t,r):void 0,raw:e}}function vR(t,e){const n=[];for(const s of e)n.push(Tae(t,s));return n}function Nae(t){return{items:M(()=>vR(t,t.items))}}const Eae=ye({baseColor:String,activeColor:String,activeClass:String,bgColor:String,disabled:Boolean,lines:{type:[Boolean,String],default:"one"},nav:Boolean,...hae({selectStrategy:"single-leaf",openStrategy:"list"}),...Oa(),...st(),...ur(),...Da(),...Ti(),itemType:{type:String,default:"type"},...mR(),..._o(),...yn(),..._n(),...$i({variant:"text"})},"VList"),_ae=Re()({name:"VList",props:Eae(),emits:{"update:selected":t=>!0,"update:opened":t=>!0,"click:open":t=>!0,"click:select":t=>!0},setup(t,e){let{slots:n}=e;const{items:s}=Nae(t),{themeClasses:o}=jn(t),{backgroundColorClasses:r,backgroundColorStyles:i}=Nr(Pe(t,"bgColor")),{borderClasses:a}=Pa(t),{densityClasses:l}=Mr(t),{dimensionStyles:c}=Fa(t),{elevationClasses:u}=Ni(t),{roundedClasses:d}=Ao(t),{open:h,select:f}=fae(t),p=M(()=>t.lines?`v-list--${t.lines}-line`:void 0),m=Pe(t,"activeColor"),g=Pe(t,"baseColor"),v=Pe(t,"color");lR(),Ra({VListGroup:{activeColor:m,baseColor:g,color:v},VListItem:{activeClass:Pe(t,"activeClass"),activeColor:m,baseColor:g,color:v,density:Pe(t,"density"),disabled:Pe(t,"disabled"),lines:Pe(t,"lines"),nav:Pe(t,"nav"),variant:Pe(t,"variant")}});const b=He(!1),y=_e();function x($){b.value=!0}function w($){b.value=!1}function k($){var T;!b.value&&!($.relatedTarget&&((T=y.value)==null?void 0:T.contains($.relatedTarget)))&&C()}function S($){if(!!y.value){if($.key==="ArrowDown")C("next");else if($.key==="ArrowUp")C("prev");else if($.key==="Home")C("first");else if($.key==="End")C("last");else return;$.preventDefault()}}function C($){if(y.value)return uf(y.value,$)}return Ge(()=>I(t.tag,{ref:y,class:["v-list",{"v-list--disabled":t.disabled,"v-list--nav":t.nav},o.value,r.value,a.value,l.value,u.value,p.value,d.value,t.class],style:[i.value,c.value,t.style],tabindex:t.disabled||b.value?-1:0,role:"listbox","aria-activedescendant":void 0,onFocusin:x,onFocusout:w,onFocus:k,onKeydown:S},{default:()=>[I(pR,{items:s.value,returnObject:t.returnObject},n)]})),{open:h,select:f,focus:C}}});const Aae=ye({active:Boolean,max:[Number,String],value:{type:[Number,String],default:0},...st(),...Dd({transition:{component:N0}})},"VCounter"),bR=Re()({name:"VCounter",functional:!0,props:Aae(),setup(t,e){let{slots:n}=e;const s=M(()=>t.max?`${t.value} / ${t.max}`:String(t.value));return Ge(()=>I(Qr,{transition:t.transition},{default:()=>[$n(I("div",{class:["v-counter",t.class],style:t.style},[n.default?n.default({counter:s.value,max:t.max,value:t.value}):s.value]),[[mi,t.active]])]})),{}}});const Rae=ye({floating:Boolean,...st()},"VFieldLabel"),hh=Re()({name:"VFieldLabel",props:Rae(),setup(t,e){let{slots:n}=e;return Ge(()=>I(_0,{class:["v-field-label",{"v-field-label--floating":t.floating},t.class],style:t.style,"aria-hidden":t.floating||void 0},n)),{}}}),Dae=["underlined","outlined","filled","solo","solo-inverted","solo-filled","plain"],O0=ye({appendInnerIcon:$t,bgColor:String,clearable:Boolean,clearIcon:{type:$t,default:"$clear"},active:Boolean,centerAffix:{type:Boolean,default:void 0},color:String,baseColor:String,dirty:Boolean,disabled:{type:Boolean,default:null},error:Boolean,flat:Boolean,label:String,persistentClear:Boolean,prependInnerIcon:$t,reverse:Boolean,singleLine:Boolean,variant:{type:String,default:"filled",validator:t=>Dae.includes(t)},"onClick:clear":Jo(),"onClick:appendInner":Jo(),"onClick:prependInner":Jo(),...st(),...k0(),..._o(),..._n()},"VField"),P0=Re()({name:"VField",inheritAttrs:!1,props:{id:String,...E0(),...O0()},emits:{"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,e){let{attrs:n,emit:s,slots:o}=e;const{themeClasses:r}=jn(t),{loaderClasses:i}=ym(t),{focusClasses:a,isFocused:l,focus:c,blur:u}=Ld(t),{InputIcon:d}=HA(t),{roundedClasses:h}=Ao(t),{rtlClasses:f}=Ro(),p=M(()=>t.dirty||t.active),m=M(()=>!t.singleLine&&!!(t.label||o.label)),g=Ps(),v=M(()=>t.id||`input-${g}`),b=M(()=>`${v.value}-messages`),y=_e(),x=_e(),w=_e(),k=M(()=>["plain","underlined"].includes(t.variant)),{backgroundColorClasses:S,backgroundColorStyles:C}=Nr(Pe(t,"bgColor")),{textColorClasses:$,textColorStyles:T}=rr(M(()=>t.error||t.disabled?void 0:p.value&&l.value?t.color:t.baseColor));ze(p,A=>{if(m.value){const O=y.value.$el,B=x.value.$el;requestAnimationFrame(()=>{const F=f0(O),V=B.getBoundingClientRect(),D=V.x-F.x,U=V.y-F.y-(F.height/2-V.height/2),J=V.width/.75,X=Math.abs(J-F.width)>1?{maxWidth:Fe(J)}:void 0,te=getComputedStyle(O),ie=getComputedStyle(B),ue=parseFloat(te.transitionDuration)*1e3||150,ce=parseFloat(ie.getPropertyValue("--v-field-label-scale")),Y=ie.getPropertyValue("color");O.style.visibility="visible",B.style.visibility="hidden",Qa(O,{transform:`translate(${D}px, ${U}px) scale(${ce})`,color:Y,...X},{duration:ue,easing:ff,direction:A?"normal":"reverse"}).finished.then(()=>{O.style.removeProperty("visibility"),B.style.removeProperty("visibility")})})}},{flush:"post"});const E=M(()=>({isActive:p,isFocused:l,controlRef:w,blur:u,focus:c}));function _(A){A.target!==document.activeElement&&A.preventDefault()}return Ge(()=>{var D,U,J,X;const A=t.variant==="outlined",O=o["prepend-inner"]||t.prependInnerIcon,B=!!(t.clearable||o.clear),F=!!(o["append-inner"]||t.appendInnerIcon||B),V=o.label?o.label({...E.value,label:t.label,props:{for:v.value}}):t.label;return I("div",Ue({class:["v-field",{"v-field--active":p.value,"v-field--appended":F,"v-field--center-affix":(D=t.centerAffix)!=null?D:!k.value,"v-field--disabled":t.disabled,"v-field--dirty":t.dirty,"v-field--error":t.error,"v-field--flat":t.flat,"v-field--has-background":!!t.bgColor,"v-field--persistent-clear":t.persistentClear,"v-field--prepended":O,"v-field--reverse":t.reverse,"v-field--single-line":t.singleLine,"v-field--no-label":!V,[`v-field--variant-${t.variant}`]:!0},r.value,S.value,a.value,i.value,h.value,f.value,t.class],style:[C.value,t.style],onClick:_},n),[I("div",{class:"v-field__overlay"},null),I(S0,{name:"v-field",active:!!t.loading,color:t.error?"error":typeof t.loading=="string"?t.loading:t.color},{default:o.loader}),O&&I("div",{key:"prepend",class:"v-field__prepend-inner"},[t.prependInnerIcon&&I(d,{key:"prepend-icon",name:"prependInner"},null),(U=o["prepend-inner"])==null?void 0:U.call(o,E.value)]),I("div",{class:"v-field__field","data-no-activator":""},[["filled","solo","solo-inverted","solo-filled"].includes(t.variant)&&m.value&&I(hh,{key:"floating-label",ref:x,class:[$.value],floating:!0,for:v.value,style:T.value},{default:()=>[V]}),I(hh,{ref:y,for:v.value},{default:()=>[V]}),(J=o.default)==null?void 0:J.call(o,{...E.value,props:{id:v.value,class:"v-field__input","aria-describedby":b.value},focus:c,blur:u})]),B&&I(GA,{key:"clear"},{default:()=>[$n(I("div",{class:"v-field__clearable",onMousedown:te=>{te.preventDefault(),te.stopPropagation()}},[o.clear?o.clear():I(d,{name:"clear"},null)]),[[mi,t.dirty]])]}),F&&I("div",{key:"append",class:"v-field__append-inner"},[(X=o["append-inner"])==null?void 0:X.call(o,E.value),t.appendInnerIcon&&I(d,{key:"append-icon",name:"appendInner"},null)]),I("div",{class:["v-field__outline",$.value],style:T.value},[A&&I(ot,null,[I("div",{class:"v-field__outline__start"},null),m.value&&I("div",{class:"v-field__outline__notch"},[I(hh,{ref:x,floating:!0,for:v.value},{default:()=>[V]})]),I("div",{class:"v-field__outline__end"},null)]),k.value&&m.value&&I(hh,{ref:x,floating:!0,for:v.value},{default:()=>[V]})])])}),{controlRef:w}}});function yR(t){const e=Object.keys(P0.props).filter(n=>!d0(n)&&n!=="class"&&n!=="style");return Sl(t,e)}const Fae=["color","file","time","date","datetime-local","week","month"],xR=ye({autofocus:Boolean,counter:[Boolean,Number,String],counterValue:[Number,Function],prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,suffix:String,role:String,type:{type:String,default:"text"},modelModifiers:Object,...Bd(),...O0()},"VTextField"),ou=Re()({name:"VTextField",directives:{Intersect:y0},inheritAttrs:!1,props:xR(),emits:{"click:control":t=>!0,"mousedown:control":t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,e){let{attrs:n,emit:s,slots:o}=e;const r=Mt(t,"modelValue"),{isFocused:i,focus:a,blur:l}=Ld(t),c=M(()=>{var k;return typeof t.counterValue=="function"?t.counterValue(r.value):typeof t.counterValue=="number"?t.counterValue:((k=r.value)!=null?k:"").toString().length}),u=M(()=>{if(n.maxlength)return n.maxlength;if(!(!t.counter||typeof t.counter!="number"&&typeof t.counter!="string"))return t.counter}),d=M(()=>["plain","underlined"].includes(t.variant));function h(k,S){var C,$;!t.autofocus||!k||($=(C=S[0].target)==null?void 0:C.focus)==null||$.call(C)}const f=_e(),p=_e(),m=_e(),g=M(()=>Fae.includes(t.type)||t.persistentPlaceholder||i.value||t.active);function v(){var k;m.value!==document.activeElement&&((k=m.value)==null||k.focus()),i.value||a()}function b(k){s("mousedown:control",k),k.target!==m.value&&(v(),k.preventDefault())}function y(k){v(),s("click:control",k)}function x(k){k.stopPropagation(),v(),gn(()=>{r.value=null,J_(t["onClick:clear"],k)})}function w(k){var C;const S=k.target;if(r.value=S.value,((C=t.modelModifiers)==null?void 0:C.trim)&&["text","search","password","tel","url"].includes(t.type)){const $=[S.selectionStart,S.selectionEnd];gn(()=>{S.selectionStart=$[0],S.selectionEnd=$[1]})}}return Ge(()=>{const k=!!(o.counter||t.counter!==!1&&t.counter!=null),S=!!(k||o.details),[C,$]=vm(n),[{modelValue:T,...E}]=pi.filterProps(t),[_]=yR(t);return I(pi,Ue({ref:f,modelValue:r.value,"onUpdate:modelValue":A=>r.value=A,class:["v-text-field",{"v-text-field--prefixed":t.prefix,"v-text-field--suffixed":t.suffix,"v-text-field--plain-underlined":["plain","underlined"].includes(t.variant)},t.class],style:t.style},C,E,{centerAffix:!d.value,focused:i.value}),{...o,default:A=>{let{id:O,isDisabled:B,isDirty:F,isReadonly:V,isValid:D}=A;return I(P0,Ue({ref:p,onMousedown:b,onClick:y,"onClick:clear":x,"onClick:prependInner":t["onClick:prependInner"],"onClick:appendInner":t["onClick:appendInner"],role:t.role},_,{id:O.value,active:g.value||F.value,dirty:F.value||t.dirty,disabled:B.value,focused:i.value,error:D.value===!1}),{...o,default:U=>{let{props:{class:J,...X}}=U;const te=$n(I("input",Ue({ref:m,value:r.value,onInput:w,autofocus:t.autofocus,readonly:V.value,disabled:B.value,name:t.name,placeholder:t.placeholder,size:1,type:t.type,onFocus:v,onBlur:l},X,$),null),[[ar("intersect"),{handler:h},null,{once:!0}]]);return I(ot,null,[t.prefix&&I("span",{class:"v-text-field__prefix"},[I("span",{class:"v-text-field__prefix__text"},[t.prefix])]),o.default?I("div",{class:J,"data-no-activator":""},[o.default(),te]):wr(te,{class:J}),t.suffix&&I("span",{class:"v-text-field__suffix"},[I("span",{class:"v-text-field__suffix__text"},[t.suffix])])])}})},details:S?A=>{var O;return I(ot,null,[(O=o.details)==null?void 0:O.call(o,A),k&&I(ot,null,[I("span",null,null),I(bR,{active:t.persistentCounter||i.value,value:c.value,max:u.value},o.counter)])])}:void 0})}),ec({},f,p,m)}});const Oae=ye({renderless:Boolean,...st()},"VVirtualScrollItem"),Pae=Re()({name:"VVirtualScrollItem",inheritAttrs:!1,props:Oae(),emits:{"update:height":t=>!0},setup(t,e){let{attrs:n,emit:s,slots:o}=e;const{resizeRef:r,contentRect:i}=km(void 0,"border");ze(()=>{var a;return(a=i.value)==null?void 0:a.height},a=>{a!=null&&s("update:height",a)}),Ge(()=>{var a,l;return t.renderless?I(ot,null,[(a=o.default)==null?void 0:a.call(o,{itemRef:r})]):I("div",Ue({ref:r,class:["v-virtual-scroll__item",t.class],style:t.style},n),[(l=o.default)==null?void 0:l.call(o)])})}}),hk=-1,fk=1,Mae=ye({itemHeight:{type:[Number,String],default:48}},"virtual");function Lae(t,e,n){const s=He(0),o=He(t.itemHeight),r=M({get:()=>{var S;return parseInt((S=o.value)!=null?S:0,10)},set(S){o.value=S}}),i=_e(),{resizeRef:a,contentRect:l}=km();To(()=>{a.value=i.value});const c=EA(),u=new Map;let d=Array.from({length:e.value.length});const h=M(()=>{var C;const S=(!l.value||i.value===document.documentElement?c.height.value:l.value.height)-((C=n==null?void 0:n.value)!=null?C:0);return Math.ceil(S/r.value*1.7+1)});function f(S,C){r.value=Math.max(r.value,C),d[S]=C,u.set(e.value[S],C)}function p(S){return d.slice(0,S).reduce((C,$)=>C+($||r.value),0)}function m(S){const C=e.value.length;let $=0,T=0;for(;T<S&&$<C;)T+=d[$++]||r.value;return $-1}let g=0;function v(){if(!i.value||!l.value)return;const S=l.value.height-56,C=i.value.scrollTop,$=C<g?hk:fk,T=m(C+S/2),E=Math.round(h.value/3),_=T-E,A=s.value+E*2-1;$===hk&&T<=A?s.value=Tr(_,0,e.value.length):$===fk&&T>=A&&(s.value=Tr(_,0,e.value.length-h.value)),g=C}function b(S){if(!i.value)return;const C=p(S);i.value.scrollTop=C}const y=M(()=>Math.min(e.value.length,s.value+h.value)),x=M(()=>e.value.slice(s.value,y.value).map((S,C)=>({raw:S,index:C+s.value}))),w=M(()=>p(s.value)),k=M(()=>p(e.value.length)-p(y.value));return ze(()=>e.value.length,()=>{d=gm(e.value.length).map(()=>r.value),u.forEach((S,C)=>{const $=e.value.indexOf(C);$===-1?u.delete(C):d[$]=S})}),{containerRef:i,computedItems:x,itemHeight:r,paddingTop:w,paddingBottom:k,scrollToIndex:b,handleScroll:v,handleItemResize:f}}const Bae=ye({items:{type:Array,default:()=>[]},renderless:Boolean,...Mae(),...st(),...Da()},"VVirtualScroll"),Vae=Re()({name:"VVirtualScroll",props:Bae(),setup(t,e){let{slots:n}=e;const s=On("VVirtualScroll"),{dimensionStyles:o}=Fa(t),{containerRef:r,handleScroll:i,handleItemResize:a,scrollToIndex:l,paddingTop:c,paddingBottom:u,computedItems:d}=Lae(t,Pe(t,"items"));return fi(()=>t.renderless,()=>{ir(()=>{var h;r.value=cA(s.vnode.el,!0),(h=r.value)==null||h.addEventListener("scroll",i)}),ms(()=>{var h;(h=r.value)==null||h.removeEventListener("scroll",i)})}),Ge(()=>{const h=d.value.map(f=>I(Pae,{key:f.index,renderless:t.renderless,"onUpdate:height":p=>a(f.index,p)},{default:p=>{var m;return(m=n.default)==null?void 0:m.call(n,{item:f.raw,index:f.index,...p})}}));return t.renderless?I(ot,null,[I("div",{class:"v-virtual-scroll__spacer",style:{paddingTop:Fe(c.value)}},null),h,I("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:Fe(u.value)}},null)]):I("div",{ref:r,class:["v-virtual-scroll",t.class],onScroll:i,style:[o.value,t.style]},[I("div",{class:"v-virtual-scroll__container",style:{paddingTop:Fe(c.value),paddingBottom:Fe(u.value)}},[h])])}),{scrollToIndex:l}}});function zae(t,e){const n=He(!1);let s;function o(a){cancelAnimationFrame(s),n.value=!0,s=requestAnimationFrame(()=>{s=requestAnimationFrame(()=>{n.value=!1})})}async function r(){await new Promise(a=>requestAnimationFrame(a)),await new Promise(a=>requestAnimationFrame(a)),await new Promise(a=>requestAnimationFrame(a)),await new Promise(a=>{if(n.value){const l=ze(n,()=>{l(),a()})}else a()})}async function i(a){var u,d;if(a.key==="Tab"&&((u=e.value)==null||u.focus()),!["PageDown","PageUp","Home","End"].includes(a.key))return;const l=(d=t.value)==null?void 0:d.$el;if(!l)return;(a.key==="Home"||a.key==="End")&&l.scrollTo({top:a.key==="Home"?0:l.scrollHeight,behavior:"smooth"}),await r();const c=l.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if(a.key==="PageDown"||a.key==="Home"){const h=l.getBoundingClientRect().top;for(const f of c)if(f.getBoundingClientRect().top>=h){f.focus();break}}else{const h=l.getBoundingClientRect().bottom;for(const f of[...c].reverse())if(f.getBoundingClientRect().bottom<=h){f.focus();break}}}return{onListScroll:o,onListKeydown:i}}const Wae=ye({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,menu:Boolean,menuIcon:{type:$t,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...mR({itemChildren:!1})},"Select"),Uae=ye({...Wae(),..._d(xR({modelValue:null,role:"button"}),["validationValue","dirty","appendInnerIcon"]),...Dd({transition:{component:T0}})},"VSelect"),hg=Re()({name:"VSelect",props:Uae(),emits:{"update:focused":t=>!0,"update:modelValue":t=>!0,"update:menu":t=>!0},setup(t,e){let{slots:n}=e;const{t:s}=x0(),o=_e(),r=_e(),i=_e(),a=Mt(t,"menu"),l=M({get:()=>a.value,set:F=>{var V;a.value&&!F&&((V=r.value)==null?void 0:V.\u03A8openChildren)||(a.value=F)}}),{items:c,transformIn:u,transformOut:d}=Iae(t),h=Mt(t,"modelValue",[],F=>u(F===null?[null]:ri(F)),F=>{var D;const V=d(F);return t.multiple?V:(D=V[0])!=null?D:null}),f=jA(),p=M(()=>h.value.map(F=>F.value)),m=He(!1),g=M(()=>l.value?t.closeText:t.openText);let v="",b;const y=M(()=>t.hideSelected?c.value.filter(F=>!h.value.some(V=>V===F)):c.value),x=M(()=>t.hideNoData&&!c.value.length||t.readonly||(f==null?void 0:f.isReadonly.value)),w=_e(),{onListScroll:k,onListKeydown:S}=zae(w,o);function C(F){t.openOnClear&&(l.value=!0)}function $(){x.value||(l.value=!l.value)}function T(F){var X,te;if(!F.key||t.readonly||(f==null?void 0:f.isReadonly.value))return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(F.key)&&F.preventDefault(),["Enter","ArrowDown"," "].includes(F.key)&&(l.value=!0),["Escape","Tab"].includes(F.key)&&(l.value=!1),F.key==="Home"?(X=w.value)==null||X.focus("first"):F.key==="End"&&((te=w.value)==null||te.focus("last"));const V=1e3;function D(ie){const ue=ie.key.length===1,ce=!ie.ctrlKey&&!ie.metaKey&&!ie.altKey;return ue&&ce}if(t.multiple||!D(F))return;const U=performance.now();U-b>V&&(v=""),v+=F.key.toLowerCase(),b=U;const J=c.value.find(ie=>ie.title.toLowerCase().startsWith(v));J!==void 0&&(h.value=[J])}function E(F){if(t.multiple){const V=h.value.findIndex(D=>t.valueComparator(D.value,F.value));if(V===-1)h.value=[...h.value,F];else{const D=[...h.value];D.splice(V,1),h.value=D}}else h.value=[F],l.value=!1}function _(F){var V;(V=w.value)!=null&&V.$el.contains(F.relatedTarget)||(l.value=!1)}function A(){var F;m.value&&((F=o.value)==null||F.focus())}function O(F){m.value=!0}function B(F){if(F==null)h.value=[];else if(df(o.value,":autofill")||df(o.value,":-webkit-autofill")){const V=c.value.find(D=>D.title===F);V&&E(V)}else o.value&&(o.value.value="")}return ze(l,()=>{if(!t.hideSelected&&l.value&&h.value.length){const F=y.value.findIndex(V=>h.value.some(D=>t.valueComparator(D.value,V.value)));zt&&window.requestAnimationFrame(()=>{var V;F>=0&&((V=i.value)==null||V.scrollToIndex(F))})}}),Ge(()=>{const F=!!(t.chips||n.chip),V=!!(!t.hideNoData||y.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),D=h.value.length>0,[U]=ou.filterProps(t),J=D||!m.value&&t.label&&!t.persistentPlaceholder?void 0:t.placeholder;return I(ou,Ue({ref:o},U,{modelValue:h.value.map(X=>X.props.value).join(", "),"onUpdate:modelValue":B,focused:m.value,"onUpdate:focused":X=>m.value=X,validationValue:h.externalValue,counterValue:h.value.length,dirty:D,class:["v-select",{"v-select--active-menu":l.value,"v-select--chips":!!t.chips,[`v-select--${t.multiple?"multiple":"single"}`]:!0,"v-select--selected":h.value.length,"v-select--selection-slot":!!n.selection},t.class],style:t.style,inputmode:"none",placeholder:J,"onClick:clear":C,"onMousedown:control":$,onBlur:_,onKeydown:T,"aria-label":s(g.value),title:s(g.value)}),{...n,default:()=>I(ot,null,[I(R0,Ue({ref:r,modelValue:l.value,"onUpdate:modelValue":X=>l.value=X,activator:"parent",contentClass:"v-select__content",disabled:x.value,eager:t.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:t.transition,onAfterLeave:A},t.menuProps),{default:()=>{var X;return[V&&I(_ae,{ref:w,selected:p.value,selectStrategy:t.multiple?"independent":"single-independent",onMousedown:te=>te.preventDefault(),onKeydown:S,onFocusin:O,onScrollPassive:k,tabindex:"-1",color:(X=t.itemColor)!=null?X:t.color},{default:()=>{var te,ie,ue,ce;return[(te=n["prepend-item"])==null?void 0:te.call(n),!y.value.length&&!t.hideNoData&&((ue=(ie=n["no-data"])==null?void 0:ie.call(n))!=null?ue:I(xf,{title:s(t.noDataText)},null)),I(Vae,{ref:i,renderless:!0,items:y.value},{default:Y=>{var Ce,R;let{item:z,index:ae,itemRef:re}=Y;const he=Ue(z.props,{ref:re,key:ae,onClick:()=>E(z)});return(R=(Ce=n.item)==null?void 0:Ce.call(n,{item:z,index:ae,props:he}))!=null?R:I(xf,he,{prepend:P=>{let{isSelected:j}=P;return I(ot,null,[t.multiple&&!t.hideSelected?I(oae,{key:z.value,modelValue:j,ripple:!1,tabindex:"-1"},null):void 0,z.props.prependIcon&&I(on,{icon:z.props.prependIcon},null)])}})}}),(ce=n["append-item"])==null?void 0:ce.call(n)]}})]}}),h.value.map((X,te)=>{var ce,Y;function ie(z){z.stopPropagation(),z.preventDefault(),E(X)}const ue={"onClick:close":ie,onMousedown(z){z.preventDefault(),z.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0};return I("div",{key:X.value,class:"v-select__selection"},[F?n.chip?I(pn,{key:"chip-defaults",defaults:{VChip:{closable:t.closableChips,size:"small",text:X.title}}},{default:()=>{var z;return[(z=n.chip)==null?void 0:z.call(n,{item:X,index:te,props:ue})]}}):I(aR,Ue({key:"chip",closable:t.closableChips,size:"small",text:X.title,disabled:X.props.disabled},ue),null):(Y=(ce=n.selection)==null?void 0:ce.call(n,{item:X,index:te}))!=null?Y:I("span",{class:"v-select__selection-text"},[X.title,t.multiple&&te<h.value.length-1&&I("span",{class:"v-select__selection-comma"},[gt(",")])])])})]),"append-inner":function(){var ue;for(var X=arguments.length,te=new Array(X),ie=0;ie<X;ie++)te[ie]=arguments[ie];return I(ot,null,[(ue=n["append-inner"])==null?void 0:ue.call(n,...te),t.menuIcon?I(on,{class:"v-select__menu-icon",icon:t.menuIcon},null):void 0])}})}),ec({isFocused:m,menu:l,select:E},o)}});const M0=Symbol.for("vuetify:v-slider");function Gae(t,e,n){const s=n==="vertical",o=e.getBoundingClientRect(),r="touches"in t?t.touches[0]:t;return s?r.clientY-(o.top+o.height/2):r.clientX-(o.left+o.width/2)}function Hae(t,e){return"touches"in t&&t.touches.length?t.touches[0][e]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0][e]:t[e]}const jae=ye({disabled:{type:Boolean,default:null},error:Boolean,readonly:{type:Boolean,default:null},max:{type:[Number,String],default:100},min:{type:[Number,String],default:0},step:{type:[Number,String],default:0},thumbColor:String,thumbLabel:{type:[Boolean,String],default:void 0,validator:t=>typeof t=="boolean"||t==="always"},thumbSize:{type:[Number,String],default:20},showTicks:{type:[Boolean,String],default:!1,validator:t=>typeof t=="boolean"||t==="always"},ticks:{type:[Array,Object]},tickSize:{type:[Number,String],default:2},color:String,trackColor:String,trackFillColor:String,trackSize:{type:[Number,String],default:4},direction:{type:String,default:"horizontal",validator:t=>["vertical","horizontal"].includes(t)},reverse:Boolean,..._o(),...Ti({elevation:2})},"Slider"),Kae=t=>{const e=M(()=>parseFloat(t.min)),n=M(()=>parseFloat(t.max)),s=M(()=>+t.step>0?parseFloat(t.step):0),o=M(()=>Math.max(SC(s.value),SC(e.value)));function r(i){if(i=parseFloat(i),s.value<=0)return i;const a=Tr(i,e.value,n.value),l=e.value%s.value,c=Math.round((a-l)/s.value)*s.value+l;return parseFloat(Math.min(c,n.value).toFixed(o.value))}return{min:e,max:n,step:s,decimals:o,roundValue:r}},qae=t=>{let{props:e,steps:n,onSliderStart:s,onSliderMove:o,onSliderEnd:r,getActiveThumb:i}=t;const{isRtl:a}=Ro(),l=Pe(e,"reverse"),c=M(()=>e.direction==="vertical"),u=M(()=>c.value!==l.value),{min:d,max:h,step:f,decimals:p,roundValue:m}=n,g=M(()=>parseInt(e.thumbSize,10)),v=M(()=>parseInt(e.tickSize,10)),b=M(()=>parseInt(e.trackSize,10)),y=M(()=>(h.value-d.value)/f.value),x=Pe(e,"disabled"),w=M(()=>{var Y;return e.error||e.disabled?void 0:(Y=e.thumbColor)!=null?Y:e.color}),k=M(()=>{var Y;return e.error||e.disabled?void 0:(Y=e.trackColor)!=null?Y:e.color}),S=M(()=>{var Y;return e.error||e.disabled?void 0:(Y=e.trackFillColor)!=null?Y:e.color}),C=He(!1),$=He(0),T=_e(),E=_e();function _(Y){var ee;const z=e.direction==="vertical",ae=z?"top":"left",re=z?"height":"width",he=z?"clientY":"clientX",{[ae]:Ce,[re]:R}=(ee=T.value)==null?void 0:ee.$el.getBoundingClientRect(),P=Hae(Y,he);let j=Math.min(Math.max((P-Ce-$.value)/R,0),1)||0;return(z?u.value:u.value!==a.value)&&(j=1-j),m(d.value+j*(h.value-d.value))}const A=Y=>{r({value:_(Y)}),C.value=!1,$.value=0},O=Y=>{E.value=i(Y),E.value&&(E.value.focus(),C.value=!0,E.value.contains(Y.target)?$.value=Gae(Y,E.value,e.direction):($.value=0,o({value:_(Y)})),s({value:_(Y)}))},B={passive:!0,capture:!0};function F(Y){o({value:_(Y)})}function V(Y){Y.stopPropagation(),Y.preventDefault(),A(Y),window.removeEventListener("mousemove",F,B),window.removeEventListener("mouseup",V)}function D(Y){var z;A(Y),window.removeEventListener("touchmove",F,B),(z=Y.target)==null||z.removeEventListener("touchend",D)}function U(Y){var z;O(Y),window.addEventListener("touchmove",F,B),(z=Y.target)==null||z.addEventListener("touchend",D,{passive:!1})}function J(Y){Y.preventDefault(),O(Y),window.addEventListener("mousemove",F,B),window.addEventListener("mouseup",V,{passive:!1})}const X=Y=>{const z=(Y-d.value)/(h.value-d.value)*100;return Tr(isNaN(z)?0:z,0,100)},te=Pe(e,"showTicks"),ie=M(()=>te.value?e.ticks?Array.isArray(e.ticks)?e.ticks.map(Y=>({value:Y,position:X(Y),label:Y.toString()})):Object.keys(e.ticks).map(Y=>({value:parseFloat(Y),position:X(parseFloat(Y)),label:e.ticks[Y]})):y.value!==1/0?gm(y.value+1).map(Y=>{const z=d.value+Y*f.value;return{value:z,position:X(z)}}):[]:[]),ue=M(()=>ie.value.some(Y=>{let{label:z}=Y;return!!z})),ce={activeThumbRef:E,color:Pe(e,"color"),decimals:p,disabled:x,direction:Pe(e,"direction"),elevation:Pe(e,"elevation"),hasLabels:ue,isReversed:l,indexFromEnd:u,min:d,max:h,mousePressed:C,numTicks:y,onSliderMousedown:J,onSliderTouchstart:U,parsedTicks:ie,parseMouseMove:_,position:X,readonly:Pe(e,"readonly"),rounded:Pe(e,"rounded"),roundValue:m,showTicks:te,startOffset:$,step:f,thumbSize:g,thumbColor:w,thumbLabel:Pe(e,"thumbLabel"),ticks:Pe(e,"ticks"),tickSize:v,trackColor:k,trackContainerRef:T,trackFillColor:S,trackSize:b,vertical:c};return vn(M0,ce),ce},Xae=ye({focused:Boolean,max:{type:Number,required:!0},min:{type:Number,required:!0},modelValue:{type:Number,required:!0},position:{type:Number,required:!0},ripple:{type:[Boolean,Object],default:!0},...st()},"VSliderThumb"),Yae=Re()({name:"VSliderThumb",directives:{Ripple:Jl},props:Xae(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n,emit:s}=e;const o=vt(M0),{isRtl:r,rtlClasses:i}=Ro();if(!o)throw new Error("[Vuetify] v-slider-thumb must be used inside v-slider or v-range-slider");const{thumbColor:a,step:l,disabled:c,thumbSize:u,thumbLabel:d,direction:h,isReversed:f,vertical:p,readonly:m,elevation:g,mousePressed:v,decimals:b,indexFromEnd:y}=o,{textColorClasses:x,textColorStyles:w}=rr(a),{pageup:k,pagedown:S,end:C,home:$,left:T,right:E,down:_,up:A}=Doe,O=[k,S,C,$,T,E,_,A],B=M(()=>l.value?[1,2,3]:[1,5,10]);function F(D,U){if(!O.includes(D.key))return;D.preventDefault();const J=l.value||.1,X=(t.max-t.min)/J;if([T,E,_,A].includes(D.key)){const ie=(p.value?[r.value?T:E,f.value?_:A]:y.value!==r.value?[T,A]:[E,A]).includes(D.key)?1:-1,ue=D.shiftKey?2:D.ctrlKey?1:0;U=U+ie*J*B.value[ue]}else if(D.key===$)U=t.min;else if(D.key===C)U=t.max;else{const te=D.key===S?1:-1;U=U-te*J*(X>100?X/10:10)}return Math.max(t.min,Math.min(t.max,U))}function V(D){const U=F(D,t.modelValue);U!=null&&s("update:modelValue",U)}return Ge(()=>{const D=Fe(y.value?100-t.position:t.position,"%"),{elevationClasses:U}=Ni(M(()=>c.value?void 0:g.value));return I("div",{class:["v-slider-thumb",{"v-slider-thumb--focused":t.focused,"v-slider-thumb--pressed":t.focused&&v.value},t.class,i.value],style:[{"--v-slider-thumb-position":D,"--v-slider-thumb-size":Fe(u.value)},t.style],role:"slider",tabindex:c.value?-1:0,"aria-valuemin":t.min,"aria-valuemax":t.max,"aria-valuenow":t.modelValue,"aria-readonly":!!m.value,"aria-orientation":h.value,onKeydown:m.value?void 0:V},[I("div",{class:["v-slider-thumb__surface",x.value,U.value],style:{...w.value}},null),$n(I("div",{class:["v-slider-thumb__ripple",x.value],style:w.value},null),[[ar("ripple"),t.ripple,null,{circle:!0,center:!0}]]),I(WA,{origin:"bottom center"},{default:()=>{var J,X;return[$n(I("div",{class:"v-slider-thumb__label-container"},[I("div",{class:["v-slider-thumb__label"]},[I("div",null,[(X=(J=n["thumb-label"])==null?void 0:J.call(n,{modelValue:t.modelValue}))!=null?X:t.modelValue.toFixed(l.value?b.value:1)])])]),[[mi,d.value&&t.focused||d.value==="always"]])]}})])}),{}}});const Zae=ye({start:{type:Number,required:!0},stop:{type:Number,required:!0},...st()},"VSliderTrack"),Qae=Re()({name:"VSliderTrack",props:Zae(),emits:{},setup(t,e){let{slots:n}=e;const s=vt(M0);if(!s)throw new Error("[Vuetify] v-slider-track must be inside v-slider or v-range-slider");const{color:o,parsedTicks:r,rounded:i,showTicks:a,tickSize:l,trackColor:c,trackFillColor:u,trackSize:d,vertical:h,min:f,max:p,indexFromEnd:m}=s,{roundedClasses:g}=Ao(i),{backgroundColorClasses:v,backgroundColorStyles:b}=Nr(u),{backgroundColorClasses:y,backgroundColorStyles:x}=Nr(c),w=M(()=>`inset-${h.value?"block":"inline"}-${m.value?"end":"start"}`),k=M(()=>h.value?"height":"width"),S=M(()=>({[w.value]:"0%",[k.value]:"100%"})),C=M(()=>t.stop-t.start),$=M(()=>({[w.value]:Fe(t.start,"%"),[k.value]:Fe(C.value,"%")})),T=M(()=>a.value?(h.value?r.value.slice().reverse():r.value).map((_,A)=>{var B,F;const O=_.value!==f.value&&_.value!==p.value?Fe(_.position,"%"):void 0;return I("div",{key:_.value,class:["v-slider-track__tick",{"v-slider-track__tick--filled":_.position>=t.start&&_.position<=t.stop,"v-slider-track__tick--first":_.value===f.value,"v-slider-track__tick--last":_.value===p.value}],style:{[w.value]:O}},[(_.label||n["tick-label"])&&I("div",{class:"v-slider-track__tick-label"},[(F=(B=n["tick-label"])==null?void 0:B.call(n,{tick:_,index:A}))!=null?F:_.label])])}):[]);return Ge(()=>I("div",{class:["v-slider-track",g.value,t.class],style:[{"--v-slider-track-size":Fe(d.value),"--v-slider-tick-size":Fe(l.value)},t.style]},[I("div",{class:["v-slider-track__background",y.value,{"v-slider-track__background--opacity":!!o.value||!u.value}],style:{...S.value,...x.value}},null),I("div",{class:["v-slider-track__fill",v.value],style:{...$.value,...b.value}},null),a.value&&I("div",{class:["v-slider-track__ticks",{"v-slider-track__ticks--always-show":a.value==="always"}]},[T.value])])),{}}}),Jae=ye({...E0(),...jae(),...Bd(),modelValue:{type:[Number,String],default:0}},"VSlider"),pk=Re()({name:"VSlider",props:Jae(),emits:{"update:focused":t=>!0,"update:modelValue":t=>!0,start:t=>!0,end:t=>!0},setup(t,e){let{slots:n,emit:s}=e;const o=_e(),{rtlClasses:r}=Ro(),i=Kae(t),a=Mt(t,"modelValue",void 0,k=>i.roundValue(k==null?i.min.value:k)),{min:l,max:c,mousePressed:u,roundValue:d,onSliderMousedown:h,onSliderTouchstart:f,trackContainerRef:p,position:m,hasLabels:g,readonly:v}=qae({props:t,steps:i,onSliderStart:()=>{s("start",a.value)},onSliderEnd:k=>{let{value:S}=k;const C=d(S);a.value=C,s("end",C)},onSliderMove:k=>{let{value:S}=k;return a.value=d(S)},getActiveThumb:()=>{var k;return(k=o.value)==null?void 0:k.$el}}),{isFocused:b,focus:y,blur:x}=Ld(t),w=M(()=>m(a.value));return Ge(()=>{const[k,S]=pi.filterProps(t),C=!!(t.label||n.label||n.prepend);return I(pi,Ue({class:["v-slider",{"v-slider--has-labels":!!n["tick-label"]||g.value,"v-slider--focused":b.value,"v-slider--pressed":u.value,"v-slider--disabled":t.disabled},r.value,t.class],style:t.style},k,{focused:b.value}),{...n,prepend:C?$=>{var T,E,_;return I(ot,null,[(E=(T=n.label)==null?void 0:T.call(n,$))!=null?E:t.label?I(_0,{id:$.id.value,class:"v-slider__label",text:t.label},null):void 0,(_=n.prepend)==null?void 0:_.call(n,$)])}:void 0,default:$=>{let{id:T,messagesId:E}=$;return I("div",{class:"v-slider__container",onMousedown:v.value?void 0:h,onTouchstartPassive:v.value?void 0:f},[I("input",{id:T.value,name:t.name||T.value,disabled:!!t.disabled,readonly:!!t.readonly,tabindex:"-1",value:a.value},null),I(Qae,{ref:p,start:0,stop:w.value},{"tick-label":n["tick-label"]}),I(Yae,{ref:o,"aria-describedby":E.value,focused:b.value,min:l.value,max:c.value,modelValue:a.value,"onUpdate:modelValue":_=>a.value=_,position:w.value,elevation:t.elevation,onFocus:y,onBlur:x},{"thumb-label":n["thumb-label"]})])}})}),{}}}),ele=["src"],tle={key:0},nle=Ct("p",{class:"mb-2"},"Automatisch spielen f\xFCr:",-1),sle=["src"],ole=["src"],rle=Ct("p",{class:"mb-2"},"Neuronale Elemente anzeigen:",-1),ile={class:"ml-3"};function ale(t,e,n,s,o,r){const i=Ln("ChooseTheme");return We(),ht(Ds,{"min-height":"200px"},{default:pe(()=>[I(so,{class:"text-h3 pt-6 pb-2"},{default:pe(()=>[gt("Einstellungen")]),_:1}),I(Io,null,{default:pe(()=>[I(Zre,null,{default:pe(()=>[I(Md,null,{default:pe(()=>[I(tn,{cols:"12",sm:"6"},{default:pe(()=>[I(hg,{modelValue:t.settings.playModelName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.settings.playModelName=a),items:t.playModelNames,label:"Neuronales Modell"},null,8,["modelValue","items"])]),_:1}),I(tn,{cols:"12",sm:"6"},{default:pe(()=>[t.settings.show.evaluation?(We(),ht(hg,{key:0,modelValue:t.settings.evaluationModelName,"onUpdate:modelValue":e[1]||(e[1]=a=>t.settings.evaluationModelName=a),items:t.evaluationModelNames,label:"Modell zur Evaluierung"},null,8,["modelValue","items"])):Cn("",!0)]),_:1}),I(tn,{cols:"12",sm:"6"},{default:pe(()=>[t.settings.show.autoencoder?(We(),ht(hg,{key:0,modelValue:t.settings.autoencoderModelName,"onUpdate:modelValue":e[2]||(e[2]=a=>t.settings.autoencoderModelName=a),items:t.autoencoderModelNames,label:"Modell zum Autoenkodieren"},null,8,["modelValue","items"])):Cn("",!0)]),_:1}),I(tn,{cols:"12"},{default:pe(()=>[I(R0,{modelValue:t.pieceThemeMenu,"onUpdate:modelValue":e[3]||(e[3]=a=>t.pieceThemeMenu=a),"close-on-content-click":!1},{activator:pe(({props:a})=>[I(us,Ue(a,{class:"mr-4",color:"primary",icon:"",size:"x-large"}),{default:pe(()=>[Ct("img",{src:r.loadPiece("wN"),class:"button-piece"},null,8,ele)]),_:2},1040)]),default:pe(()=>[I(i,{onSelect:r.selectTheme,oldTheme:t.settings.theme},null,8,["onSelect","oldTheme"])]),_:1},8,["modelValue"]),Ct("span",null,[gt("von "+ts(r.license.by)+" ",1),r.license.license?(We(),es("span",tle,", lizenziert unter "+ts(r.license.license),1)):Cn("",!0)])]),_:1}),I(tn,{cols:"12",md:"5"},{default:pe(()=>[nle,I(us,{onClick:e[4]||(e[4]=a=>r.autoPlay("white")),color:t.settings.autoPlay.white?"primary":null,class:"mr-4",icon:"",size:"x-large"},{default:pe(()=>[Ct("img",{src:r.loadPiece("wK"),class:"button-piece"},null,8,sle)]),_:1},8,["color"]),I(us,{onClick:e[5]||(e[5]=a=>r.autoPlay("black")),color:t.settings.autoPlay.black?"primary":null,icon:"",size:"x-large"},{default:pe(()=>[Ct("img",{src:r.loadPiece("bK"),class:"button-piece"},null,8,ole)]),_:1},8,["color"])]),_:1}),I(tn,{cols:"12",md:"7"},{default:pe(()=>[rle,(We(!0),es(ot,null,Mf([["neuralOutput","ausgabe","Zeige die Z\xFCge an, die das neuronale Netzwerk in der aktuellen Situation spielen w\xFCrde."],["capturedPieces","material","Zeige den Materialunterschied an \u2013 welche Seite mehr Figuren hat"],["evaluation","evaluierung","Ein weiteres neuronales Netzwerk zeigt die aktuelle Bewertung des Spielfelds an."],["continuation","fortsetzung","Wie w\xFCrde das aktuell ausgew\xE4hlte neuronale Netzwerk diese Partie f\xFCr beide Seiten weiter spielen?"],["infoboxes","infofelder","Zeige \xFCberall verstreut ein paar Informationen an, so \xE4hnlich wie diese hier."],["autoencoder","autoenkodierung","Zeige an, wie das Brett von einem neuronalen Netzwerk automatisch en- und wieder dekodiert wird."]],([a,l,c])=>(We(),es("span",{key:a},[I(us,{color:t.settings.show[a]?"primary":null,onClick:u=>t.settings.show[a]=!t.settings.show[a],class:"mr-4 mb-4"},{default:pe(()=>[Ct("span",null,ts(l),1),Ct("span",ile,[I(Nl,{text:c,"max-width":"250px"},{activator:pe(({props:u})=>[I(on,Ue({onClick:e[6]||(e[6]=Cb(()=>{},["stop"]))},u),{default:pe(()=>[gt("mdi-information")]),_:2},1040)]),_:2},1032,["text"])])]),_:2},1032,["color","onClick"])]))),128))]),_:1}),I(tn,{cols:"12"},{default:pe(()=>[I(pk,{modelValue:t.settings.temperature,"onUpdate:modelValue":e[8]||(e[8]=a=>t.settings.temperature=a),min:0,max:1,step:.025,"thumb-label":"",label:"Temperatur"},{append:pe(()=>[I(ou,{modelValue:t.settings.temperature,"onUpdate:modelValue":e[7]||(e[7]=a=>t.settings.temperature=a),"hide-details":"","single-line":"",disabled:"",density:"compact",type:"number",style:{width:"90px"}},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),I(tn,{cols:"12",md:"6"},{default:pe(()=>[t.settings.show.neuralOutput?(We(),ht(_v,{key:0,disabled:!t.settings.show.neuralOutput,modelValue:t.settings.onlyShowLegalMoves,"onUpdate:modelValue":e[9]||(e[9]=a=>t.settings.onlyShowLegalMoves=a),color:"primary",label:"Nur legale Z\xFCge anzeigen",density:"compact"},null,8,["disabled","modelValue"])):Cn("",!0)]),_:1}),I(tn,{cols:"12",md:"6"},{default:pe(()=>[t.settings.show.neuralOutput?(We(),ht(_v,{key:0,disabled:!t.settings.show.neuralOutput,modelValue:t.settings.showActivation,"onUpdate:modelValue":e[10]||(e[10]=a=>t.settings.showActivation=a),color:"primary",label:"Neuronale Aktivierung zeigen",density:"compact"},null,8,["disabled","modelValue"])):Cn("",!0)]),_:1}),I(tn,{cols:"12"},{default:pe(()=>[t.settings.show.neuralOutput?(We(),ht(pk,{key:0,disabled:!t.settings.show.neuralOutput,modelValue:t.settings.maxMoves,"onUpdate:modelValue":e[12]||(e[12]=a=>t.settings.maxMoves=a),min:1,max:20,step:1,"thumb-label":"",label:"Maximale angezeigte Z\xFCge"},{append:pe(()=>[I(ou,{modelValue:t.settings.maxMoves,"onUpdate:modelValue":e[11]||(e[11]=a=>t.settings.maxMoves=a),"hide-details":"","single-line":"",density:"compact",type:"number",style:{width:"70px"}},null,8,["modelValue"])]),_:1},8,["disabled","modelValue"])):Cn("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),I(nu),I(v0,null,{default:pe(()=>[I(us,{onClick:r.reset},{default:pe(()=>[gt("Zur\xFCcksetzen")]),_:1},8,["onClick"]),I(nu),I(us,{onClick:e[13]||(e[13]=a=>t.$emit("cancel"))},{default:pe(()=>[gt("Abbrechen")]),_:1}),I(us,{onClick:r.save,variant:"tonal",color:"primary"},{default:pe(()=>[gt("Speichern")]),_:1},8,["onClick"])]),_:1})]),_:1})}const lle=ks(Yie,[["render",ale]]),cle={name:"App",components:{SettingsDialog:lle},data:()=>({dialog:!1,mainKey:0}),methods:{cancel(){this.dialog=!1},save(){this.mainKey++,this.dialog=!1}},mounted(){const t=[["#872A97","#3F51B5"],["#EEAB3B","#F44336"],["#3F51B5","#872A97"]],e=t[Math.floor(Math.random()*t.length)];this.$refs["app-bar"].$el.style.background=`linear-gradient(to right, ${e[0]}, ${e[1]})`}};const wf=Symbol.for("vuetify:layout"),wR=Symbol.for("vuetify:layout-item"),mk=1e3,ule=ye({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),dle=ye({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function hle(){const t=vt(wf);if(!t)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:t.getLayoutItem,mainRect:t.mainRect,mainStyles:t.mainStyles}}function fle(t){var a;const e=vt(wf);if(!e)throw new Error("[Vuetify] Could not find injected layout");const n=(a=t.id)!=null?a:`layout-item-${Ps()}`,s=On("useLayoutItem");vn(wR,{id:n});const o=He(!1);AS(()=>o.value=!0),_S(()=>o.value=!1);const{layoutItemStyles:r,layoutItemScrimStyles:i}=e.register(s,{...t,active:M(()=>o.value?!1:t.active.value),id:n});return oo(()=>e.unregister(n)),{layoutItemStyles:r,layoutRect:e.layoutRect,layoutItemScrimStyles:i}}const ple=(t,e,n,s)=>{let o={top:0,left:0,right:0,bottom:0};const r=[{id:"",layer:{...o}}];for(const i of t){const a=e.get(i),l=n.get(i),c=s.get(i);if(!a||!l||!c)continue;const u={...o,[a.value]:parseInt(o[a.value],10)+(c.value?parseInt(l.value,10):0)};r.push({id:i,layer:u}),o=u}return r};function mle(t){const e=vt(wf,null),n=M(()=>e?e.rootZIndex.value-100:mk),s=_e([]),o=Jn(new Map),r=Jn(new Map),i=Jn(new Map),a=Jn(new Map),l=Jn(new Map),{resizeRef:c,contentRect:u}=km(),d=M(()=>{var C;const k=new Map,S=(C=t.overlaps)!=null?C:[];for(const $ of S.filter(T=>T.includes(":"))){const[T,E]=$.split(":");if(!s.value.includes(T)||!s.value.includes(E))continue;const _=o.get(T),A=o.get(E),O=r.get(T),B=r.get(E);!_||!A||!O||!B||(k.set(E,{position:_.value,amount:parseInt(O.value,10)}),k.set(T,{position:A.value,amount:-parseInt(B.value,10)}))}return k}),h=M(()=>{const k=[...new Set([...i.values()].map(C=>C.value))].sort((C,$)=>C-$),S=[];for(const C of k){const $=s.value.filter(T=>{var E;return((E=i.get(T))==null?void 0:E.value)===C});S.push(...$)}return ple(S,o,r,a)}),f=M(()=>!Array.from(l.values()).some(k=>k.value)),p=M(()=>h.value[h.value.length-1].layer),m=M(()=>({"--v-layout-left":Fe(p.value.left),"--v-layout-right":Fe(p.value.right),"--v-layout-top":Fe(p.value.top),"--v-layout-bottom":Fe(p.value.bottom),...f.value?void 0:{transition:"none"}})),g=M(()=>h.value.slice(1).map((k,S)=>{let{id:C}=k;const{layer:$}=h.value[S],T=r.get(C),E=o.get(C);return{id:C,...$,size:Number(T.value),position:E.value}})),v=k=>g.value.find(S=>S.id===k),b=On("createLayout"),y=He(!1);ir(()=>{y.value=!0}),vn(wf,{register:(k,S)=>{let{id:C,order:$,position:T,layoutSize:E,elementSize:_,active:A,disableTransitions:O,absolute:B}=S;i.set(C,$),o.set(C,T),r.set(C,E),a.set(C,A),O&&l.set(C,O);const V=Nc(wR,b==null?void 0:b.vnode).indexOf(k);V>-1?s.value.splice(V,0,C):s.value.push(C);const D=M(()=>g.value.findIndex(te=>te.id===C)),U=M(()=>n.value+h.value.length*2-D.value*2),J=M(()=>{const te=T.value==="left"||T.value==="right",ie=T.value==="right",ue=T.value==="bottom",ce={[T.value]:0,zIndex:U.value,transform:`translate${te?"X":"Y"}(${(A.value?0:-110)*(ie||ue?-1:1)}%)`,position:B.value||n.value!==mk?"absolute":"fixed",...f.value?void 0:{transition:"none"}};if(!y.value)return ce;const Y=g.value[D.value];if(!Y)throw new Error(`[Vuetify] Could not find layout item "${C}"`);const z=d.value.get(C);return z&&(Y[z.position]+=z.amount),{...ce,height:te?`calc(100% - ${Y.top}px - ${Y.bottom}px)`:_.value?`${_.value}px`:void 0,left:ie?void 0:`${Y.left}px`,right:ie?`${Y.right}px`:void 0,top:T.value!=="bottom"?`${Y.top}px`:void 0,bottom:T.value!=="top"?`${Y.bottom}px`:void 0,width:te?_.value?`${_.value}px`:void 0:`calc(100% - ${Y.left}px - ${Y.right}px)`}}),X=M(()=>({zIndex:U.value-1}));return{layoutItemStyles:J,layoutItemScrimStyles:X,zIndex:U}},unregister:k=>{i.delete(k),o.delete(k),r.delete(k),a.delete(k),l.delete(k),s.value=s.value.filter(S=>S!==k)},mainRect:p,mainStyles:m,getLayoutItem:v,items:g,layoutRect:u,rootZIndex:n});const x=M(()=>["v-layout",{"v-layout--full-height":t.fullHeight}]),w=M(()=>({zIndex:e?n.value:void 0,position:e?"relative":void 0,overflow:e?"hidden":void 0}));return{layoutClasses:x,layoutStyles:w,getLayoutItem:v,items:g,layoutRect:u,layoutRef:c}}const gle=ye({...st(),...ule({fullHeight:!0}),..._n()},"VApp"),vle=Re()({name:"VApp",props:gle(),setup(t,e){let{slots:n}=e;const s=jn(t),{layoutClasses:o,getLayoutItem:r,items:i,layoutRef:a}=mle(t),{rtlClasses:l}=Ro();return Ge(()=>{var c;return I("div",{ref:a,class:["v-application",s.themeClasses.value,o.value,l.value,t.class],style:[t.style]},[I("div",{class:"v-application__wrap"},[(c=n.default)==null?void 0:c.call(n)])])}),{getLayoutItem:r,items:i,theme:s}}});const CR=ye({text:String,...st(),...yn()},"VToolbarTitle"),kR=Re()({name:"VToolbarTitle",props:CR(),setup(t,e){let{slots:n}=e;return Ge(()=>{const s=!!(n.default||n.text||t.text);return I(t.tag,{class:["v-toolbar-title",t.class],style:t.style},{default:()=>{var o;return[s&&I("div",{class:"v-toolbar-title__placeholder"},[n.text?n.text():t.text,(o=n.default)==null?void 0:o.call(n)])]}})}),{}}}),ble=[null,"prominent","default","comfortable","compact"],SR=ye({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:t=>ble.includes(t)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...Oa(),...st(),...Ti(),..._o(),...yn({tag:"header"}),..._n()},"VToolbar"),gk=Re()({name:"VToolbar",props:SR(),setup(t,e){var f;let{slots:n}=e;const{backgroundColorClasses:s,backgroundColorStyles:o}=Nr(Pe(t,"color")),{borderClasses:r}=Pa(t),{elevationClasses:i}=Ni(t),{roundedClasses:a}=Ao(t),{themeClasses:l}=jn(t),{rtlClasses:c}=Ro(),u=He(!!(t.extended||((f=n.extension)==null?void 0:f.call(n)))),d=M(()=>parseInt(Number(t.height)+(t.density==="prominent"?Number(t.height):0)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0),10)),h=M(()=>u.value?parseInt(Number(t.extensionHeight)+(t.density==="prominent"?Number(t.extensionHeight):0)-(t.density==="comfortable"?4:0)-(t.density==="compact"?8:0),10):0);return Ra({VBtn:{variant:"text"}}),Ge(()=>{var v;const p=!!(t.title||n.title),m=!!(n.image||t.image),g=(v=n.extension)==null?void 0:v.call(n);return u.value=!!(t.extended||g),I(t.tag,{class:["v-toolbar",{"v-toolbar--absolute":t.absolute,"v-toolbar--collapse":t.collapse,"v-toolbar--flat":t.flat,"v-toolbar--floating":t.floating,[`v-toolbar--density-${t.density}`]:!0},s.value,r.value,i.value,a.value,l.value,c.value,t.class],style:[o.value,t.style]},{default:()=>[m&&I("div",{key:"image",class:"v-toolbar__image"},[n.image?I(pn,{key:"image-defaults",disabled:!t.image,defaults:{VImg:{cover:!0,src:t.image}}},n.image):I(Fd,{key:"image-img",cover:!0,src:t.image},null)]),I(pn,{defaults:{VTabs:{height:Fe(d.value)}}},{default:()=>{var b,y,x;return[I("div",{class:"v-toolbar__content",style:{height:Fe(d.value)}},[n.prepend&&I("div",{class:"v-toolbar__prepend"},[(b=n.prepend)==null?void 0:b.call(n)]),p&&I(kR,{key:"title",text:t.title},{text:n.title}),(y=n.default)==null?void 0:y.call(n),n.append&&I("div",{class:"v-toolbar__append"},[(x=n.append)==null?void 0:x.call(n)])])]}}),I(pn,{defaults:{VTabs:{height:Fe(h.value)}}},{default:()=>[I(UA,null,{default:()=>[u.value&&I("div",{class:"v-toolbar__extension",style:{height:Fe(h.value)}},[g])]})]})]})}),{contentHeight:d,extensionHeight:h}}}),yle=ye({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function xle(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:n}=e;let s=0;const o=_e(null),r=He(0),i=He(0),a=He(0),l=He(!1),c=He(!1),u=M(()=>Number(t.scrollThreshold)),d=M(()=>Tr((u.value-r.value)/u.value||0)),h=()=>{const f=o.value;!f||n&&!n.value||(s=r.value,r.value="window"in f?f.pageYOffset:f.scrollTop,c.value=r.value<s,a.value=Math.abs(r.value-u.value))};return ze(c,()=>{i.value=i.value||r.value}),ze(l,()=>{i.value=0}),ir(()=>{ze(()=>t.scrollTarget,f=>{var m;const p=f?document.querySelector(f):window;!p||p!==o.value&&((m=o.value)==null||m.removeEventListener("scroll",h),o.value=p,o.value.addEventListener("scroll",h,{passive:!0}))},{immediate:!0})}),oo(()=>{var f;(f=o.value)==null||f.removeEventListener("scroll",h)}),n&&ze(n,h,{immediate:!0}),{scrollThreshold:u,currentScroll:r,currentThreshold:a,isScrollActive:l,scrollRatio:d,isScrollingUp:c,savedScroll:i}}const wle=ye({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:t=>["top","bottom"].includes(t)},...SR(),...dle(),...yle(),height:{type:[Number,String],default:64}},"VAppBar"),Cle=Re()({name:"VAppBar",props:wle(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const s=_e(),o=Mt(t,"modelValue"),r=M(()=>{var b,y;const v=new Set((y=(b=t.scrollBehavior)==null?void 0:b.split(" "))!=null?y:[]);return{hide:v.has("hide"),inverted:v.has("inverted"),collapse:v.has("collapse"),elevate:v.has("elevate"),fadeImage:v.has("fade-image")}}),i=M(()=>{const v=r.value;return v.hide||v.inverted||v.collapse||v.elevate||v.fadeImage||!o.value}),{currentScroll:a,scrollThreshold:l,isScrollingUp:c,scrollRatio:u}=xle(t,{canScroll:i}),d=M(()=>t.collapse||r.value.collapse&&(r.value.inverted?u.value>0:u.value===0)),h=M(()=>t.flat||r.value.elevate&&(r.value.inverted?a.value>0:a.value===0)),f=M(()=>r.value.fadeImage?r.value.inverted?1-u.value:u.value:void 0),p=M(()=>{var y,x,w,k;if(r.value.hide&&r.value.inverted)return 0;const v=(x=(y=s.value)==null?void 0:y.contentHeight)!=null?x:0,b=(k=(w=s.value)==null?void 0:w.extensionHeight)!=null?k:0;return v+b});fi(M(()=>!!t.scrollBehavior),()=>{To(()=>{r.value.hide?r.value.inverted?o.value=a.value>l.value:o.value=c.value||a.value<l.value:o.value=!0})});const{ssrBootStyles:m}=F0(),{layoutItemStyles:g}=fle({id:t.name,order:M(()=>parseInt(t.order,10)),position:Pe(t,"location"),layoutSize:p,elementSize:He(void 0),active:o,absolute:Pe(t,"absolute")});return Ge(()=>{const[v]=gk.filterProps(t);return I(gk,Ue({ref:s,class:["v-app-bar",{"v-app-bar--bottom":t.location==="bottom"},t.class],style:[{...g.value,"--v-toolbar-image-opacity":f.value,height:void 0,...m.value},t.style]},v,{collapse:d.value,flat:h.value}),n)}),{}}}),kle=Re()({name:"VAppBarTitle",props:CR(),setup(t,e){let{slots:n}=e;return Ge(()=>I(kR,Ue(t,{class:"v-app-bar-title"}),n)),{}}});const Sle=ye({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...$m({origin:"center center",scrollStrategy:"block",transition:{component:T0},zIndex:2400})},"VDialog"),IR=Re()({name:"VDialog",props:Sle(),emits:{"update:modelValue":t=>!0},setup(t,e){let{slots:n}=e;const s=Mt(t,"modelValue"),{scopeId:o}=Im(),r=_e();function i(l){var d,h;const c=l.relatedTarget,u=l.target;if(c!==u&&((d=r.value)==null?void 0:d.contentEl)&&((h=r.value)==null?void 0:h.globalTop)&&![document,r.value.contentEl].includes(u)&&!r.value.contentEl.contains(u)){const f=cf(r.value.contentEl);if(!f.length)return;const p=f[0],m=f[f.length-1];c===p?m.focus():p.focus()}}zt&&ze(()=>s.value&&t.retainFocus,l=>{l?document.addEventListener("focusin",i):document.removeEventListener("focusin",i)},{immediate:!0}),ze(s,async l=>{var c,u;await gn(),l?(c=r.value.contentEl)==null||c.focus({preventScroll:!0}):(u=r.value.activatorEl)==null||u.focus({preventScroll:!0})});const a=M(()=>Ue({"aria-haspopup":"dialog","aria-expanded":String(s.value)},t.activatorProps));return Ge(()=>{const[l]=Tl.filterProps(t);return I(Tl,Ue({ref:r,class:["v-dialog",{"v-dialog--fullscreen":t.fullscreen,"v-dialog--scrollable":t.scrollable},t.class],style:t.style},l,{modelValue:s.value,"onUpdate:modelValue":c=>s.value=c,"aria-modal":"true",activatorProps:a.value,role:"dialog"},o),{activator:n.activator,default:function(){for(var c=arguments.length,u=new Array(c),d=0;d<c;d++)u[d]=arguments[d];return I(pn,{root:"VDialog"},{default:()=>{var h;return[(h=n.default)==null?void 0:h.call(n,...u)]}})}})}),ec({},r)}});const Ile=ye({scrollable:Boolean,...st(),...yn({tag:"main"})},"VMain"),$le=Re()({name:"VMain",props:Ile(),setup(t,e){let{slots:n}=e;const{mainStyles:s}=hle(),{ssrBootStyles:o}=F0();return Ge(()=>I(t.tag,{class:["v-main",{"v-main--scrollable":t.scrollable},t.class],style:[s.value,o.value,t.style]},{default:()=>{var r,i;return[t.scrollable?I("div",{class:"v-main__scroller"},[(r=n.default)==null?void 0:r.call(n)]):(i=n.default)==null?void 0:i.call(n)]}})),{}}}),$R=t=>(IF("data-v-bb89c4f6"),t=t(),$F(),t),Tle=$R(()=>Ct("span",null,"Langfassung",-1)),Nle=$R(()=>Ct("span",null,"Quellcode",-1));function Ele(t,e,n,s,o,r){const i=Ln("SettingsDialog"),a=Ln("router-view");return We(),ht(vle,null,{default:pe(()=>[I(Cle,{ref:"app-bar",app:"",floating:""},{default:pe(()=>[I(kle,null,{default:pe(()=>[gt(" Wie kann K\xFCnstliche Intelligenz Schach lernen? ")]),_:1}),I(nu),I(us,{icon:"",href:"https://raw.githubusercontent.com/leo848/jufo2023/master/langfassung.pdf"},{default:pe(()=>[I(on,null,{default:pe(()=>[gt("mdi-file-document-multiple")]),_:1}),I(Nl,{activator:"parent",location:"bottom"},{default:pe(()=>[Tle]),_:1})]),_:1}),I(us,{icon:"",href:"https://github.com/leo848/jufo2023"},{default:pe(()=>[I(on,null,{default:pe(()=>[gt("mdi-code-braces-box")]),_:1}),I(Nl,{activator:"parent",location:"bottom"},{default:pe(()=>[Nle]),_:1})]),_:1}),I(us,{icon:"",class:"mx-4"},{default:pe(()=>[I(on,{size:"large"},{default:pe(()=>[gt("mdi-cog")]),_:1}),I(IR,{modelValue:t.dialog,"onUpdate:modelValue":e[0]||(e[0]=l=>t.dialog=l),activator:"parent","max-width":"800px"},{default:pe(()=>[I(i,{onCancel:r.cancel,onSave:r.save},null,8,["onCancel","onSave"])]),_:1},8,["modelValue"])]),_:1})]),_:1},512),(We(),ht($le,{class:"mt-4",key:t.mainKey},{default:pe(()=>[I(a)]),_:1}))]),_:1})}const _le=ks(cle,[["render",Ele],["__scopeId","data-v-bb89c4f6"]]);/*!
  * vue-router v4.2.5
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */const Ya=typeof window<"u";function Ale(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const yt=Object.assign;function fg(t,e){const n={};for(const s in e){const o=e[s];n[s]=$o(o)?o.map(t):t(o)}return n}const Ec=()=>{},$o=Array.isArray,Rle=/\/$/,Dle=t=>t.replace(Rle,"");function pg(t,e,n="/"){let s,o={},r="",i="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(s=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),o=t(r)),a>-1&&(s=s||e.slice(0,a),i=e.slice(a,e.length)),s=Mle(s!=null?s:e,n),{fullPath:s+(r&&"?")+r+i,path:s,query:o,hash:i}}function Fle(t,e){const n=e.query?t(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}function vk(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function Ole(t,e,n){const s=e.matched.length-1,o=n.matched.length-1;return s>-1&&s===o&&El(e.matched[s],n.matched[o])&&TR(e.params,n.params)&&t(e.query)===t(n.query)&&e.hash===n.hash}function El(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function TR(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!Ple(t[n],e[n]))return!1;return!0}function Ple(t,e){return $o(t)?bk(t,e):$o(e)?bk(e,t):t===e}function bk(t,e){return $o(e)?t.length===e.length&&t.every((n,s)=>n===e[s]):t.length===1&&t[0]===e}function Mle(t,e){if(t.startsWith("/"))return t;if(!t)return e;const n=e.split("/"),s=t.split("/"),o=s[s.length-1];(o===".."||o===".")&&s.push("");let r=n.length-1,i,a;for(i=0;i<s.length;i++)if(a=s[i],a!==".")if(a==="..")r>1&&r--;else break;return n.slice(0,r).join("/")+"/"+s.slice(i-(i===s.length?1:0)).join("/")}var ru;(function(t){t.pop="pop",t.push="push"})(ru||(ru={}));var _c;(function(t){t.back="back",t.forward="forward",t.unknown=""})(_c||(_c={}));function Lle(t){if(!t)if(Ya){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),Dle(t)}const Ble=/^[^#]+#/;function Vle(t,e){return t.replace(Ble,"#")+e}function zle(t,e){const n=document.documentElement.getBoundingClientRect(),s=t.getBoundingClientRect();return{behavior:e.behavior,left:s.left-n.left-(e.left||0),top:s.top-n.top-(e.top||0)}}const Tm=()=>({left:window.pageXOffset,top:window.pageYOffset});function Wle(t){let e;if("el"in t){const n=t.el,s=typeof n=="string"&&n.startsWith("#"),o=typeof n=="string"?s?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!o)return;e=zle(o,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}function yk(t,e){return(history.state?history.state.position-e:-1)+t}const Pv=new Map;function Ule(t,e){Pv.set(t,e)}function Gle(t){const e=Pv.get(t);return Pv.delete(t),e}let Hle=()=>location.protocol+"//"+location.host;function NR(t,e){const{pathname:n,search:s,hash:o}=e,r=t.indexOf("#");if(r>-1){let a=o.includes(t.slice(r))?t.slice(r).length:1,l=o.slice(a);return l[0]!=="/"&&(l="/"+l),vk(l,"")}return vk(n,t)+s+o}function jle(t,e,n,s){let o=[],r=[],i=null;const a=({state:h})=>{const f=NR(t,location),p=n.value,m=e.value;let g=0;if(h){if(n.value=f,e.value=h,i&&i===p){i=null;return}g=m?h.position-m.position:0}else s(f);o.forEach(v=>{v(n.value,p,{delta:g,type:ru.pop,direction:g?g>0?_c.forward:_c.back:_c.unknown})})};function l(){i=n.value}function c(h){o.push(h);const f=()=>{const p=o.indexOf(h);p>-1&&o.splice(p,1)};return r.push(f),f}function u(){const{history:h}=window;!h.state||h.replaceState(yt({},h.state,{scroll:Tm()}),"")}function d(){for(const h of r)h();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",u)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",u,{passive:!0}),{pauseListeners:l,listen:c,destroy:d}}function xk(t,e,n,s=!1,o=!1){return{back:t,current:e,forward:n,replaced:s,position:window.history.length,scroll:o?Tm():null}}function Kle(t){const{history:e,location:n}=window,s={value:NR(t,n)},o={value:e.state};o.value||r(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,u){const d=t.indexOf("#"),h=d>-1?(n.host&&document.querySelector("base")?t:t.slice(d))+l:Hle()+t+l;try{e[u?"replaceState":"pushState"](c,"",h),o.value=c}catch(f){console.error(f),n[u?"replace":"assign"](h)}}function i(l,c){const u=yt({},e.state,xk(o.value.back,l,o.value.forward,!0),c,{position:o.value.position});r(l,u,!0),s.value=l}function a(l,c){const u=yt({},o.value,e.state,{forward:l,scroll:Tm()});r(u.current,u,!0);const d=yt({},xk(s.value,l,null),{position:u.position+1},c);r(l,d,!1),s.value=l}return{location:s,state:o,push:a,replace:i}}function qle(t){t=Lle(t);const e=Kle(t),n=jle(t,e.state,e.location,e.replace);function s(r,i=!0){i||n.pauseListeners(),history.go(r)}const o=yt({location:"",base:t,go:s,createHref:Vle.bind(null,t)},e,n);return Object.defineProperty(o,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(o,"state",{enumerable:!0,get:()=>e.state.value}),o}function Xle(t){return typeof t=="string"||t&&typeof t=="object"}function ER(t){return typeof t=="string"||typeof t=="symbol"}const Vr={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},_R=Symbol("");var wk;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(wk||(wk={}));function _l(t,e){return yt(new Error,{type:t,[_R]:!0},e)}function dr(t,e){return t instanceof Error&&_R in t&&(e==null||!!(t.type&e))}const Ck="[^/]+?",Yle={sensitive:!1,strict:!1,start:!0,end:!0},Zle=/[.+*?^${}()[\]/\\]/g;function Qle(t,e){const n=yt({},Yle,e),s=[];let o=n.start?"^":"";const r=[];for(const c of t){const u=c.length?[]:[90];n.strict&&!c.length&&(o+="/");for(let d=0;d<c.length;d++){const h=c[d];let f=40+(n.sensitive?.25:0);if(h.type===0)d||(o+="/"),o+=h.value.replace(Zle,"\\$&"),f+=40;else if(h.type===1){const{value:p,repeatable:m,optional:g,regexp:v}=h;r.push({name:p,repeatable:m,optional:g});const b=v||Ck;if(b!==Ck){f+=10;try{new RegExp(`(${b})`)}catch(x){throw new Error(`Invalid custom RegExp for param "${p}" (${b}): `+x.message)}}let y=m?`((?:${b})(?:/(?:${b}))*)`:`(${b})`;d||(y=g&&c.length<2?`(?:/${y})`:"/"+y),g&&(y+="?"),o+=y,f+=20,g&&(f+=-8),m&&(f+=-20),b===".*"&&(f+=-50)}u.push(f)}s.push(u)}if(n.strict&&n.end){const c=s.length-1;s[c][s[c].length-1]+=.7000000000000001}n.strict||(o+="/?"),n.end?o+="$":n.strict&&(o+="(?:/|$)");const i=new RegExp(o,n.sensitive?"":"i");function a(c){const u=c.match(i),d={};if(!u)return null;for(let h=1;h<u.length;h++){const f=u[h]||"",p=r[h-1];d[p.name]=f&&p.repeatable?f.split("/"):f}return d}function l(c){let u="",d=!1;for(const h of t){(!d||!u.endsWith("/"))&&(u+="/"),d=!1;for(const f of h)if(f.type===0)u+=f.value;else if(f.type===1){const{value:p,repeatable:m,optional:g}=f,v=p in c?c[p]:"";if($o(v)&&!m)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const b=$o(v)?v.join("/"):v;if(!b)if(g)h.length<2&&(u.endsWith("/")?u=u.slice(0,-1):d=!0);else throw new Error(`Missing required param "${p}"`);u+=b}}return u||"/"}return{re:i,score:s,keys:r,parse:a,stringify:l}}function Jle(t,e){let n=0;for(;n<t.length&&n<e.length;){const s=e[n]-t[n];if(s)return s;n++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function ece(t,e){let n=0;const s=t.score,o=e.score;for(;n<s.length&&n<o.length;){const r=Jle(s[n],o[n]);if(r)return r;n++}if(Math.abs(o.length-s.length)===1){if(kk(s))return 1;if(kk(o))return-1}return o.length-s.length}function kk(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const tce={type:0,value:""},nce=/[a-zA-Z0-9_]/;function sce(t){if(!t)return[[]];if(t==="/")return[[tce]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(f){throw new Error(`ERR (${n})/"${c}": ${f}`)}let n=0,s=n;const o=[];let r;function i(){r&&o.push(r),r=[]}let a=0,l,c="",u="";function d(){!c||(n===0?r.push({type:0,value:c}):n===1||n===2||n===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:u,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}function h(){c+=l}for(;a<t.length;){if(l=t[a++],l==="\\"&&n!==2){s=n,n=4;continue}switch(n){case 0:l==="/"?(c&&d(),i()):l===":"?(d(),n=1):h();break;case 4:h(),n=s;break;case 1:l==="("?n=2:nce.test(l)?h():(d(),n=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+l:n=3:u+=l;break;case 3:d(),n=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,u="";break;default:e("Unknown state");break}}return n===2&&e(`Unfinished custom RegExp for param "${c}"`),d(),i(),o}function oce(t,e,n){const s=Qle(sce(t.path),n),o=yt(s,{record:t,parent:e,children:[],alias:[]});return e&&!o.record.aliasOf==!e.record.aliasOf&&e.children.push(o),o}function rce(t,e){const n=[],s=new Map;e=$k({strict:!1,end:!0,sensitive:!1},e);function o(u){return s.get(u)}function r(u,d,h){const f=!h,p=ice(u);p.aliasOf=h&&h.record;const m=$k(e,u),g=[p];if("alias"in u){const y=typeof u.alias=="string"?[u.alias]:u.alias;for(const x of y)g.push(yt({},p,{components:h?h.record.components:p.components,path:x,aliasOf:h?h.record:p}))}let v,b;for(const y of g){const{path:x}=y;if(d&&x[0]!=="/"){const w=d.record.path,k=w[w.length-1]==="/"?"":"/";y.path=d.record.path+(x&&k+x)}if(v=oce(y,d,m),h?h.alias.push(v):(b=b||v,b!==v&&b.alias.push(v),f&&u.name&&!Ik(v)&&i(u.name)),p.children){const w=p.children;for(let k=0;k<w.length;k++)r(w[k],v,h&&h.children[k])}h=h||v,(v.record.components&&Object.keys(v.record.components).length||v.record.name||v.record.redirect)&&l(v)}return b?()=>{i(b)}:Ec}function i(u){if(ER(u)){const d=s.get(u);d&&(s.delete(u),n.splice(n.indexOf(d),1),d.children.forEach(i),d.alias.forEach(i))}else{const d=n.indexOf(u);d>-1&&(n.splice(d,1),u.record.name&&s.delete(u.record.name),u.children.forEach(i),u.alias.forEach(i))}}function a(){return n}function l(u){let d=0;for(;d<n.length&&ece(u,n[d])>=0&&(u.record.path!==n[d].record.path||!AR(u,n[d]));)d++;n.splice(d,0,u),u.record.name&&!Ik(u)&&s.set(u.record.name,u)}function c(u,d){let h,f={},p,m;if("name"in u&&u.name){if(h=s.get(u.name),!h)throw _l(1,{location:u});m=h.record.name,f=yt(Sk(d.params,h.keys.filter(b=>!b.optional).map(b=>b.name)),u.params&&Sk(u.params,h.keys.map(b=>b.name))),p=h.stringify(f)}else if("path"in u)p=u.path,h=n.find(b=>b.re.test(p)),h&&(f=h.parse(p),m=h.record.name);else{if(h=d.name?s.get(d.name):n.find(b=>b.re.test(d.path)),!h)throw _l(1,{location:u,currentLocation:d});m=h.record.name,f=yt({},d.params,u.params),p=h.stringify(f)}const g=[];let v=h;for(;v;)g.unshift(v.record),v=v.parent;return{name:m,path:p,params:f,matched:g,meta:lce(g)}}return t.forEach(u=>r(u)),{addRoute:r,resolve:c,removeRoute:i,getRoutes:a,getRecordMatcher:o}}function Sk(t,e){const n={};for(const s of e)s in t&&(n[s]=t[s]);return n}function ice(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:ace(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function ace(t){const e={},n=t.props||!1;if("component"in t)e.default=n;else for(const s in t.components)e[s]=typeof n=="object"?n[s]:n;return e}function Ik(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function lce(t){return t.reduce((e,n)=>yt(e,n.meta),{})}function $k(t,e){const n={};for(const s in t)n[s]=s in e?e[s]:t[s];return n}function AR(t,e){return e.children.some(n=>n===t||AR(t,n))}const RR=/#/g,cce=/&/g,uce=/\//g,dce=/=/g,hce=/\?/g,DR=/\+/g,fce=/%5B/g,pce=/%5D/g,FR=/%5E/g,mce=/%60/g,OR=/%7B/g,gce=/%7C/g,PR=/%7D/g,vce=/%20/g;function L0(t){return encodeURI(""+t).replace(gce,"|").replace(fce,"[").replace(pce,"]")}function bce(t){return L0(t).replace(OR,"{").replace(PR,"}").replace(FR,"^")}function Mv(t){return L0(t).replace(DR,"%2B").replace(vce,"+").replace(RR,"%23").replace(cce,"%26").replace(mce,"`").replace(OR,"{").replace(PR,"}").replace(FR,"^")}function yce(t){return Mv(t).replace(dce,"%3D")}function xce(t){return L0(t).replace(RR,"%23").replace(hce,"%3F")}function wce(t){return t==null?"":xce(t).replace(uce,"%2F")}function Cf(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function Cce(t){const e={};if(t===""||t==="?")return e;const s=(t[0]==="?"?t.slice(1):t).split("&");for(let o=0;o<s.length;++o){const r=s[o].replace(DR," "),i=r.indexOf("="),a=Cf(i<0?r:r.slice(0,i)),l=i<0?null:Cf(r.slice(i+1));if(a in e){let c=e[a];$o(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}function Tk(t){let e="";for(let n in t){const s=t[n];if(n=yce(n),s==null){s!==void 0&&(e+=(e.length?"&":"")+n);continue}($o(s)?s.map(r=>r&&Mv(r)):[s&&Mv(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+n,r!=null&&(e+="="+r))})}return e}function kce(t){const e={};for(const n in t){const s=t[n];s!==void 0&&(e[n]=$o(s)?s.map(o=>o==null?null:""+o):s==null?s:""+s)}return e}const Sce=Symbol(""),Nk=Symbol(""),B0=Symbol(""),MR=Symbol(""),Lv=Symbol("");function uc(){let t=[];function e(s){return t.push(s),()=>{const o=t.indexOf(s);o>-1&&t.splice(o,1)}}function n(){t=[]}return{add:e,list:()=>t.slice(),reset:n}}function Kr(t,e,n,s,o){const r=s&&(s.enterCallbacks[o]=s.enterCallbacks[o]||[]);return()=>new Promise((i,a)=>{const l=d=>{d===!1?a(_l(4,{from:n,to:e})):d instanceof Error?a(d):Xle(d)?a(_l(2,{from:e,to:d})):(r&&s.enterCallbacks[o]===r&&typeof d=="function"&&r.push(d),i())},c=t.call(s&&s.instances[o],e,n,l);let u=Promise.resolve(c);t.length<3&&(u=u.then(l)),u.catch(d=>a(d))})}function mg(t,e,n,s){const o=[];for(const r of t)for(const i in r.components){let a=r.components[i];if(!(e!=="beforeRouteEnter"&&!r.instances[i]))if(Ice(a)){const c=(a.__vccOpts||a)[e];c&&o.push(Kr(c,n,s,r,i))}else{let l=a();o.push(()=>l.then(c=>{if(!c)return Promise.reject(new Error(`Couldn't resolve component "${i}" at "${r.path}"`));const u=Ale(c)?c.default:c;r.components[i]=u;const h=(u.__vccOpts||u)[e];return h&&Kr(h,n,s,r,i)()}))}}return o}function Ice(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function Ek(t){const e=vt(B0),n=vt(MR),s=M(()=>e.resolve(hs(t.to))),o=M(()=>{const{matched:l}=s.value,{length:c}=l,u=l[c-1],d=n.matched;if(!u||!d.length)return-1;const h=d.findIndex(El.bind(null,u));if(h>-1)return h;const f=_k(l[c-2]);return c>1&&_k(u)===f&&d[d.length-1].path!==f?d.findIndex(El.bind(null,l[c-2])):h}),r=M(()=>o.value>-1&&Ece(n.params,s.value.params)),i=M(()=>o.value>-1&&o.value===n.matched.length-1&&TR(n.params,s.value.params));function a(l={}){return Nce(l)?e[hs(t.replace)?"replace":"push"](hs(t.to)).catch(Ec):Promise.resolve()}return{route:s,href:M(()=>s.value.href),isActive:r,isExactActive:i,navigate:a}}const $ce=hb({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ek,setup(t,{slots:e}){const n=Jn(Ek(t)),{options:s}=vt(B0),o=M(()=>({[Ak(t.activeClass,s.linkActiveClass,"router-link-active")]:n.isActive,[Ak(t.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive}));return()=>{const r=e.default&&e.default(n);return t.custom?r:lr("a",{"aria-current":n.isExactActive?t.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:o.value},r)}}}),Tce=$ce;function Nce(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function Ece(t,e){for(const n in e){const s=e[n],o=t[n];if(typeof s=="string"){if(s!==o)return!1}else if(!$o(o)||o.length!==s.length||s.some((r,i)=>r!==o[i]))return!1}return!0}function _k(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const Ak=(t,e,n)=>t!=null?t:e!=null?e:n,_ce=hb({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:n}){const s=vt(Lv),o=M(()=>t.route||s.value),r=vt(Nk,0),i=M(()=>{let c=hs(r);const{matched:u}=o.value;let d;for(;(d=u[c])&&!d.components;)c++;return c}),a=M(()=>o.value.matched[i.value]);vn(Nk,M(()=>i.value+1)),vn(Sce,a),vn(Lv,o);const l=_e();return ze(()=>[l.value,a.value,t.name],([c,u,d],[h,f,p])=>{u&&(u.instances[d]=c,f&&f!==u&&c&&c===h&&(u.leaveGuards.size||(u.leaveGuards=f.leaveGuards),u.updateGuards.size||(u.updateGuards=f.updateGuards))),c&&u&&(!f||!El(u,f)||!h)&&(u.enterCallbacks[d]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=o.value,u=t.name,d=a.value,h=d&&d.components[u];if(!h)return Rk(n.default,{Component:h,route:c});const f=d.props[u],p=f?f===!0?c.params:typeof f=="function"?f(c):f:null,g=lr(h,yt({},p,e,{onVnodeUnmounted:v=>{v.component.isUnmounted&&(d.instances[u]=null)},ref:l}));return Rk(n.default,{Component:g,route:c})||g}}});function Rk(t,e){if(!t)return null;const n=t(e);return n.length===1?n[0]:n}const Ace=_ce;function Rce(t){const e=rce(t.routes,t),n=t.parseQuery||Cce,s=t.stringifyQuery||Tk,o=t.history,r=uc(),i=uc(),a=uc(),l=He(Vr);let c=Vr;Ya&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=fg.bind(null,z=>""+z),d=fg.bind(null,wce),h=fg.bind(null,Cf);function f(z,ae){let re,he;return ER(z)?(re=e.getRecordMatcher(z),he=ae):he=z,e.addRoute(he,re)}function p(z){const ae=e.getRecordMatcher(z);ae&&e.removeRoute(ae)}function m(){return e.getRoutes().map(z=>z.record)}function g(z){return!!e.getRecordMatcher(z)}function v(z,ae){if(ae=yt({},ae||l.value),typeof z=="string"){const j=pg(n,z,ae.path),ee=e.resolve({path:j.path},ae),se=o.createHref(j.fullPath);return yt(j,ee,{params:h(ee.params),hash:Cf(j.hash),redirectedFrom:void 0,href:se})}let re;if("path"in z)re=yt({},z,{path:pg(n,z.path,ae.path).path});else{const j=yt({},z.params);for(const ee in j)j[ee]==null&&delete j[ee];re=yt({},z,{params:d(j)}),ae.params=d(ae.params)}const he=e.resolve(re,ae),Ce=z.hash||"";he.params=u(h(he.params));const R=Fle(s,yt({},z,{hash:bce(Ce),path:he.path})),P=o.createHref(R);return yt({fullPath:R,hash:Ce,query:s===Tk?kce(z.query):z.query||{}},he,{redirectedFrom:void 0,href:P})}function b(z){return typeof z=="string"?pg(n,z,l.value.path):yt({},z)}function y(z,ae){if(c!==z)return _l(8,{from:ae,to:z})}function x(z){return S(z)}function w(z){return x(yt(b(z),{replace:!0}))}function k(z){const ae=z.matched[z.matched.length-1];if(ae&&ae.redirect){const{redirect:re}=ae;let he=typeof re=="function"?re(z):re;return typeof he=="string"&&(he=he.includes("?")||he.includes("#")?he=b(he):{path:he},he.params={}),yt({query:z.query,hash:z.hash,params:"path"in he?{}:z.params},he)}}function S(z,ae){const re=c=v(z),he=l.value,Ce=z.state,R=z.force,P=z.replace===!0,j=k(re);if(j)return S(yt(b(j),{state:typeof j=="object"?yt({},Ce,j.state):Ce,force:R,replace:P}),ae||re);const ee=re;ee.redirectedFrom=ae;let se;return!R&&Ole(s,he,re)&&(se=_l(16,{to:ee,from:he}),X(he,he,!0,!1)),(se?Promise.resolve(se):T(ee,he)).catch(le=>dr(le)?dr(le,2)?le:J(le):D(le,ee,he)).then(le=>{if(le){if(dr(le,2))return S(yt({replace:P},b(le.to),{state:typeof le.to=="object"?yt({},Ce,le.to.state):Ce,force:R}),ae||ee)}else le=_(ee,he,!0,P,Ce);return E(ee,he,le),le})}function C(z,ae){const re=y(z,ae);return re?Promise.reject(re):Promise.resolve()}function $(z){const ae=ue.values().next().value;return ae&&typeof ae.runWithContext=="function"?ae.runWithContext(z):z()}function T(z,ae){let re;const[he,Ce,R]=Dce(z,ae);re=mg(he.reverse(),"beforeRouteLeave",z,ae);for(const j of he)j.leaveGuards.forEach(ee=>{re.push(Kr(ee,z,ae))});const P=C.bind(null,z,ae);return re.push(P),Y(re).then(()=>{re=[];for(const j of r.list())re.push(Kr(j,z,ae));return re.push(P),Y(re)}).then(()=>{re=mg(Ce,"beforeRouteUpdate",z,ae);for(const j of Ce)j.updateGuards.forEach(ee=>{re.push(Kr(ee,z,ae))});return re.push(P),Y(re)}).then(()=>{re=[];for(const j of R)if(j.beforeEnter)if($o(j.beforeEnter))for(const ee of j.beforeEnter)re.push(Kr(ee,z,ae));else re.push(Kr(j.beforeEnter,z,ae));return re.push(P),Y(re)}).then(()=>(z.matched.forEach(j=>j.enterCallbacks={}),re=mg(R,"beforeRouteEnter",z,ae),re.push(P),Y(re))).then(()=>{re=[];for(const j of i.list())re.push(Kr(j,z,ae));return re.push(P),Y(re)}).catch(j=>dr(j,8)?j:Promise.reject(j))}function E(z,ae,re){a.list().forEach(he=>$(()=>he(z,ae,re)))}function _(z,ae,re,he,Ce){const R=y(z,ae);if(R)return R;const P=ae===Vr,j=Ya?history.state:{};re&&(he||P?o.replace(z.fullPath,yt({scroll:P&&j&&j.scroll},Ce)):o.push(z.fullPath,Ce)),l.value=z,X(z,ae,re,P),J()}let A;function O(){A||(A=o.listen((z,ae,re)=>{if(!ce.listening)return;const he=v(z),Ce=k(he);if(Ce){S(yt(Ce,{replace:!0}),he).catch(Ec);return}c=he;const R=l.value;Ya&&Ule(yk(R.fullPath,re.delta),Tm()),T(he,R).catch(P=>dr(P,12)?P:dr(P,2)?(S(P.to,he).then(j=>{dr(j,20)&&!re.delta&&re.type===ru.pop&&o.go(-1,!1)}).catch(Ec),Promise.reject()):(re.delta&&o.go(-re.delta,!1),D(P,he,R))).then(P=>{P=P||_(he,R,!1),P&&(re.delta&&!dr(P,8)?o.go(-re.delta,!1):re.type===ru.pop&&dr(P,20)&&o.go(-1,!1)),E(he,R,P)}).catch(Ec)}))}let B=uc(),F=uc(),V;function D(z,ae,re){J(z);const he=F.list();return he.length?he.forEach(Ce=>Ce(z,ae,re)):console.error(z),Promise.reject(z)}function U(){return V&&l.value!==Vr?Promise.resolve():new Promise((z,ae)=>{B.add([z,ae])})}function J(z){return V||(V=!z,O(),B.list().forEach(([ae,re])=>z?re(z):ae()),B.reset()),z}function X(z,ae,re,he){const{scrollBehavior:Ce}=t;if(!Ya||!Ce)return Promise.resolve();const R=!re&&Gle(yk(z.fullPath,0))||(he||!re)&&history.state&&history.state.scroll||null;return gn().then(()=>Ce(z,ae,R)).then(P=>P&&Wle(P)).catch(P=>D(P,z,ae))}const te=z=>o.go(z);let ie;const ue=new Set,ce={currentRoute:l,listening:!0,addRoute:f,removeRoute:p,hasRoute:g,getRoutes:m,resolve:v,options:t,push:x,replace:w,go:te,back:()=>te(-1),forward:()=>te(1),beforeEach:r.add,beforeResolve:i.add,afterEach:a.add,onError:F.add,isReady:U,install(z){const ae=this;z.component("RouterLink",Tce),z.component("RouterView",Ace),z.config.globalProperties.$router=ae,Object.defineProperty(z.config.globalProperties,"$route",{enumerable:!0,get:()=>hs(l)}),Ya&&!ie&&l.value===Vr&&(ie=!0,x(o.location).catch(Ce=>{}));const re={};for(const Ce in Vr)Object.defineProperty(re,Ce,{get:()=>l.value[Ce],enumerable:!0});z.provide(B0,ae),z.provide(MR,fS(re)),z.provide(Lv,l);const he=z.unmount;ue.add(z),z.unmount=function(){ue.delete(z),ue.size<1&&(c=Vr,A&&A(),A=null,l.value=Vr,ie=!1,V=!1),he()}}};function Y(z){return z.reduce((ae,re)=>ae.then(()=>$(re)),Promise.resolve())}return ce}function Dce(t,e){const n=[],s=[],o=[],r=Math.max(e.matched.length,t.matched.length);for(let i=0;i<r;i++){const a=e.matched[i];a&&(t.matched.find(c=>El(c,a))?s.push(a):n.push(a));const l=t.matched[i];l&&(e.matched.find(c=>El(c,l))||o.push(l))}return[n,s,o]}/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Pn="w",Ws="b",xn="p",Bv="n",kh="b",Cc="r",qr="q",wn="k",gg="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Ss=-1,Fce={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Oce=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],Ke={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Ye={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},vg={b:[16,32,17,15],w:[-16,-32,-17,-15]},Dk={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Pce=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Mce=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Lce={p:1,n:2,b:4,r:8,q:16,k:32},Bce="pnbrqkPNBRQK",Fk=[Bv,kh,Cc,qr],Vce=7,zce=6,Wce=1,Uce=0,fh={[wn]:Ke.KSIDE_CASTLE,[qr]:Ke.QSIDE_CASTLE},zr={w:[{square:Ye.a1,flag:Ke.QSIDE_CASTLE},{square:Ye.h1,flag:Ke.KSIDE_CASTLE}],b:[{square:Ye.a8,flag:Ke.QSIDE_CASTLE},{square:Ye.h8,flag:Ke.KSIDE_CASTLE}]},Gce={b:Wce,w:zce},Hce=["1-0","0-1","1/2-1/2","*"];function ta(t){return t>>4}function iu(t){return t&15}function LR(t){return"0123456789".indexOf(t)!==-1}function Is(t){const e=iu(t),n=ta(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function dc(t){return t===Pn?Ws:Pn}function jce(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=e[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let i=0;i<o.length;i++){let a=0,l=!1;for(let c=0;c<o[i].length;c++)if(LR(o[i][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(o[i][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[i][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,l=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:i,regex:a}of r){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${i} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${i} kings`}}return{ok:!0}}function Kce(t,e){const n=t.from,s=t.to,o=t.piece;let r=0,i=0,a=0;for(let l=0,c=e.length;l<c;l++){const u=e[l].from,d=e[l].to,h=e[l].piece;o===h&&n!==u&&s===d&&(r++,ta(n)===ta(u)&&i++,iu(n)===iu(u)&&a++)}return r>0?i>0&&a>0?Is(n):a>0?Is(n).charAt(1):Is(n).charAt(0):""}function Wr(t,e,n,s,o,r=void 0,i=Ke.NORMAL){const a=ta(s);if(o===xn&&(a===Vce||a===Uce))for(let l=0;l<Fk.length;l++){const c=Fk[l];t.push({color:e,from:n,to:s,piece:o,captured:r,promotion:c,flags:i|Ke.PROMOTION})}else t.push({color:e,from:n,to:s,piece:o,captured:r,flags:i})}function Ok(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:xn:(e=e.toLowerCase(),e==="o"?wn:e)}function bg(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class tc{constructor(e=gg){lo(this,"_board",new Array(128));lo(this,"_turn",Pn);lo(this,"_header",{});lo(this,"_kings",{w:Ss,b:Ss});lo(this,"_epSquare",-1);lo(this,"_halfMoves",0);lo(this,"_moveNumber",0);lo(this,"_history",[]);lo(this,"_comments",{});lo(this,"_castling",{w:0,b:0});this.load(e)}clear(e=!1){this._board=new Array(128),this._kings={w:Ss,b:Ss},this._turn=Pn,this._castling={w:0,b:0},this._epSquare=Ss,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._updateSetup(this.fen())}removeHeader(e){e in this._header&&delete this._header[e]}load(e,n=!1){let s=e.split(/\s+/);if(s.length>=2&&s.length<6){const l=["-","-","0","1"];e=s.concat(l.slice(-(6-s.length))).join(" ")}s=e.split(/\s+/);const{ok:o,error:r}=jce(e);if(!o)throw new Error(r);const i=s[0];let a=0;this.clear(n);for(let l=0;l<i.length;l++){const c=i.charAt(l);if(c==="/")a+=8;else if(LR(c))a+=parseInt(c,10);else{const u=c<"a"?Pn:Ws;this.put({type:c.toLowerCase(),color:u},Is(a)),a++}}this._turn=s[1],s[2].indexOf("K")>-1&&(this._castling.w|=Ke.KSIDE_CASTLE),s[2].indexOf("Q")>-1&&(this._castling.w|=Ke.QSIDE_CASTLE),s[2].indexOf("k")>-1&&(this._castling.b|=Ke.KSIDE_CASTLE),s[2].indexOf("q")>-1&&(this._castling.b|=Ke.QSIDE_CASTLE),this._epSquare=s[3]==="-"?Ss:Ye[s[3]],this._halfMoves=parseInt(s[4],10),this._moveNumber=parseInt(s[5],10),this._updateSetup(this.fen())}fen(){var r,i;let e=0,n="";for(let a=Ye.a8;a<=Ye.h1;a++){if(this._board[a]){e>0&&(n+=e,e=0);const{color:l,type:c}=this._board[a];n+=l===Pn?c.toUpperCase():c.toLowerCase()}else e++;a+1&136&&(e>0&&(n+=e),a!==Ye.h1&&(n+="/"),e=0,a+=8)}let s="";this._castling[Pn]&Ke.KSIDE_CASTLE&&(s+="K"),this._castling[Pn]&Ke.QSIDE_CASTLE&&(s+="Q"),this._castling[Ws]&Ke.KSIDE_CASTLE&&(s+="k"),this._castling[Ws]&Ke.QSIDE_CASTLE&&(s+="q"),s=s||"-";let o="-";if(this._epSquare!==Ss){const a=this._epSquare+(this._turn===Pn?16:-16),l=[a+1,a-1];for(const c of l){if(c&136)continue;const u=this._turn;if(((r=this._board[c])==null?void 0:r.color)===u&&((i=this._board[c])==null?void 0:i.type)===xn){this._makeMove({color:u,from:c,to:this._epSquare,piece:xn,captured:xn,flags:Ke.EP_CAPTURE});const d=!this._isKingAttacked(u);if(this._undoMove(),d){o=Is(this._epSquare);break}}}}return[n,this._turn,s,o,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==gg?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(gg)}get(e){return this._board[Ye[e]]||!1}put({type:e,color:n},s){if(Bce.indexOf(e.toLowerCase())===-1||!(s in Ye))return!1;const o=Ye[s];return e==wn&&!(this._kings[n]==Ss||this._kings[n]==o)?!1:(this._board[o]={type:e,color:n},e===wn&&(this._kings[n]=o),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}remove(e){const n=this.get(e);return delete this._board[Ye[e]],n&&n.type===wn&&(this._kings[n.color]=Ss),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var s,o,r,i,a,l,c,u,d,h,f,p;const e=((s=this._board[Ye.e1])==null?void 0:s.type)===wn&&((o=this._board[Ye.e1])==null?void 0:o.color)===Pn,n=((r=this._board[Ye.e8])==null?void 0:r.type)===wn&&((i=this._board[Ye.e8])==null?void 0:i.color)===Ws;(!e||((a=this._board[Ye.a1])==null?void 0:a.type)!==Cc||((l=this._board[Ye.a1])==null?void 0:l.color)!==Pn)&&(this._castling.w&=~Ke.QSIDE_CASTLE),(!e||((c=this._board[Ye.h1])==null?void 0:c.type)!==Cc||((u=this._board[Ye.h1])==null?void 0:u.color)!==Pn)&&(this._castling.w&=~Ke.KSIDE_CASTLE),(!n||((d=this._board[Ye.a8])==null?void 0:d.type)!==Cc||((h=this._board[Ye.a8])==null?void 0:h.color)!==Ws)&&(this._castling.b&=~Ke.QSIDE_CASTLE),(!n||((f=this._board[Ye.h8])==null?void 0:f.type)!==Cc||((p=this._board[Ye.h8])==null?void 0:p.color)!==Ws)&&(this._castling.b&=~Ke.KSIDE_CASTLE)}_updateEnPassantSquare(){var r,i;if(this._epSquare===Ss)return;const e=this._epSquare+(this._turn===Pn?-16:16),n=this._epSquare+(this._turn===Pn?16:-16),s=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((r=this._board[n])==null?void 0:r.color)!==dc(this._turn)||((i=this._board[n])==null?void 0:i.type)!==xn){this._epSquare=Ss;return}const o=a=>{var l,c;return!(a&136)&&((l=this._board[a])==null?void 0:l.color)===this._turn&&((c=this._board[a])==null?void 0:c.type)===xn};s.some(o)||(this._epSquare=Ss)}_attacked(e,n){for(let s=Ye.a8;s<=Ye.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const o=this._board[s],r=s-n;if(r===0)continue;const i=r+119;if(Pce[i]&Lce[o.type]){if(o.type===xn){if(r>0){if(o.color===Pn)return!0}else if(o.color===Ws)return!0;continue}if(o.type==="n"||o.type==="k")return!0;const a=Mce[i];let l=s+a,c=!1;for(;l!==n;){if(this._board[l]!=null){c=!0;break}l+=a}if(!c)return!0}}return!1}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(dc(e),n)}isAttacked(e,n){return this._attacked(n,Ye[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let s=0,o=0;for(let r=Ye.a8;r<=Ye.h1;r++){if(o=(o+1)%2,r&136){r+=7;continue}const i=this._board[r];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===kh&&n.push(o),s++)}if(s===2)return!0;if(s===3&&(e[kh]===1||e[Bv]===1))return!0;if(s===e[kh]+2){let r=0;const i=n.length;for(let a=0;a<i;a++)r+=n[a];if(r===0||r===i)return!0}return!1}isThreefoldRepetition(){const e=[],n={};let s=!1;for(;;){const o=this._undoMove();if(!o)break;e.push(o)}for(;;){const o=this.fen().split(" ").slice(0,4).join(" ");n[o]=o in n?n[o]+1:1,n[o]>=3&&(s=!0);const r=e.pop();if(r)this._makeMove(r);else break}return s}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:s=void 0}={}){const o=this._moves({square:n,piece:s});return e?o.map(r=>this._makePretty(r)):o.map(r=>this._moveToSan(r,o))}_moves({legal:e=!0,piece:n=void 0,square:s=void 0}={}){var f;const o=s?s.toLowerCase():void 0,r=n==null?void 0:n.toLowerCase(),i=[],a=this._turn,l=dc(a);let c=Ye.a8,u=Ye.h1,d=!1;if(o)if(o in Ye)c=u=Ye[o],d=!0;else return[];for(let p=c;p<=u;p++){if(p&136){p+=7;continue}if(!this._board[p]||this._board[p].color===l)continue;const{type:m}=this._board[p];let g;if(m===xn){if(r&&r!==m)continue;g=p+vg[a][0],this._board[g]||(Wr(i,a,p,g,xn),g=p+vg[a][1],Gce[a]===ta(p)&&!this._board[g]&&Wr(i,a,p,g,xn,void 0,Ke.BIG_PAWN));for(let v=2;v<4;v++)g=p+vg[a][v],!(g&136)&&(((f=this._board[g])==null?void 0:f.color)===l?Wr(i,a,p,g,xn,this._board[g].type,Ke.CAPTURE):g===this._epSquare&&Wr(i,a,p,g,xn,xn,Ke.EP_CAPTURE))}else{if(r&&r!==m)continue;for(let v=0,b=Dk[m].length;v<b;v++){const y=Dk[m][v];for(g=p;g+=y,!(g&136);){if(!this._board[g])Wr(i,a,p,g,m);else{if(this._board[g].color===a)break;Wr(i,a,p,g,m,this._board[g].type,Ke.CAPTURE);break}if(m===Bv||m===wn)break}}}}if((r===void 0||r===wn)&&(!d||u===this._kings[a])){if(this._castling[a]&Ke.KSIDE_CASTLE){const p=this._kings[a],m=p+2;!this._board[p+1]&&!this._board[m]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,p+1)&&!this._attacked(l,m)&&Wr(i,a,this._kings[a],m,wn,void 0,Ke.KSIDE_CASTLE)}if(this._castling[a]&Ke.QSIDE_CASTLE){const p=this._kings[a],m=p-2;!this._board[p-1]&&!this._board[p-2]&&!this._board[p-3]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,p-1)&&!this._attacked(l,m)&&Wr(i,a,this._kings[a],m,wn,void 0,Ke.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return i;const h=[];for(let p=0,m=i.length;p<m;p++)this._makeMove(i[p]),this._isKingAttacked(a)||h.push(i[p]),this._undoMove();return h}move(e,{strict:n=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,n);else if(typeof e=="object"){const r=this._moves();for(let i=0,a=r.length;i<a;i++)if(e.from===Is(r[i].from)&&e.to===Is(r[i].to)&&(!("promotion"in r[i])||e.promotion===r[i].promotion)){s=r[i];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const o=this._makePretty(s);return this._makeMove(s),o}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const n=this._turn,s=dc(n);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&Ke.EP_CAPTURE&&(this._turn===Ws?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:n}),this._board[e.to].type===wn){if(this._kings[n]=e.to,e.flags&Ke.KSIDE_CASTLE){const o=e.to-1,r=e.to+1;this._board[o]=this._board[r],delete this._board[r]}else if(e.flags&Ke.QSIDE_CASTLE){const o=e.to+1,r=e.to-2;this._board[o]=this._board[r],delete this._board[r]}this._castling[n]=0}if(this._castling[n]){for(let o=0,r=zr[n].length;o<r;o++)if(e.from===zr[n][o].square&&this._castling[n]&zr[n][o].flag){this._castling[n]^=zr[n][o].flag;break}}if(this._castling[s]){for(let o=0,r=zr[s].length;o<r;o++)if(e.to===zr[s][o].square&&this._castling[s]&zr[s][o].flag){this._castling[s]^=zr[s][o].flag;break}}e.flags&Ke.BIG_PAWN?n===Ws?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=Ss,e.piece===xn?this._halfMoves=0:e.flags&(Ke.CAPTURE|Ke.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Ws&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();return e?this._makePretty(e):null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,o=dc(s);if(this._board[n.from]=this._board[n.to],this._board[n.from].type=n.piece,delete this._board[n.to],n.captured)if(n.flags&Ke.EP_CAPTURE){let r;s===Ws?r=n.to-16:r=n.to+16,this._board[r]={type:xn,color:o}}else this._board[n.to]={type:n.captured,color:o};if(n.flags&(Ke.KSIDE_CASTLE|Ke.QSIDE_CASTLE)){let r,i;n.flags&Ke.KSIDE_CASTLE?(r=n.to+1,i=n.to-1):(r=n.to-2,i=n.to+1),this._board[r]=this._board[i],delete this._board[i]}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const s=[];let o=!1;for(const h in this._header)s.push("["+h+' "'+this._header[h]+'"]'+e),o=!0;o&&this._history.length&&s.push(e);const r=h=>{const f=this._comments[this.fen()];if(typeof f<"u"){const p=h.length>0?" ":"";h=`${h}${p}{${f}}`}return h},i=[];for(;this._history.length>0;)i.push(this._undoMove());const a=[];let l="";for(i.length===0&&a.push(r(""));i.length>0;){l=r(l);const h=i.pop();if(!h)break;if(!this._history.length&&h.color==="b"){const f=`${this._moveNumber}. ...`;l=l?`${l} ${f}`:f}else h.color==="w"&&(l.length&&a.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(h,this._moves({legal:!0})),this._makeMove(h)}if(l.length&&a.push(r(l)),typeof this._header.Result<"u"&&a.push(this._header.Result),n===0)return s.join("")+a.join(" ");const c=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},u=function(h,f){for(const p of f.split(" "))if(!!p){if(h+p.length>n){for(;c();)h--;s.push(e),h=0}s.push(p),h+=p.length,s.push(" "),h++}return c()&&h--,h};let d=0;for(let h=0;h<a.length;h++){if(d+a[h].length>n&&a[h].includes("{")){d=u(d,a[h]);continue}d+a[h].length>n&&h!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),d=0):h!==0&&(s.push(" "),d++),s.push(a[h]),d+=a[h].length}return s.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}loadPgn(e,{strict:n=!1,newlineChar:s=`\r?
`}={}){function o(y){return y.replace(/\\/g,"\\")}function r(y){const x={},w=y.split(new RegExp(o(s)));let k="",S="";for(let C=0;C<w.length;C++){const $=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;k=w[C].replace($,"$1"),S=w[C].replace($,"$2"),k.trim().length>0&&(x[k]=S)}return x}e=e.trim();const a=new RegExp("^(\\[((?:"+o(s)+")|.)*\\])((?:\\s*"+o(s)+"){2}|(?:\\s*"+o(s)+")*$)").exec(e),l=a&&a.length>=2?a[1]:"";this.reset();const c=r(l);let u="";for(const y in c)y.toLowerCase()==="fen"&&(u=c[y]),this.header(y,c[y]);if(!n)u&&this.load(u,!0);else if(c.SetUp==="1"){if(!("FEN"in c))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(c.FEN,!0)}function d(y){return Array.from(y).map(function(x){return x.charCodeAt(0)<128?x.charCodeAt(0).toString(16):encodeURIComponent(x).replace(/%/g,"").toLowerCase()}).join("")}function h(y){return y.length==0?"":decodeURIComponent("%"+(y.match(/.{1,2}/g)||[]).join("%"))}const f=function(y){return y=y.replace(new RegExp(o(s),"g")," "),`{${d(y.slice(1,y.length-1))}}`},p=function(y){if(y.startsWith("{")&&y.endsWith("}"))return h(y.slice(1,y.length-1))};let m=e.replace(l,"").replace(new RegExp(`({[^}]*})+?|;([^${o(s)}]*)`,"g"),function(y,x,w){return x!==void 0?f(x):" "+f(`{${w.slice(1)}}`)}).replace(new RegExp(o(s),"g")," ");const g=/(\([^()]+\))+?/g;for(;g.test(m);)m=m.replace(g,"");m=m.replace(/\d+\.(\.\.)?/g,""),m=m.replace(/\.\.\./g,""),m=m.replace(/\$\d+/g,"");let v=m.trim().split(new RegExp(/\s+/));v=v.filter(y=>y!=="");let b="";for(let y=0;y<v.length;y++){const x=p(v[y]);if(x!==void 0){this._comments[this.fen()]=x;continue}const w=this._moveFromSan(v[y],n);if(w==null)if(Hce.indexOf(v[y])>-1)b=v[y];else throw new Error(`Invalid move in PGN: ${v[y]}`);else b="",this._makeMove(w)}b&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",b)}_moveToSan(e,n){let s="";if(e.flags&Ke.KSIDE_CASTLE)s="O-O";else if(e.flags&Ke.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==xn){const o=Kce(e,n);s+=e.piece.toUpperCase()+o}e.flags&(Ke.CAPTURE|Ke.EP_CAPTURE)&&(e.piece===xn&&(s+=Is(e.from)[0]),s+="x"),s+=Is(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,n=!1){const s=bg(e);let o=Ok(s),r=this._moves({legal:!0,piece:o});for(let h=0,f=r.length;h<f;h++)if(s===bg(this._moveToSan(r[h],r)))return r[h];if(n)return null;let i,a,l,c,u,d=!1;if(a=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(i=a[1],l=a[2],c=a[3],u=a[4],l.length==1&&(d=!0)):(a=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(i=a[1],l=a[2],c=a[3],u=a[4],l.length==1&&(d=!0))),o=Ok(s),r=this._moves({legal:!0,piece:i||o}),!c)return null;for(let h=0,f=r.length;h<f;h++)if(l){if((!i||i.toLowerCase()==r[h].piece)&&Ye[l]==r[h].from&&Ye[c]==r[h].to&&(!u||u.toLowerCase()==r[h].promotion))return r[h];if(d){const p=Is(r[h].from);if((!i||i.toLowerCase()==r[h].piece)&&Ye[c]==r[h].to&&(l==p[0]||l==p[1])&&(!u||u.toLowerCase()==r[h].promotion))return r[h]}}else if(s===bg(this._moveToSan(r[h],r)).replace("x",""))return r[h];return null}ascii(){let e=`   +------------------------+
`;for(let n=Ye.a8;n<=Ye.h1;n++){if(iu(n)===0&&(e+=" "+"87654321"[ta(n)]+" |"),this._board[n]){const s=this._board[n].type,r=this._board[n].color===Pn?s.toUpperCase():s.toLowerCase();e+=" "+r+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let s=0;const o=this._turn;for(let r=0,i=n.length;r<i;r++)this._makeMove(n[r]),this._isKingAttacked(o)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:n,piece:s,from:o,to:r,flags:i,captured:a,promotion:l}=e;let c="";for(const f in Ke)Ke[f]&i&&(c+=Fce[f]);const u=Is(o),d=Is(r),h={color:n,piece:s,from:u,to:d,san:this._moveToSan(e,this._moves({legal:!0})),flags:c,lan:u+d,before:this.fen(),after:""};return this._makeMove(e),h.after=this.fen(),this._undoMove(),a&&(h.captured=a),l&&(h.promotion=l,h.lan+=l),h}turn(){return this._turn}board(){const e=[];let n=[];for(let s=Ye.a8;s<=Ye.h1;s++)this._board[s]==null?n.push(null):n.push({square:Is(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(n),n=[],s+=8);return e}squareColor(e){if(e in Ye){const n=Ye[e];return(ta(n)+iu(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],s=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;e?s.push(this._makePretty(o)):s.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return s}_pruneComments(){const e=[],n={},s=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const o=e.pop();if(!o)break;this._makeMove(o),s(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const o of[wn,qr])n[o]!==void 0&&(n[o]?this._castling[e]|=fh[o]:this._castling[e]&=~fh[o]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(n[wn]===void 0||n[wn]===s[wn])&&(n[qr]===void 0||n[qr]===s[qr])}getCastlingRights(e){return{[wn]:(this._castling[e]&fh[wn])!==0,[qr]:(this._castling[e]&fh[qr])!==0}}moveNumber(){return this._moveNumber}}let Wt=new tc;window._game=Wt;const Al={};let Pk=69;function qce(t){Al[Pk]=t;for(const e of Object.values(Al))e(Wt);return Pk++}function Xce(t){delete Al[t]}function Yce(t){try{Wt.move(t)}catch{}for(const e of Object.values(Al))e(Wt)}function Zce(t){Wt=new tc(t);for(const e of Object.values(Al))e(Wt)}function Qce(){Wt.reset();for(const t of Object.values(Al))t(Wt)}const Vv={"move-suggestions":{title:"Zugvorschl\xE4ge",template:"Die Zugvorschl\xE4ge zeigen alle Z\xFCge, die das Modell in der aktuellen Stellung ausgibt. Sie sind nach der neuronalen Aktivierung sortiert und, falls ausgew\xE4hlt, nach ihrer Legalit\xE4t im Schach gefiltert."},"legal-outputs":{title:"Legale Ausgaben",template:"Das Modell hat immer 4096 Ausgaben, die jeweils einem Zug entsprechen. Die Softmax-Funktion garantiert, dass sie zusammen immer 1 bzw. 100% ergeben. Der (hoffentlich) gr\xFCne Kreis zeigt nun an, wie viele der Ausgaben legal und wieviele illegal sind \u2013 jetzt gerade sind es {percentage}%."},"move-display":{title:"Zuganzeige",templateFunction:t=>{const{move:e}=t;return e.inner?`Der hier vorgeschlagene Zug ist ${{p:"Bauer",n:"Springer",b:"L\xE4ufer",r:"Turm",q:"Dame",k:"K\xF6nig"}[e.inner.piece]} von ${e.from} nach ${e.to}. Mit einer neuronalen Aktivierung dieses Zuges von ${(e.act*100).toFixed(3)}% ist er der ${e.index}. Zug in der Liste.`:`Dieser Zug ist nicht legal - in dieser Stellung kann nicht von ${e.from} nach ${e.to} gezogen werden. Hierbei betr\xE4gt die neuronale Aktivierung dieses (illegalen) Zuges ${(e.act*100).toFixed(3)}%.`}},"game-over":{title:"Spielende",template:"Eine Schachpartie kann durch viele verschiedene Gr\xFCnde enden, aber es gibt immer drei Ausg\xE4nge: Schwarz gewinnt, Wei\xDF gewinnt oder Remis (Unentschieden). Ein Gewinn kann durch ein Schachmatt oder durch vorzeitige Aufgabe eines Spielers entstehen, ein Remis durch Patt, ungen\xFCgendes Material oder dreimal die gleiche Stellung."}},yg=t=>t in Vv,Jce={name:"InfoBox",props:{name:{type:String,required:!1,validator:yg},templates:{type:Object,required:!1,default:()=>({})},plain:{type:String,required:!1,default:null}},data:()=>({show:un("show").infoboxes}),computed:{text(){if(this.plain)return this.plain;if(!this.name)throw new Error("No name");if(!yg(this.name))throw new Error(`Invalid key: ${this.name}`);if(!this.templates)throw new Error("No templates");const t=Vv[this.name];let e=this.templates;if(t.prepare&&(e=t.prepare(e)),t.templateFunction)return t.templateFunction(e);function n(s){const o=e[s];if(!o)throw console.log(e),new Error(`No template for ${s}`);return o}return t.template.replace(/{(\w+)}/g,(s,o)=>n.call(this,o))},title(){if(!this.name)throw new Error("No name");if(!yg(this.name))throw new Error(`Invalid key: ${this.name}`);return Vv[this.name].title}}},eue={class:"ml-2"};function tue(t,e,n,s,o,r){return We(),es("span",eue,[I(R0,{"max-width":"350px"},{activator:pe(({props:i})=>[t.show?(We(),ht(on,Ue({key:0,onClick:e[0]||(e[0]=Cb(()=>{},["stop"]))},i),{default:pe(()=>[gt("mdi-information")]),_:2},1040)):Cn("",!0)]),default:pe(()=>[I(Ds,null,{default:pe(()=>[I(so,{class:"text-h5"},{default:pe(()=>[gt(ts(r.title),1)]),_:1}),I(Io,{class:"text-body-1"},{default:pe(()=>[gt(ts(r.text),1)]),_:1})]),_:1})]),_:1})])}const BR=ks(Jce,[["render",tue]]),nue={name:"PercentageDial",props:{value:{type:Number,required:!0}},computed:{displayValue(){return new Intl.NumberFormat(void 0,{style:"percent",maximumFractionDigits:2,minimumFractionDigits:2}).format(this.value)}}},sue={class:"text-h4"};function oue(t,e,n,s,o,r){return We(),ht(Nl,{right:"","open-on-click":!0},{activator:pe(({props:i})=>[I(Sm,Ue({"model-value":n.value*100,color:"green","bg-color":"red",width:"8",size:"large",class:"ml-4"},i),null,16,["model-value"])]),default:pe(()=>[Ct("p",sue,ts(r.displayValue),1)]),_:1})}const VR=ks(nue,[["render",oue]]),rue={name:"MoveDisplay",components:{InfoBox:BR,PercentageDial:VR},data:()=>({gray:"grey lighten-3",showIndex:un("onlyShowLegalMoves"),showActivation:un("showActivation"),movesShown:!1}),computed:{computedMoves(){let t=un("maxMoves"),e=un("onlyShowLegalMoves"),n=this.moves;return e&&(n=n.filter(s=>s.inner)),n.slice(0,t)}},methods:{interpolate:t=>e=>1+1/t-1/(t*e+1)-1/(t*t*e+t),makeMove(t){Yce(t)},prettyMove(t){let e=t.san;return e?(t.piece!=="p"&&!e.startsWith("O")&&(e=e.slice(1)),`
      <div class="d-flex py-1">
        <img class="piece-letter" src="${va(t.color+t.piece.toUpperCase())}"/> <span class="text-h5">${e}</span>
      </div>
        `):""},actToColor(t){let e=this.interpolate(20)(t),n=Math.min(1,2-2*e)*200,s=Math.min(1,2*e)*200;return`linear-gradient(90deg, rgb(${n}, ${s}, 0) 70%, rgb(${n*.7}, ${s*.7}, 0) 90%)`},hover(t){this.$emit("suggest",t),t||this.movesShown&&(this.movesShown=!1,this.showAll())},showAll(){if(this.movesShown){this.movesShown=!1,this.$emit("suggest",void 0);return}this.movesShown=!0,this.$emit("showAll")}},emits:["suggest","showAll"],props:{moves:{type:Array,required:!0,validator:t=>t.every(e=>e.from&&e.to&&e.act)},legals:{type:Number,required:!0}}},iue={class:"text-h5"},aue={class:"text-body-2"},lue={class:"d-flex flex-row justify-space-between"},cue=["innerHTML"],uue={key:1,class:"text-h5 pl-2 py-1"},due=["onClick"],hue=Ct("br",null,null,-1),fue={key:0,class:"mt-n2"};function pue(t,e,n,s,o,r){const i=Ln("InfoBox"),a=Ln("PercentageDial");return We(),ht(Md,null,{default:pe(()=>[I(tn,{cols:"12"},{default:pe(()=>[Ct("p",iue,[gt(" Zugvorschl\xE4ge des Modells "),I(i,{name:"move-suggestions"})]),Ct("p",aue,[I(us,{icon:t.movesShown?"mdi-eye-off-outline":"mdi-eye-outline",onClick:r.showAll,onBlur:e[0]||(e[0]=l=>t.movesShown&&r.showAll),color:t.movesShown?"white":void 0,variant:"plain",class:"mb-0"},null,8,["icon","onClick","color"]),gt(" Legale Ausgaben: "),I(a,{value:n.legals},null,8,["value"]),I(i,{class:"ml-2",name:"legal-outputs",templates:{percentage:(n.legals*100).toFixed(2)}},null,8,["templates"])])]),_:1}),I(tI,{name:"moves"},{default:pe(()=>[(We(!0),es(ot,null,Mf(r.computedMoves,l=>{var c;return We(),ht(tn,{key:l.from+l.to+((c=l.inner)==null?void 0:c.san),cols:"6",sm:"12"},{default:pe(()=>{var u;return[(We(),ht(Ds,{style:_f("background: "+(l.inner?r.actToColor(l.act):t.gray)),key:l.from+l.to+((u=l.inner)==null?void 0:u.san),onClick:d=>l.inner&&r.makeMove(l.inner),onMouseover:d=>r.hover(l),onMouseleave:e[1]||(e[1]=d=>r.hover()),"max-width":"300","max-height":"50",elevation:"3",rounded:"lg"},{default:pe(()=>[Ct("div",lue,[l.inner&&r.prettyMove(l.inner)?(We(),es("div",{key:0,innerHTML:r.prettyMove(l.inner)},null,8,cue)):(We(),es("div",uue,ts(l.from)+" - "+ts(l.to),1)),I(nu),t.showActivation?(We(),es("div",{key:2,class:"text-gray mr-1",onClick:d=>r.hover(l)},[gt(ts(l.act.toFixed(4).slice(1)),1),hue,t.showIndex?(We(),es("div",fue,"#"+ts(l.index),1)):Cn("",!0)],8,due)):Cn("",!0),I(i,{name:"move-display",templates:{move:l}},null,8,["templates"])])]),_:2},1032,["style","onClick","onMouseover"]))]}),_:2},1024)}),128))]),_:1})]),_:1})}const mue=ks(rue,[["render",pue]]);function gue(t){return t==="checkmate"?"Schachmatt":t==="resign"?"Aufgabe":t==="stalemate"?"Patt":t==="timeout"?"Zeit abgelaufen":t==="insufficient"?"Zu wenig Material":t==="repetition"?"Dreifache Stellungswiederholung":t==="agreement"?"Absprache":t==="50move"?"50 Z\xFCge nichts passiert":t==="variantend"?"Variantenende":t==="other"?"Unbekannter Grund":vue()}function vue(t){throw new Error("this should *never* happen")}function bue(t){return t.isCheckmate()?{result:t.turn()==="w"?"0-1":"1-0",reason:"checkmate"}:t.isDraw()?{result:"1/2-1/2",reason:t.isStalemate()?"stalemate":t.isThreefoldRepetition()?"repetition":t.isInsufficientMaterial()?"insufficient":"agreement"}:{result:"*",reason:"other"}}const yue={data:()=>({game:Wt,status:bue(Wt),showPgn:!1}),components:{InfoBox:BR},computed:{result(){return this.status.result==="1-0"?"1 - 0":this.status.result==="0-1"?"0 - 1":"\xBD - \xBD"},winPieceIcons(){return this.status.result==="0-1"?`${this.pieceIcon("bK")}`:this.status.result==="1-0"?`${this.pieceIcon("wK")}`:`${this.pieceIcon("wK")}&emsp;${this.pieceIcon("bK")}`},pgn(){return this.game.pgn()}},methods:{pieceIcon(t){return`
        <img src="${va(t)}" class="small-piece"/>
      `},newGame(){Qce(),this.$emit("new")},gameOverString(){const t=["Game over","Spiel vorbei!"];return this.status.result==="0-1"?t.push("Schwarz gewinnt!","Sieg f\xFCr Schwarz!"):this.status.result==="1-0"?t.push("Wei\xDF gewinnt!","Sieg f\xFCr Wei\xDF!"):t.push("Unentschieden!","Remis!"),t[Math.random()*t.length|0]},translateReason:gue},emits:["new"]};const xue=ye({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:t=>!isNaN(parseFloat(t))},maxRows:{type:[Number,String],validator:t=>!isNaN(parseFloat(t))},suffix:String,modelModifiers:Object,...Bd(),...O0()},"VTextarea"),wue=Re()({name:"VTextarea",directives:{Intersect:y0},inheritAttrs:!1,props:xue(),emits:{"click:control":t=>!0,"mousedown:control":t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,e){let{attrs:n,emit:s,slots:o}=e;const r=Mt(t,"modelValue"),{isFocused:i,focus:a,blur:l}=Ld(t),c=M(()=>typeof t.counterValue=="function"?t.counterValue(r.value):(r.value||"").toString().length),u=M(()=>{if(n.maxlength)return n.maxlength;if(!(!t.counter||typeof t.counter!="number"&&typeof t.counter!="string"))return t.counter});function d(E,_){var A,O;!t.autofocus||!E||(O=(A=_[0].target)==null?void 0:A.focus)==null||O.call(A)}const h=_e(),f=_e(),p=He(""),m=_e(),g=M(()=>t.persistentPlaceholder||i.value||t.active);function v(){var E;m.value!==document.activeElement&&((E=m.value)==null||E.focus()),i.value||a()}function b(E){v(),s("click:control",E)}function y(E){s("mousedown:control",E)}function x(E){E.stopPropagation(),v(),gn(()=>{r.value="",J_(t["onClick:clear"],E)})}function w(E){var A;const _=E.target;if(r.value=_.value,(A=t.modelModifiers)!=null&&A.trim){const O=[_.selectionStart,_.selectionEnd];gn(()=>{_.selectionStart=O[0],_.selectionEnd=O[1]})}}const k=_e(),S=_e(+t.rows),C=M(()=>["plain","underlined"].includes(t.variant));To(()=>{t.autoGrow||(S.value=+t.rows)});function $(){!t.autoGrow||gn(()=>{if(!k.value||!f.value)return;const E=getComputedStyle(k.value),_=getComputedStyle(f.value.$el),A=parseFloat(E.getPropertyValue("--v-field-padding-top"))+parseFloat(E.getPropertyValue("--v-input-padding-top"))+parseFloat(E.getPropertyValue("--v-field-padding-bottom")),O=k.value.scrollHeight,B=parseFloat(E.lineHeight),F=Math.max(parseFloat(t.rows)*B+A,parseFloat(_.getPropertyValue("--v-input-control-height"))),V=parseFloat(t.maxRows)*B+A||1/0,D=Tr(O!=null?O:0,F,V);S.value=Math.floor((D-A)/B),p.value=Fe(D)})}ir($),ze(r,$),ze(()=>t.rows,$),ze(()=>t.maxRows,$),ze(()=>t.density,$);let T;return ze(k,E=>{E?(T=new ResizeObserver($),T.observe(k.value)):T==null||T.disconnect()}),oo(()=>{T==null||T.disconnect()}),Ge(()=>{const E=!!(o.counter||t.counter||t.counterValue),_=!!(E||o.details),[A,O]=vm(n),[{modelValue:B,...F}]=pi.filterProps(t),[V]=yR(t);return I(pi,Ue({ref:h,modelValue:r.value,"onUpdate:modelValue":D=>r.value=D,class:["v-textarea v-text-field",{"v-textarea--prefixed":t.prefix,"v-textarea--suffixed":t.suffix,"v-text-field--prefixed":t.prefix,"v-text-field--suffixed":t.suffix,"v-textarea--auto-grow":t.autoGrow,"v-textarea--no-resize":t.noResize||t.autoGrow,"v-text-field--plain-underlined":C.value},t.class],style:t.style},A,F,{centerAffix:S.value===1&&!C.value,focused:i.value}),{...o,default:D=>{let{isDisabled:U,isDirty:J,isReadonly:X,isValid:te}=D;return I(P0,Ue({ref:f,style:{"--v-textarea-control-height":p.value},onClick:b,onMousedown:y,"onClick:clear":x,"onClick:prependInner":t["onClick:prependInner"],"onClick:appendInner":t["onClick:appendInner"]},V,{active:g.value||J.value,centerAffix:S.value===1&&!C.value,dirty:J.value||t.dirty,disabled:U.value,focused:i.value,error:te.value===!1}),{...o,default:ie=>{let{props:{class:ue,...ce}}=ie;return I(ot,null,[t.prefix&&I("span",{class:"v-text-field__prefix"},[t.prefix]),$n(I("textarea",Ue({ref:m,class:ue,value:r.value,onInput:w,autofocus:t.autofocus,readonly:X.value,disabled:U.value,placeholder:t.placeholder,rows:t.rows,name:t.name,onFocus:v,onBlur:l},ce,O),null),[[ar("intersect"),{handler:d},null,{once:!0}]]),t.autoGrow&&$n(I("textarea",{class:[ue,"v-textarea__sizer"],id:`${ce.id}-sizer`,"onUpdate:modelValue":Y=>r.value=Y,ref:k,readonly:!0,"aria-hidden":"true"},null),[[YO,r.value]]),t.suffix&&I("span",{class:"v-text-field__suffix"},[t.suffix])])}})},details:_?D=>{var U;return I(ot,null,[(U=o.details)==null?void 0:U.call(o,D),E&&I(ot,null,[I("span",null,null),I(bR,{active:t.persistentCounter||i.value,value:c.value,max:u.value},o.counter)])])}:void 0})}),ec({},h,f,m)}}),Cue=["innerHTML"],kue=["innerHTML"],Sue={class:"text-h5 mb-4"};function Iue(t,e,n,s,o,r){const i=Ln("InfoBox");return We(),ht(Ds,null,{default:pe(()=>[I(so,{class:"text-h5"},{default:pe(()=>[gt(ts(r.gameOverString()),1),I(i,{name:"game-over"})]),_:1}),I(Io,{class:"mt-4 mb-4"},{default:pe(()=>[Ct("p",{class:"text-h2 mb-4 font-weight-bold",innerHTML:r.result},null,8,Cue),Ct("p",{class:"mb-2",innerHTML:r.winPieceIcons},null,8,kue),Ct("p",Sue,"Grund: "+ts(r.translateReason(t.status.reason)),1),I(Ds,{color:t.showPgn?null:"brown",onClick:e[2]||(e[2]=a=>t.showPgn=!t.showPgn)},{default:pe(()=>[I(so,null,{default:pe(()=>[gt("PGN")]),_:1}),I(N0,null,{default:pe(()=>[$n(I(Io,null,{default:pe(()=>[I(wue,{modelValue:r.pgn,"onUpdate:modelValue":e[0]||(e[0]=a=>r.pgn=a),rows:1,"auto-grow":!0,counter:!1,outlined:!0,readonly:!0,onClick:e[1]||(e[1]=Cb(()=>{},["stop"]))},null,8,["modelValue"])]),_:1},512),[[mi,t.showPgn]])]),_:1})]),_:1},8,["color"]),I(us,{size:"x-large",class:"mt-6 rainbow-btn",onClick:r.newGame},{default:pe(()=>[gt("Neues Spiel")]),_:1},8,["onClick"])]),_:1})]),_:1})}const $ue=ks(yue,[["render",Iue]]),Tue=["white","black"],V0=["a","b","c","d","e","f","g","h"],z0=["1","2","3","4","5","6","7","8"],Nue=[...z0].reverse(),W0=Array.prototype.concat(...V0.map(t=>z0.map(e=>t+e))),Gs=t=>W0[8*t[0]+t[1]],Bt=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],zR=W0.map(Bt);function Eue(t){let e;const n=()=>(e===void 0&&(e=t()),e);return n.clear=()=>{e=void 0},n}const _ue=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},U0=t=>t==="white"?"black":"white",au=(t,e)=>{const n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s},zv=(t,e)=>t.role===e.role&&t.color===e.color,Vd=t=>(e,n)=>[(n?e[0]:7-e[0])*t.width/8,(n?7-e[1]:e[1])*t.height/8],Bo=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},WR=(t,e,n=1)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px) scale(${n})`},G0=(t,e)=>{t.style.visibility=e?"visible":"hidden"},Ma=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},UR=t=>t.buttons===2||t.button===2,yr=(t,e)=>{const n=document.createElement(t);return e&&(n.className=e),n};function GR(t,e,n){const s=Bt(t);return e||(s[0]=7-s[0],s[1]=7-s[1]),[n.left+n.width*s[0]/8+n.width/16,n.top+n.height*(7-s[1])/8+n.height/16]}const ba=(t,e)=>Math.abs(t-e),Aue=t=>(e,n,s,o)=>ba(e,s)<2&&(t==="white"?o===n+1||n<=1&&o===n+2&&e===s:o===n-1||n>=6&&o===n-2&&e===s),HR=(t,e,n,s)=>{const o=ba(t,n),r=ba(e,s);return o===1&&r===2||o===2&&r===1},jR=(t,e,n,s)=>ba(t,n)===ba(e,s),KR=(t,e,n,s)=>t===n||e===s,qR=(t,e,n,s)=>jR(t,e,n,s)||KR(t,e,n,s),Rue=(t,e,n)=>(s,o,r,i)=>ba(s,r)<2&&ba(o,i)<2||n&&o===i&&o===(t==="white"?0:7)&&(s===4&&(r===2&&e.includes(0)||r===6&&e.includes(7))||e.includes(r));function Due(t,e){const n=e==="white"?"1":"8",s=[];for(const[o,r]of t)o[1]===n&&r.color===e&&r.role==="rook"&&s.push(Bt(o)[0]);return s}function XR(t,e,n){const s=t.get(e);if(!s)return[];const o=Bt(e),r=s.role,i=r==="pawn"?Aue(s.color):r==="knight"?HR:r==="bishop"?jR:r==="rook"?KR:r==="queen"?qR:Rue(s.color,Due(t,s.color),n);return zR.filter(a=>(o[0]!==a[0]||o[1]!==a[1])&&i(o[0],o[1],a[0],a[1])).map(Gs)}function xs(t,...e){t&&setTimeout(()=>t(...e),1)}function Fue(t){t.orientation=U0(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function Oue(t,e){for(const[n,s]of e)s?t.pieces.set(n,s):t.pieces.delete(n)}function Pue(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[n,s]of t.pieces)s.role==="king"&&s.color===e&&(t.check=n)}function Mue(t,e,n,s){_i(t),t.premovable.current=[e,n],xs(t.premovable.events.set,e,n,s)}function Ei(t){t.premovable.current&&(t.premovable.current=void 0,xs(t.premovable.events.unset))}function Lue(t,e,n){Ei(t),t.predroppable.current={role:e,key:n},xs(t.predroppable.events.set,e,n)}function _i(t){const e=t.predroppable;e.current&&(e.current=void 0,xs(e.events.unset))}function Bue(t,e,n){if(!t.autoCastle)return!1;const s=t.pieces.get(e);if(!s||s.role!=="king")return!1;const o=Bt(e),r=Bt(n);if(o[1]!==0&&o[1]!==7||o[1]!==r[1])return!1;o[0]===4&&!t.pieces.has(n)&&(r[0]===6?n=Gs([7,r[1]]):r[0]===2&&(n=Gs([0,r[1]])));const i=t.pieces.get(n);return!i||i.color!==s.color||i.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(n),o[0]<r[0]?(t.pieces.set(Gs([6,r[1]]),s),t.pieces.set(Gs([5,r[1]]),i)):(t.pieces.set(Gs([2,r[1]]),s),t.pieces.set(Gs([3,r[1]]),i)),!0)}function YR(t,e,n){const s=t.pieces.get(e),o=t.pieces.get(n);if(e===n||!s)return!1;const r=o&&o.color!==s.color?o:void 0;return n===t.selected&&Js(t),xs(t.events.move,e,n,r),Bue(t,e,n)||(t.pieces.set(n,s),t.pieces.delete(e)),t.lastMove=[e,n],t.check=void 0,xs(t.events.change),r||!0}function H0(t,e,n,s){if(t.pieces.has(n))if(s)t.pieces.delete(n);else return!1;return xs(t.events.dropNewPiece,e,n),t.pieces.set(n,e),t.lastMove=[n],t.check=void 0,xs(t.events.change),t.movable.dests=void 0,t.turnColor=U0(t.turnColor),!0}function ZR(t,e,n){const s=YR(t,e,n);return s&&(t.movable.dests=void 0,t.turnColor=U0(t.turnColor),t.animation.current=void 0),s}function QR(t,e,n){if(j0(t,e,n)){const s=ZR(t,e,n);if(s){const o=t.hold.stop();Js(t);const r={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:o};return s!==!0&&(r.captured=s),xs(t.movable.events.after,e,n,r),!0}}else if(zue(t,e,n))return Mue(t,e,n,{ctrlKey:t.stats.ctrlKey}),Js(t),!0;return Js(t),!1}function JR(t,e,n,s){const o=t.pieces.get(e);o&&(Vue(t,e,n)||s)?(t.pieces.delete(e),H0(t,o,n,s),xs(t.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&Wue(t,e,n)?Lue(t,o.role,n):(Ei(t),_i(t)),t.pieces.delete(e),Js(t)}function Wv(t,e,n){if(xs(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){Js(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==e&&QR(t,t.selected,e)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(tD(t,e)||K0(t,e))&&(eD(t,e),t.hold.start())}function eD(t,e){t.selected=e,K0(t,e)?t.premovable.customDests||(t.premovable.dests=XR(t.pieces,e,t.premovable.castle)):t.premovable.dests=void 0}function Js(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function tD(t,e){const n=t.pieces.get(e);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}const j0=(t,e,n)=>{var s,o;return e!==n&&tD(t,e)&&(t.movable.free||!!(!((o=(s=t.movable.dests)===null||s===void 0?void 0:s.get(e))===null||o===void 0)&&o.includes(n)))};function Vue(t,e,n){const s=t.pieces.get(e);return!!s&&(e===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===s.color&&t.turnColor===s.color)}function K0(t,e){const n=t.pieces.get(e);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}function zue(t,e,n){var s,o;const r=(o=(s=t.premovable.customDests)===null||s===void 0?void 0:s.get(e))!==null&&o!==void 0?o:XR(t.pieces,e,t.premovable.castle);return e!==n&&K0(t,e)&&r.includes(n)}function Wue(t,e,n){const s=t.pieces.get(e),o=t.pieces.get(n);return!!s&&(!o||o.color!==t.movable.color)&&t.predroppable.enabled&&(s.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===s.color&&t.turnColor!==s.color}function Uue(t,e){const n=t.pieces.get(e);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function Gue(t){const e=t.premovable.current;if(!e)return!1;const n=e[0],s=e[1];let o=!1;if(j0(t,n,s)){const r=ZR(t,n,s);if(r){const i={premove:!0};r!==!0&&(i.captured=r),xs(t.movable.events.after,n,s,i),o=!0}}return Ei(t),o}function Hue(t,e){const n=t.predroppable.current;let s=!1;if(!n)return!1;if(e(n)){const o={role:n.role,color:t.movable.color};H0(t,o,n.key)&&(xs(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),s=!0)}return _i(t),s}function q0(t){Ei(t),_i(t),Js(t)}function Mk(t){t.movable.color=t.movable.dests=t.animation.current=void 0,q0(t)}function La(t,e,n){let s=Math.floor(8*(t[0]-n.left)/n.width);e||(s=7-s);let o=7-Math.floor(8*(t[1]-n.top)/n.height);return e||(o=7-o),s>=0&&s<8&&o>=0&&o<8?Gs([s,o]):void 0}function jue(t,e,n,s){const o=Bt(t),r=zR.filter(c=>qR(o[0],o[1],c[0],c[1])||HR(o[0],o[1],c[0],c[1])),a=r.map(c=>GR(Gs(c),n,s)).map(c=>au(e,c)),[,l]=a.reduce((c,u,d)=>c[0]<u?c:[u,d],[a[0],0]);return Gs(r[l])}const ws=t=>t.orientation==="white",nD="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Kue={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},que={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function lu(t){t==="start"&&(t=nD);const e=new Map;let n=7,s=0;for(const o of t)switch(o){case" ":case"[":return e;case"/":if(--n,n<0)return e;s=0;break;case"~":{const r=e.get(Gs([s-1,n]));r&&(r.promoted=!0);break}default:{const r=o.charCodeAt(0);if(r<57)s+=r-48;else{const i=o.toLowerCase();e.set(Gs([s,n]),{role:Kue[i],color:o===i?"black":"white"}),++s}}}return e}function sD(t){return Nue.map(e=>V0.map(n=>{const s=t.get(n+e);if(s){let o=que[s.role];return s.color==="white"&&(o=o.toUpperCase()),s.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function oD(t,e){e.animation&&(X0(t.animation,e.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function rD(t,e){var n,s,o;if(!((n=e.movable)===null||n===void 0)&&n.dests&&(t.movable.dests=void 0),!((s=e.drawable)===null||s===void 0)&&s.autoShapes&&(t.drawable.autoShapes=[]),X0(t,e),e.fen&&(t.pieces=lu(e.fen),t.drawable.shapes=((o=e.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in e&&Pue(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&eD(t,t.selected),oD(t,e),!t.movable.rookCastle&&t.movable.dests){const r=t.movable.color==="white"?"1":"8",i="e"+r,a=t.movable.dests.get(i),l=t.pieces.get(i);if(!a||!l||l.role!=="king")return;t.movable.dests.set(i,a.filter(c=>!(c==="a"+r&&a.includes("c"+r))&&!(c==="h"+r&&a.includes("g"+r))))}}function X0(t,e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)&&Lk(t[n])&&Lk(e[n])?X0(t[n],e[n]):t[n]=e[n])}function Lk(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null}const Li=(t,e)=>e.animation.enabled?Zue(t,e):Gr(t,e);function Gr(t,e){const n=t(e);return e.dom.redraw(),n}const xg=(t,e)=>({key:t,pos:Bt(t),piece:e}),Xue=(t,e)=>e.sort((n,s)=>au(t.pos,n.pos)-au(t.pos,s.pos))[0];function Yue(t,e){const n=new Map,s=[],o=new Map,r=[],i=[],a=new Map;let l,c,u;for(const[d,h]of t)a.set(d,xg(d,h));for(const d of W0)l=e.pieces.get(d),c=a.get(d),l?c?zv(l,c.piece)||(r.push(c),i.push(xg(d,l))):i.push(xg(d,l)):c&&r.push(c);for(const d of i)c=Xue(d,r.filter(h=>zv(d.piece,h.piece))),c&&(u=[c.pos[0]-d.pos[0],c.pos[1]-d.pos[1]],n.set(d.key,u.concat(u)),s.push(c.key));for(const d of r)s.includes(d.key)||o.set(d.key,d.piece);return{anims:n,fadings:o}}function iD(t,e){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const s=1-(e-n.start)*n.frequency;if(s<=0)t.animation.current=void 0,t.dom.redrawNow();else{const o=Que(s);for(const r of n.plan.anims.values())r[2]=r[0]*o,r[3]=r[1]*o;t.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>iD(t,r))}}function Zue(t,e){const n=new Map(e.pieces),s=t(e),o=Yue(n,e);if(o.anims.size||o.fadings.size){const r=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:o},r||iD(e,performance.now())}else e.dom.redraw();return s}const Que=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,Jue=["green","red","blue","yellow"];function ede(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?Js(t):q0(t);const n=Ma(e),s=La(n,ws(t),t.dom.bounds());!s||(t.drawable.current={orig:s,pos:n,brush:ode(e),snapToValidMove:t.drawable.defaultSnapToValidMove},aD(t))}function aD(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const n=La(e.pos,ws(t),t.dom.bounds());n||(e.snapToValidMove=!1);const s=e.snapToValidMove?jue(e.orig,e.pos,ws(t),t.dom.bounds()):n;s!==e.mouseSq&&(e.mouseSq=s,e.dest=s!==e.orig?s:void 0,t.dom.redrawNow()),aD(t)}})}function tde(t,e){t.drawable.current&&(t.drawable.current.pos=Ma(e))}function nde(t){const e=t.drawable.current;e&&(e.mouseSq&&rde(t.drawable,e),lD(t))}function lD(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function sde(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),cD(t.drawable))}function ode(t){var e;const n=(t.shiftKey||t.ctrlKey)&&UR(t),s=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return Jue[(n?1:0)+(s?2:0)]}function rde(t,e){const n=o=>o.orig===e.orig&&o.dest===e.dest,s=t.shapes.find(n);s&&(t.shapes=t.shapes.filter(o=>!n(o))),(!s||s.brush!==e.brush)&&t.shapes.push({orig:e.orig,dest:e.dest,brush:e.brush}),cD(t)}function cD(t){t.onChange&&t.onChange(t.shapes)}function ide(t,e){if(!(t.trustAllEvents||e.isTrusted)||e.button!==void 0&&e.button!==0||e.touches&&e.touches.length>1)return;const n=t.dom.bounds(),s=Ma(e),o=La(s,ws(t),n);if(!o)return;const r=t.pieces.get(o),i=t.selected;if(!i&&t.drawable.enabled&&(t.drawable.eraseOnClick||!r||r.color!==t.turnColor)&&sde(t),e.cancelable!==!1&&(!e.touches||t.blockTouchScroll||r||i||ade(t,s)))e.preventDefault();else if(e.touches)return;const a=!!t.premovable.current,l=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&j0(t,t.selected,o)?Li(d=>Wv(d,o),t):Wv(t,o);const c=t.selected===o,u=dD(t,o);if(r&&u&&c&&Uue(t,o)){t.draggable.current={orig:o,piece:r,origPos:s,pos:s,started:t.draggable.autoDistance&&t.stats.dragged,element:u,previouslySelected:i,originTarget:e.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const d=t.dom.elements.ghost;d&&(d.className=`ghost ${r.color} ${r.role}`,Bo(d,Vd(n)(Bt(o),ws(t))),G0(d,!0)),Y0(t)}else a&&Ei(t),l&&_i(t);t.dom.redraw()}function ade(t,e){const n=ws(t),s=t.dom.bounds(),o=Math.pow(s.width/8,2);for(const r of t.pieces.keys()){const i=GR(r,n,s);if(au(i,e)<=o)return!0}return!1}function lde(t,e,n,s){const o="a0";t.pieces.set(o,e),t.dom.redraw();const r=Ma(n);t.draggable.current={orig:o,piece:e,origPos:r,pos:r,started:!0,element:()=>dD(t,o),originTarget:n.target,newPiece:!0,force:!!s,keyHasChanged:!1},Y0(t)}function Y0(t){requestAnimationFrame(()=>{var e;const n=t.draggable.current;if(!n)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(n.orig)&&(t.animation.current=void 0);const s=t.pieces.get(n.orig);if(!s||!zv(s,n.piece))kf(t);else if(!n.started&&au(n.pos,n.origPos)>=Math.pow(t.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const r=n.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),n.element=r}const o=t.dom.bounds();Bo(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==La(n.pos,ws(t),o))}Y0(t)})}function cde(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=Ma(e))}function ude(t,e){const n=t.draggable.current;if(!n)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&n.originTarget!==e.target&&!n.newPiece){t.draggable.current=void 0;return}Ei(t),_i(t);const s=Ma(e)||n.pos,o=La(s,ws(t),t.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?JR(t,n.orig,o,n.force):(t.stats.ctrlKey=e.ctrlKey,QR(t,n.orig,o)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!o&&(t.pieces.delete(n.orig),xs(t.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?Js(t):t.selectable.enabled||Js(t),uD(t),t.draggable.current=void 0,t.dom.redraw()}function kf(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,Js(t),uD(t),t.dom.redraw())}function uD(t){const e=t.dom.elements;e.ghost&&G0(e.ghost,!1)}function dD(t,e){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===e&&n.tagName==="PIECE")return n;n=n.nextSibling}}function dde(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{Bk(t,2),setTimeout(()=>Bk(t,void 0),120)},120)}function Bk(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function hde(t,e){function n(){Fue(t),e()}return{set(s){s.orientation&&s.orientation!==t.orientation&&n(),oD(t,s),(s.fen?Li:Gr)(o=>rD(o,s),t)},state:t,getFen:()=>sD(t.pieces),toggleOrientation:n,setPieces(s){Li(o=>Oue(o,s),t)},selectSquare(s,o){s?Li(r=>Wv(r,s,o),t):t.selected&&(Js(t),t.dom.redraw())},move(s,o){Li(r=>YR(r,s,o),t)},newPiece(s,o){Li(r=>H0(r,s,o),t)},playPremove(){if(t.premovable.current){if(Li(Gue,t))return!0;t.dom.redraw()}return!1},playPredrop(s){if(t.predroppable.current){const o=Hue(t,s);return t.dom.redraw(),o}return!1},cancelPremove(){Gr(Ei,t)},cancelPredrop(){Gr(_i,t)},cancelMove(){Gr(s=>{q0(s),kf(s)},t)},stop(){Gr(s=>{Mk(s),kf(s)},t)},explode(s){dde(t,s)},setAutoShapes(s){Gr(o=>o.drawable.autoShapes=s,t)},setShapes(s){Gr(o=>o.drawable.shapes=s,t)},getKeyAtDomPos(s){return La(s,ws(t),t.dom.bounds())},redrawAll:e,dragNewPiece(s,o,r){lde(t,s,o,r)},destroy(){Mk(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function fde(){return{pieces:lu(nD),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purp",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},hilite:{key:"hilite",color:"#fff",opacity:1,lineWidth:1}},prevSvgHash:""},hold:_ue()}}function pde(){const t=mn("defs"),e=ss(mn("filter"),{id:"cg-filter-blur"});return e.appendChild(ss(mn("feGaussianBlur"),{stdDeviation:"0.022"})),t.appendChild(e),t}function mde(t,e,n){var s;const o=t.drawable,r=o.current,i=r&&r.mouseSq?r:void 0,a=new Map,l=t.dom.bounds(),c=o.autoShapes.filter(f=>!f.piece);for(const f of o.shapes.concat(c).concat(i?[i]:[])){if(!f.dest)continue;const p=(s=a.get(f.dest))!==null&&s!==void 0?s:new Set,m=If(Sf(Bt(f.orig),t.orientation),l),g=If(Sf(Bt(f.dest),t.orientation),l);p.add(Gv(m,g)),a.set(f.dest,p)}const u=o.shapes.concat(c).map(f=>({shape:f,current:!1,hash:Vk(f,Uv(f.dest,a),!1,l)}));i&&u.push({shape:i,current:!0,hash:Vk(i,Uv(i.dest,a),!0,l)});const d=u.map(f=>f.hash).join(";");if(d===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=d;const h=e.querySelector("defs");gde(o,u,h),vde(u,e.querySelector("g"),n.querySelector("g"),f=>xde(t,f,o.brushes,a,l))}function gde(t,e,n){var s;const o=new Map;let r;for(const l of e)l.shape.dest&&(r=hD(t.brushes[l.shape.brush],l.shape.modifiers),!((s=l.shape.modifiers)===null||s===void 0)&&s.hilite&&o.set("hilite",t.brushes.hilite),o.set(r.key,r));const i=new Set;let a=n.firstElementChild;for(;a;)i.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[l,c]of o.entries())i.has(l)||n.appendChild(kde(c))}function vde(t,e,n,s){const o=new Map;for(const r of t)o.set(r.hash,!1);for(const r of[e,n]){const i=[];let a=r.firstElementChild,l;for(;a;)l=a.getAttribute("cgHash"),o.has(l)?o.set(l,!0):i.push(a),a=a.nextElementSibling;for(const c of i)r.removeChild(c)}for(const r of t.filter(i=>!o.get(i.hash)))for(const i of s(r))i.isCustom?n.appendChild(i.el):e.appendChild(i.el)}function Vk({orig:t,dest:e,brush:n,piece:s,modifiers:o,customSvg:r,label:i},a,l,c){return[c.width,c.height,l,t,e,n,a&&"-",s&&bde(s),o&&yde(o),r&&`custom-${zk(r)}`,i&&`label-${zk(i.text)}`].filter(u=>u).join(",")}function bde(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function yde(t){var e;return[t.lineWidth,t.hilite&&"*",(e=t.overlayCustomSvg)===null||e===void 0?void 0:e[0]].filter(n=>n).join(",")}function zk(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)>>>0;return e.toString()}function xde(t,{shape:e,current:n,hash:s},o,r,i){var a,l,c;const u=If(Sf(Bt(e.orig),t.orientation),i),d=e.dest?If(Sf(Bt(e.dest),t.orientation),i):u,h=hD(o[e.brush],e.modifiers),f=r.get(e.dest),p=[];if(!e.customSvg||((a=e.modifiers)===null||a===void 0?void 0:a.overlayCustomSvg)){const m=ss(mn("g"),{cgHash:s});p.push({el:m}),u[0]!==d[0]||u[1]!==d[1]?m.appendChild(Cde(e,h,u,d,n,Uv(e.dest,r))):m.appendChild(wde(o[e.brush],u,n,i)),e.label&&p.push({el:Sde(e.label.text,h.color,s,u,d,f),isCustom:!0})}if(e.customSvg){const m=(c=(l=e.modifiers)===null||l===void 0?void 0:l.overlayCustomSvg)!==null&&c!==void 0?c:"orig",[g,v]=m==="label"?pD(u,d,f):m==="dest"?d:u,b=ss(mn("g"),{transform:`translate(${g},${v})`,cgHash:s});b.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${e.customSvg}</svg>`,p.push({el:b,isCustom:!0})}return p}function wde(t,e,n,s){const o=Ide(),r=(s.width+s.height)/(4*Math.max(s.width,s.height));return ss(mn("circle"),{stroke:t.color,"stroke-width":o[n?0:1],fill:"none",opacity:fD(t,n),cx:e[0],cy:e[1],r:r-o[1]/2})}function Cde(t,e,n,s,o,r){var i;function a(u){var d;const h=Tde(r&&!o),f=s[0]-n[0],p=s[1]-n[1],m=Math.atan2(p,f),g=Math.cos(m)*h,v=Math.sin(m)*h;return ss(mn("line"),{stroke:u?"white":e.color,"stroke-width":$de(e,o)+(u?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?"hilite":e.key})`,opacity:!((d=t.modifiers)===null||d===void 0)&&d.hilite?1:fD(e,o),x1:n[0],y1:n[1],x2:s[0]-g,y2:s[1]-v})}if(!(!((i=t.modifiers)===null||i===void 0)&&i.hilite))return a(!1);const l=mn("g"),c=ss(mn("g"),{filter:"url(#cg-filter-blur)"});return c.appendChild(Nde(n,s)),c.appendChild(a(!0)),l.appendChild(c),l.appendChild(a(!1)),l}function kde(t){const e=ss(mn("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key==="hilite"?1.86:2.05,refY:2});return e.appendChild(ss(mn("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function Sde(t,e,n,s,o,r){const a=.4*.8**t.length,[l,c]=pD(s,o,r),u=ss(mn("g"),{transform:`translate(${l+.5},${c+.5})`,cgHash:n});u.appendChild(ss(mn("circle"),{r:.4/2,"fill-opacity":.8,"stroke-opacity":.7,"stroke-width":.03,fill:e,stroke:"white"}));const d=ss(mn("text"),{"font-size":a,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:a*.34,innerHTML:t});return d.innerHTML=t,u.appendChild(d),u}function Sf(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function Uv(t,e){return(t&&e.has(t)&&e.get(t).size>1)===!0}function mn(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function ss(t,e){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.setAttribute(n,e[n]);return t}function hD(t,e){return e?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(n=>n).join("")}:t}function Ide(){return[3/64,4/64]}function $de(t,e){return(t.lineWidth||10)*(e?.85:1)/64}function fD(t,e){return(t.opacity||1)*(e?.9:1)}function Tde(t){return(t?20:10)/64}function If(t,e){const n=Math.min(1,e.width/e.height),s=Math.min(1,e.height/e.width);return[(t[0]-3.5)*n,(3.5-t[1])*s]}function Nde(t,e){const n={from:[Math.floor(Math.min(t[0],e[0])),Math.floor(Math.min(t[1],e[1]))],to:[Math.ceil(Math.max(t[0],e[0])),Math.ceil(Math.max(t[1],e[1]))]};return ss(mn("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function Gv(t,e,n=!0){const s=Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI;return n?(Math.round(s*8/Math.PI)+16)%16:s}function Ede(t,e){return Math.sqrt([t[0]-e[0],t[1]-e[1]].reduce((n,s)=>n+s*s,0))}function pD(t,e,n){let s=Ede(t,e);if(s===0)return[.5+t[0],.5+t[1]];const o=Gv(t,e,!1);if(n&&(s-=33/64,n.size>1)){s-=10/64;const r=Gv(t,e);(n.has((r+1)%16)||n.has((r+15)%16))&&r&1&&(s-=.4)}return[t[0]-Math.cos(o)*s,t[1]-Math.sin(o)*s]}function _de(t,e){t.innerHTML="",t.classList.add("cg-wrap");for(const l of Tue)t.classList.toggle("orientation-"+l,e.orientation===l);t.classList.toggle("manipulable",!e.viewOnly);const n=yr("cg-container");t.appendChild(n);const s=yr("cg-board");n.appendChild(s);let o,r,i;if(e.drawable.visible&&(o=ss(mn("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(pde()),o.appendChild(mn("g")),r=ss(mn("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(mn("g")),i=yr("cg-auto-pieces"),n.appendChild(o),n.appendChild(r),n.appendChild(i)),e.coordinates){const l=e.orientation==="black"?" black":"",c=e.ranksPosition==="left"?" left":"";n.appendChild(Wk(z0,"ranks"+l+c)),n.appendChild(Wk(V0,"files"+l))}let a;return e.draggable.enabled&&e.draggable.showGhost&&(a=yr("piece","ghost"),G0(a,!1),n.appendChild(a)),{board:s,container:n,wrap:t,ghost:a,svg:o,customSvg:r,autoPieces:i}}function Wk(t,e){const n=yr("coords",e);let s;for(const o of t)s=yr("coord"),s.textContent=o,n.appendChild(s);return n}function Ade(t,e){if(!t.dropmode.active)return;Ei(t),_i(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const s=Ma(e),o=s&&La(s,ws(t),t.dom.bounds());o&&JR(t,"a0",o)}t.dom.redraw()}function Rde(t,e){const n=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(e).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault()),t.viewOnly)return;const s=Fde(t);n.addEventListener("touchstart",s,{passive:!1}),n.addEventListener("mousedown",s,{passive:!1})}function Dde(t,e){const n=[];if("ResizeObserver"in window||n.push(hc(document.body,"chessground.resize",e)),!t.viewOnly){const s=Uk(t,cde,tde),o=Uk(t,ude,nde);for(const i of["touchmove","mousemove"])n.push(hc(document,i,s));for(const i of["touchend","mouseup"])n.push(hc(document,i,o));const r=()=>t.dom.bounds.clear();n.push(hc(document,"scroll",r,{capture:!0,passive:!0})),n.push(hc(window,"resize",r,{passive:!0}))}return()=>n.forEach(s=>s())}function hc(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}const Fde=t=>e=>{t.draggable.current?kf(t):t.drawable.current?lD(t):e.shiftKey||UR(e)?t.drawable.enabled&&ede(t,e):t.viewOnly||(t.dropmode.active?Ade(t,e):ide(t,e))},Uk=(t,e,n)=>s=>{t.drawable.current?t.drawable.enabled&&n(t,s):t.viewOnly||e(t,s)};function Ode(t){const e=ws(t),n=Vd(t.dom.bounds()),s=t.dom.elements.board,o=t.pieces,r=t.animation.current,i=r?r.plan.anims:new Map,a=r?r.plan.fadings:new Map,l=t.draggable.current,c=Mde(t),u=new Set,d=new Set,h=new Map,f=new Map;let p,m,g,v,b,y,x,w,k,S;for(m=s.firstChild;m;){if(p=m.cgKey,mD(m))if(g=o.get(p),b=i.get(p),y=a.get(p),v=m.cgPiece,m.cgDragging&&(!l||l.orig!==p)&&(m.classList.remove("dragging"),Bo(m,n(Bt(p),e)),m.cgDragging=!1),!y&&m.cgFading&&(m.cgFading=!1,m.classList.remove("fading")),g){if(b&&m.cgAnimating&&v===fc(g)){const C=Bt(p);C[0]+=b[2],C[1]+=b[3],m.classList.add("anim"),Bo(m,n(C,e))}else m.cgAnimating&&(m.cgAnimating=!1,m.classList.remove("anim"),Bo(m,n(Bt(p),e)),t.addPieceZIndex&&(m.style.zIndex=wg(Bt(p),e)));v===fc(g)&&(!y||!m.cgFading)?u.add(p):y&&v===fc(y)?(m.classList.add("fading"),m.cgFading=!0):Cg(h,v,m)}else Cg(h,v,m);else if(gD(m)){const C=m.className;c.get(p)===C?d.add(p):Cg(f,C,m)}m=m.nextSibling}for(const[C,$]of c)if(!d.has(C)){k=f.get($),S=k&&k.pop();const T=n(Bt(C),e);if(S)S.cgKey=C,Bo(S,T);else{const E=yr("square",$);E.cgKey=C,Bo(E,T),s.insertBefore(E,s.firstChild)}}for(const[C,$]of o)if(b=i.get(C),!u.has(C))if(x=h.get(fc($)),w=x&&x.pop(),w){w.cgKey=C,w.cgFading&&(w.classList.remove("fading"),w.cgFading=!1);const T=Bt(C);t.addPieceZIndex&&(w.style.zIndex=wg(T,e)),b&&(w.cgAnimating=!0,w.classList.add("anim"),T[0]+=b[2],T[1]+=b[3]),Bo(w,n(T,e))}else{const T=fc($),E=yr("piece",T),_=Bt(C);E.cgPiece=T,E.cgKey=C,b&&(E.cgAnimating=!0,_[0]+=b[2],_[1]+=b[3]),Bo(E,n(_,e)),t.addPieceZIndex&&(E.style.zIndex=wg(_,e)),s.appendChild(E)}for(const C of h.values())Hk(t,C);for(const C of f.values())Hk(t,C)}function Pde(t){const e=ws(t),n=Vd(t.dom.bounds());let s=t.dom.elements.board.firstChild;for(;s;)(mD(s)&&!s.cgAnimating||gD(s))&&Bo(s,n(Bt(s.cgKey),e)),s=s.nextSibling}function Gk(t){var e,n;const s=t.dom.elements.wrap.getBoundingClientRect(),o=t.dom.elements.container,r=s.height/s.width,i=Math.floor(s.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=i*r;o.style.width=i+"px",o.style.height=a+"px",t.dom.bounds.clear(),(e=t.addDimensionsCssVarsTo)===null||e===void 0||e.style.setProperty("--cg-width",i+"px"),(n=t.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",a+"px")}const mD=t=>t.tagName==="PIECE",gD=t=>t.tagName==="SQUARE";function Hk(t,e){for(const n of e)t.dom.elements.board.removeChild(n)}function wg(t,e){const s=t[1];return`${e?3+7-s:3+s}`}const fc=t=>`${t.color} ${t.role}`;function Mde(t){var e,n,s;const o=new Map;if(t.lastMove&&t.highlight.lastMove)for(const a of t.lastMove)hr(o,a,"last-move");if(t.check&&t.highlight.check&&hr(o,t.check,"check"),t.selected&&(hr(o,t.selected,"selected"),t.movable.showDests)){const a=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(a)for(const c of a)hr(o,c,"move-dest"+(t.pieces.has(c)?" oc":""));const l=(s=(n=t.premovable.customDests)===null||n===void 0?void 0:n.get(t.selected))!==null&&s!==void 0?s:t.premovable.dests;if(l)for(const c of l)hr(o,c,"premove-dest"+(t.pieces.has(c)?" oc":""))}const r=t.premovable.current;if(r)for(const a of r)hr(o,a,"current-premove");else t.predroppable.current&&hr(o,t.predroppable.current.key,"current-premove");const i=t.exploding;if(i)for(const a of i.keys)hr(o,a,"exploding"+i.stage);return t.highlight.custom&&t.highlight.custom.forEach((a,l)=>{hr(o,l,a)}),o}function hr(t,e,n){const s=t.get(e);s?t.set(e,`${s} ${n}`):t.set(e,n)}function Cg(t,e,n){const s=t.get(e);s?s.push(n):t.set(e,[n])}function Lde(t,e,n){const s=new Map,o=[];for(const a of t)s.set(a.hash,!1);let r=e.firstElementChild,i;for(;r;)i=r.getAttribute("cgHash"),s.has(i)?s.set(i,!0):o.push(r),r=r.nextElementSibling;for(const a of o)e.removeChild(a);for(const a of t)s.get(a.hash)||e.appendChild(n(a))}function Bde(t,e){const s=t.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Wde(o),current:!1}));Lde(s,e,o=>zde(t,o,t.dom.bounds()))}function Vde(t){var e;const n=ws(t),s=Vd(t.dom.bounds());let o=(e=t.dom.elements.autoPieces)===null||e===void 0?void 0:e.firstChild;for(;o;)WR(o,s(Bt(o.cgKey),n),o.cgScale),o=o.nextSibling}function zde(t,{shape:e,hash:n},s){var o,r,i;const a=e.orig,l=(o=e.piece)===null||o===void 0?void 0:o.role,c=(r=e.piece)===null||r===void 0?void 0:r.color,u=(i=e.piece)===null||i===void 0?void 0:i.scale,d=yr("piece",`${l} ${c}`);return d.setAttribute("cgHash",n),d.cgKey=a,d.cgScale=u,WR(d,Vd(s)(Bt(a),ws(t)),u),d}const Wde=t=>{var e,n,s;return[t.orig,(e=t.piece)===null||e===void 0?void 0:e.role,(n=t.piece)===null||n===void 0?void 0:n.color,(s=t.piece)===null||s===void 0?void 0:s.scale].join(",")};function Nm(t,e){const n=fde();rD(n,e||{});function s(){const o="dom"in n?n.dom.unbind:void 0,r=_de(t,n),i=Eue(()=>r.board.getBoundingClientRect()),a=u=>{Ode(c),r.autoPieces&&Bde(c,r.autoPieces),!u&&r.svg&&mde(c,r.svg,r.customSvg)},l=()=>{Gk(c),Pde(c),r.autoPieces&&Vde(c)},c=n;return c.dom={elements:r,bounds:i,redraw:Ude(a),redrawNow:a,unbind:o},c.drawable.prevSvgHash="",Gk(c),a(!1),Rde(c,l),o||(c.dom.unbind=Dde(c,l)),c.events.insert&&c.events.insert(r),c}return hde(s(),s)}function Ude(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}function Em(t){let e=new tc(t),n=[e.turn()==="w"?1:0],s=e.board().reverse().flat();for(const o of s){let r=new Array(13).fill(0);if(o===null)r[0]=1;else{let i=o.color==="w"?0:6;switch(o.type){case"p":r[1+i]=1;break;case"n":r[2+i]=1;break;case"b":r[3+i]=1;break;case"r":r[4+i]=1;break;case"q":r[5+i]=1;break;case"k":r[6+i]=1;break;default:console.error("Error: invalid piece type")}}n=n.concat(r)}return n.length!==1+(1+6*2)*64&&console.error("Invalid length",n.length,"expected",1+(1+6*2)*64),new Float32Array(n)}function Gde(t){return t>.5}function Hde(t){let e=new Map,n=0;Gde(t[n++]);for(const o of["1","2","3","4","5","6","7","8"])for(const r of["a","b","c","d","e","f","g","h"]){const i=r+o,a=t.slice(n,n+13);let l=0,c=-1/0;if(a.forEach((u,d)=>{u>c&&(c=u,l=d)}),l!=0){let u=(l-1)%6,d=Math.floor((l-1)/6);e.set(i,{role:["pawn","knight","bishop","rook","queen","king"][u],color:["white","black"][d]})}n+=13}return sD(e)}function jde(t,e){let n=lu(t),s=lu(e),o=[],r=0,i=0;for(const a of Oce){if(n.get(a)||s.get(a))r+=1;else continue;const l=d=>d.get(a)||{};let c=l(n),u=l(s);c.color+c.role!=u.color+u.role&&(o.push(a),i+=1)}return r==0&&(r=1),{ratio:i/r,deltas:o}}function vD(t){return[...t].map((n,s)=>[n,[s/64,s%64]]).map(([n,[s,o]])=>{let r=i=>String.fromCharCode(97+i);return{act:n,from:r(s%8)+(Math.floor(s/8)+1),to:r(o%8)+(Math.floor(o/8)+1)}}).sort((n,s)=>s.act-n.act)}function Kde(t){return t[0]}const qde={props:{fen:{type:String,required:!0}},data:()=>({model:null,cg:null,chess:null}),created(){K_(un("playModelName")).then(t=>this.model=t).then(()=>setTimeout(this.nextMove,1500))},async mounted(){const t={fen:this.fen,orientation:un("orientation"),viewOnly:!0,coordinates:!1,resizable:!1,addPieceZIndex:!0,highlight:{check:!0}};this.cg=Nm(this.$refs.board,t),this.chess=new tc(this.fen)},methods:{nextMove(){const t=Em(this.chess.fen()),e=this.model.predict(t),n=vD(e);for(const s of n)if(this.chess.move(s)){this.cg.move(s.from,s.to);break}this.chess.isGameOver()||setTimeout(this.nextMove,500)}}};const Xde={ref:"board",id:"chessground-continuation"};function Yde(t,e,n,s,o,r){return We(),ht(Ds,null,{default:pe(()=>[I(so,null,{default:pe(()=>[gt("Neuronale Fortsetzung")]),_:1}),I(Io,null,{default:pe(()=>[Ct("div",Xde,null,512)]),_:1})]),_:1})}const Zde=ks(qde,[["render",Yde],["__scopeId","data-v-81035060"]]),Qde={name:"Evaluation",data:()=>({model:null,evaluation:.5,blackLeft:un("orientation")==="black",error:null}),props:{fen:{type:String,required:!0}},created(){$oe(un("evaluationModelName")).then(t=>{this.model=t,this.updateEvaluation()})},watch:{fen(){this.updateEvaluation()}},computed:{displayEvaluation(){return this.evaluation>=1?1:this.evaluation<=0?0:this.sigmoid(this.logit(this.evaluation),3/5)}},methods:{updateEvaluation(){if(!this.model)return;this.error=null;let t;try{t=Em(this.fen)}catch(n){this.error=n+"";return}const e=this.model.predict(t);this.evaluation=Kde(e)},logit(t){return Math.log(t/(1-t))},sigmoid(t,e=1){return 1/(1+Math.exp(-e*t))},display(t){const e=this.logit(t),n=new Intl.NumberFormat(void 0,{minimumFractionDigits:2,maximumFractionDigits:2,signDisplay:"always"});if(isNaN(e)){if(t<=0)return n.format(-1/0);if(t>=1)return n.format(1/0)}return n.format(e)}}},Jde={class:"text-h4"};function ehe(t,e,n,s,o,r){return We(),ht(Nl,{location:"bottom"},{activator:pe(({props:i})=>[I(bA,Ue({modelValue:r.displayEvaluation,"onUpdate:modelValue":e[0]||(e[0]=a=>r.displayEvaluation=a),max:1,min:0,color:t.error?"red":"white","background-color":t.error?"#ddd":"black",reverse:t.blackLeft,height:"20",indeterminate:t.model===null,striped:!!t.error,class:"rounded-xl mt-4"},i),null,16,["modelValue","color","background-color","reverse","indeterminate","striped"])]),default:pe(()=>[Ct("p",Jde,ts(t.error?t.error:r.display(t.evaluation)),1)]),_:1})}const bD=ks(Qde,[["render",ehe]]),the={props:{fen:{type:String,required:!0}},data:()=>({theme:un("theme")}),methods:{loadPiece:va,pieceToString(t){let e;switch(t.role){case"pawn":e="P";break;case"knight":e="N";break;case"bishop":e="B";break;case"rook":e="R";break;case"queen":e="Q";break;case"king":e="K";break}return t.color.charAt(0)+e},roleToNumber(t){return["k","q","r","b","n","p"].indexOf(t.toLowerCase())},pieces(){const t=o=>new tc(o).board().flat().reduce((r,i)=>{if(!i)return r;const a=`${i.color}${i.type.toUpperCase()}`,l=r.find(c=>c.id[1]===a[1]);return l?l.id[0]===a[0]?l.count+=1:l.count-=1:r.push({id:a,count:1}),r},[]),e=t(this.fen),n=t();return e.map(o=>{const r=n.find(i=>i.id===o.id);return r?{...o,count:o.count-r.count}:o}).map(o=>o.count<0?{id:o.id[0]==="w"?`b${o.id[1]}`:`w${o.id[1]}`,count:-o.count}:o).filter(o=>o.count>0)},displayPieces(){return this.pieces().sort((t,e)=>t.id[0]===e.id[0]?this.roleToNumber(t.id[1])-this.roleToNumber(e.id[1]):t.id[0].localeCompare(e.id[0]))}}};function nhe(t,e,n,s,o,r){return r.displayPieces().length?(We(),ht(Ds,{key:0,"max-width":"400px"},{default:pe(()=>[I(so,null,{default:pe(()=>[gt("Materialunterschied")]),_:1}),I(Io,{class:"mt-n4"},{default:pe(()=>[I(Md,{"no-gutters":""},{default:pe(()=>[(We(!0),es(ot,null,Mf(r.displayPieces(),i=>(We(),ht(tn,{cols:"2",key:i},{default:pe(()=>[I(aR,{color:"primary",dark:"",class:"mb-n12 mt-0 pt-0"},{default:pe(()=>[gt(ts(i.count),1)]),_:2},1024),I(Fd,{src:r.loadPiece(i.id,t.theme),"aspect-ratio":"1",class:"ma-0 pa-0 piece"},null,8,["src"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):Cn("",!0)}const she=ks(the,[["render",nhe],["__scopeId","data-v-56967005"]]),ohe={name:"FenDialog",data:()=>({fen:"",error:void 0,valid:!1,cg:null,chess:null}),emits:["done"],mounted(){const t={fen:this.fen,viewOnly:!0,coordinates:!1,resizable:!1,addPieceZIndex:!0,highlight:{check:!0}};this.chess=new tc(this.fen),this.cg=Nm(this.$refs.board,t)},methods:{save(){this.$emit("done",this.fen)}},watch:{fen(t,e){try{let n=this.chess.load(t)}catch{}this.cg.set({fen:t}),this.error=void 0}}};const rhe={ref:"board",id:"chessground-fen-input"};function ihe(t,e,n,s,o,r){return We(),ht(Ds,{"max-width":"600px"},{default:pe(()=>[I(so,null,{default:pe(()=>[gt("Gib eine FEN ein")]),_:1}),I(Io,null,{default:pe(()=>[I(ou,{modelValue:t.fen,"onUpdate:modelValue":e[0]||(e[0]=i=>t.fen=i),label:"FEN",error:t.error!=null,"error-messages":t.error},null,8,["modelValue","error","error-messages"]),Ct("div",rhe,null,512)]),_:1}),I(v0,null,{default:pe(()=>[I(nu),I(us,{size:"large",color:"primary",onClick:r.save,disabled:this.error!=null},{default:pe(()=>[gt("Speichern")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})}const ahe=ks(ohe,[["render",ihe]]),lhe={name:"Autoencoder",data:()=>({model:null,cg:null,calculatedFen:null,show:un("show"),deltasShown:!1}),components:{PercentageDial:VR,Evaluation:bD},props:{fen:{type:String,required:!0}},created(){Toe(un("autoencoderModelName")).then(t=>{this.model=t,this.update()})},mounted(){const t={viewOnly:!0,coordinates:!0,resizable:!1,addPieceZIndex:!0,highlight:{check:!0}};this.cg=Nm(this.$refs.boardauto,t)},watch:{fen(){this.update()}},methods:{update(){if(!this.model)return;const t=Em(this.fen),e=this.model.predict(t),n=Hde(e);this.calculatedFen=n,this.cg.set({fen:this.calculatedFen}),this.showDeltas()},showDeltas(){if(this.deltasShown){this.deltasShown=!1,this.cg.setShapes([]);return}this.deltasShown=!0;let t=lu(this.fen);this.cg.setShapes(this.fenDifference.deltas.map(e=>({orig:e,brush:"red",piece:t.get(e)})))}},computed:{fenDifference(){return this.fen==null||this.calculatedFen==null?{ratio:0,deltas:[]}:jde(this.fen,this.calculatedFen)},correctness(){return 1-this.fenDifference.ratio}}};const che={class:"text-body-2"},uhe={ref:"boardauto",id:"chessground-autoencoder"};function dhe(t,e,n,s,o,r){const i=Ln("PercentageDial"),a=Ln("Evaluation");return We(),ht(Ds,null,{default:pe(()=>[I(so,null,{default:pe(()=>[gt(" Autoenkodierung "),Ct("p",che,[gt(" Ausgabegenauigkeit: "),I(i,{value:r.correctness},null,8,["value"]),I(us,{icon:t.deltasShown?"mdi-eye-off-outline":"mdi-eye-outline",onClick:r.showDeltas,onBlur:e[0]||(e[0]=l=>t.deltasShown&&r.showDeltas),color:t.deltasShown?"white":void 0,variant:"plain",class:"mb-0"},null,8,["icon","onClick","color"])])]),_:1}),I(Io,null,{default:pe(()=>[Ct("div",uhe,null,512),t.calculatedFen&&t.show.evaluation?(We(),ht(a,{key:0,fen:t.calculatedFen+" w KQkq - 0 1",class:"mt-4"},null,8,["fen"])):Cn("",!0)]),_:1})]),_:1})}const hhe=ks(lhe,[["render",dhe],["__scopeId","data-v-2252e1af"]]);function Ga(t){if(typeof t!="string"){const n=Wt.get(t.from);n&&n.type==="p"&&(t.to[1]==="1"||t.to[1]==="8")&&(t.promotion="q")}let e;try{e=Wt.move(t),Wt.undo()}catch{return null}return e}function fhe(t,e){return $f(e>=0&&e<=1),e=(s=>-(2/(Math.pow(s,1.8)-2))-1)(e),$f(e>=0&&e<=1),e<.5?phe(t,(.5-e)*2):mhe(t,(e-.5)*2)}function phe(t,e){$f(e>=0&&e<=1);const n=[1,...Array(t.length-1).fill(0)];return t.map((s,o)=>s*(1-e)+n[o]*e)}function mhe(t,e){$f(e>=0&&e<=1);const n=Array(t.length).fill(1/t.length);return t.map((s,o)=>s*(1-e)+n[o]*e)}function $f(t){if(!t)throw new Error("Assertion failed")}const ghe={components:{MoveDisplay:mue,GameOver:$ue,Continuation:Zde,Evaluation:bD,CapturedPieces:she,FenDialog:ahe,Autoencoder:hhe},created(){K_(un("playModelName"),{onProgress:(t=>{this.modelLoadProgress=t}).bind(this)}).then(t=>this.model=t).then(this.update)},data:()=>({message:"Hello World!",event:0,model:null,modelLoadProgress:void 0,moves:[],legals:-1,board:null,capturedPieces:[],autoPlay:un("autoPlay"),show:un("show"),gameOver:!1,fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",fenDialog:!1}),mounted(){const t={autoCastle:!0,movable:{free:!1},events:{move:(s,o,r)=>{if(this.gameOver)return;const i=Ga({from:s,to:o});if(i){try{Wt.move(i)}catch{}this.update()}r&&this.capturedPieces.push(r)}},highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:500},orientation:un("orientation")};if(!(this.$refs.board instanceof HTMLElement))throw new Error("Board ref is not an HTMLElement");this.board=Nm(this.$refs.board,t),this.event=qce(s=>{this.board.set({fen:s.fen()}),this.update()});const e=document.createElement("style");e.id="pieceStyle";const n=un("theme");for(const[s,o]of[["pawn","P"],["knight","N"],["bishop","B"],["rook","R"],["queen","Q"],["king","K"]])for(const[r,i]of[["white","w"],["black","b"]]){const a=va(`${i}${o}`,n);e.innerHTML+=`.cg-wrap piece.${s}.${r} { background-image: url("${a}"); }`}document.head.appendChild(e),document.addEventListener("keyup",s=>{if(s.key!=="f")return!0;this.fenDialog=!0})},beforeUnmount(){Xce(this.event);const t=document.getElementById("pieceStyle");t&&t.remove()},methods:{pieceTheme(t){return va(t)},update(){const t=new Map;for(const n of Wt.moves({verbose:!0})){if(typeof n=="string")throw new Error("move is string");t.get(n.from)===void 0&&t.set(n.from,[]),t.get(n.from).push(n.to)}this.fen=Wt.fen();const e={fen:Wt.fen(),movable:{free:!1,dests:t}};this.board.set(e),this.updateMoves(),Wt.isGameOver()&&setTimeout(()=>{this.gameOver=!0},100)},updateMoves(){if(this.model===null)return;const t=Wt.fen(),e=this.model.predict(Em(t));let n=vD(e);const{maxMoves:s,onlyShowLegalMoves:o}=sI();let r=500,i=[];for(;i.length<s&&r<=1e4;)i=n.slice(0,r).map((u,d)=>({...u,inner:Ga(u),index:d+1})),r*=10;const a=Wt.turn();!Wt.isGameOver()&&(this.autoPlay.black&&a==="b"||this.autoPlay.white&&a==="w")?setTimeout(()=>{let u=this.assignProbabilities(i),d=this.chooseMove(u);try{Wt.move(d)}catch{}this.board.move(d.from,d.to),this.update()},100):this.moves=i;const c=i.filter(u=>u.inner!==null).reduce((u,d)=>u+d.act,0);this.legals=c},assignProbabilities(t){const e=un("temperature"),n=fhe(t.map(s=>s.act),e);return t.map((s,o)=>Object.assign({},s,{prob:n[o]}))},chooseMove(t,e=20){if(e<=0)return this.fallbackChooseMove(t);let n=Math.random(),s=null;t=t.filter(r=>Ga(r)!=null);const o=t.reduce((r,i)=>r+i.prob,0);t=t.map(r=>Object.assign({},r,{prob:r.prob/o}));for(const r of t)if(n<r.prob){s=r;break}else n-=r.prob;return s==null?this.chooseMove(t,e-1):Ga(s)==null?this.chooseMove(t,e-.1):s},fallbackChooseMove(t){return console.log("fallback"),t.filter(e=>Ga(e)!=null)[0]},moveToShape(t,e){let n=e===0?"blue":"paleBlue";Ga(t)==null&&(n=e===0?"red":"paleRed");const s=o=>25*Math.pow(o,2/5)+1;return{orig:t.from,dest:t.to,brush:n,modifiers:{lineWidth:s(t.act)}}},suggestMove(t){if(!t){this.board.setShapes([]);return}this.board.setShapes([this.moveToShape(t)])},showAll(){this.board.setShapes(this.moves.filter(t=>t.act>.01).map(this.moveToShape))},newGame(){this.gameOver=!1,this.board.set({lastMove:void 0})},getNewFen(t){console.log(t),this.fenDialog=!1,this.fen=t,Zce(t)}}};const vhe={ref:"board",id:"chessground-main"},bhe={key:0},yhe={key:1};function xhe(t,e,n,s,o,r){const i=Ln("Evaluation"),a=Ln("GameOver"),l=Ln("MoveDisplay"),c=Ln("Continuation"),u=Ln("Autoencoder"),d=Ln("CapturedPieces"),h=Ln("FenDialog");return We(),es("div",null,[I(Md,{class:"main-grid"},{default:pe(()=>[I(tn,{cols:"12",sm:"8",md:"6",lg:"4"},{default:pe(()=>[Ct("div",vhe,null,512),t.show.evaluation&&!t.gameOver?(We(),ht(i,{key:0,fen:t.fen,class:"mt-4"},null,8,["fen"])):Cn("",!0)]),_:1}),t.show.neuralOutput||t.gameOver?(We(),ht(tn,{key:0,cols:"12",sm:"4",lg:"3"},{default:pe(()=>[t.gameOver?(We(),es("div",bhe,[I(a,{onNew:r.newGame},null,8,["onNew"])])):t.show.neuralOutput&&!t.gameOver?(We(),es("div",yhe,[t.model?(We(),ht(l,{key:0,moves:t.moves,legals:t.legals,onSuggest:r.suggestMove,onShowAll:r.showAll},null,8,["moves","legals","onSuggest","onShowAll"])):(We(),ht(Ds,{key:1,"max-width":"300px"},{default:pe(()=>[I(so,null,{default:pe(()=>[gt("Lade Modell...")]),_:1}),I(Io,null,{default:pe(()=>[I(Sm,{size:50,width:6,max:"1","model-value":t.modelLoadProgress*100,indeterminate:t.modelLoadProgress==null},null,8,["model-value","indeterminate"]),t.modelLoadProgress?(We(),ht(Ds,{key:0},{default:pe(()=>[I(so,null,{default:pe(()=>[gt(ts(Math.round(t.modelLoadProgress*1e4)/100)+"%",1)]),_:1})]),_:1})):Cn("",!0)]),_:1})]),_:1}))])):Cn("",!0)]),_:1})):Cn("",!0),t.show.continuation&&t.model&&!t.gameOver?(We(),ht(tn,{key:1,cols:"12",sm:"4",lg:"3"},{default:pe(()=>[Ct("div",null,[(We(),ht(c,{fen:t.fen,key:t.fen},null,8,["fen"]))])]),_:1})):Cn("",!0),t.show.autoencoder?(We(),ht(tn,{key:2,cols:"12",sm:"4",lg:"3"},{default:pe(()=>[Ct("div",null,[I(u,{fen:t.fen},null,8,["fen"])])]),_:1})):Cn("",!0),t.show.capturedPieces&&!t.gameOver?(We(),ht(tn,{key:3,cols:"6",sm:"4",lg:"3"},{default:pe(()=>[I(d,{fen:t.fen,class:"mt-2"},null,8,["fen"])]),_:1})):Cn("",!0),I(IR,{modelValue:t.fenDialog,"onUpdate:modelValue":e[0]||(e[0]=f=>t.fenDialog=f)},{default:pe(()=>[I(h,{onDone:r.getNewFen},null,8,["onDone"])]),_:1},8,["modelValue"])]),_:1})])}const whe=ks(ghe,[["render",xhe]]),Che={name:"HomeView",components:{Main:whe}};function khe(t,e,n,s,o,r){const i=Ln("Main");return We(),es("div",null,[I(i)])}const She=ks(Che,[["render",khe]]),Ihe=Rce({history:qle("/jufo2023/"),routes:[{path:"/",name:"home",component:She}]});const Hv={"001":1,AD:1,AE:6,AF:6,AG:0,AI:1,AL:1,AM:1,AN:1,AR:1,AS:0,AT:1,AU:1,AX:1,AZ:1,BA:1,BD:0,BE:1,BG:1,BH:6,BM:1,BN:1,BR:0,BS:0,BT:0,BW:0,BY:1,BZ:0,CA:0,CH:1,CL:1,CM:1,CN:1,CO:0,CR:1,CY:1,CZ:1,DE:1,DJ:6,DK:1,DM:0,DO:0,DZ:6,EC:1,EE:1,EG:6,ES:1,ET:0,FI:1,FJ:1,FO:1,FR:1,GB:1,"GB-alt-variant":0,GE:1,GF:1,GP:1,GR:1,GT:0,GU:0,HK:0,HN:0,HR:1,HU:1,ID:0,IE:1,IL:0,IN:0,IQ:6,IR:6,IS:1,IT:1,JM:0,JO:6,JP:0,KE:0,KG:1,KH:0,KR:0,KW:6,KZ:1,LA:0,LB:1,LI:1,LK:1,LT:1,LU:1,LV:1,LY:6,MC:1,MD:1,ME:1,MH:0,MK:1,MM:0,MN:1,MO:0,MQ:1,MT:0,MV:5,MX:0,MY:1,MZ:0,NI:0,NL:1,NO:1,NP:0,NZ:1,OM:6,PA:0,PE:0,PH:0,PK:0,PL:1,PR:0,PT:0,PY:0,QA:6,RE:1,RO:1,RS:1,RU:1,SA:0,SD:6,SE:1,SG:0,SI:1,SK:1,SM:1,SV:0,SY:6,TH:0,TJ:1,TM:1,TR:1,TT:0,TW:0,UA:1,UM:0,US:0,UY:1,UZ:1,VA:1,VE:0,VI:0,VN:1,WS:0,XK:1,YE:0,ZA:0,ZW:0};function $he(t,e){const n=[];let s=[];const o=yD(t),r=xD(t),i=(o.getDay()-Hv[e.slice(-2).toUpperCase()]+7)%7,a=(r.getDay()-Hv[e.slice(-2).toUpperCase()]+7)%7;for(let l=0;l<i;l++){const c=new Date(o);c.setDate(c.getDate()-(i-l)),s.push(c)}for(let l=1;l<=r.getDate();l++){const c=new Date(t.getFullYear(),t.getMonth(),l);s.push(c),s.length===7&&(n.push(s),s=[])}for(let l=1;l<7-a;l++){const c=new Date(r);c.setDate(c.getDate()+l),s.push(c)}return n.push(s),n}function yD(t){return new Date(t.getFullYear(),t.getMonth(),1)}function xD(t){return new Date(t.getFullYear(),t.getMonth()+1,0)}function The(t){const e=t.split("-").map(Number);return new Date(e[0],e[1]-1,e[2])}const Nhe=/([12]\d{3}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01]))/;function Ehe(t){if(t==null)return new Date;if(t instanceof Date)return t;if(typeof t=="string"){let e;if(Nhe.test(t))return The(t);if(e=Date.parse(t),!isNaN(e))return new Date(e)}return null}const jk=new Date(2e3,0,2);function _he(t){const e=Hv[t.slice(-2).toUpperCase()];return gm(7).map(n=>{const s=new Date(jk);return s.setDate(jk.getDate()+e+n),new Intl.DateTimeFormat(t,{weekday:"narrow"}).format(s)})}function Ahe(t,e,n){const s=new Date(t);let o={};switch(e){case"fullDateWithWeekday":o={weekday:"long",day:"numeric",month:"long",year:"numeric"};break;case"normalDateWithWeekday":o={weekday:"short",day:"numeric",month:"short"};break;case"keyboardDate":o={};break;case"monthAndDate":o={month:"long",day:"numeric"};break;case"monthAndYear":o={month:"long",year:"numeric"};break;case"dayOfMonth":o={day:"numeric"};break;case"shortDate":o={year:"numeric"};break;default:o={timeZone:"UTC",timeZoneName:"short"}}return new Intl.DateTimeFormat(n,o).format(s)}function Rhe(t,e){const n=t.toJsDate(e),s=n.getFullYear(),o=$C(String(n.getMonth()+1),2,"0"),r=$C(String(n.getDate()),2,"0");return`${s}-${o}-${r}`}function Dhe(t){const[e,n,s]=t.split("-").map(Number);return new Date(e,n-1,s)}function Fhe(t,e){const n=new Date(t);return n.setDate(n.getDate()+e),n}function Ohe(t,e){const n=new Date(t);return n.setMonth(n.getMonth()+e),n}function Phe(t){return t.getFullYear()}function Mhe(t){return t.getMonth()}function Lhe(t){return new Date(t.getFullYear(),0,1)}function Bhe(t){return new Date(t.getFullYear(),11,31)}function Vhe(t,e){return jv(t,e[0])&&Whe(t,e[1])}function zhe(t){if(!t||t==null)return!1;const e=new Date(t);return e instanceof Date&&!isNaN(e.getTime())}function jv(t,e){return t.getTime()>e.getTime()}function Whe(t,e){return t.getTime()<e.getTime()}function Kk(t,e){return t.getTime()===e.getTime()}function Uhe(t,e){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}function Ghe(t,e){return t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}function Hhe(t,e,n){const s=new Date(t),o=new Date(e);return n==="month"?s.getMonth()-o.getMonth()+(s.getFullYear()-o.getFullYear())*12:Math.floor((s.getTime()-o.getTime())/(1e3*60*60*24))}function jhe(t,e){const n=new Date(t);return n.setFullYear(e),n}function Khe(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate())}function qhe(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999)}class Xhe{constructor(e){this.locale=e.locale}date(e){return Ehe(e)}toJsDate(e){return e}toISO(e){return Rhe(this,e)}parseISO(e){return Dhe(e)}addDays(e,n){return Fhe(e,n)}addMonths(e,n){return Ohe(e,n)}getWeekArray(e){return $he(e,this.locale)}startOfMonth(e){return yD(e)}endOfMonth(e){return xD(e)}format(e,n){return Ahe(e,n,this.locale)}isEqual(e,n){return Kk(e,n)}isValid(e){return zhe(e)}isWithinRange(e,n){return Vhe(e,n)}isAfter(e,n){return jv(e,n)}isBefore(e,n){return!jv(e,n)&&!Kk(e,n)}isSameDay(e,n){return Uhe(e,n)}isSameMonth(e,n){return Ghe(e,n)}setYear(e,n){return jhe(e,n)}getDiff(e,n,s){return Hhe(e,n,s)}getWeekdays(){return _he(this.locale)}getYear(e){return Phe(e)}getMonth(e){return Mhe(e)}startOfDay(e){return Khe(e)}endOfDay(e){return qhe(e)}startOfYear(e){return Lhe(e)}endOfYear(e){return Bhe(e)}}const qk=Symbol.for("vuetify:date-adapter");function Yhe(t){return Zs({adapter:Xhe,locale:{af:"af-ZA",bg:"bg-BG",ca:"ca-ES",ckb:"",cs:"",de:"de-DE",el:"el-GR",en:"en-US",et:"et-EE",fa:"fa-IR",fi:"fi-FI",hr:"hr-HR",hu:"hu-HU",he:"he-IL",id:"id-ID",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lv:"lv-LV",lt:"lt-LT",nl:"nl-NL",no:"no-NO",pl:"pl-PL",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",sl:"sl-SI",srCyrl:"sr-SP",srLatn:"sr-SP",sv:"sv-SE",th:"th-TH",tr:"tr-TR",az:"az-AZ",uk:"uk-UA",vi:"vi-VN",zhHans:"zh-CN",zhHant:"zh-TW"}},t)}function wD(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:e,...n}=t,s=Zs(e,n),{aliases:o={},components:r={},directives:i={}}=s,a=dre(s.defaults),l=Jre(s.display,s.ssr),c=Cre(s.theme),u=bre(s.icons),d=Lre(s.locale),h=Yhe(s.date);return{install:p=>{for(const m in i)p.directive(m,i[m]);for(const m in r)p.component(m,r[m]);for(const m in o)p.component(m,Zl({...o[m],name:m,aliasName:o[m].name}));if(c.install(p),p.provide(Il,a),p.provide(Ev,l),p.provide(mf,c),p.provide($v,u),p.provide(gf,d),p.provide(qk,h),zt&&s.ssr)if(p.$nuxt)p.$nuxt.hook("app:suspense:resolve",()=>{l.update()});else{const{mount:m}=p;p.mount=function(){const g=m(...arguments);return gn(()=>l.update()),p.mount=m,g}}Ps.reset(),p.mixin({computed:{$vuetify(){return Jn({defaults:Ha.call(this,Il),display:Ha.call(this,Ev),theme:Ha.call(this,mf),icons:Ha.call(this,$v),locale:Ha.call(this,gf),date:Ha.call(this,qk)})}}})},defaults:a,display:l,theme:c,icons:u,locale:d,date:h}}const Zhe="3.3.22";wD.version=Zhe;function Ha(t){var s,o,r;const e=this.$,n=(r=(s=e.parent)==null?void 0:s.provides)!=null?r:(o=e.vnode.appContext)==null?void 0:o.provides;if(n&&t in n)return n[t]}const Qhe=wD({theme:{defaultTheme:"dark"}}),Jhe="modulepreload",efe=function(t){return"/jufo2023/"+t},Xk={},tfe=function(e,n,s){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=efe(r),r in Xk)return;Xk[r]=!0;const i=r.endsWith(".css"),a=i?'[rel="stylesheet"]':"";if(!!s)for(let u=o.length-1;u>=0;u--){const d=o[u];if(d.href===r&&(!i||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":Jhe,i||(c.as="script",c.crossOrigin=""),c.href=r,document.head.appendChild(c),i)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())};async function nfe(){await tfe(()=>import("./webfontloader.b777d690.js").then(t=>t.w),[])}function sfe(t){if(t=Math.trunc(t)||0,t<0&&(t+=this.length),!(t<0||t>=this.length))return this[t]}const ofe=Reflect.getPrototypeOf(Int8Array);for(const t of[Array,String,ofe])Object.defineProperty(t.prototype,"at",{value:sfe,writable:!0,enumerable:!1,configurable:!0});nfe();tP(_le).use(Ihe).use(Qhe).mount("#app");
